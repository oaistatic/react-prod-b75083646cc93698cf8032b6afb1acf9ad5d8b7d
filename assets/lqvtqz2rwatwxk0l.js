import{r,e as E,j as e,M as p}from"./lu2xqwqmjc95q6j6.js";import{mB as k,ei as R}from"./rseqzngxzbdt1oxg.js";import{d as h,B as D,eW as z,aB as L,n as W,bg as H,c6 as K}from"./hml6mmd5fyx85si7.js";import{C as U,S as $,i as q,g as G,D as J,N as Q}from"./msab1t9ew5jwzw5m.js";import{i as X}from"./d0g29t0qm74gluj7.js";import{F as Y}from"./lw1kjinrctt8cogu.js";import{k as Z}from"./ktoofw7mjru0a6r5.js";function V({filePath:t,side:i,lineNumber:m,onSubmit:c,onDelete:x,onClose:u,initialComment:o}){const g=o?T(o):"",[l,b]=r.useState(o?T(o):""),[w,d]=r.useState(!o),[F,j]=r.useState(!1),y=r.useRef(null),v=E(),N=()=>{if(!l)return;const a=o?{...o,content:[{content_type:"text",text:l}]}:{id:crypto.randomUUID(),type:"comment",content:[{content_type:"text",text:l}],position:{side:i===$.old?"left":"right",path:t,line:m}};c?.(a),d(!1),y.current?.blur(),u?.()};return r.useEffect(()=>{!F&&o&&l===g&&setTimeout(()=>{d(!1)},100),F&&(d(!0),y.current?.focus())},[F,o,l,g]),e.jsx("div",{className:"gap-2 bg-gray-100/50 p-4 font-sans dark:bg-gray-900",id:o?.id,children:e.jsxs("div",{className:h("flex flex-col gap-2",U),children:[e.jsx(X,{ref:y,className:"border-token-border-medium bg-token-main-surface-primary text-token-text-primary border-1.5 w-full resize-none rounded-lg p-4 text-sm ring-0 focus:border-black focus:outline-hidden dark:focus:border-white","data-wham-comment-textarea":!0,onFocus:()=>j(!0),onBlur:()=>j(!1),placeholder:v.formatMessage({id:"code.diff.addComment",defaultMessage:"Add a comment"}),minRows:1,maxRows:10,autoFocus:!o,onSubmit:()=>{},value:l,onChange:a=>b(a.target.value),onKeyDown:a=>{a.key==="Enter"&&a.metaKey&&(a.preventDefault(),N()),a.key==="Escape"&&(a.preventDefault(),u?.())}}),w&&e.jsxs("div",{className:h("mt-2 flex items-center justify-between gap-2",!x&&"justify-end"),children:[x&&e.jsx(D,{color:"danger",onClick:()=>x?.(),children:e.jsx(p,{id:"code.diffComment.delete",defaultMessage:"Delete"})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(D,{color:"secondary",onClick:()=>{u?.(),d(!1),o&&b(T(o))},children:e.jsx(p,{id:"code.diffComment.cancel",defaultMessage:"Cancel"})}),e.jsx(D,{color:"primary",disabled:!l,onClick:N,children:o?e.jsx(p,{id:"code.diffComment.save",defaultMessage:"Save"}):e.jsx(p,{id:"code.diffComment.comment",defaultMessage:"Comment"})})]})]})]})})}function T(t){return t.content.map(i=>i.content_type==="text"?i.text:"").join("")}function ee({copyDiffToClipboard:t,copyPatchToClipboard:i}){const[m,c]=r.useState(!1),x=E(),u=o=>g=>{g.preventDefault(),g.stopPropagation(),o==="diff"?t():i()};return e.jsxs(z,{open:m,onOpenChange:c,contentAlign:"end",sideOffset:8,modal:!0,triggerButton:e.jsx("button",{type:"button",onClick:o=>{o.preventDefault(),o.stopPropagation(),c(!0)},className:"hover:bg-token-border-light rounded p-1","aria-label":x.formatMessage({id:"wham.copyFileActionDropdown.openMenu",defaultMessage:"Open copy menu"}),children:e.jsx(k,{className:"icon"})}),children:[e.jsx(L.Item,{icon:k,onClick:u("diff"),children:e.jsx(p,{id:"wham.copyFile.apply",defaultMessage:"Copy git apply"})}),e.jsx(L.Item,{icon:k,onClick:u("patch"),children:e.jsx(p,{id:"wham.copyFile.patch",defaultMessage:"Copy patch"})})]})}const te="_diffView_avtz7_1",oe={diffView:te},S="wham-toggle-all-diffs";function se(t){return r.useEffect(()=>{function i(m){t(m.detail.open)}return window.addEventListener(S,i),()=>{window.removeEventListener(S,i)}},[t]),r.useCallback(i=>{window.dispatchEvent(new CustomEvent(S,{detail:{open:i}}))},[])}function ce({diff:t,viewType:i,stickyHeader:m,enableComments:c=!1,comments:x,buttonClassName:u,onCommentCreate:o,onCommentDelete:g,onCommentUpdate:l}){const b=W(),w=E(),[d,F]=r.useState(()=>!q(t.diffFile)),[j,y]=r.useState(!1),v=H(),N=se(F);r.useEffect(()=>{t.diffFile.initTheme(b?"dark":"light")},[t.diffFile,b]);const a=(x??[]).reduce((s,n)=>{const f=n.position.path,_=n.position.side,M=n.position.line;s[f]||(s[f]={oldFile:{},newFile:{}});const B=_==="left"?s[f].oldFile:s[f].newFile;return B&&(B[M]={data:n}),s},{}),C=G(t.diffFile),O=()=>{const s=t.diffFile._newFileName===Q?t.diffFile._oldFileName:t.diffFile._newFileName;navigator.clipboard.writeText(s),y(!0),setTimeout(()=>{y(!1)},1e3)},A=async()=>{t.hunksText&&(await navigator.clipboard.writeText(` (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
${t.hunksText} 
EOF
)`),v.success(w.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}))},I=async()=>{t.hunksText&&(await navigator.clipboard.writeText(t.hunksText),v.success(w.formatMessage({id:"wham.codeDiff.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}))},P=!t.diffFile.unifiedLineLength&&!t.diffFile.splitLineLength;return e.jsxs("div",{"data-diff-header":C,className:h("flex flex-col pt-1",oe.diffView),children:[e.jsx("div",{role:"button",onClick:s=>{const n=!d;s.altKey?N(n):F(n)},className:h("focus-visible:outline-none",m&&"sticky top-0 z-1",u),children:e.jsxs("div",{className:h("bg-token-bg-primary border-token-border-default relative flex items-center rounded-t-2xl border px-4 py-3 text-sm font-medium before:absolute before:inset-x-[-1px] before:top-[-1px] before:bottom-0 before:z-[-1] before:bg-[var(--right-bg)] before:content-['']",!d&&"rounded-b-2xl"),children:[e.jsx(R,{className:h("icon me-3 transition-transform duration-200",d&&"rotate-90")}),e.jsx("span",{className:"me-1 truncate text-start select-text",title:C,children:C}),e.jsx(Y,{diffFile:t.diffFile}),e.jsx(K,{label:w.formatMessage({id:"wham.codeDiff.copiedFileName",defaultMessage:"Copied File Name"}),open:j,children:e.jsx("div",{role:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),O()},className:"hover:bg-token-border-light rounded p-1","aria-label":w.formatMessage({id:"wham.codeDiff.copyFileName",defaultMessage:"Copy file name"}),children:e.jsx(k,{className:"icon-xs"})})}),e.jsxs("div",{className:"ms-auto flex items-center gap-1 ps-1",children:[e.jsx(Z,{linesAdded:t.diffFile.additionLength,linesRemoved:t.diffFile.deletionLength}),!t.isBinary&&e.jsx(ee,{copyDiffToClipboard:A,copyPatchToClipboard:I})]})]})}),d&&(P||t.isBinary?e.jsx("div",{className:"text-token-text-secondary bg-token-bg-secondary flex h-full justify-center rounded-b-2xl py-4 text-sm font-medium",children:t.isBinary?e.jsx(p,{id:"wham.diff.binaryFile",defaultMessage:"Binary file not shown"}):e.jsx(p,{id:"wham.diff.noContent",defaultMessage:"No content"})}):e.jsx(J,{className:h("relative overflow-clip rounded-b-2xl transition-opacity duration-300","after:border-token-border-default after:pointer-events-none after:absolute after:inset-0 after:rounded-b-2xl after:border-s after:border-e after:border-b after:content-['']"),diffViewFontSize:12,diffFile:t.diffFile,diffViewTheme:b?"dark":"light",diffViewHighlight:!0,diffViewMode:i==="split"?3:4,diffViewWrap:!0,diffViewAddWidget:c,extendData:a[t.diffFile._newFileName],renderExtendLine:({lineNumber:s,side:n,data:f})=>!c||!(n===1?a[t.diffFile._newFileName]?.oldFile:a[t.diffFile._newFileName]?.newFile)?null:e.jsx(V,{initialComment:f,onSubmit:M=>l?.(M),onDelete:()=>g?.(f),filePath:t.diffFile._newFileName,side:n,lineNumber:s}),renderWidgetLine:({onClose:s,lineNumber:n,side:f})=>!c||!o?null:e.jsx(V,{onSubmit:o,onClose:s,filePath:t.diffFile._newFileName,side:f,lineNumber:n})}))]})}export{ce as C};
//# sourceMappingURL=lqvtqz2rwatwxk0l.js.map
