const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dzirgccz3aal4v9u.js","assets/lu2xqwqmjc95q6j6.js","assets/hml6mmd5fyx85si7.js","assets/root-c0w5lvnh.css","assets/rseqzngxzbdt1oxg.js","assets/conversation-small-gcvo4yhm.css","assets/e0cf2nztzmm3evd7.js","assets/l29qldloj3xqr7yu.js","assets/fzrn137102spawew.js","assets/dq9j3pioxqah4sfs.js","assets/kyavoy07nhuntf5e.js","assets/nhs24pb9s8hnfshq.js","assets/ktoofw7mjru0a6r5.js","assets/fsu81ov1h2xmh0dx.js","assets/blhqqdzhd9z6fst7.js","assets/dth89wjzf9gy8rh3.js","assets/lqvtqz2rwatwxk0l.js","assets/msab1t9ew5jwzw5m.js","assets/eywlrsjhpmu02zoa.js","assets/itjugg22bqh0ueps.js","assets/ansi-1f6vhsjh.css","assets/kkw9h7dq0af4udcb.js","assets/e3c6g208bapx5eab.js","assets/d8r48c27g352nr7t.js","assets/dp7t1jmnbbend843.js","assets/99iw5y145xpdn59x.js","assets/fi4t5vltimyk5jia.js","assets/parse-diff-iz0raby8.css","assets/d0g29t0qm74gluj7.js","assets/d7o4nful0h1qw8zk.js","assets/lw1kjinrctt8cogu.js","assets/code-diff-krvv6lyt.css","assets/n0u5fqw2jde51umw.js","assets/kwjkd9zyf9vouy1r.js","assets/dc45v808kg6x38y7.js"])))=>i.map(i=>d[i]);
import{e as R,l as Gt,r as C,n as ut,j as o,M as B,a as dt,A as ht,u as Kt,d as Vt}from"./lu2xqwqmjc95q6j6.js";import{a as re,c as Z,bg as mt,B as W,G as xe,ea as qt,c6 as J,k2 as zt,dc as ft,bw as ke,le as Qt,o$ as Le,gP as fe,dU as Oe,p as Xt,bl as Ut,d as Se,h0 as Yt,g0 as Zt,o_ as Jt,C as es,ap as ts,aq as ss,R as ns,bO as rs,fJ as os,ld as Ye,lt as as,iV as de,an as is,fE as cs,e9 as ls,df as q,de as Ze,qf as us,fB as be,jm as Je,Q as he,qd as ds,fF as hs}from"./hml6mmd5fyx85si7.js";import{ot as ms,o3 as gt,p_ as fs,eg as gs,p$ as ps,ea as pt,a3 as xs,q0 as Fe,ey as ne,ez as xt,oK as Cs,h8 as vs,b1 as Ct,lL as Ms,q1 as ws,q2 as Es,q3 as As,q4 as bs,q5 as et,q6 as ys,q7 as ks,lr as Ss,q8 as Fs,q9 as js,qa as Bs}from"./rseqzngxzbdt1oxg.js";import{W as K}from"./n0u5fqw2jde51umw.js";import{W as je,h as j,C as vt,M as Ns,S as Ts,H as _s,I as Is,J as Ds,n as Mt,N as Rs,s as Ls,k as Os,j as Ps,l as Ws,m as Hs,f as tt,w as st,F as $s}from"./ktoofw7mjru0a6r5.js";import{C as wt,a as Be,u as Gs,b as Ks,c as Vs,S as nt,s as qs}from"./nhs24pb9s8hnfshq.js";import{u as zs}from"./kwjkd9zyf9vouy1r.js";import{e as Qs}from"./dc45v808kg6x38y7.js";function Xs(){const t=re();return Z(t,"3651421897")}function Us({taskId:t,hasMultipleInProgressOrStreamingTurns:e}){const s=R(),r=mt(),n=Gt(),[a,i]=C.useState(!1),{mutate:c}=ut({mutationFn:async()=>{i(!0),await je.cancelTask(t)},onError:()=>{r.danger(s.formatMessage({id:"wham.whamTaskRow.failedToCancelTask",defaultMessage:"Failed to cancel task"}))},onSuccess:()=>{n.refetchQueries({queryKey:["wham","task",t]}),n.invalidateQueries({queryKey:["wham","tasks"]})}});return o.jsx(W,{color:"primary",type:"button",size:"small",className:e?void 0:"h-9 w-9",icon:a?xe:ms,onClick:()=>(K.recordCancel("task-details"),c()),disabled:a,"aria-label":s.formatMessage({id:"wham.composer.cancelTask",defaultMessage:"Cancel task"}),"data-testid":"stop-button",children:e&&o.jsx(B,{id:"wham.composer.stopButton.multipleInProgressOrStreamingTurns",defaultMessage:"Stop all"})})}function Ys({isSubmitDisabled:t,createTask:e,disabledReason:s}){const r=R(),n=qt(),[a,i]=C.useState(!1);return o.jsxs("div",{className:"flex items-center gap-2",onClick:c=>c.stopPropagation(),children:[o.jsx(J,{open:n?a:void 0,onOpenChange:i,label:s??r.formatMessage({id:"wham.whamComposer.fasterTitle",defaultMessage:"Fast mode where the agent doesn't edit code"}),children:o.jsx(W,{color:"secondary",type:"button",className:n&&t?"opacity-50":"",disabled:t&&!n,onClick:t?()=>i(!0):()=>(K.recordComposerAction("ask"),e({runEnvironmentInQaMode:!0})),children:o.jsx(B,{id:"wham.composer.askButton",defaultMessage:"Ask"})})}),o.jsx(J,{label:s,children:o.jsx(W,{color:"primary",type:"button",className:n&&t?"opacity-50":"",disabled:t&&!n,onClick:t?()=>i(!0):()=>(K.recordComposerAction("code"),e({runEnvironmentInQaMode:!1})),children:o.jsx(B,{id:"wham.composer.codeItButton",defaultMessage:"Code"})})})]})}function Pe(t){const e=R(),s=j(r=>r.getRateLimit()?.resets_after_text);switch(t){case"enabled":return;case"rate-limit":return e.formatMessage({id:"wham.whamComposer.hitRateLimit",defaultMessage:"You have reached your rate limit. It will reset {resetsAfterText}"},{resetsAfterText:s});case"no-environment":return e.formatMessage({id:"wham.whamComposer.noEnvironment",defaultMessage:"No environment selected"});case"no-content":return e.formatMessage({id:"wham.whamComposer.noContent",defaultMessage:"Enter a prompt to continue"});case"no-github-connection":return e.formatMessage({id:"wham.whamComposer.noGitHubConnection",defaultMessage:"No GitHub connection"});case"connect-github-error":return e.formatMessage({id:"wham.whamComposer.connectGitHubError",defaultMessage:"Failed to load environments"});default:zt(t)}}function We({isFollowUp:t,hasComments:e}){const s=j(d=>d.getRateLimit()?.remaining===0),r=j(({environmentId:d})=>d),n=j(({branch:d})=>d),a=ft(),c=!ke(Qt(a))||e,{isConnected:l,error:u}=Le(Oe.GITHUB_CONNECTOR,"github","/codex",fe.CODEX);return s?"rate-limit":!r&&!n&&!t?"no-environment":!t&&!l?"no-github-connection":!t&&u?"connect-github-error":c?"enabled":"no-content"}const Zs=4,Js=t=>{switch(t){case 1:return o.jsx(Ds,{"aria-hidden":!0,className:"icon-sm"});case 2:return o.jsx(Is,{"aria-hidden":!0,className:"icon-sm"});case 3:return o.jsx(_s,{"aria-hidden":!0,className:"icon-sm"});default:return o.jsx(Ts,{"aria-hidden":!0,className:"icon-sm"})}};function en({attempts:t,setAttempts:e}){const s=R(),[r,n]=C.useState(!1),a=C.useRef(null),i=()=>n(!1),c=re(),l=Xt(c,"2179180337").value.max_attempts??Zs;return o.jsx(tn,{children:o.jsxs(gt,{open:r,onOpenChange:n,children:[o.jsx(wt,{triggerText:s.formatMessage({id:"wham.attemptsSelector.trigger",defaultMessage:"{count}x"},{count:t}),toolTip:s.formatMessage({id:"wham.attemptsSelector.tooltip",defaultMessage:"Number of simultaneous versions"}),ariaLabel:s.formatMessage({id:"wham.attemptsSelector.ariaLabel",defaultMessage:"Open versions number selector, currently set to {count}x"},{count:t}),Icon:Js(t),truncate:!1}),o.jsx(vt,{align:"start",isOpen:r,closePopover:i,popoverContentRef:a,children:o.jsx("div",{className:"flex w-50 flex-col rounded-lg p-1.5",children:[...Array(l)].map((u,d)=>o.jsx(Be,{className:"w-full",onClick:()=>{e(d+1),i()},isSelected:t===d+1,label:s.formatMessage({id:"wham.attemptsSelector.option",defaultMessage:"{count, plural, one {# version} other {# versions}}"},{count:d+1})},d+1))})})]})})}function tn({children:t}){const e=R(),s=fs(),r=Ns(),n=s&&!s.isLoading&&s.eligible&&!r.isLoading&&!!r.data;return o.jsx(gs,{side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",show:n,sideOffset:0,className:"w-60",announcementKey:ps,title:e.formatMessage({id:"wham.composerBon.nuxTooltip.title",defaultMessage:"Best-of-N"}),description:e.formatMessage({id:"wham.composerBon.nuxTooltip.description",defaultMessage:"Generate multiple solutions so you can pick the best approach."}),onDismiss:s.markAsViewed,children:t})}function sn({comments:t,onClearComments:e}){const s=R();return t.length===0?null:o.jsxs("div",{className:"bg bg-token-bg-secondary mx-1 mt-1 flex items-center gap-2 rounded-t-3xl rounded-b-lg py-0.5 ps-3 pe-0.5 font-semibold text-blue-400",children:[o.jsx(pt,{className:"icon"}),o.jsx("div",{className:"flex-1 text-sm",children:o.jsx(B,{id:"wham.composer.commentCount",defaultMessage:"{count, plural, one {One code comment} other {# code comments}}",values:{count:t.length}})}),o.jsx("button",{className:"text-token-text-secondary flex h-9 w-9 shrink-0 items-center justify-center",onClick:r=>{r.preventDefault(),r.stopPropagation(),e()},"aria-label":s.formatMessage({id:"wham.composer.clearComments",defaultMessage:"Clear comments"}),children:o.jsx(Ut,{className:"icon"})})]})}const Et=t=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},C.createElement("path",{d:"M18 4C19.6569 4 21 5.34315 21 7V14.5H21.5L21.6025 14.5049C22.1067 14.5562 22.5 14.9823 22.5 15.5V17C22.5 18.6569 21.1569 20 19.5 20H4.5C2.89489 20 1.58421 18.7394 1.50391 17.1543L1.5 17V15.5L1.50488 15.3975C1.55621 14.8933 1.98232 14.5 2.5 14.5H3V7C3 5.34315 4.34315 4 6 4H18ZM3.5 17L3.50488 17.1025C3.55621 17.6067 3.98232 18 4.5 18H19.5C20.0523 18 20.5 17.5523 20.5 17V16.5H3.5V17ZM6 6C5.44772 6 5 6.44772 5 7V14.5H19V7C19 6.44772 18.5523 6 18 6H6Z",fill:"currentColor"}));function At({className:t}){return o.jsx(xs,{className:Se("flex w-[8rem] items-center gap-1.5 rounded-full! md:w-[10rem]",t)})}function H(t){return Array.isArray?Array.isArray(t):kt(t)==="[object Array]"}function nn(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function rn(t){return t==null?"":nn(t)}function O(t){return typeof t=="string"}function bt(t){return typeof t=="number"}function on(t){return t===!0||t===!1||an(t)&&kt(t)=="[object Boolean]"}function yt(t){return typeof t=="object"}function an(t){return yt(t)&&t!==null}function D(t){return t!=null}function ye(t){return!t.trim().length}function kt(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const cn="Incorrect 'index' type",ln=t=>`Invalid value for key ${t}`,un=t=>`Pattern length exceeds max of ${t}.`,dn=t=>`Missing ${t} property in key`,hn=t=>`Property 'weight' in key '${t}' must be a positive integer`,rt=Object.prototype.hasOwnProperty;class mn{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(r=>{let n=St(r);this._keys.push(n),this._keyMap[n.id]=n,s+=n.weight}),this._keys.forEach(r=>{r.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function St(t){let e=null,s=null,r=null,n=1,a=null;if(O(t)||H(t))r=t,e=ot(t),s=Ne(t);else{if(!rt.call(t,"name"))throw new Error(dn("name"));const i=t.name;if(r=i,rt.call(t,"weight")&&(n=t.weight,n<=0))throw new Error(hn(i));e=ot(i),s=Ne(i),a=t.getFn}return{path:e,id:s,weight:n,src:r,getFn:a}}function ot(t){return H(t)?t:t.split(".")}function Ne(t){return H(t)?t.join("."):t}function fn(t,e){let s=[],r=!1;const n=(a,i,c)=>{if(D(a))if(!i[c])s.push(a);else{let l=i[c];const u=a[l];if(!D(u))return;if(c===i.length-1&&(O(u)||bt(u)||on(u)))s.push(rn(u));else if(H(u)){r=!0;for(let d=0,h=u.length;d<h;d+=1)n(u[d],i,c+1)}else i.length&&n(u,i,c+1)}};return n(t,O(e)?e.split("."):e,0),r?s:s[0]}const gn={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},pn={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},xn={location:0,threshold:.6,distance:100},Cn={useExtendedSearch:!1,getFn:fn,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var f={...pn,...gn,...xn,...Cn};const vn=/[^ ]+/g;function Mn(t=1,e=3){const s=new Map,r=Math.pow(10,e);return{get(n){const a=n.match(vn).length;if(s.has(a))return s.get(a);const i=1/Math.pow(a,.5*t),c=parseFloat(Math.round(i*r)/r);return s.set(a,c),c},clear(){s.clear()}}}class He{constructor({getFn:e=f.getFn,fieldNormWeight:s=f.fieldNormWeight}={}){this.norm=Mn(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,r)=>{this._keysMap[s.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,O(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();O(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,r=this.size();s<r;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!D(e)||ye(e))return;let r={v:e,i:s,n:this.norm.get(e)};this.records.push(r)}_addObject(e,s){let r={i:s,$:{}};this.keys.forEach((n,a)=>{let i=n.getFn?n.getFn(e):this.getFn(e,n.path);if(D(i)){if(H(i)){let c=[];const l=[{nestedArrIndex:-1,value:i}];for(;l.length;){const{nestedArrIndex:u,value:d}=l.pop();if(D(d))if(O(d)&&!ye(d)){let h={v:d,i:u,n:this.norm.get(d)};c.push(h)}else H(d)&&d.forEach((h,m)=>{l.push({nestedArrIndex:m,value:h})})}r.$[a]=c}else if(O(i)&&!ye(i)){let c={v:i,n:this.norm.get(i)};r.$[a]=c}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function Ft(t,e,{getFn:s=f.getFn,fieldNormWeight:r=f.fieldNormWeight}={}){const n=new He({getFn:s,fieldNormWeight:r});return n.setKeys(t.map(St)),n.setSources(e),n.create(),n}function wn(t,{getFn:e=f.getFn,fieldNormWeight:s=f.fieldNormWeight}={}){const{keys:r,records:n}=t,a=new He({getFn:e,fieldNormWeight:s});return a.setKeys(r),a.setIndexRecords(n),a}function me(t,{errors:e=0,currentLocation:s=0,expectedLocation:r=0,distance:n=f.distance,ignoreLocation:a=f.ignoreLocation}={}){const i=e/t.length;if(a)return i;const c=Math.abs(r-s);return n?i+c/n:c?1:i}function En(t=[],e=f.minMatchCharLength){let s=[],r=-1,n=-1,a=0;for(let i=t.length;a<i;a+=1){let c=t[a];c&&r===-1?r=a:!c&&r!==-1&&(n=a-1,n-r+1>=e&&s.push([r,n]),r=-1)}return t[a-1]&&a-r>=e&&s.push([r,a-1]),s}const z=32;function An(t,e,s,{location:r=f.location,distance:n=f.distance,threshold:a=f.threshold,findAllMatches:i=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,includeMatches:l=f.includeMatches,ignoreLocation:u=f.ignoreLocation}={}){if(e.length>z)throw new Error(un(z));const d=e.length,h=t.length,m=Math.max(0,Math.min(r,h));let p=a,x=m;const E=c>1||l,M=E?Array(h):[];let b;for(;(b=t.indexOf(e,x))>-1;){let A=me(e,{currentLocation:b,expectedLocation:m,distance:n,ignoreLocation:u});if(p=Math.min(A,p),x=b+d,E){let w=0;for(;w<d;)M[b+w]=1,w+=1}}x=-1;let N=[],v=1,_=d+h;const Q=1<<d-1;for(let A=0;A<d;A+=1){let w=0,L=_;for(;w<L;)me(e,{errors:A,currentLocation:m+L,expectedLocation:m,distance:n,ignoreLocation:u})<=p?w=L:_=L,L=Math.floor((_-w)/2+w);_=L;let oe=Math.max(1,m-L+1),te=i?h:Math.min(m+L,h)+d,$=Array(te+2);$[te+1]=(1<<A)-1;for(let I=te;I>=oe;I-=1){let G=I-1,ae=s[t.charAt(G)];if(E&&(M[G]=+!!ae),$[I]=($[I+1]<<1|1)&ae,A&&($[I]|=(N[I+1]|N[I])<<1|1|N[I+1]),$[I]&Q&&(v=me(e,{errors:A,currentLocation:G,expectedLocation:m,distance:n,ignoreLocation:u}),v<=p)){if(p=v,x=G,x<=m)break;oe=Math.max(1,2*m-x)}}if(me(e,{errors:A+1,currentLocation:m,expectedLocation:m,distance:n,ignoreLocation:u})>p)break;N=$}const y={isMatch:x>=0,score:Math.max(.001,v)};if(E){const A=En(M,c);A.length?l&&(y.indices=A):y.isMatch=!1}return y}function bn(t){let e={};for(let s=0,r=t.length;s<r;s+=1){const n=t.charAt(s);e[n]=(e[n]||0)|1<<r-s-1}return e}const ge=String.prototype.normalize?t=>t.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):t=>t;class jt{constructor(e,{location:s=f.location,threshold:r=f.threshold,distance:n=f.distance,includeMatches:a=f.includeMatches,findAllMatches:i=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,isCaseSensitive:l=f.isCaseSensitive,ignoreDiacritics:u=f.ignoreDiacritics,ignoreLocation:d=f.ignoreLocation}={}){if(this.options={location:s,threshold:r,distance:n,includeMatches:a,findAllMatches:i,minMatchCharLength:c,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d},e=l?e:e.toLowerCase(),e=u?ge(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const h=(p,x)=>{this.chunks.push({pattern:p,alphabet:bn(p),startIndex:x})},m=this.pattern.length;if(m>z){let p=0;const x=m%z,E=m-x;for(;p<E;)h(this.pattern.substr(p,z),p),p+=z;if(x){const M=m-z;h(this.pattern.substr(M),M)}}else h(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n}=this.options;if(e=s?e:e.toLowerCase(),e=r?ge(e):e,this.pattern===e){let E={isMatch:!0,score:0};return n&&(E.indices=[[0,e.length-1]]),E}const{location:a,distance:i,threshold:c,findAllMatches:l,minMatchCharLength:u,ignoreLocation:d}=this.options;let h=[],m=0,p=!1;this.chunks.forEach(({pattern:E,alphabet:M,startIndex:b})=>{const{isMatch:N,score:v,indices:_}=An(e,E,M,{location:a+b,distance:i,threshold:c,findAllMatches:l,minMatchCharLength:u,includeMatches:n,ignoreLocation:d});N&&(p=!0),m+=v,N&&_&&(h=[...h,..._])});let x={isMatch:p,score:p?m/this.chunks.length:1};return p&&n&&(x.indices=h),x}}class V{constructor(e){this.pattern=e}static isMultiMatch(e){return at(e,this.multiRegex)}static isSingleMatch(e){return at(e,this.singleRegex)}search(){}}function at(t,e){const s=t.match(e);return s?s[1]:null}class yn extends V{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const s=e===this.pattern;return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class kn extends V{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const r=e.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,e.length-1]}}}class Sn extends V{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const s=e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class Fn extends V{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const s=!e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class jn extends V{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const s=e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Bn extends V{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const s=!e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Bt extends V{constructor(e,{location:s=f.location,threshold:r=f.threshold,distance:n=f.distance,includeMatches:a=f.includeMatches,findAllMatches:i=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,isCaseSensitive:l=f.isCaseSensitive,ignoreDiacritics:u=f.ignoreDiacritics,ignoreLocation:d=f.ignoreLocation}={}){super(e),this._bitapSearch=new jt(e,{location:s,threshold:r,distance:n,includeMatches:a,findAllMatches:i,minMatchCharLength:c,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Nt extends V{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let s=0,r;const n=[],a=this.pattern.length;for(;(r=e.indexOf(this.pattern,s))>-1;)s=r+a,n.push([r,s-1]);const i=!!n.length;return{isMatch:i,score:i?0:1,indices:n}}}const Te=[yn,Nt,Sn,Fn,Bn,jn,kn,Bt],it=Te.length,Nn=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Tn="|";function _n(t,e={}){return t.split(Tn).map(s=>{let r=s.trim().split(Nn).filter(a=>a&&!!a.trim()),n=[];for(let a=0,i=r.length;a<i;a+=1){const c=r[a];let l=!1,u=-1;for(;!l&&++u<it;){const d=Te[u];let h=d.isMultiMatch(c);h&&(n.push(new d(h,e)),l=!0)}if(!l)for(u=-1;++u<it;){const d=Te[u];let h=d.isSingleMatch(c);if(h){n.push(new d(h,e));break}}}return n})}const In=new Set([Bt.type,Nt.type]);class Dn{constructor(e,{isCaseSensitive:s=f.isCaseSensitive,ignoreDiacritics:r=f.ignoreDiacritics,includeMatches:n=f.includeMatches,minMatchCharLength:a=f.minMatchCharLength,ignoreLocation:i=f.ignoreLocation,findAllMatches:c=f.findAllMatches,location:l=f.location,threshold:u=f.threshold,distance:d=f.distance}={}){this.query=null,this.options={isCaseSensitive:s,ignoreDiacritics:r,includeMatches:n,minMatchCharLength:a,findAllMatches:c,ignoreLocation:i,location:l,threshold:u,distance:d},e=s?e:e.toLowerCase(),e=r?ge(e):e,this.pattern=e,this.query=_n(this.pattern,this.options)}static condition(e,s){return s.useExtendedSearch}searchIn(e){const s=this.query;if(!s)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:n,ignoreDiacritics:a}=this.options;e=n?e:e.toLowerCase(),e=a?ge(e):e;let i=0,c=[],l=0;for(let u=0,d=s.length;u<d;u+=1){const h=s[u];c.length=0,i=0;for(let m=0,p=h.length;m<p;m+=1){const x=h[m],{isMatch:E,indices:M,score:b}=x.search(e);if(E){if(i+=1,l+=b,r){const N=x.constructor.type;In.has(N)?c=[...c,...M]:c.push(M)}}else{l=0,i=0,c.length=0;break}}if(i){let m={isMatch:!0,score:l/i};return r&&(m.indices=c),m}}return{isMatch:!1,score:1}}}const _e=[];function Rn(...t){_e.push(...t)}function Ie(t,e){for(let s=0,r=_e.length;s<r;s+=1){let n=_e[s];if(n.condition(t,e))return new n(t,e)}return new jt(t,e)}const pe={AND:"$and",OR:"$or"},De={PATH:"$path",PATTERN:"$val"},Re=t=>!!(t[pe.AND]||t[pe.OR]),Ln=t=>!!t[De.PATH],On=t=>!H(t)&&yt(t)&&!Re(t),ct=t=>({[pe.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Tt(t,e,{auto:s=!0}={}){const r=n=>{let a=Object.keys(n);const i=Ln(n);if(!i&&a.length>1&&!Re(n))return r(ct(n));if(On(n)){const l=i?n[De.PATH]:a[0],u=i?n[De.PATTERN]:n[l];if(!O(u))throw new Error(ln(l));const d={keyId:Ne(l),pattern:u};return s&&(d.searcher=Ie(u,e)),d}let c={children:[],operator:a[0]};return a.forEach(l=>{const u=n[l];H(u)&&u.forEach(d=>{c.children.push(r(d))})}),c};return Re(t)||(t=ct(t)),r(t)}function Pn(t,{ignoreFieldNorm:e=f.ignoreFieldNorm}){t.forEach(s=>{let r=1;s.matches.forEach(({key:n,norm:a,score:i})=>{const c=n?n.weight:null;r*=Math.pow(i===0&&c?Number.EPSILON:i,(c||1)*(e?1:a))}),s.score=r})}function Wn(t,e){const s=t.matches;e.matches=[],D(s)&&s.forEach(r=>{if(!D(r.indices)||!r.indices.length)return;const{indices:n,value:a}=r;let i={indices:n,value:a};r.key&&(i.key=r.key.src),r.idx>-1&&(i.refIndex=r.idx),e.matches.push(i)})}function Hn(t,e){e.score=t.score}function $n(t,e,{includeMatches:s=f.includeMatches,includeScore:r=f.includeScore}={}){const n=[];return s&&n.push(Wn),r&&n.push(Hn),t.map(a=>{const{idx:i}=a,c={item:e[i],refIndex:i};return n.length&&n.forEach(l=>{l(a,c)}),c})}class ee{constructor(e,s={},r){this.options={...f,...s},this.options.useExtendedSearch,this._keyStore=new mn(this.options.keys),this.setCollection(e,r)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof He))throw new Error(cn);this._myIndex=s||Ft(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){D(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let r=0,n=this._docs.length;r<n;r+=1){const a=this._docs[r];e(a,r)&&(this.removeAt(r),r-=1,n-=1,s.push(a))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:r,includeScore:n,shouldSort:a,sortFn:i,ignoreFieldNorm:c}=this.options;let l=O(e)?O(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Pn(l,{ignoreFieldNorm:c}),a&&l.sort(i),bt(s)&&s>-1&&(l=l.slice(0,s)),$n(l,this._docs,{includeMatches:r,includeScore:n})}_searchStringList(e){const s=Ie(e,this.options),{records:r}=this._myIndex,n=[];return r.forEach(({v:a,i,n:c})=>{if(!D(a))return;const{isMatch:l,score:u,indices:d}=s.searchIn(a);l&&n.push({item:a,idx:i,matches:[{score:u,value:a,norm:c,indices:d}]})}),n}_searchLogical(e){const s=Tt(e,this.options),r=(c,l,u)=>{if(!c.children){const{keyId:h,searcher:m}=c,p=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(l,h),searcher:m});return p&&p.length?[{idx:u,item:l,matches:p}]:[]}const d=[];for(let h=0,m=c.children.length;h<m;h+=1){const p=c.children[h],x=r(p,l,u);if(x.length)d.push(...x);else if(c.operator===pe.AND)return[]}return d},n=this._myIndex.records,a={},i=[];return n.forEach(({$:c,i:l})=>{if(D(c)){let u=r(s,c,l);u.length&&(a[l]||(a[l]={idx:l,item:c,matches:[]},i.push(a[l])),u.forEach(({matches:d})=>{a[l].matches.push(...d)}))}}),i}_searchObjectList(e){const s=Ie(e,this.options),{keys:r,records:n}=this._myIndex,a=[];return n.forEach(({$:i,i:c})=>{if(!D(i))return;let l=[];r.forEach((u,d)=>{l.push(...this._findMatches({key:u,value:i[d],searcher:s}))}),l.length&&a.push({idx:c,item:i,matches:l})}),a}_findMatches({key:e,value:s,searcher:r}){if(!D(s))return[];let n=[];if(H(s))s.forEach(({v:a,i,n:c})=>{if(!D(a))return;const{isMatch:l,score:u,indices:d}=r.searchIn(a);l&&n.push({score:u,key:e,value:a,idx:i,norm:c,indices:d})});else{const{v:a,n:i}=s,{isMatch:c,score:l,indices:u}=r.searchIn(a);c&&n.push({score:l,key:e,value:a,norm:i,indices:u})}return n}}ee.version="7.1.0";ee.createIndex=Ft;ee.parseIndex=wn;ee.config=f;ee.parseQuery=Tt;Rn(Dn);function Gn(){const{data:t}=Rs(),{data:e,isLoading:s}=Ls();return{environments:e??t,fullEnvironmentsLoading:s}}function Kn({onCreateEnvironment:t}={}){const e=R(),{environmentId:s,setEnvironmentId:r}=j(),[n,a]=C.useState(!1),i=C.useRef(null),{environments:c,fullEnvironmentsLoading:l}=Gn(),u=c?.find(h=>h.id===s);Gs("environment",n,()=>a(!1)),C.useEffect(()=>{if(!l){if(s&&!u)r(null);else if(!s&&c?.length){const h=Fe(c,[m=>!(m.is_pinned??!1),m=>-(m.task_count??0)]);r(h[0].id)}}},[l,s,u,c,r]),Mt([{key:"whamEnvironments",action:()=>a(!0),actionMessageDescriptor:e.formatMessage({id:"wham.keyboardActions.whamEnvironments",defaultMessage:"Environments"}),group:xt.Chat,keyboardBinding:[ne.Mod,"e"]}]);const d=()=>a(!1);return l&&!c?.length?o.jsx("div",{className:"flex items-center gap-3 rounded-full",children:o.jsx(At,{})}):o.jsxs("div",{className:"flex items-center gap-2 rounded-full",children:[o.jsxs(gt,{open:n,onOpenChange:a,children:[o.jsx(wt,{triggerText:u?.label??e.formatMessage({id:"wham.codexEnvironmentPopover.selectEnvironment",defaultMessage:"Select environment"}),toolTip:(u?.label?.length??0)>16?u?.label??"":u?.label||n?"":e.formatMessage({id:"wham.codexEnvironmentPopover.viewAllCodeEnvironments",defaultMessage:"View all code environments"}),ariaLabel:e.formatMessage({id:"wham.codexEnvironmentPopover.viewAll",defaultMessage:"View all code environments"}),Icon:o.jsx(Et,{"aria-hidden":!0,className:"icon-sm"})}),o.jsx(vt,{align:"start",isOpen:n,closePopover:d,popoverContentRef:i,children:o.jsx(Vn,{isLoading:l,environments:c??[],environmentId:s,setEnvironmentId:r,closePopover:d,onCreateEnvironment:t})})]}),u&&o.jsx(Ks,{environment:u})]})}function Vn({isLoading:t,environments:e,environmentId:s,setEnvironmentId:r,closePopover:n,onCreateEnvironment:a}){const i=R(),c=C.useRef(null),[l,u]=C.useState(""),d=v=>{r(v),n()},h=dt(),m=e.length>0,p=C.useMemo(()=>new ee(e,{threshold:.4,keys:["label","repos"]}),[e]),x=C.useMemo(()=>{if(!l?.trim()){const[y,A]=Cs(e,w=>w.is_pinned);return[...Fe(y,w=>-(w.task_count??0)),...Fe(A,w=>-(w.task_count??0))]}const v=l.trim().toLowerCase(),_=p?.search(l).map(y=>y.item)??[],Q=y=>{const A=y.toLowerCase();return A===v?0:A.startsWith(v)?1:2};return _.sort((y,A)=>{if(y.is_pinned!==A.is_pinned)return y.is_pinned?-1:1;const w=Q(y.label)-Q(A.label);return w!==0?w:y.label.localeCompare(A.label)})},[l,p,e]),{hoveredId:E,setHoveredId:M,onKeyDown:b,getItemRef:N}=Vs({items:x,keyExtractor:v=>v.id,onSelect:d});return C.useEffect(()=>{c.current?.focus()},[]),o.jsxs("div",{className:"flex max-h-[280px] w-80 flex-col overflow-y-auto rounded-lg md:max-h-[360px]",children:[e.length>4&&o.jsxs("div",{className:"contents",onClick:v=>{v.stopPropagation()},children:[o.jsx(Yt,{ref:c,className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",inputClassName:"text-sm",type:"text",autoComplete:"off",name:"branch-to-add",value:l,onChange:v=>u(v.target.value),onKeyDown:b,suppressFocus:!0,placeholder:i.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip",defaultMessage:"Search environments…"}),ariaLabel:i.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsAria",defaultMessage:"Search environments"})}),o.jsx("div",{className:"bg-token-border-default h-px w-full"})]}),o.jsx("div",{className:"flex flex-col overflow-y-auto p-1.5",children:t?o.jsx("div",{className:"flex w-full items-center justify-center py-2",children:o.jsx(xe,{className:"ms-2"})}):e.length>0?x.length>0?x.map(v=>{const _=s===v.id;return o.jsx(Be,{as:"button",ref:N(v),onMouseEnter:()=>M(v.id),className:"w-full",truncateLabel:!0,onClick:()=>{d(v.id)},isVirtualHover:E===v.id,isSelected:_,label:v.label},v.id)}):o.jsx("div",{className:"p-5 text-center",children:o.jsx("p",{className:"text-token-text-tertiary text-sm",children:o.jsx(B,{id:"wham.environmentPopover.noMatches",defaultMessage:"No matches found"})})}):o.jsxs("div",{className:"p-2 text-center",children:[o.jsx("p",{className:"text-token-text-primary text-sm",children:o.jsx(B,{id:"wham.environmentPopover.noEnvironments",defaultMessage:"No environments"})}),o.jsx("p",{className:"text-token-text-secondary text-xs",children:o.jsx(B,{id:"wham.environmentPopover.missingEnvironment",defaultMessage:"Codex requires an environment to work"})})]})}),o.jsx("div",{className:"bg-token-border-default h-px w-full"}),o.jsx("div",{className:"bg-token-bg-tertiary px-2 py-1.5",children:o.jsx(Be,{className:"w-full",noDefaultHoverState:!0,onClick:()=>{!m&&a?a():h("/codex/settings/environments")},isSelected:!1,icon:o.jsx(Zt,{className:"icon-sm"}),label:m?i.formatMessage({id:"wham.codexEnvironmentPopover.manageEnvironments",defaultMessage:"Manage environments"}):i.formatMessage({id:"wham.codexEnvironmentPopover.createEnvironment",defaultMessage:"Create environment"})},"environment-action")})]})}function qn({onCreateEnvironment:t}={}){const e=R(),{isConnected:s,isLoading:r,openGithubModal:n,error:a,refetch:i}=Le(Oe.GITHUB_CONNECTOR,"github","/codex",fe.CODEX),{enabled:c}=Jt(fe.CODEX);return r?o.jsx(At,{className:"h-9"}):a?o.jsx(J,{label:e.formatMessage({id:"wham.whamComposerEnvironmentsSelector.failedClickToRetry",defaultMessage:"Click to retry"}),children:o.jsx(W,{color:"secondary",type:"button",className:"border-token-border-default flex w-fit items-center gap-1.5 rounded-full! border",onClick:i,children:o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx(Et,{"aria-hidden":!0,className:"icon-sm"}),o.jsx(B,{id:"wham.environmentsSelector.retry",defaultMessage:"Failed to load environments"})]})})}):c?o.jsx(o.Fragment,{children:o.jsx("div",{className:"z-0 flex w-full justify-between",children:s?o.jsx("div",{className:"flex gap-4",children:o.jsx(Kn,{onCreateEnvironment:t})}):o.jsx("div",{className:"flex gap-2",children:o.jsxs(W,{type:"button",color:"secondary",size:"small",onClick:n,children:[o.jsx(nt,{"aria-hidden":!0,className:"icon-sm me-1.5"}),o.jsx(B,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})})}):o.jsx(J,{label:e.formatMessage({id:"wham.whamComposerEnvironmentsSelector.disabledByWorkspaceAdmin",defaultMessage:"Disabled by workspace admin"}),children:o.jsxs(W,{type:"button",color:"secondary",onClick:n,disabled:!0,children:[o.jsx(nt,{"aria-hidden":!0,className:"icon-sm me-1.5"}),o.jsx(B,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})}function zn(){const t=R(),e=dt(),{setupMfa:s}=zs({redirectUrl:"/codex"});return o.jsx(es,{isOpen:!0,onClose:()=>{},type:"warning",title:t.formatMessage({id:"wham.mfaRequiredModal.title",defaultMessage:"Enable multi-factor authentication to access Codex"}),description:t.formatMessage({id:"wham.mfaRequiredModal.description",defaultMessage:"To continue using Codex, please turn on multi-factor authentication for your account."}),testId:"modal-mfa-required",children:o.jsxs("div",{className:"flex w-full justify-end gap-2",children:[o.jsx(W,{color:"secondary",onClick:()=>{e("/")},children:o.jsx(B,{id:"wham.mfaRequiredModal.backToChatGPT",defaultMessage:"Back to ChatGPT"})}),o.jsx(W,{color:"primary",onClick:()=>{s()},children:o.jsx(B,{id:"wham.mfaRequiredModal.enableMFA",defaultMessage:"Enable MFA"})})]})})}const Qn=t=>C.createElement("svg",{width:18,height:18,viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 4.5C5.68355 4.5 5.84354 4.62492 5.88806 4.80299C6.08089 5.57434 6.30775 6.04206 6.63284 6.36716C6.95794 6.69225 7.42566 6.91911 8.19701 7.11194C8.37508 7.15646 8.5 7.31645 8.5 7.5C8.5 7.68355 8.37508 7.84354 8.19701 7.88806C7.42566 8.08089 6.95794 8.30775 6.63284 8.63284C6.30775 8.95794 6.08089 9.42566 5.88806 10.197C5.84354 10.3751 5.68355 10.5 5.5 10.5C5.31645 10.5 5.15646 10.3751 5.11194 10.197C4.91911 9.42566 4.69225 8.95794 4.36716 8.63284C4.04206 8.30775 3.57434 8.08089 2.80299 7.88806C2.62492 7.84354 2.5 7.68355 2.5 7.5C2.5 7.31645 2.62492 7.15646 2.80299 7.11194C3.57434 6.91911 4.04206 6.69225 4.36716 6.36716C4.69225 6.04206 4.91911 5.57434 5.11194 4.80299C5.15646 4.62492 5.31645 4.5 5.5 4.5Z",fill:"currentColor"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.5 2.5C12.6835 2.5 12.8435 2.62492 12.8881 2.80299C13.0809 3.57434 13.3077 4.04206 13.6328 4.36716C13.9579 4.69225 14.4257 4.91911 15.197 5.11194C15.3751 5.15646 15.5 5.31645 15.5 5.5C15.5 5.68355 15.3751 5.84354 15.197 5.88806C14.4257 6.08089 13.9579 6.30775 13.6328 6.63284C13.3077 6.95794 13.0809 7.42566 12.8881 8.19701C12.8435 8.37508 12.6835 8.5 12.5 8.5C12.3165 8.5 12.1565 8.37508 12.1119 8.19701C11.9191 7.42566 11.6923 6.95794 11.3672 6.63284C11.0421 6.30775 10.5743 6.08089 9.80299 5.88806C9.62492 5.84354 9.5 5.68355 9.5 5.5C9.5 5.31645 9.62492 5.15646 9.80299 5.11194C10.5743 4.91911 11.0421 4.69225 11.3672 4.36716C11.6923 4.04206 11.9191 3.57434 12.1119 2.80299C12.1565 2.62492 12.3165 2.5 12.5 2.5Z",fill:"currentColor"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.5 9.5C10.6835 9.5 10.8435 9.62492 10.8881 9.80299C11.0809 10.5743 11.3077 11.0421 11.6328 11.3672C11.9579 11.6923 12.4257 11.9191 13.197 12.1119C13.3751 12.1565 13.5 12.3165 13.5 12.5C13.5 12.6835 13.3751 12.8435 13.197 12.8881C12.4257 13.0809 11.9579 13.3077 11.6328 13.6328C11.3077 13.9579 11.0809 14.4257 10.8881 15.197C10.8435 15.3751 10.6835 15.5 10.5 15.5C10.3165 15.5 10.1565 15.3751 10.1119 15.197C9.91911 14.4257 9.69225 13.9579 9.36716 13.6328C9.04206 13.3077 8.57434 13.0809 7.80299 12.8881C7.62492 12.8435 7.5 12.6835 7.5 12.5C7.5 12.3165 7.62492 12.1565 7.80299 12.1119C8.57434 11.9191 9.04206 11.6923 9.36716 11.3672C9.69225 11.0421 9.91911 10.5743 10.1119 9.80299C10.1565 9.62492 10.3165 9.5 10.5 9.5Z",fill:"currentColor"})),Xn=ts(()=>ss(()=>import("./dzirgccz3aal4v9u.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34])).then(t=>t.SpeculativeTaskContentModal));function Un({taskId:t,index:e,assistantTurn:s,suggestion:r,disabledReason:n,loading:a}){const i=s.output_items.find(c=>c.type==="pr")?.output_diff;return o.jsx(J,{side:"right",sideOffset:10,label:n,children:o.jsxs("div",{className:"flex w-full items-center gap-1.5 rounded-lg px-2 py-1",children:[o.jsx("span",{className:"self-start pt-[0.125rem]",children:a?o.jsx(xe,{className:"text-token-text-tertiary icon-sm"}):o.jsx(Qn,{className:"text-token-text-tertiary icon-sm"})}),o.jsx("span",{className:"text-token-text-primary line-clamp-2 flex-1 text-start text-sm leading-snug break-words",children:r.title}),i&&i.lines_added!=null&&i.lines_removed!=null&&o.jsx(Os,{className:"text-sm",linesAdded:i.lines_added,linesRemoved:i.lines_removed}),o.jsx(Yn,{taskId:t,assistantTurn:s,suggestion:r,index:e})]})})}function Yn({taskId:t,assistantTurn:e,suggestion:s,index:r}){const[n,a]=C.useState(!1);return o.jsxs("div",{onClick:i=>{i.stopPropagation(),i.preventDefault()},children:[o.jsx(W,{color:"secondary",size:"small",icon:vs,onClick:i=>{i.stopPropagation(),i.preventDefault(),a(!0)},children:o.jsx(B,{id:"wham.speculativeFollowUpSuggestionRow.preview",defaultMessage:"Preview"})}),o.jsx(Xn,{taskId:t,suggestion:s,index:r,assistantTurn:e,isOpen:n,onClose:()=>a(!1)})]})}function Zn({taskId:t,turnId:e,followupVisibilityState:s,followUpSuggestions:r,hasComments:n,isSubmitting:a,onSuggestionClick:i,children:c}){const l=R(),[u,d]=C.useState(null),{data:h}=Jn({taskId:t,turnId:e}),m=We({isFollowUp:!0,hasComments:n});let p=Pe(m);m==="no-content"&&(p=void 0);const x=!!h?.length&&t&&e;return C.useEffect(()=>{x&&K.recordFollowUpsSeen(t,e,r.length)},[x,t,e,r.length]),x?o.jsxs("div",{className:"bg-token-bg-tertiary flex flex-col gap-1.5 rounded-2xl p-2",children:[o.jsx(ht,{initial:!1,children:s==="visible"&&o.jsx("div",{className:"flex flex-col",inert:a,children:h.map(({suggested_task:E,assistant_turn:M},b)=>o.jsx(Un,{index:b,taskId:t,turnId:e,assistantTurn:M,suggestion:E,disabledReason:p,loading:u===b&&a,onClick:()=>{a||(d(b),i(E))}},b))})}),s==="collapsed"&&o.jsxs("button",{type:"button",className:"text-token-text-tertiary enabled:hover:text-token-text-secondary focus:bg-token-bg-secondary flex items-center gap-2 rounded-lg p-2 text-xs font-semibold focus:outline-none","aria-label":l.formatMessage({id:"wham.speculativeFollowUpContainer.showSuggestions",defaultMessage:"Show follow up suggestions"}),onClick:()=>{K.recordFollowUpsExpanded(t,e)},children:[o.jsx(Ct,{className:"icon-sm"}),o.jsx(B,{id:"wham.composer.followup.show",defaultMessage:"Suggestions"},"text")]},"collapsed"),c({isWrappedByContainer:!0})]}):c({isWrappedByContainer:!1})}function Jn({taskId:t,turnId:e}){return Kt({queryKey:["wham","speculative-turns",t,e],queryFn:async()=>{const s=await ns.safeGet("/wham/tasks/{task_id}/speculative_turns/{turn_id}",{parameters:{path:{task_id:t,turn_id:e}}}),r=s.speculative_turns;return Qs(r,a=>a.assistant_turn.turn_status==="completed")?s.speculative_turns.filter(a=>!a.assistant_turn.discarded):[]},refetchInterval:s=>s&&s.state?.data?.some(n=>n.assistant_turn.turn_status==="pending"||n.assistant_turn.turn_status==="in_progress")?3e4:!1})}function er({taskId:t,turnId:e,isComposerExpanded:s,followUpSuggestions:r,hasComments:n,isSubmitting:a,onSuggestionClick:i,children:c}){const l=re(),u=sr(l,s),d=R(),[h,m]=C.useState(null),p=We({isFollowUp:!0,hasComments:n});let x=Pe(p);p==="no-content"&&(x=void 0);const E=!(u==="hidden"||!r.length)&&t&&e;if(C.useEffect(()=>{E&&K.recordFollowUpsSeen(t,e,r.length)},[E,t,e,r.length]),E){if(Z(l,"2007094101")&&r.find(M=>!!M.assistantTurnId))return o.jsx(Zn,{taskId:t,turnId:e,followupVisibilityState:u,followUpSuggestions:r,hasComments:n,isSubmitting:a,onSuggestionClick:i,children:({isWrappedByContainer:M})=>c({isWrappedByContainer:M})})}else return c({isWrappedByContainer:!1});return o.jsxs("div",{className:"bg-token-bg-tertiary flex flex-col gap-1.5 rounded-2xl p-2",children:[o.jsx(ht,{initial:!1,children:u==="visible"&&o.jsx("div",{className:"flex flex-col",inert:a,children:r.map((M,b)=>o.jsx(tr,{index:b,taskId:t,turnId:e,suggestion:M.suggestion,disabledReason:x,loading:h===b&&a,onClick:()=>{a||(m(b),i(M.suggestion))}},b))})}),u==="collapsed"&&o.jsxs("button",{type:"button",className:"text-token-text-tertiary enabled:hover:text-token-text-secondary focus:bg-token-bg-secondary flex items-center gap-2 rounded-lg p-2 text-xs font-semibold focus:outline-none","aria-label":d.formatMessage({id:"wham.followUpContainer.showSuggestions",defaultMessage:"Show follow up suggestions"}),onClick:()=>{K.recordFollowUpsExpanded(t,e)},children:[o.jsx(Ct,{className:"icon-sm"}),o.jsx(B,{id:"wham.composer.followup.show",defaultMessage:"Suggestions"},"text")]},"collapsed"),c({isWrappedByContainer:!0})]})}function tr({taskId:t,turnId:e,index:s,suggestion:r,disabledReason:n,loading:a,onClick:i}){return o.jsx(J,{side:"right",sideOffset:10,label:n,children:o.jsxs("button",{type:"button",disabled:!!n||a,className:"group hover:bg-token-bg-secondary focus:bg-token-bg-secondary -disabled:cursor-pointer flex w-full items-start gap-1.5 rounded-lg px-2 py-1 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>{i(),K.recordFollowUpsClicked(t,e,s,r.severity)},children:[o.jsx("span",{className:"pt-[0.125rem]",children:a?o.jsx(xe,{className:"text-token-text-tertiary icon-sm"}):o.jsx(pt,{className:"text-token-text-tertiary icon-sm"})}),o.jsx("span",{className:"text-token-text-primary line-clamp-2 text-start text-sm leading-snug break-words",children:r.title})]})})}function sr(t,e){return Z(t,"3485296344")||void 0?e?"collapsed":"visible":"hidden"}function nr(){const t=re(),e=j(r=>r.bestOfN);return e??rs(t,"2398649844").get("default_attempts",1)}function mr({disableAutoFocus:t=!1,isBigBoxMode:e=!1,disableDuringSubmit:s=!1,expanded:r,followUp:n,onClearComments:a,onSubmit:i,onSuccess:c,onCreateEnvironment:l,attemptIndex:u,ariaLabel:d}){const h=R(),m=mt(),{refetch:p}=Ps(),{refetch:x}=Ws(n?.taskId),{refetch:E}=Hs(n?.taskId),M=j(({environmentId:g})=>g),b=j(({branch:g})=>g),N=j(({addTurnToTaskMap:g})=>g),v=j(g=>g.setHasSubmittedTaskInSession),[_,Q]=C.useState(!0),[y,A]=C.useState(!1),w=os(),L=Ye(g=>g.files),oe=Ye(be.hasUploadInProgress),te=nr(),$=j(g=>g.setBestOfN),[$e,I]=C.useState(1),G=n?$e:te,ae=n?I:$,Ce=re(),ve=Z(Ce,"3492040717"),_t=Z(Ce,"879591222")||void 0,Ge=Z(Ce,"3536244140"),se=Xs(),[It,Ke]=C.useState(!1),S=ft(),ie=ke(Ms(S).isWhisperActive$),Ve=C.useRef(null),qe=j(g=>g.getRateLimit()?.remaining===0),ce=qe&&!!n,Dt=ce?!1:ie?!0:r,Rt=as(S),le=ke(()=>Dt??Rt()),Lt=s&&y||ce,ue=!!n&&(n.comments.length??0)>0,Me=C.useCallback(g=>{for(const k of g)de.uploadFile(w,is(k),k,cs.Codex,[],h,m)},[w,h,m]);function Ot(g){const k=g.target.files;k&&(Me(k),g.target.value="")}C.useEffect(()=>{if(!se)return;const g=k=>{const P=k.clipboardData?.items;if(!P)return;const U=[];for(const Ae of P)if(Ae.kind==="file"){const Y=Ae.getAsFile();Y&&Y.type.startsWith("image/")&&U.push(Y)}U.length>0&&(k.preventDefault(),Me(U))};return ls(q(S).dom,{paste:g})},[S,se,Me]);function Pt(){return be.getReadyFiles(w.getState()).flatMap(g=>{const k=g.fileSpec;return k&&"width"in k&&"height"in k&&g.fileId?[{type:"image_asset_pointer",asset_pointer:hs(g.fileId),width:k.width,height:k.height,size_bytes:k.size}]:[]})}Mt([{key:"focusComposer",action:()=>Ze(q(S)),actionMessageDescriptor:h.formatMessage({id:"wham.keyboardActions.focusComposer",defaultMessage:"Focus chat"}),group:xt.Chat,keyboardBinding:[ne.Shift,ne.Escape],altKeyboardBindings:n?void 0:[[ne.Mod,ne.Shift,"o"]]}]);const Wt=We({isFollowUp:!!n,hasComments:ue}),{isConnected:we}=Le(Oe.GITHUB_CONNECTOR,"github","/codex",fe.CODEX),ze=Pe(Wt),Ee=!!ze||y&&s||oe,{mutate:X,isPending:Qe}=ut({mutationFn:async({runEnvironmentInQaMode:g,promptOverride:k}={runEnvironmentInQaMode:!1})=>{const P=k??us(q(S).state.doc).content,U=be.getReadyFiles(w.getState());if(!(!!P.length||ue))throw new Error("No content to submit");const Y=se?Pt():[];if(i?.(),de.reset(w),A(!0),n)return await je.createFollowUpTask(n.taskId,n.turnId,P,n.comments,g,ve?G:void 0,Y).catch(F=>{throw k||(Je(q(S),P),de.restoreFiles(w,U)),F instanceof he&&F.status===429?m.danger(h.formatMessage(lt.rateLimit),{id:n.turnId,duration:5,hasCloseButton:!0}):F instanceof tt?st(F,n.turnId,h,m):F instanceof he&&F.status===403&&F.detail?.toLowerCase().includes("multi-factor authentication")?Ke(!0):m.danger(h.formatMessage({id:"wham.whamComposer.failedToCreateFollowUpTask",defaultMessage:"Failed to create follow-up"}),{id:n.turnId,duration:5,hasCloseButton:!0}),F});{if(b){if(!M)throw new Error("Environment is required for new tasks.")}else throw new Error("Branch is required");Q(!1);const F=crypto.randomUUID();return j.getState().addPendingTaskId(F),je.createNewTask(M,b,P,g,ve?G:void 0,Y).catch(T=>{throw j.getState().removePendingTaskId(F),k||(ds(q(S).state.doc)?(Je(q(S),P),de.restoreFiles(w,U)):(m.danger(h.formatMessage({id:"wham.whamComposer.failedToCreateTaskCopyToClipboard",defaultMessage:"Failed to create task. Previous prompt copied to clipboard."}),{id:F,duration:5,hasCloseButton:!0}),navigator.clipboard.writeText(P))),T}).catch(T=>{throw T instanceof he&&T.status===429?m.danger(h.formatMessage(lt.rateLimit),{id:F,duration:5,hasCloseButton:!0}):T instanceof tt?st(T,F,h,m):T instanceof he&&T.status===403&&T.detail?.toLowerCase().includes("multi-factor authentication")?Ke(!0):m.danger(h.formatMessage({id:"wham.whamComposer.failedToCreateTask",defaultMessage:"Failed to create task"}),{id:F,duration:5,hasCloseButton:!0}),T}).then(T=>(j.getState().assignPendingTaskToFinalTask(F,T.task.id),j.getState().setRateLimit(T.rate_limit),T))}},onSuccess:g=>{v(!0),N(g.task.id,g.turn),g.user_turn&&N(g.task.id,g.user_turn),c?.(g),setTimeout(()=>{Ze(q(S))},0),p(),n&&(x(),E())},onSettled:()=>{A(!1)}});C.useEffect(()=>{if(!Ee)return S.subscribe("keydown",g=>{g.metaKey&&g.key==="Enter"?X({runEnvironmentInQaMode:!1}):g.altKey&&g.key==="Enter"&&X({runEnvironmentInQaMode:!0})})},[S,X,Ee]);const Xe=qs(n?[n.turnStatus,...n.siblingTurnStatuses]:[],g=>g==="pending"||g==="in_progress"?1:0),Ue=!!n&&_t&&Xe>0,Ht=!Ue&&(Ge?!ie:!0),$t=(n?.siblingTurnStatuses?.length??0)>1&&u?h.formatMessage({id:"wham.whamComposer.followUpOnTurn",defaultMessage:"Follow-up on version {version}"},{version:u}):h.formatMessage({id:"wham.whamComposer.requestChangesOrAskAQuestion",defaultMessage:"Request changes or ask a question"});return o.jsx(er,{taskId:n?.taskId,turnId:n?.turnId,isComposerExpanded:le,followUpSuggestions:n?.followUpSuggestions??[],hasComments:ue,isSubmitting:y,onSuggestionClick:g=>{X({runEnvironmentInQaMode:!1,promptOverride:g.body})},children:({isWrappedByContainer:g})=>o.jsxs("div",{className:"contents",inert:Lt,children:[o.jsxs(ws,{expanded:le,canCollapseWithInput:!Qe&&g,isTemporaryChat:!1,shouldUseTightRadius:g,onSubmit:()=>{Qe||X({runEnvironmentInQaMode:!1})},composerController:S,ariaLabel:d??h.formatMessage({id:"wham.whamComposer.ariaLabel",defaultMessage:"Codex composer"}),children:[o.jsx(Es,{children:ie?o.jsx("div",{className:Se("flex max-w-full min-w-0 flex-1 items-center",e&&le&&"min-h-30"),children:o.jsx(As,{composerController:S,className:"h-14"})}):o.jsx(bs,{composerController:S,disableAutoFocus:t||qe,textareaMaxHeightClassName:Se(e&&le&&"min-h-30",n?"max-h-[max(10rem,min(calc(100dvh-29rem),10rem))]":"max-h-[max(10rem,min(calc(100dvh-29rem),50dvh))]"),placeholder:n?$t:_?h.formatMessage({id:"wham.whamComposer.describeACodingTask",defaultMessage:"Describe a task"}):h.formatMessage({id:"wham.whamComposer.describeAnotherCodingTask",defaultMessage:"Describe another task"})})}),we&&se&&L.length>0&&o.jsx(et,{children:o.jsx(ys,{files:L,selectedApps:[],activeSystemHintType:void 0,disableEditButton:!0,forceSmallView:!0,className:"no-scrollbar horizontal-scroll-fade-mask flex flex-nowrap gap-2 overflow-x-auto px-2.5 pt-2.5 pb-1.5 [--edge-fade-distance:1rem]"})}),we&&se&&o.jsx(ks,{children:o.jsxs(o.Fragment,{children:[o.jsx("input",{ref:Ve,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:Ot}),o.jsx("button",{type:"button",className:"composer-btn","aria-label":h.formatMessage({id:"wham.whamComposer.attachImage",defaultMessage:"Attach image"}),onClick:()=>Ve.current?.click(),children:o.jsx(Ss,{className:"icon"})})]})}),ue&&o.jsx(et,{children:o.jsx(sn,{comments:n.comments,onClearComments:a})}),!ie&&o.jsx(Fs,{children:o.jsxs("div",{className:"flex gap-2",children:[!n&&o.jsx(qn,{onCreateEnvironment:l}),ve&&we&&o.jsx(en,{attempts:G,setAttempts:ae})]})}),o.jsxs(js,{children:[!ce&&o.jsxs("div",{className:"flex",children:[Ge&&o.jsx("div",{inert:y,children:o.jsx(Bs,{composerController:S,composerType:"codex"})}),Ht&&o.jsx(Ys,{isSubmitDisabled:Ee,createTask:X,disabledReason:ze}),Ue&&o.jsx(Us,{taskId:n.taskId,hasMultipleInProgressOrStreamingTurns:Xe>1})]}),ce&&o.jsx($s,{})]})]}),It&&o.jsx(zn,{})]})})}const lt=Vt({rateLimit:{id:"wham.whamComposer.failedToCreateTaskRateLimit",defaultMessage:"Codex is busy right now. Please try again later."}});export{Et as S,mr as W,Xs as u};
//# sourceMappingURL=mc1n5d2hvi71ywqx.js.map
