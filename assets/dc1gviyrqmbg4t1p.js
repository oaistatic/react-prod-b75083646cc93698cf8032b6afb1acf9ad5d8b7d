import{lI as R,bg as S,gh as h,gi as f,R as C}from"./hml6mmd5fyx85si7.js";import{a as b}from"./itdwpc2q0aiung3v.js";import{N as O,a as E,r}from"./lu2xqwqmjc95q6j6.js";async function k(p,t,e,s){const c=await C.safeGet("/connectors/{id}/oauth/callback",{parameters:{path:{id:p},query:{code:t,redirect_uri:e,state:s}}});return{...c,redirect_path:b(c.redirect_path).toString()}}const $=R(function(){const{pluginId:t}=O(),e=E(),s=r.useRef(!1),[c,d]=r.useState(""),{code:o,error:n,error_description:i,state:u}=Object.fromEntries(new URLSearchParams(c.substring(1)).entries());r.useEffect(()=>{d(window.location.hash)},[]),r.useEffect(()=>{if(s.current)return;if(t&&o&&u)s.current=!0;else{e("/");return}async function _(){const m=window.location.origin+`/ccc/${t}/oauth/callback`;if(!(!t||!o||!u))try{const a=await k(t,o,m,u);if(a.success){const l=new URL(h(f.OAUTH_SUCCESS,a.redirect_path),location.origin);l.searchParams.set("oauth_success","true"),e(l.pathname+l.search+l.hash)}else e(h(f.CUSTOM_ERROR,a.redirect_path,a.error??a.message))}catch{e(h(f.CUSTOM_ERROR))}}_()},[t,o,u,e]);const g=S();return r.useEffect(()=>{n&&g.danger(`${n}${i?`: ${i}`:""}`,{duration:5,toastId:"oauth_callback: CCCOauth",loggingTitle:n,loggingDescription:i??""})},[n,i,g]),null});export{$ as default};
//# sourceMappingURL=dc1gviyrqmbg4t1p.js.map
