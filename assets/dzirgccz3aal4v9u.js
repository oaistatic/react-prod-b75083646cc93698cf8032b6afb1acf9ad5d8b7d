import{r as u,e as C,j as e,n as w,M as x}from"./lu2xqwqmjc95q6j6.js";import{d7 as k,d as N,nn as _,bl as A,C as T,R as v,B as b}from"./hml6mmd5fyx85si7.js";import{c6 as R}from"./rseqzngxzbdt1oxg.js";import{JsonViewer as F}from"./e0cf2nztzmm3evd7.js";import{T as D,a as U,b as W}from"./kyavoy07nhuntf5e.js";import{C as B}from"./lqvtqz2rwatwxk0l.js";import{p as H,W as E,b as q,M as z}from"./msab1t9ew5jwzw5m.js";import{W as j}from"./n0u5fqw2jde51umw.js";import{g as V,W as G,u as J}from"./ktoofw7mjru0a6r5.js";import"./l29qldloj3xqr7yu.js";import"./fzrn137102spawew.js";import"./dq9j3pioxqah4sfs.js";import"./nhs24pb9s8hnfshq.js";import"./dth89wjzf9gy8rh3.js";import"./d0g29t0qm74gluj7.js";import"./d7o4nful0h1qw8zk.js";import"./lw1kjinrctt8cogu.js";import"./eywlrsjhpmu02zoa.js";import"./itjugg22bqh0ueps.js";import"./kkw9h7dq0af4udcb.js";import"./e3c6g208bapx5eab.js";import"./d8r48c27g352nr7t.js";import"./dp7t1jmnbbend843.js";import"./mc1n5d2hvi71ywqx.js";import"./kwjkd9zyf9vouy1r.js";import"./dc45v808kg6x38y7.js";import"./99iw5y145xpdn59x.js";import"./fi4t5vltimyk5jia.js";import"./fsu81ov1h2xmh0dx.js";import"./blhqqdzhd9z6fst7.js";const M=new Set;function ke({taskId:a,suggestion:s,index:l,assistantTurn:t,isOpen:i,onClose:r}){const d=u.useMemo(()=>V(t,!0).length>0,[t]),f=u.useMemo(()=>H({assistantTurn:t,followUp:d}),[t,d]),c=!d,o=C(),m=k(),[L,y]=u.useState("diff"),S="diff";u.useEffect(()=>{const n=t.id;i&&n&&!M.has(n)&&(M.add(n),G.viewSpeculativeTurn(a,n))},[i,t.id,a]);const h=e.jsx(K,{taskId:a,suggestion:s,index:l,assistantTurn:t,showFullDiff:c}),P=e.jsx("div",{className:"relative flex h-full w-full flex-col",children:e.jsxs(D,{onChange:y,currentTab:L,defaultTab:S,tabs:[{key:"chat",isHidden:m,label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.conversation",defaultMessage:"Conversation"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.conversationAriaLabel",defaultMessage:"Tab to view the conversation with the assistant"}),children:h},{key:"diff",isHidden:!1,label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.diff",defaultMessage:"Diff"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.diffAriaLabel",defaultMessage:"Tab to view the code diff"}),children:e.jsx($,{taskId:a,assistantTurn:t,index:l,diffFiles:f})},{key:"logs",label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.logs",defaultMessage:"Logs"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.logsAriaLabel",defaultMessage:"Tab to view the work logs"}),children:e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"flex h-full w-full items-center justify-center py-8",children:e.jsx(_,{})}),children:e.jsx(E,{taskId:a,focusedAssistantTurn:t,agentNetworkAccess:t?.environment?.agent_network_access,footer:e.jsx("div",{className:"block md:hidden",children:e.jsx(p,{taskId:a,assistantTurn:t,index:l})})})})},{key:"internal_rollout",isHidden:t?.internal_only_rollouts==null||!0,label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.internalRollout",defaultMessage:"Internal Rollout"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.internalRolloutAriaLabel",defaultMessage:"Tab to view the internal rollout information"}),children:e.jsx("div",{className:"flex h-full w-full overflow-auto p-4",children:e.jsx(F,{json:t?.internal_only_rollouts??void 0,jsonViewProps:{collapsed:5}})})}],children:[e.jsx(U,{withUnderline:!m,className:N("p-3 max-md:py-0",!m&&"border-b"),skipTabUnderlineAnimation:!0}),e.jsx(W,{children:({content:n})=>e.jsx("div",{className:"flex h-full w-full",children:n})})]},t?.id??a)}),g=e.jsxs("div",{className:"relative flex h-full w-full flex-col",children:[P,e.jsx(R,{className:"absolute end-3 top-0 md:top-3",icon:e.jsx(A,{}),label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.close",defaultMessage:"Close"}),onClick:r})]});return e.jsx(T,{testId:`modal-speculative-task-content-${t.id}`,isOpen:i,visuallyHiddenHeader:!0,size:"custom",className:"h-full w-full",contentClassName:"h-screen",noPadding:!0,onClose:r,onEscapeKeyDown:n=>{n.preventDefault(),n.stopPropagation(),r()},showCloseButton:!0,children:e.jsx("div",{className:"bg-token-bg-tertiary flex h-full w-full",children:m?e.jsx(q,{leftContent:h,rightContent:g}):g})})}function K({taskId:a,suggestion:s,index:l,assistantTurn:t,showFullDiff:i}){return e.jsxs("div",{className:"flex h-full w-full flex-col",children:[e.jsx("span",{className:"p-6 text-sm font-medium",children:s.title}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:e.jsx(z,{isLatest:!0,assistantTurns:[t],selectedAssistantId:t.id,focusedAssistantTurn:t,setFocusedAssistantTurnId:()=>{},onClickFile:()=>{},startOpen:!0,currentTab:void 0,onTabChange:()=>{},permissions:"read",flushHeaderSeparator:!0,showFullDiff:i},t.id)}),e.jsx(p,{taskId:a,assistantTurn:t,index:l})]})}function $({taskId:a,assistantTurn:s,index:l,diffFiles:t}){const i=t.length>0,{data:r}=J(),f=!k()||r?.git_diff_mode==="unified";return e.jsxs("div",{className:"flex h-full w-full flex-col",children:[i&&e.jsx("div",{className:"flex w-full flex-1 flex-col gap-6 overflow-y-auto px-6 pb-6",children:t.map(c=>e.jsx(B,{diff:c,stickyHeader:!0,viewType:f?"unified":"split",enableComments:!1,buttonClassName:"bg-token-bg-tertiary"},c.diffFile._newFileName))}),e.jsx("div",{className:"block md:hidden",children:e.jsx(p,{taskId:a,assistantTurn:s,index:l})})]})}function p({taskId:a,assistantTurn:s,index:l}){const t=C(),i=()=>{window.location.reload()},{mutate:r,isPending:d}=w({mutationFn:()=>(j.recordSpeculativeSuggestionRejected(a,s.id,l),v.safePost("/wham/tasks/{task_id}/speculative_turns/{turn_id}/reject",{parameters:{path:{task_id:a,turn_id:s.id}}})),onSuccess:i}),{mutate:f,isPending:c}=w({mutationFn:()=>(j.recordSpeculativeSuggestionAccepted(a,s.id,l),v.safePost("/wham/tasks/{task_id}/speculative_turns/{turn_id}/accept",{parameters:{path:{task_id:a,turn_id:s.id}}})),onSuccess:i}),o=d||c;return e.jsxs("div",{className:"flex w-full justify-center gap-3 py-10",children:[e.jsx(b,{color:"primary",onClick:()=>f(),disabled:o,loading:c,"aria-label":t.formatMessage({id:"wham.speculative.followUp.applyAriaLabel",defaultMessage:"Button to apply the speculative follow up suggestion"}),children:e.jsx(x,{id:"wham.speculative.followUp.apply",defaultMessage:"Apply"})}),e.jsx(b,{color:"secondary",onClick:()=>r(),disabled:o,loading:d,"aria-label":t.formatMessage({id:"wham.speculative.followUp.rejectAriaLabel",defaultMessage:"Button to reject the speculative follow up suggestion"}),children:e.jsx(x,{id:"wham.speculative.followUp.reject",defaultMessage:"Reject"})})]})}export{ke as SpeculativeTaskContentModal};
//# sourceMappingURL=dzirgccz3aal4v9u.js.map
