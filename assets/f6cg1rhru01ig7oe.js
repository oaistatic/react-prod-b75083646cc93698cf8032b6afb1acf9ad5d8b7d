import{bg as z,R as N,t as je,d as H,cY as Ce,B as J,lI as ke}from"./hml6mmd5fyx85si7.js";import{u as ne,l as $,n as O,t as le,e as ie,r as o,j as t,d as Ie,M as j}from"./lu2xqwqmjc95q6j6.js";import{go as Ae}from"./rseqzngxzbdt1oxg.js";import{a as Pe,c as Se,u as Ne,d as De}from"./cz3tvo7iwbv2krt2.js";import{W as ee}from"./js0o5pkoyxnt23ro.js";import"./owyq2pc3j9e6vumq.js";import"./on8091w14zfmyea2.js";import"./cqyjjngibokvfw83.js";import"./ogr5nmy9hq7gfgq0.js";import"./iq82wz84d1fxj03i.js";import"./elolu96rnfzqcgif.js";import"./kcqshnk26ykm1u4n.js";import"./fibktxptqydbr54o.js";import"./6a3e5rtr9pyzi31y.js";import"./ik8y7nlve9mzjttb.js";import"./isxemcalu9537a8n.js";import"./ejklrllfl9wcn2za.js";import"./gnhjnh2n0u3gy6qx.js";import"./e0pswmo7irlt62pp.js";import"./fd9rmcpa6ai71fe6.js";import"./ml28jwjklb12w4ms.js";import"./kj7psz5s4tjdmz6e.js";import"./isqkn4xlzoktkvfr.js";import"./idnt7o3g1nnw0r5k.js";function _e(s){return ne({queryKey:["workspace-ip-allowlist",s],queryFn:s?()=>N.safeGet("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:s}}}):le})}function Te(s){return ne({queryKey:["workspace-compliance-ip-allowlist",s],queryFn:s?()=>N.safeGet("/accounts/{account_id}/compliance-ip-allowlist",{parameters:{path:{account_id:s}}}):le})}function Re(s){const l=$(),a=z();return O({mutationFn:n=>N.safePost("/accounts/{account_id}/compliance-ip-allowlist",{parameters:{path:{account_id:s}},requestBody:n}),onSuccess:()=>{l.invalidateQueries({queryKey:["workspace-compliance-ip-allowlist",s]})},onError:n=>{a.danger(n.message,{toastId:"compliance_ip_allowlist_create",loggingTitle:n.message,loggingDescription:"Failed to update Compliance API IP allowlist"})}})}function Ee(s){const l=$(),a=z();return O({mutationFn:n=>N.safePost("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:s}},requestBody:n}),onSuccess:()=>{l.invalidateQueries({queryKey:["workspace-ip-allowlist",s]})},onError:n=>{a.danger(n.message,{toastId:"ip_allowlist_create",loggingTitle:n.message,loggingDescription:"Failed to update IP allowlist"})}})}function Fe(s){const l=$(),a=z();return O({mutationFn:n=>N.safePatch("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:s}},requestBody:n}),onSuccess:()=>{l.invalidateQueries({queryKey:["workspace-ip-allowlist",s]})},onError:n=>{a.danger(n.message,{toastId:"ip_allowlist_toggle",loggingTitle:n.message,loggingDescription:"Failed to toggle IP allowlist"})}})}const te={md:{font:14,h:18,gap:6},lg:{font:14,h:20,gap:6},xl:{font:14,h:24,gap:6},"2xl":{font:16,h:24,gap:8},"3xl":{font:16,h:32,gap:8}};function se({value:s,defaultValue:l=[],onChange:a,validator:n,placeholder:d="",disabled:r=!1,size:v="xl",rows:g=1,maxTags:c,delimiters:f=[","," "],autoFocus:w=!1,showCount:C}){const D=ie(),_=s!==void 0,[F,q]=o.useState(l),u=s??F,h=o.useRef(null),k=o.useRef(null),U=o.useRef(null),[oe,Y]=o.useState(w),[y,I]=o.useState(""),[A,b]=o.useState(null),[re,G]=o.useState(new Set),[ce,ue]=o.useState(16),T=!c||u.length<c,R=u.length===0,de=o.useMemo(()=>{const e=te[v];return g*e.h+(g+1)*e.gap},[g,v]),B=o.useMemo(()=>new Set(u.map(e=>e.value)),[u]),P=o.useCallback(e=>{a?.(e),_||q(e)},[a,_]),V=o.useCallback(e=>n?n(e):!0,[n]),W=o.useCallback(e=>{G(i=>new Set(i).add(e)),window.setTimeout(()=>{G(i=>{const p=new Set(i);return p.delete(e),p})},500)},[]),Q=o.useCallback(e=>{const i=e.trim();if(!i)return;if(B.has(i)){W(i);return}const p=[...u,{value:i,valid:V(i)}];P(p)},[u,B,V,P,W]),Z=o.useCallback(e=>{const i=[...u];i.splice(e,1),P(i),b(null)},[u,P]),X=()=>{const e=h.current;return!e||e.selectionStart===0&&e.selectionEnd===0},pe=e=>{if(T)if(e.key==="ArrowLeft"||e.key==="ArrowUp")X()&&(e.preventDefault(),b(i=>i==null?u.length-1:Math.max(0,i-1)));else if(e.key==="ArrowRight"||e.key==="ArrowDown"){if(A!=null){e.preventDefault();const i=A+1;b(i>=u.length?null:i)}}else e.key==="Backspace"&&(A!=null?(e.preventDefault(),Z(A)):X()&&u.length&&(e.preventDefault(),b(u.length-1)))},ge=e=>{e.key==="Enter"||f.includes(e.key)?(e.preventDefault(),y&&(Q(y),I(""))):e.key==="Tab"&&y&&(e.preventDefault(),Q(y),I(""))},fe=e=>{let p=[e.clipboardData.getData("text")];for(const x of f){const S=[];for(const L of p)S.push(...L.split(x));p=S}if(p=p.flatMap(x=>x.split(/\r?\n/)).map(x=>x.trim()).filter(Boolean),p.length>1){e.preventDefault();const x=[...u],S=new Set(B);for(const L of p){const M=L.trim();if(M){if(S.has(M)){W(M);continue}if(c&&x.length>=c)break;x.push({value:M,valid:V(M)}),S.add(M)}}x.length!==u.length&&P(x),I("")}},me=()=>Y(!0),he=e=>{k.current&&e.relatedTarget instanceof Node&&k.current.contains(e.relatedTarget)||(Y(!1),b(null),y.trim()&&(Q(y),I("")))},xe=e=>{if(r)return;const i=e.target instanceof Element?e.target.closest("[data-tag]"):null;if(i){const p=Number(i.getAttribute("data-index"));b(isNaN(p)?null:p);return}e.preventDefault(),h.current?.focus(),b(null)};je(()=>{if(!T)return;const e=U.current,i=k.current;if(!e||!i)return;e.textContent=y||(R?d:"")||"";const p=e.getBoundingClientRect().width,x=i.getBoundingClientRect().width-32;ue(Math.max(16,Math.min(p+4,x)))},[y,d,T,R]);const K=te[v],ve={"--input-font-size":`${K.font}px`,"--input-height":`${K.h}px`,"--input-tag-spacing":`${K.gap}px`,minHeight:`${de}px`},we="flex items-center rounded px-[6px] py-[4px] text-[var(--input-font-size)] leading-none transition-colors select-none",ye="bg-green-50 text-green-800 hover:bg-green-100",be="bg-red-50 text-red-800 hover:bg-red-100",Me="font-bold";return t.jsxs(t.Fragment,{children:[t.jsx("div",{ref:k,className:H("relative mb-[8px] cursor-text overflow-x-hidden overflow-y-auto rounded-xl border-2 px-4 py-2",r?"cursor-not-allowed border-neutral-200 bg-neutral-50 opacity-60":"border-neutral-300 hover:border-neutral-400"),style:ve,"data-size":v,"data-focused":oe?"":void 0,"data-empty":R?"":void 0,"data-disabled":r?"":void 0,onKeyDown:pe,onMouseDown:xe,onFocus:me,onBlur:he,tabIndex:-1,children:t.jsxs("div",{className:"flex flex-wrap items-start gap-x-[var(--input-tag-spacing)] gap-y-[var(--input-tag-spacing)]",children:[u.map((e,i)=>{const p=A===i,x=re.has(e.value);return t.jsxs("div",{"data-tag":e.value,"data-index":i,className:H(we,e.valid?ye:be,p&&Me,x&&"animate-pulse"),children:[t.jsx("span",{title:e.value,children:e.value}),!r&&t.jsx("button",{type:"button","aria-label":D.formatMessage({id:"4LMrjM",defaultMessage:"Remove"}),onClick:()=>Z(i),className:"ms-[2px] inline-flex h-3.5 w-3.5 items-center justify-center rounded text-xs text-neutral-500 hover:text-neutral-900",children:D.formatMessage({id:"3pDUsa",defaultMessage:"x"})})]},e.value)}),T&&t.jsxs("div",{className:"inline-flex items-center",children:[t.jsx("span",{ref:U,className:"invisible absolute -z-10 whitespace-pre text-[var(--input-font-size)]"}),t.jsx("input",{ref:h,type:"text",value:y,placeholder:R?d:void 0,disabled:r,onChange:e=>I(e.currentTarget.value),onKeyDown:ge,onPaste:fe,className:H("m-0 border-none bg-transparent p-0","leading-[1.4] text-[var(--input-font-size)] caret-current","outline-none focus:outline-none focus-visible:outline-none","ring-0 focus:ring-0 focus-visible:ring-0","placeholder:text-neutral-400"),style:{width:ce},autoFocus:w})]})]})}),(c||C)&&t.jsxs("div",{className:"mt-1 w-full text-end font-mono text-[12px] tracking-widest text-neutral-500",children:[u.length,c?`/${c}`:null]})]})}const E=s=>{const l=s.trim();if(!l)return!1;const a=l.split("/");if(a.length>2)return!1;const[n,d]=a;if(d==="")return!1;let r;return d!==void 0&&(r=parseInt(d,10),isNaN(r))?!1:n.includes(":")?!(!qe(n)||r!==void 0&&(r<0||r>128)):!(!/^(\d{1,3}\.){3}\d{1,3}$/.test(n)||r!==void 0&&(r<0||r>32))},qe=s=>{const l=s.split("::");if(l.length>2)return!1;const a=l[0]?l[0].split(":"):[],n=l.length===2&&l[1]?l[1].split(":"):[],d=/^[0-9a-fA-F]{1,4}$/;return a.some(r=>!d.test(r))||n.some(r=>!d.test(r))?!1:l.length===1?a.length===8:a.length+n.length<8},m=Ie({title:{id:"BQ70ZO",defaultMessage:"IP allowlists"},apiSectionTitle:{id:"UoxlHB",defaultMessage:"Workspace IP Allowlist"},complianceSectionTitle:{id:"nQY8cF",defaultMessage:"Compliance API IP allowlist"},apiHelperText:{id:"hb/u6V",defaultMessage:"When enabled, only requests from the IP addresses or ranges you specify are allowed. You can toggle the allowlist on or off for the entire workspace. Changes may take up to 15 minutes to take effect."},complianceHelperText:{id:"Kog1O7",defaultMessage:"Always enforced for Compliance API keys: usage is restricted to the specified IP addresses or ranges. There is no global on/off toggle—add or remove IPs to change access. This does not impact other API keys or workspace permissions. Changes may take up to 15 minutes to take effect."},editIpsLabel:{id:"eoBlQ3",defaultMessage:"Allowed IPs / CIDR ranges"},emptyMessage:{id:"ynbWU8",defaultMessage:"Add IP address or CIDR range…"},saveButton:{id:"8c8mEa",defaultMessage:"Save"},invalidNotice:{id:"vwaoU9",defaultMessage:"One or more IP / CIDR entries are invalid."},emptyWarning:{id:"8GqXoq",defaultMessage:"You are enabling an IP allowlist with no entries. This will block traffic. Continue?"},toggleLabel:{id:"eIKgW3",defaultMessage:"Enable IP allowlist"}});function ae(s){const l=o.useMemo(()=>new Set(s?.allowed_ips??[]),[s]),[a,n]=o.useState(s?.allowed_ips??[]);o.useEffect(()=>{s&&n(s.allowed_ips)},[s]);const d=o.useMemo(()=>a.filter(f=>!E(f)),[a]),r=d.length===0,v=o.useMemo(()=>{if(!s)return a.length>0;if((s.allowed_ips?.length??0)!==a.length)return!0;for(const f of a)if(!l.has(f))return!0;return!1},[s,a,l]),g=o.useMemo(()=>a.map(f=>({value:f,valid:E(f)})),[a]),c=o.useCallback(f=>{n(f.map(w=>w.value))},[]);return{ips:a,setIps:n,tagValues:g,invalidEntries:d,isValid:r,isDirty:v,handleTagChange:c}}function Be({currentWorkspaceId:s,readonly:l=!1}){const a=ie(),n=_e(s),d=Te(s),r=o.useMemo(()=>{const h=n.data;if(h)return{allowed_ips:Array.isArray(h.allowed_ips)?h.allowed_ips:[],enabled:!!h.enabled}},[n.data]),v=o.useMemo(()=>{const h=d.data;if(h)return{allowed_ips:Array.isArray(h.allowed_ips)?h.allowed_ips:[]}},[d.data]),g=ae(r),c=ae(v),f=Ee(s),w=Re(s),C=Fe(s),D=o.useCallback(()=>{g.isValid&&f.mutate({allowed_ips:g.ips})},[g.isValid,g.ips,f]),_=o.useCallback(()=>{c.isValid&&w.mutate({allowed_ips:c.ips})},[c.isValid,c.ips,w]),F=o.useCallback(h=>{h&&g.ips.length===0&&!window.confirm(a.formatMessage(m.emptyWarning))||C.mutate({enabled:h})},[C,g.ips,a]),q=n.isLoading||d.isLoading,u=n.isFetching||d.isFetching;return t.jsxs(t.Fragment,{children:[t.jsx(Ae,{children:t.jsx("title",{children:a.formatMessage(m.title)})}),t.jsx(Pe,{title:a.formatMessage(m.title)}),t.jsx(Se,{showSpinner:q,children:t.jsxs("div",{className:"space-y-10 pt-6",children:[r&&t.jsx(ee,{title:m.apiSectionTitle,children:t.jsxs("div",{className:"max-w-4xl space-y-6 pb-6",children:[t.jsx("p",{className:"text-sm text-neutral-500",children:a.formatMessage(m.apiHelperText)}),t.jsx("label",{className:"block text-sm font-medium text-neutral-700",children:t.jsx(j,{...m.editIpsLabel})}),t.jsx(se,{value:g.tagValues,onChange:g.handleTagChange,validator:E,placeholder:a.formatMessage(m.emptyMessage),disabled:l||f.isPending,size:"xl",rows:3}),t.jsxs("div",{className:"mt-2 flex w-full items-center",children:[g.invalidEntries.length>0&&t.jsx("div",{className:"text-sm text-red-600",role:"alert",children:a.formatMessage(m.invalidNotice)}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ce,{checked:!!r.enabled,disabled:l||C.isPending,onCheckedChange:F,"aria-label":a.formatMessage(m.toggleLabel)}),t.jsx("span",{className:"text-sm text-neutral-600",children:r.enabled?t.jsx(j,{id:"0eFOl8",defaultMessage:"Allowlist is active."}):t.jsx(j,{id:"4N2jsY",defaultMessage:"Allowlist is inactive."})})]}),t.jsx(J,{className:"ms-auto",onClick:D,disabled:l||!g.isDirty||!g.isValid||f.isPending||u,children:t.jsx(j,{...m.saveButton})})]})]})}),v&&t.jsx(ee,{title:m.complianceSectionTitle,children:t.jsxs("div",{className:"max-w-4xl space-y-6 pb-6",children:[t.jsx("p",{className:"text-sm text-neutral-500",children:a.formatMessage(m.complianceHelperText)}),t.jsx("label",{className:"block text-sm font-medium text-neutral-700",children:t.jsx(j,{...m.editIpsLabel})}),t.jsx(se,{value:c.tagValues,onChange:c.handleTagChange,validator:E,placeholder:a.formatMessage(m.emptyMessage),disabled:l||w.isPending,size:"xl",rows:3}),t.jsxs("div",{className:"mt-2 flex w-full items-center",children:[c.invalidEntries.length>0&&t.jsx("div",{className:"text-sm text-red-600",role:"alert",children:a.formatMessage(m.invalidNotice)}),t.jsx(J,{className:"ms-auto",onClick:_,disabled:l||!c.isDirty||!c.isValid||w.isPending||u,children:t.jsx(j,{...m.saveButton})})]})]})})]})})]})}const Ve=o.memo(Be),ut=ke(function(){const l=Ne();return De(),t.jsx(Ve,{...l})});export{ut as default};
//# sourceMappingURL=f6cg1rhru01ig7oe.js.map
