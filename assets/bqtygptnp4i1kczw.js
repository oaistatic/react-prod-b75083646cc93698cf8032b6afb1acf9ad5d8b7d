import{j as e,M as r,r as f,e as g,s as C,d as T}from"./lu2xqwqmjc95q6j6.js";import{a4 as i,a3 as E,S as R,q as O}from"./rseqzngxzbdt1oxg.js";import{h0 as G,b2 as H,kK as I,d as p,hi as D,h1 as F,B,a as q,q as V,g8 as W,c as z}from"./hml6mmd5fyx85si7.js";import{q as $,W as Q}from"./ktoofw7mjru0a6r5.js";import{B as M}from"./hl8o93vkogird41u.js";import{I as K}from"./dth89wjzf9gy8rh3.js";import{S as U}from"./dy6grwmx1xskr6sg.js";import{P as u,a as N,b as S}from"./dp7t1jmnbbend843.js";function X({className:t,githubInstallations:a,githubInstallationsLoading:s,selectedInstallationId:o,handleValueChange:l}){return e.jsx(M,{className:t,selectedInstallationId:o,githubInstallationsLoading:s,handleValueChange:l,children:a.length>0?a.map(n=>e.jsx(i.Item,{value:n.id.toString(),children:n.account_login},n.id)):e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("p",{className:"text-token-text-primary text-sm",children:e.jsx(r,{id:"wham.accountSelect.noGitHubAccounts",defaultMessage:"No GitHub accounts"})}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(r,{id:"wham.accountSelect.noGitHubAccountsDescription",defaultMessage:"Codex requires a GitHub account to work"})})]})})}function Z({className:t,selectedInstallationId:a,setSelectedInstallationId:s}){const{data:o,isLoading:l}=$(),n=f.useMemo(()=>[...o?.memberships??[],...o?.other??[]],[o]),c=o?.memberships??[],m=o?.other??[],h=n?.find(x=>x.id===a);f.useEffect(()=>{a&&!h?s(null):!a&&n?.length&&s(n[0].id)},[a,h,n,s]);const j=x=>{s(parseInt(x))};if(o?.likely_on_old_access_token)return e.jsx(X,{className:t,githubInstallations:n,githubInstallationsLoading:l,selectedInstallationId:a,handleValueChange:j});const y=e.jsx(e.Fragment,{children:n.length>0?e.jsxs(e.Fragment,{children:[c.length>0&&e.jsxs(i.Group,{children:[e.jsx(i.Label,{className:"text-token-text-tertiary px-2!",children:e.jsx(r,{id:"OMOdyv",defaultMessage:"Member"})}),c.map(x=>e.jsx(i.Item,{value:x.id.toString(),children:x.account_login},`member-${x.id}`))]}),c.length>0&&m.length>0&&e.jsx(i.Separator,{className:"mx-3!"}),m.length>0&&e.jsxs(i.Group,{children:[e.jsx(i.Label,{className:"text-token-text-tertiary px-2!",children:e.jsx(r,{id:"w/PT1a",defaultMessage:"Other"})}),m.map(x=>e.jsx(i.Item,{value:x.id.toString(),children:x.account_login},`other-${x.id}`))]})]}):e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("p",{className:"text-token-text-primary text-sm",children:e.jsx(r,{id:"wham.accountSelect.noGitHubAccounts",defaultMessage:"No GitHub accounts"})}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(r,{id:"wham.accountSelect.noGitHubAccountsDescription",defaultMessage:"Codex requires a GitHub account to work"})})]})});return e.jsx(M,{className:t,selectedInstallationId:a,githubInstallationsLoading:l,handleValueChange:j,children:y})}function ge({className:t,selectedInstallationId:a,setSelectedInstallationId:s}){return e.jsx(Z,{className:t,selectedInstallationId:a,setSelectedInstallationId:s})}function J({repository:t,isSelected:a,className:s,isDisabled:o,disablePill:l}){const n=g(),c=t.visibility==="private"?n.formatMessage({id:"wham.repositorySection.private",defaultMessage:"Private"}):n.formatMessage({id:"wham.repositorySection.public",defaultMessage:"Public"});return e.jsxs("div",{className:p("flex items-center justify-between gap-2",s),children:[e.jsx("div",{className:p("flex items-start gap-3",o&&"opacity-50"),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-start text-sm font-medium",children:t.name}),e.jsx("a",{href:`https://github.com/${t.repository_full_name}`,target:"_blank",rel:"noopener noreferrer",className:"text-token-text-secondary opacity-0 group-hover:opacity-100","aria-label":n.formatMessage({id:"wham.repositorySection.viewRepositoryAriaLabel",defaultMessage:"Link to view {repository} in GitHub"},{repository:t.name}),onClick:m=>{m.stopPropagation()},children:e.jsx(D,{className:"icon-sm"})})]}),e.jsx("div",{className:"text-token-text-secondary text-start text-sm leading-tight font-normal",children:[t.language,c].filter(Boolean).map((m,h)=>e.jsx("span",{className:"after:mx-1 after:content-['\\u00b7'] last:after:content-[none]",children:m},h))})]})}),o&&l?l:a?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(F,{className:"icon-sm"})}):null]})}function Y({repository:t,isSelected:a,onClick:s,shouldDisableRow:o,disablePill:l}){const n=g(),c=o?.(t);return e.jsx("button",{className:p("group flex w-full items-center justify-between gap-2 rounded-md p-3",c?"cursor-default select-none":"hover:bg-token-bg-tertiary cursor-pointer"),"aria-label":n.formatMessage({id:"wham.repositorySection.repositoryAriaLabel",defaultMessage:"Select repository {repository} to create an environment with"},{repository:t.name}),disabled:c,onClick:s,type:"button",children:e.jsx(J,{repository:t,isSelected:a,className:"w-full",isDisabled:c,disablePill:l})})}function w(){return e.jsx("div",{className:"flex w-full items-center justify-between gap-2 rounded-md",children:e.jsx(E,{className:"h-14 w-full"})})}const k=100;function ee({selectedRepository:t,onSelect:a,installationId:s,shouldDisableRow:o,disablePill:l}){const n=g(),[c,m]=f.useState(""),{data:h,isLoading:j,fetchNextPage:y,hasNextPage:x,isFetchingNextPage:A,error:P}=C({queryKey:["repositories",s],enabled:!!s,initialPageParam:1,queryFn:({pageParam:d})=>Q.getRepositoriesByInstallationId(s??0,d,k),getNextPageParam:(d,L)=>{if(!((d?.repositories??[]).length<k))return L.length+1},refetchOnWindowFocus:!0}),v=f.useMemo(()=>h?.pages.flatMap(d=>d.repositories??[])??[],[h]).filter(d=>d.name.toLowerCase().includes(c.toLowerCase())),_=I(`installations/${s}`);return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(r,{id:"wham.createEnvironments.repository",defaultMessage:"Repository"})}),e.jsx("div",{className:"flex justify-between",children:e.jsx(G,{color:"search",iconPosition:"left",icon:H,className:"text-token-text-tertiary flex h-8 w-full items-center rounded-md!",inputClassName:"text-token-text-primary w-full",containerInputClassName:"w-full",name:"search-repos",type:"text",value:c,onChange:d=>m(d.target.value),placeholder:n.formatMessage({id:"wham.repositorySection.searchPlaceholder",defaultMessage:"Search"}),ariaLabel:n.formatMessage({id:"wham.repositorySection.searchAria",defaultMessage:"Search"})})}),e.jsxs("div",{className:"border-token-border-heavy bg-token-bg-primary flex flex-col gap-2 rounded-lg border p-3",children:[e.jsx("div",{className:"flex max-h-56 flex-col overflow-y-auto",children:!s||j?e.jsxs("div",{className:"flex h-full flex-col gap-2",children:[e.jsx(w,{}),e.jsx(w,{}),e.jsx(w,{}),e.jsx(w,{})]}):P?e.jsx("div",{className:"text-token-text-primary flex h-full items-center justify-center text-sm",children:e.jsx(r,{id:"wham.createEnvironments.repositorySection.error",defaultMessage:"Failed to load repositories. Please ensure you have connected your GitHub account."})}):e.jsxs(e.Fragment,{children:[v.length===0&&!x?e.jsx("div",{className:"text-token-text-secondary text-md flex h-24 w-full items-center justify-center",children:e.jsx(r,{id:"wham.createEnvironments.repositorySection.noRepositories.short",defaultMessage:"No repositories found"})}):v.map(d=>e.jsxs("div",{children:[e.jsx(Y,{repository:d,isSelected:t===d.id,onClick:()=>a(d.id,d.repository_full_name,d.name),shouldDisableRow:o,disablePill:l}),e.jsx("div",{className:"border-token-border-light border-t"})]},d.id)),e.jsx(K,{isFetchingNextPage:A,hasNextPage:x??!1,fetchNextPage:y,bgColor:"dark:bg-token-bg-secondary"})]})}),s&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary pt-3 text-start text-xs leading-none",children:e.jsx(r,{id:"wham.createEnvironments.repositorySection.access",defaultMessage:"This list only includes repositories that you have access to in GitHub and can use with Codex."})}),e.jsx("p",{className:"text-token-text-secondary text-start text-xs leading-none",children:s?e.jsx(r,{id:"wham.createEnvironments.repositorySection.noRepositories",defaultMessage:"Missing a repo? <link>Configure repository access</link>.",values:{link:d=>e.jsx("a",{href:_,target:"_blank",rel:"noopener noreferrer",className:"underline","aria-label":n.formatMessage({id:"wham.repositorySection.configureRepositoryAccessAriaLabel",defaultMessage:"Link to configure repository access in GitHub installations settings page"}),children:d})}}):e.jsx(r,{id:"wham.createEnvironments.repositorySection.selectAccount",defaultMessage:"Select an account to connect to"})})]})]})]})}const pe=f.memo(ee),b=T({toggleOffLabel:{id:"wham.networkAccessToggle.off",defaultMessage:"Off"},toggleOnLabel:{id:"wham.networkAccessToggle.on",defaultMessage:"On"},toggleOffAriaLabel:{id:"wham.networkAccessToggle.offAriaLabel",defaultMessage:"Toggle to turn off internet access"},toggleOnAriaLabel:{id:"wham.networkAccessToggle.onAriaLabel",defaultMessage:"Toggle to turn on internet access"}});function je(){const t=q(),a=V(t),{data:s,isLoading:o}=W(a?.getWorkspaceId());return z(t,"3507761600")?o?null:s==null?!1:!s.beta_settings.codex_agent_network_access:!1}function we({className:t}){return e.jsxs("div",{className:p("border-token-border-light flex flex-col items-start justify-start gap-1 self-stretch rounded-lg border bg-orange-600/10 p-3",t),children:[e.jsx("div",{className:"text-token-text-status-warning justify-start self-stretch text-xs leading-none font-medium",children:e.jsx(r,{id:"wham.createEnvironments.networkAccessAlert.title",defaultMessage:"Enabling internet access exposes your environment to security risks"})}),e.jsx("div",{className:"text-token-text-primary justify-start self-stretch text-xs",children:e.jsx(r,{id:"wham.createEnvironments.networkAccessAlert.description",defaultMessage:"These include prompt injection, exfiltration of code or secrets, inclusion of malware or vulnerabilities, or use of content with license restrictions. <docsLink>See the docs</docsLink> for an example exfiltration attack.{br}{br}To mitigate risks, only allow necessary domains and methods, and always review Codex's outputs and work log.",values:{br:e.jsx("br",{}),docsLink:a=>e.jsx("a",{href:"https://platform.openai.com/docs/codex/agent-network#preset-domain-lists",target:"_blank",rel:"noopener noreferrer",className:"underline",children:a})}})})]})}function be({className:t}){return e.jsxs("div",{className:p("border-token-border-light flex flex-col items-start justify-start gap-1 self-stretch rounded-lg border bg-orange-600/10 p-3",t),children:[e.jsx("div",{className:"text-token-text-status-warning justify-start self-stretch text-xs leading-none font-medium",children:e.jsx(r,{id:"wham.createEnvironments.internalNetworkAccessAlert.title",defaultMessage:"[OpenAI internal] Internet access settings may not be honored"})}),e.jsx("div",{className:"text-token-text-primary justify-start self-stretch text-xs",children:e.jsx(r,{id:"wham.createEnvironments.internalNetworkAccessAlert.description",defaultMessage:"Internet access settings are currently overridden for repos owned by the openai GitHub organization. Repos not owned by openai are not affected."})})]})}function te({accessSettings:t,onAccessSettingsChange:a,disabled:s}){const o=g();return e.jsx(U,{className:p("max-w-32",s&&"pointer-events-none opacity-50"),ariaLabel:o.formatMessage({id:"wham.networkAccessToggle.label",defaultMessage:"Internet access"}),value:t?.mode??"off",onChange:l=>{a(l==="off"?{mode:"off"}:{mode:"on",preset_allowlist:S})},leftItem:{ariaLabel:o.formatMessage(b.toggleOffAriaLabel),label:o.formatMessage(b.toggleOffLabel),value:"off"},rightItem:{ariaLabel:o.formatMessage(b.toggleOnAriaLabel),label:o.formatMessage(b.toggleOnLabel),value:"on"}})}function se({value:t,onValueChange:a}){const s=g();return e.jsxs(i.Root,{value:t,onValueChange:o=>{o&&a(o)},children:[e.jsx(i.Trigger,{className:"border-token-border-default! bg-token-bg-primary! w-fit min-w-64 rounded-md! border","aria-label":s.formatMessage({id:"wham.presetAllowlistSelectorPopover.openPresetAllowlist",defaultMessage:"Open preset allowlist menu"}),children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(i.Value,{placeholder:s.formatMessage({id:"wham.presetAllowlistSelectorPopover.selectPresetAllowlist",defaultMessage:"Select preset allowlist option"})}),e.jsx(i.Icon,{})]})}),e.jsx(i.Portal,{children:e.jsxs(i.Content,{align:"start",className:"bg-token-bg-primary min-w-64",children:[e.jsx(i.Item,{value:u,children:e.jsx("div",{className:"flex w-full justify-start pe-2 text-start",children:e.jsx(r,{id:"wham.presetAllowlistSelectorPopover.none",defaultMessage:"None"})})}),e.jsx(i.Item,{value:S,children:e.jsx("div",{className:"flex w-full justify-start pe-2 text-start",children:e.jsx(r,{id:"wham.presetAllowlistSelectorPopover.codex",defaultMessage:"Common dependencies"})})}),e.jsx(i.Item,{value:N,children:e.jsx("div",{className:"flex w-full justify-start pe-2 text-start",children:e.jsx(r,{id:"wham.presetAllowlistSelectorPopover.all",defaultMessage:"All (unrestricted)"})})})]})})]})}function ae({value:t,onValueChange:a}){const s=g();return e.jsxs(i.Root,{value:t?"on":"off",onValueChange:o=>a(o==="on"),children:[e.jsx(i.Trigger,{className:"border-token-border-default! bg-token-bg-primary! w-fit min-w-64 rounded-md! border","aria-label":s.formatMessage({id:"wham.networkAccess.safeMethodsMenu.openSafeMethodsMenu",defaultMessage:"Open safe HTTP methods menu"}),children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(i.Value,{placeholder:s.formatMessage({id:"wham.networkAccess.safeMethodsMenu.selectSafeMethodsOption",defaultMessage:"Select safe HTTP methods option"})}),e.jsx(i.Icon,{})]})}),e.jsx(i.Portal,{children:e.jsxs(i.Content,{align:"start",className:"bg-token-bg-primary",children:[e.jsx(i.Item,{value:"off",children:e.jsx("div",{className:"flex w-full justify-start pe-2 text-start",children:e.jsx(r,{id:"wham.networkAccess.safeMethodsMenu.off",defaultMessage:"All methods"})})}),e.jsx(i.Item,{value:"on",children:e.jsx("div",{className:"flex w-full justify-start pe-2 text-start",children:e.jsx(r,{id:"wham.networkAccess.safeMethodsMenu.on",defaultMessage:"GET, HEAD, and OPTIONS"})})})]})})]})}function oe({value:t,onChange:a,preset:s}){const o=g(),[l,n]=f.useState(s!==u&&t.length===0);return l&&s!==u?e.jsx(B,{icon:O,color:"secondary",size:"medium",type:"button",className:"ms-auto",onClick:()=>n(!1),children:e.jsx(r,{id:"wham.networkAccess.additionalAllowedDomainsButton",defaultMessage:"Add domains"})}):e.jsxs(e.Fragment,{children:[e.jsx("textarea",{name:"allowlistDomains",className:"border-token-border-default focus-within:border-token-border-heavy focus-within:ring-token-text-secondary bg-token-bg-primary w-full resize-y rounded-md border px-3 py-2 font-mono text-xs shadow-none focus-within:ring-1",value:t,rows:3,onChange:c=>{a(c.target.value)},placeholder:o.formatMessage({id:"wham.networkAccess.allowlistAdditionalDomainsPlaceholder",defaultMessage:"domain1, domain2, domain3"}),"aria-label":o.formatMessage({id:"wham.networkAccess.allowlistDomains",defaultMessage:"Additional allowed domains"})}),e.jsx("p",{className:"text-token-text-tertiary text-xs",children:e.jsx(r,{id:"wham.networkAccess.allowlistDomainsDescription",defaultMessage:"Enter domains, separated by commas"})})]})}function ne({agentNetworkAccess:t,onChange:a,disabledByWorkspaceSettings:s}){const[o,l]=f.useState(()=>({[t?.preset_allowlist??u]:t?.allowlist_domains??""}));return s&&(t={mode:"off"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(r,{id:"wham.createEnvironments.internetAccessSection.label",defaultMessage:"Agent internet access"})}),e.jsx(te,{accessSettings:t,onAccessSettingsChange:a,disabled:s}),s&&e.jsx("p",{className:"text-token-text-tertiary text-xs",children:e.jsx(r,{id:"wham.createEnvironments.networkAccessSection.disabledByWorkspaceSettings",defaultMessage:"Agent internet access is not permitted by your workspace settings."})}),t==null||t.mode==="off"?e.jsx("p",{className:"text-token-text-tertiary mb-2 text-xs",children:e.jsx(r,{id:"wham.networkAccess.offDescription",defaultMessage:"Internet access will be disabled after setup. Codex will only be able to use dependencies installed by the setup script."})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"py-2",children:e.jsxs("div",{className:"flex flex-col gap-4 border-s-3 ps-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(r,{id:"wham.networkAccess.allowlist",defaultMessage:"Domain allowlist"})}),e.jsxs("div",{className:"flex flex-row items-center gap-3",children:[e.jsx(se,{value:t.preset_allowlist??u,onValueChange:n=>{const c=t.preset_allowlist??u,m={...o,[c]:t.allowlist_domains??""};l(m),a({...t,preset_allowlist:n,allowlist_domains:m[n]??""})}}),e.jsxs("a",{href:"https://platform.openai.com/docs/codex/agent-network#preset-domain-lists",target:"_blank",rel:"noopener noreferrer",className:"text-token-text-tertiary flex items-center gap-1 text-xs",children:[e.jsx(R,{className:"icon-sm"}),e.jsx(r,{id:"wham.networkTab.allowlist.readList",defaultMessage:"Domain details"})]})]})]}),t.preset_allowlist!==N&&e.jsxs("div",{children:[e.jsx("p",{className:"text-token-text-primary pb-2 text-sm font-medium",children:e.jsx(r,{id:"wham.networkAccess.additionalAllowedDomains",defaultMessage:"Additional allowed domains"})}),e.jsx(oe,{value:t.allowlist_domains??"",onChange:n=>{const c=t.preset_allowlist??u;l(m=>({...m,[c]:n})),a({...t,allowlist_domains:n})},preset:t.preset_allowlist??u})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(r,{id:"wham.networkAccess.allowedHttpMethods",defaultMessage:"Allowed HTTP Methods"})}),e.jsx(ae,{value:!!t.safe_methods_only,onValueChange:n=>a({...t,safe_methods_only:n})})]})]})})})]})}const ye=f.memo(ne);export{ge as A,be as I,ye as N,pe as R,we as a,J as b,je as u};
//# sourceMappingURL=bqtygptnp4i1kczw.js.map
