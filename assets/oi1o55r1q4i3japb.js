import{r as C,e as ht,j as a,m as k,A as H,ar as Ft}from"./lu2xqwqmjc95q6j6.js";import{iE as zt,qs as Wt,mU as N,b$ as gt,mV as I,qt as at,qu as Ct,a1 as $t,a2 as qt,gC as Jt,o2 as Zt,gA as Qt,gB as te,nb as ee}from"./rseqzngxzbdt1oxg.js";import{j as _,h as w,l as oe,c as j,m as Et,x as ne,y as xt,z as se,A as bt,E as re,B as ie}from"./iv9cwo4pw9mxn1rf.js";import{C as ct}from"./glo5fx5nh6p199c2.js";import{T as yt,Z as Y}from"./jy1u8exw8iz2slve.js";import{u as U,i as $,d as ae}from"./b5mk7g3hp5gwjh3g.js";import{eb as z,di as ce,d as M,lh as le,e9 as ue,t as vt,ef as ot,hz as de,bG as q,bB as Tt,bC as fe,dn as me,bF as pe,bI as St,bJ as he,ay as At,gg as ge}from"./hml6mmd5fyx85si7.js";import{p as Ot,q as Lt,a as Ce}from"./l1uu5qm215xg1y5k.js";import{P as Ee,H as xe}from"./ohrnryaqpp1d2um7.js";import{E as tt,j as be,G as P,c as lt}from"./nv7zjskuxqbd0a8k.js";import{u as J}from"./em6xteal3laxzbp5.js";import{S as ye}from"./k7qzfsghcibbkoqo.js";import{i as ve}from"./d0g29t0qm74gluj7.js";var D=(t=>(t[t.up=-1]="up",t[t.down=1]="down",t))(D||{}),W=(t=>(t.COMMENT="comment",t.COMPOSER="composer",t))(W||{}),A=(t=>(t.COLLAPSED="collapsed",t.EXPANDED="expanded",t))(A||{});const Nt=([t,e],[o,s])=>{const n=t+e,r=o+s;return t<r&&o<n},nt=([t,e])=>t+e,R=t=>{if(t.type===A.COLLAPSED)return[t.offsetY??0,0];const{offsetY:e,shiftY:o=0,height:s=0}=t,n=e+o;return o<0?[n,s+Math.abs(o)]:[n,s]},Te=(t,e,o)=>{if(!Nt(t,e))return null;const[s,n]=t,r=s+n,[i,c]=e,l=i+c,u=i-r,d=l-s;return o===D.up?u:d};var Pt=(t=>(t.ABOVE="above",t.BELOW="below",t))(Pt||{});function V(t,e){return z(t.coordsAtPos(e))}const ut=360,Se=250,wt=44,Ae=.5,Oe=[.5,.9,1],Le=[1,.75,.2],Ne=({onClose:t,onSubmit:e,opensOverDocument:o=!1,opensFromGutter:s=!1,gutterHasComments:n=!1},r)=>{const i=ht(),c=C.useRef(null),l=C.useRef(!1),[u,d]=C.useState(""),[f,m]=C.useState(!0),p=()=>{document.hasFocus()&&(d(""),t?.(l.current))},h=(b,y=u)=>{l.current=!0,e?.(b,y),d("")},E=ce(({windowWidth:b})=>o?b<ut+100?Se:ut:tt,0),g={};s&&(g.top=-12),o&&s?g.right=0:g.left=0;let x="";s&&!o?x="8px 50%":s&&o?x="calc(100% + 8px) 50%":o&&(x="center left");let T=0;s&&!o&&n&&(T=be);const S=b=>{const{metaKey:y,shiftKey:O,key:X}=b;X==="Enter"&&!b.nativeEvent.isComposing&&u&&!(O||y)?(h(b),b.preventDefault()):X==="Escape"&&(d(""),t?.(!1))},v=i.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return a.jsx(k.div,{ref:zt(c,r),className:M("absolute flex items-center",Y.commentComposer),style:{...g,minHeight:wt},transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:T},exit:{translateX:0},children:a.jsx(k.div,{className:M("no-scrollbar border-token-border-default relative z-10 flex items-center overflow-x-hidden border",yt,{"rounded-full":f,"rounded-2xl":!f}),initial:{width:o?tt:24,scale:o?void 0:Ae},animate:{width:E,scale:o?void 0:Oe},exit:{filter:"blur(16px)",scale:o?void 0:Le,width:o?tt:24,opacity:o?0:[1,1,0]},transition:{type:"spring",bounce:o?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:x},children:a.jsxs(k.div,{className:"bg-token-main-surface-primary relative z-0 flex w-full items-center px-4 py-2.5",children:[a.jsx(k.div,{className:"absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl backdrop-saturate-25 dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),a.jsx(ve,{"aria-placeholder":v,value:u,className:"text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent px-1 py-0 pe-2 outline-0 focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:p,onHeightChange:(b,{rowHeight:y})=>{m(Math.floor(b/y)<=1)},onChange:({target:{value:b}})=>d(b),onKeyDown:S}),!u&&a.jsx("span",{"aria-hidden":!0,className:"text-token-text-secondary absolute inline-block ps-1 text-nowrap",children:v}),a.jsx(k.button,{className:M("-me-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!f}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:b=>h(b),children:a.jsx(Wt,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},Mt=C.forwardRef(Ne),Pe=(t,e)=>{if(e?.type!==_.SELECTION)return null;try{const{from:o,to:s}=e,{top:n}=t.dom.getBoundingClientRect(),{bottom:r,top:i}=V(t,o),{bottom:c}=V(t,s),l=$(t)?-30:-24;let u=r-n+l;const d=i-n;return u=c-n+8,{composerTop:u,loadingTop:d}}catch(o){return N.logError("Invalid position in SelectionCommentComposer",o),null}},we=({toolbarPosition:t,composerRect:e,view:o})=>{const{width:s}=e;let{height:n}=e;if(n||=wt,o==null||t==null)return null;const{right:r,left:i}=o.dom.getBoundingClientRect(),{left:c,top:l,aboveOrBelow:u,toolbarSize:d}=t,f=l-(u===Pt.ABOVE&&n!==0?n-d.height:0),m=ae(o)?12:0;return{left:Math.min(c,r-i-s-m),composerTop:f,aboveOrBelow:u}},Me=({toolbarPosition:t,commentingOn:e,isWaitingForCommentResponse:o=!1,onAddComment:s})=>{const n=U()(),[r,i]=J(),c=we({view:n,toolbarPosition:t,composerRect:r});if(n==null||c==null)return null;const{left:l,composerTop:u}=c,d=(f,m)=>{if(e?.type!==_.SELECTION)return;const{action:p,sourceRange:h}=e;s?.(f,m,p,h,e.type)};return a.jsx(H,{children:e?.type===_.SELECTION&&!o&&a.jsx("div",{className:M("absolute",Y.commentComposer),style:{left:l,top:u},children:a.jsx(Mt,{opensOverDocument:!0,onClose:f=>{f||(w.cancelCommentingOn(),n&&$(n)&&!n.state.selection.empty&&n.dispatch(n.state.tr.setSelection(new le(n.state.selection.$from))),document.getSelection()?.removeAllRanges())},onSubmit:d,ref:i})},"composer")})};function ke(t,e,o){const s=t+e;for(const n of o.values()){const r=n.start,i=n.end;if(t<i&&r<s)return!0}return!1}const je=50,De=200,_e=[Ee.proseMirrorNodeName(),xe.proseMirrorNodeName()],Be=t=>t?t.isBlock:!1,Ie=t=>{if(!t)return!1;const{isBlock:e,type:{name:o}}=t;return e&&_e.includes(o)},Re=(t,e,o,s)=>{const n=t.posAtCoords({left:e,top:o});if(n==null)return;const{pos:r,inside:i}=n;if(i===-1)return;const{state:c}=t;let l=r,u=c.doc.nodeAt(l);for(;!Be(u)&&l>=0;)l--,u=c.doc.nodeAt(l);if(!u||!Ie(u))return;const d=s!=null&&ke(l,u.nodeSize,s);return{node:u,nodeHasComment:d,pos:l}};function He(t,e,o){const s=Re(t,e.x,e.y,o);if(s==null)return null;const{node:n,pos:r,nodeHasComment:i}=s,{top:c}=t.coordsAtPos(0);function l(){const p=r+1;return Ce(t.state.doc,p)&&t.state.doc.nodeAt(p)?.isText?t.coordsAtPos(p).top:t.coordsAtPos(r).top}const u=l(),d=u-c;return{height:t.coordsAtPos(r+n.nodeSize-1).bottom-u,nodeHasComment:i,mouseEnteredAt:Date.now(),yOffset:d,pos:r}}function Ye(t){const e=C.useRef(!1),o=C.useRef(!1),[s,n]=C.useState(null),r=oe(),i=r()?.dom,c=C.useRef(!1),l=j(({visibleBlockCommentLauncher_DEBUG_ONLY:f})=>f),u=C.useCallback(gt(f=>{e.current=!0;const{commentingOn:m}=j.getState();if(o.current||m!=null)return;const p=r();if(p==null||!e.current)return n(null);const{dom:h,state:E}=p,g=Ot(Lt,E)?.positions;if(g==null)return n(null);const x=He(p,f,g);if(x==null||x.nodeHasComment&&t===P.COLLAPSED){n(null);return}if(c.current&&x.yOffset!==s?.yOffset){n(null);return}const T=p.coordsAtPos(0),S=h.getBoundingClientRect().width,b=(f.x-T.left)/S>=je/100;n(b?x:null)},De),[r,c,s]);C.useEffect(()=>{if(i!=null)return ue(i,{mouseenter:()=>{e.current=!0,o.current=!1},mouseleave:({relatedTarget:f})=>{if(u.cancel(),f instanceof HTMLElement&&f.closest("[data-block-comment-launcher]")){o.current=!0;return}o.current=!1,e.current=!1,j.getState().commentingOn==null&&n(null)},mousemove:u})},[r,i,t,u]);const d=C.useCallback(({relatedTarget:f})=>{const{commentingOn:m}=j.getState();m==null&&f!==i&&(o.current=!1,n(null))},[i]);return{visibleBlockComment:l??s,handleMouseLeave:d,onComposerVisibleChange:f=>{c.current=f}}}const Ge=({isWaitingForCommentResponse:t=!1,opensOverDocument:e=!1,hasComments:o=!1,activeBlockComment:s,composerRef:n,onLaunchComposer:r,onMouseLeave:i,onSubmit:c})=>{const[l,u]=C.useState(!1),{yOffset:d,height:f,pos:m}=s,p=()=>{u(!0),r?.(),N.logButtonClick(I.BLOCK_COMMENT_LAUNCHER),w.startCommentingOn({type:_.BLOCK,pos:m})},h=x=>{x||(u(!1),w.cancelCommentingOn())},E=(x,T)=>{u(!1),c?.(x,T)};C.useEffect(()=>()=>{w.mouseLeaveBlock()},[]);const g=o&&l?e?-88:88:0;return a.jsx(k.div,{className:M("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",Y.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:f,translateY:d},onMouseLeave:i,"data-block-comment-launcher":!0,children:a.jsxs(H,{children:[l?a.jsx(Mt,{ref:n,opensFromGutter:!0,onClose:h,onSubmit:E,gutterHasComments:o,opensOverDocument:e},"composer"):null,a.jsx(k.button,{initial:{opacity:0},animate:{opacity:l?0:1,translateX:g},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-right-4 after:-left-1 after:content-['']",onClick:p,onMouseEnter:()=>w.mouseEnterBlock(m),onMouseLeave:()=>w.mouseLeaveBlock(),disabled:l||t,children:a.jsx(ne,{isLoading:t})},"launcer")]})})},Ve=({isWaitingForCommentResponse:t=!1,isRequestActive:e=!1,hasComments:o=!1,composerRef:s,gutterMode:n,onAddComment:r})=>{const i=Et(),{visibleBlockComment:c,handleMouseLeave:l,onComposerVisibleChange:u}=Ye(n),d=(f,m)=>{if(!c||!i)return;const{doc:p}=i,{pos:h}=c,E=p.nodeAt(h);if(!E)return;const{attrs:{start:g,end:x}}=E;r?.(f,m,xt.ASK,{start:g,end:x},_.BLOCK)};return a.jsx(H,{onExitComplete:()=>u(!1),children:c&&i&&(t||!e)&&a.jsx(Ge,{composerRef:s,isWaitingForCommentResponse:t,opensOverDocument:n===P.COLLAPSED,activeBlockComment:c,hasComments:o,onSubmit:d,onMouseLeave:l,onLaunchComposer:()=>u(!0)},"launcher")})},Ue=({onAcceptComment:t,onDismissComment:e,disableActions:o=!1,entry:s,isGutterCollapsed:n=!1,isHovered:r=!1,isFocused:i=!1,isSomeCommentFocused:c=!1})=>{const{offsetY:l,type:u}=s,[d,f]=Ft();let m=null;if(u===A.COLLAPSED)m=!i&&a.jsx(se,{offsetY:l,count:s.count,onClick:()=>{N.logButtonClick(I.COLLAPSED_COMMENT),w.focusComment(s.children[0])}},"collapsed");else{const{comment:p}=s;if(p==null||p.content===""||p.status===at.DISMISSED)m=null;else if(p.status===at.ACCEPT_INITIATED)m=a.jsx("div",{className:"absolute",style:{top:l},children:a.jsx(bt,{})},"loading");else{const{id:h}=p;m=a.jsx(re,{isSomeCommentFocused:c,isHovered:r,isFocused:i,offsetY:l,disableActions:o,onClick:()=>{N.logButtonClick(I.EXPANDED_COMMENT),w.focusComment(h)},onMouseEnter:()=>w.mouseEnterComment(h),onMouseLeave:()=>w.mouseLeaveComment(),comment:p,onAccept:E=>{N.logButtonClick(I.COMMENT_ACCEPT,{commentId:h}),t?.(E,h)},onDismiss:()=>{N.logButtonClick(I.COMMENT_DISMISS,{commentId:h}),e?.(h)},opensOverDocument:n},"expanded")}}return a.jsx(H,{onExitComplete:()=>f?.(),children:d&&m})},dt=({onMeasureHeight:t,comment:e,isFocused:o=!1})=>{const[{height:s},n]=J();return vt(()=>{t?.(s)},[s]),a.jsx(ie,{ref:n,comment:e,isFocused:o,disableAnimations:!0})},Xe=({comments:t,onMeasure:e,getStableCommentId:o})=>{const s=C.useRef(new Map),n=C.useRef(new Map),r=C.useRef(null),i=(c,l,u=!1)=>{l&&(u?n.current.set(o(c),l):s.current.set(o(c),l),r.current&&cancelAnimationFrame(r.current),r.current=requestAnimationFrame(()=>{e?.({focusedHeights:new Map(n.current),heights:new Map(s.current)}),r.current=null}))};return t?.length?a.jsxs("div",{className:"pointer-events-none invisible fixed start-0 top-0 overflow-clip","aria-hidden":"true",children:[t.map(c=>a.jsx(dt,{comment:c,onMeasureHeight:l=>i(c.id,l)},o(c.id))),t.map(c=>a.jsx(dt,{isFocused:!0,comment:c,onMeasureHeight:l=>i(c.id,l,!0)},`${o(c.id)}-focused`))]}):null},ft=(t,e,o)=>{let s=o+e;for(;e===D.down?s<t.length:s>-1;){const n=t[s],r=t[s-e],i=Te(R(n),R(r),e);if(i!=null&&n.type!==A.COLLAPSED)n.shiftY+=i;else break;s+=e}},mt=(t,e)=>{for(const o of e){const{index:s,amount:n}=o,r=t[s];r.type===A.EXPANDED&&(r.shiftY+=n),ft(t,D.down,s),ft(t,D.up,s);for(const i of t)i.type!==A.COLLAPSED&&(i.offsetY+=i.shiftY,i.shiftY=0)}},Ke=(t,e)=>{const o=[],[s,n]=e,r=s+n;for(let i=0;i<t.length;i++){const c=t[i],[l]=R(c),u=[l,c.type===A.EXPANDED?c.height:0],[d,f]=u;if(Nt(u,e)){const m=d+f,p=s-m,h=r-d,g=(Math.abs(p)<Math.abs(h)?D.up:D.down)===D.up?p:h;o.push({index:i,amount:g})}}return o},Fe=({gutterMode:t,focusedCommentId:e,gutterPositions:o,getCommentKey:s,getComment:n})=>{if(!o?.size)return[];const r=new Map,i=[];let c=null,l=-1;for(const d of o.values()){if(d.type===W.COMPOSER){c=[d.offsetY,d.height];continue}const{commentId:f,height:m,collapsedOffsetY:p,offsetY:h}=d;if(t===P.EXPANDED){const x=ot(i),T=x?nt(R(x)):0;let S=h;x&&S<=T&&(S=T),r.set(f,{originalOffsetY:h,offsetY:S}),e===f&&(l=i.length),i.push({key:s(f),comment:n(f),type:A.EXPANDED,height:m,offsetY:S,shiftY:0});continue}let E=i.findIndex(({offsetY:x,type:T})=>T===A.COLLAPSED&&x===p),g=i[E]??null;if(!g)g={key:i.length,type:A.COLLAPSED,offsetY:h,count:1,children:[f]},E=i.length,i.push(g);else{if(g.type!==A.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");g.count+=1,g.children.push(f),g.offsetY=p}e===f&&(l=E)}const u=i[l];if(t===P.COLLAPSED&&u?.type===A.COLLAPSED){const d=[];for(let f=0;f<u.children.length;f++){const m=u.children[f];m===e&&(l+=f+1);const p=ot(d),h=p?nt(R(p)):0,E=o.get(m)?.offsetY??0,g=Math.max(h,E);r.set(m,{originalOffsetY:E,offsetY:g}),d.push({type:A.EXPANDED,key:s(m),comment:n(m),offsetY:g,height:o.get(m)?.height??0,shiftY:0})}i.splice(l,0,...d)}if(e){const d=r.get(e);if(!d)return i;const{offsetY:f,originalOffsetY:m}=d,p=m-f,h=[{amount:p,index:l}];let E=l+1;for(;E<i.length;){const g=i[E],{type:x}=g;let T=p;if(x===A.EXPANDED&&g.comment?.id){const{offsetY:S,originalOffsetY:v}=z(r.get(g.comment.id));if(S===v)break;T=Math.max(v-S,p)}else break;h.push({amount:T,index:E}),E++}h.length&&mt(i,h)}else if(t!==P.COLLAPSED&&c){const d=Ke(i,c);mt(i,d)}return i},ze=t=>{try{return Fe(t)}catch(e){return N.logError("Generating comment gutter entries",e),[]}},We=t=>"length"in t?t.length===0:t.nodeSize===0,et=12,$e=({composerHeight:t,getCommentHeight:e,getCollapsedStartPos:o,commentingOn:s,commentPositions:n,view:r})=>{if(!n||!r||We(r.state.doc))return null;const{top:i}=r.dom.getBoundingClientRect(),c=Array.from(n.entries()).sort(([u,d],[f,m])=>d.start-m.start),l=new Map;for(const[u,{start:d}]of c)try{const f=o?.(d)??d,{top:m}=V(r,f),{top:p}=V(r,d),h=p-i,E=m-i,g=(e(u)??0)+et;l.set(u,{commentId:u,height:g,collapsedOffsetY:E,offsetY:h,type:W.COMMENT})}catch{continue}if(s?.type===_.BLOCK){const{pos:u}=s;try{const{top:d}=V(r,u),m=d-i-et;l.set("block-composer",{type:W.COMPOSER,height:(t??0)+et,offsetY:m})}catch{}}return l},kt=(t,e)=>e.nodeAt(t)?.isBlock?t+1:kt(t-1,e);function qe(t){const e=Et(),s=U()?.();if(!s)return null;if($(s)){if(!e)return null;const n=Ot(Lt,e);return n?n.positions:null}return new Map(t.map(n=>[n.id,n.at]))}const Je=({gutterMode:t,focusedCommentId:e,commentingOn:o,comments:s,getStableId:n})=>{const[{height:r},i]=J(),c=U(),[l,u]=C.useState(()=>new Map),[d,f]=C.useState(()=>new Map),m=C.useCallback(({focusedHeights:v,heights:b})=>{u(v),f(b)},[]),p=v=>{const b=n(v);return v===e?l.get(b)??0:d.get(b)??0},h=c(),E=h!=null&&$(h)?v=>kt(v,h.state.doc):void 0,g=new Map(s?.map(v=>[n(v.id),v])),x=qe(s),T=$e({composerHeight:r,commentingOn:o,getCommentHeight:p,getCollapsedStartPos:E,commentPositions:x,view:h}),S=ze({gutterMode:t,gutterPositions:T,focusedCommentId:e,getComment:v=>g.get(n(v))??null,getCommentKey:n});return{blockComposerRef:i,onMeasureComments:m,gutterEntries:S}};function Ze(){const e=U()(),o=j(({commentingOn:r})=>r),n=e==null?null:Pe(e,o);return n==null?null:a.jsx(k.div,{className:"absolute",style:{top:n.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:a.jsx(bt,{})},"selection-loading")}const Qe=t=>a.jsx("div",{className:"absolute",style:{top:nt(R(t))},children:a.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),Do=({availableWidth:t,comments:e,commentsMode:o,disableBlockComments:s=!1,isRequestActive:n=!1,isWaitingForCommentResponse:r=!1,onAddComment:i,onAcceptComment:c,onDismissComment:l,getStableCommentId:u})=>{const d=j(({focusedCommentId:L})=>L),f=j(({hoveredCommentId:L})=>L),m=j(({commentingOn:L})=>L),p=de(),h=t<lt?P.COLLAPSED:P.EXPANDED,{onMeasureComments:E,blockComposerRef:g,gutterEntries:x}=Je({comments:e,getStableId:u,gutterMode:h,focusedCommentId:d,commentingOn:m}),T=x.length>0,S=m!=null&&!r&&m.type!=="selection"||T,b=(()=>{if(!S)return 0;switch(h){case P.COLLAPSED:return 0;case P.EXPANDED:return lt}})(),y=m?.type==="selection",O=ot(x),X=o===ct.ENABLED&&p&&!y&&!s;return a.jsxs(k.div,{className:M("pointer-events-none relative flex h-full shrink-0",Y.commentGutter,h===P.COLLAPSED&&b?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:b,opacity:1},exit:{width:0,opacity:0},children:[a.jsx(Xe,{getStableCommentId:u,comments:e,onMeasure:E}),a.jsxs("div",{className:M("pointer-events-auto absolute start-0 top-0 bottom-0 w-0 overflow-visible",{"ps-2":S||!s}),children:[a.jsx(H,{children:x.map(L=>{const{key:Ut,type:it}=L,Xt=!!d&&it===A.EXPANDED&&L.comment?.id===d,Kt=!!d&&L.type===A.COLLAPSED&&L.children.includes(d);return a.jsx(Ue,{isGutterCollapsed:h===P.COLLAPSED,isSomeCommentFocused:!!m||!!d,isHovered:it===A.EXPANDED&&L.comment?.id===f,isFocused:Xt||Kt,entry:L,disableActions:n||r||o===ct.COMMENTS_READONLY,onAcceptComment:(K,B)=>{try{c?.(K,z(e?.find(Q=>Q.id===B)))}catch(Q){N.logError(`Comment ${B} not found`,Q)}},onDismissComment:K=>{try{l?.(z(e?.find(B=>B.id===K)))}catch(B){N.logError(`Comment ${K} not found`,B)}}},Ut)})}),T&&O&&a.jsx(Qe,{...O}),X&&a.jsx(Ve,{composerRef:g,gutterMode:h,onAddComment:i,isWaitingForCommentResponse:r,isRequestActive:n,hasComments:T}),r&&y&&a.jsx(Ze,{})]})]})};var to="Separator",pt="horizontal",eo=["horizontal","vertical"],jt=C.forwardRef((t,e)=>{const{decorative:o,orientation:s=pt,...n}=t,r=oo(s)?s:pt,c=o?{role:"none"}:{"aria-orientation":r==="vertical"?r:void 0,role:"separator"};return a.jsx(q.div,{"data-orientation":r,...c,...n,ref:e})});jt.displayName=to;function oo(t){return eo.includes(t)}var no=jt,st="Toolbar",[so,_o]=me(st,[Tt,Ct]),rt=Tt(),Dt=Ct(),[ro,_t]=so(st),Bt=C.forwardRef((t,e)=>{const{__scopeToolbar:o,orientation:s="horizontal",dir:n,loop:r=!0,...i}=t,c=rt(o),l=fe(n);return a.jsx(ro,{scope:o,orientation:s,dir:l,children:a.jsx(pe,{asChild:!0,...c,orientation:s,dir:l,loop:r,children:a.jsx(q.div,{role:"toolbar","aria-orientation":s,dir:l,...i,ref:e})})})});Bt.displayName=st;var It="ToolbarSeparator",Rt=C.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=_t(It,o);return a.jsx(no,{orientation:n.orientation==="horizontal"?"vertical":"horizontal",...s,ref:e})});Rt.displayName=It;var io="ToolbarButton",Z=C.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=rt(o);return a.jsx(St,{asChild:!0,...n,focusable:!t.disabled,children:a.jsx(q.button,{type:"button",...s,ref:e})})});Z.displayName=io;var ao="ToolbarLink",co=C.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=rt(o);return a.jsx(St,{asChild:!0,...n,focusable:!0,children:a.jsx(q.a,{...s,ref:e,onKeyDown:he(t.onKeyDown,r=>{r.key===" "&&r.currentTarget.click()})})})});co.displayName=ao;var Ht="ToolbarToggleGroup",lo=C.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=_t(Ht,o),r=Dt(o);return a.jsx($t,{"data-orientation":n.orientation,dir:n.dir,...r,...s,ref:e,rovingFocus:!1})});lo.displayName=Ht;var uo="ToolbarToggleItem",fo=C.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=Dt(o),r={__scopeToolbar:t.__scopeToolbar};return a.jsx(Z,{asChild:!0,...r,children:a.jsx(qt,{...n,...s,ref:e})})});fo.displayName=uo;var mo=Bt,po=Rt,ho=(t=>(t.CODE="code",t.WRITING="writing",t))(ho||{});const G=({children:t,toolbarType:e})=>a.jsx(mo,{className:M("border-token-border-default bg-token-main-surface-primary m-0 flex h-10 w-fit min-w-0 shrink items-center overflow-hidden rounded-full border px-2",yt,e==="code"?"py-0":"py-1"),children:t}),Yt=({icon:t,hideLabel:e,label:o})=>a.jsxs(a.Fragment,{children:[a.jsx(t,{className:M("icon-sm",{"text-token-text-tertiary me-0.5":!e,"text-token-text-primary":e})}),!e&&a.jsx("span",{className:"text-token-text-primary truncate text-sm",children:o})]}),Gt=At(Z)`flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] disabled:opacity-50 disabled:cursor-not-allowed dark:hover:bg-token-main-surface-secondary disabled:hover:bg-transparent`,go=({label:t,icon:e,isDisabled:o=!1,hideLabel:s=!1,onClick:n,onMouseDown:r})=>a.jsx(Gt,{onClick:n,"aria-label":s?t:void 0,onMouseDown:r,disabled:o,children:a.jsx(Yt,{icon:e,hideLabel:s,label:t})}),Co=({icon:t,hideLabel:e,label:o,children:s,align:n="end"})=>a.jsxs(Jt,{children:[a.jsx(Zt,{asChild:!0,children:a.jsx(Gt,{"aria-label":e?o:void 0,children:a.jsx(Yt,{icon:t,hideLabel:e,label:o})})}),a.jsx(Qt,{children:a.jsx(te,{align:n,className:M(Y.toolbar,"popover"),sideOffset:8,children:s})})]});G.Separator=At(po)`mx-1 p-0 list-none h-full w-[1px] bg-token-border-default`;G.Action=go;G.Button=Z;G.Popover=Co;function Vt(t){const e=t();if(e==null)return;const{from:o,to:s,sourceFrom:n,sourceTo:r}=e;if(o==null||s==null||n==null||r==null){N.logError("Missing selection range on targeted edit",e);return}const i=xt.ASK;N.logButtonClick(I.TOOLBAR_ASK_CHATGPT,{action:i,sourceFrom:n,sourceTo:r}),w.startCommentingOn({type:_.SELECTION,from:o,to:s,sourceRange:{start:n,end:r},action:i})}function Eo(t,e,o){C.useEffect(()=>{if(o)return;const s=n=>{(n.metaKey||n.ctrlKey)&&n.key.toLowerCase()==="k"&&(n.preventDefault(),Vt(e))};return t?.addEventListener("keydown",s),()=>t?.removeEventListener("keydown",s)},[t,e,o])}const xo=({isSendDisabled:t=!1,getSelectionRange:e})=>{const o=ht(),s=()=>{Vt(e)};return a.jsx(G.Action,{isDisabled:t,label:o.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:s,icon:ye})},Bo=({getEditorDom:t,getToolbarPosition:e,getSelectionRange:o,toolbarType:s,children:n,onAddComment:r,isWaitingForCommentResponse:i=!1,isSendDisabled:c=!1})=>{const[{height:l,width:u},d]=J(),[f,m]=C.useState(!0),[p,h]=C.useState(!1),E=t(),g=j(({commentingOn:y})=>y),[x,T]=C.useState(null);Eo(E,o,c);const S=C.useCallback(()=>{const y=t(),O=document.getSelection();return!O||O.type!=="Range"||O.isCollapsed||!y?.contains(O.anchorNode)},[t]);C.useEffect(()=>{const y=ge(()=>{h(!0)},200,{leading:!0}),O=()=>{y.cancel(),h(!1)};return E?.addEventListener("pointerdown",y,{passive:!0}),document.addEventListener("pointerup",O,{passive:!0}),()=>{E?.removeEventListener("pointerdown",y),document.removeEventListener("pointerup",O)}},[E]),C.useEffect(()=>{const y=()=>{m(S())};return document.addEventListener("selectionchange",y,{passive:!0}),()=>{document.removeEventListener("selectionchange",y)}},[S]),vt(()=>{if(f||S())return m(!0);try{const y=e({width:u,height:l});y!=null&&T(y)}catch(y){N.logError("Invalid position in getToolbarPosition",y)}},[l,u,f,S,e]);const v=a.jsxs(G,{toolbarType:s,children:[a.jsx(xo,{isSendDisabled:c,getSelectionRange:o}),n]}),b=!f&&!g&&x!=null;return a.jsxs(a.Fragment,{children:[a.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed start-0 top-0 h-0 overflow-clip",children:a.jsx("div",{ref:d,children:v})}),a.jsx(H,{children:b&&a.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:p?0:1,scale:p?.95:1},style:{top:x.top,left:x.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:p?0:.1},className:M("absolute",Y.toolbar,p?"pointer-events-none":"pointer-events-auto"),children:v})}),a.jsx(Me,{toolbarPosition:x,commentingOn:g,isWaitingForCommentResponse:i,onAddComment:r})]})};function bo(t){let e=t;for(;e;){const s=window.getComputedStyle(e).overflowY;if(s==="auto"||s==="scroll")return e;e=e.parentElement}return null}function Io(t,e){const o=U(),s=ee(),n=o();C.useEffect(()=>{const r=n?.dom;if(!r||t.length===0)return;const i=bo(r),c=e?gt(e,100):null;return i&&c&&i.addEventListener("scroll",c,{passive:!0}),()=>{c&&(i&&i.removeEventListener("scroll",c),c.cancel())}},[n,s,t,e])}let F=null;function Ro(){if(F!=null)return F;if(typeof window>"u")return 0;const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);try{F=t.offsetWidth-t.clientWidth}finally{document.body.removeChild(t)}return F}function Ho(t){return t==null?null:t.scrollHeight>t.clientHeight}export{Pt as A,Do as C,Bo as T,ho as a,We as b,G as c,Ro as g,Ho as i,Io as u};
//# sourceMappingURL=oi1o55r1q4i3japb.js.map
