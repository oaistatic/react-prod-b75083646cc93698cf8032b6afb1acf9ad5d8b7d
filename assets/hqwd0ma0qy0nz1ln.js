import{e as y,r as d,j as e,d as U,M as A}from"./lu2xqwqmjc95q6j6.js";import{qC as W,qD as E,C as X,h0 as Z,G as H,cY as B,B as P,dH as G,qE as q,c7 as ee,oJ as T,a as se,b5 as $,e0 as J,qF as te,c as _,qG as ne,qH as oe,qI as ae,qJ as re,qK as ie,nK as K,dS as Q,dU as Y,qL as le,qM as ce,qN as de,qO as me,c6 as ue,g8 as pe,qP as ge,pL as fe}from"./hml6mmd5fyx85si7.js";import{dQ as xe,b0 as he,mA as be}from"./rseqzngxzbdt1oxg.js";import{f as Ce,g as Ne,h as Me,i as je}from"./kzf8idfnvo156ew7.js";import{W as ve}from"./js0o5pkoyxnt23ro.js";import{d as Ee,e as Se,c as z}from"./idnt7o3g1nnw0r5k.js";const ke=n=>({[E.CONTEXT_CONNECTOR_GDRIVE]:{id:E.CONTEXT_CONNECTOR_GDRIVE,icon:e.jsx(ee,{className:"h-6 w-6"}),name:n.formatMessage(w.gdriveFileUploadLabel),description:n.formatMessage(w.gdriveFileUploadDescription)},[E.CONTEXT_CONNECTOR_O365_PERSONAL]:{id:E.CONTEXT_CONNECTOR_O365_PERSONAL,icon:e.jsx(q,{className:"h-6 w-6"}),name:n.formatMessage(w.onedrivePersonalFileUploadLabel),description:n.formatMessage(w.sharepointFileUploadDescription)},[E.CONTEXT_CONNECTOR_O365_BUSINESS]:{id:E.CONTEXT_CONNECTOR_O365_BUSINESS,icon:e.jsx(q,{className:"h-6 w-6"}),name:n.formatMessage(w.sharepointFileUploadLabel),description:n.formatMessage(w.sharepointFileUploadDescription)}}),V=(n,m)=>m?.get(n)?.includes(T.UseConnector)??!1,Re=({platformConnectorsWithPermission:n,contextConnectorsWithPermission:m,workspaceId:i,roleId:l,onClose:r})=>{const c=y(),b=W(),g=d.useMemo(()=>Array.from(n.values()??[]).filter(t=>t.connector.status!=="DISABLED_BY_ADMIN"),[n]),C=d.useMemo(()=>{const t=[];for(const[a,u]of Object.entries(m))t.push({connector:{...ke(c)[a],kind:"context"},permissions:u});for(const a of g)t.push({connector:{...a.connector,kind:"platform"},permissions:a.permissions});return t},[g,m,c]),p=d.useMemo(()=>{const t=new Map;for(const[a,u]of n)t.set(a,u.permissions);for(const[a,u]of Object.entries(m))t.set(a,u);return t},[n,m]),[f,O]=d.useState(""),j=d.useMemo(()=>{if(!f.trim())return C;const t=f.toLowerCase();return C.filter(a=>`${a.connector.name} ${a.connector.description??""} ${a.permissions.length>0?"true on":"false off"}`.toLowerCase().includes(t))},[C,f]),v=d.useMemo(()=>[...j].sort((t,a)=>t.connector.name.localeCompare(a.connector.name)),[j]),[N,S]=d.useState(()=>new Map),[I,k]=d.useState(()=>new Set),{updateRoleConnectorPermission:L}=Ce({workspaceId:i,roleId:l}),R=t=>N.has(t)?N.get(t):V(t,p);d.useEffect(()=>{S(t=>{if(t.size===0)return t;let a=!1;const u=new Map(t);for(const[s,o]of t)V(s,p)===o&&(u.delete(s),a=!0);return a?u:t})},[p]);const D=async t=>{const a=R(t),u=!a;S(s=>{const o=new Map(s);return o.set(t,u),o}),k(s=>new Set(s).add(t));try{await L({connectorId:t,permissions:u?[T.UseConnector]:[]})}catch{S(o=>{const x=new Map(o);return x.set(t,a),x})}finally{k(s=>{const o=new Set(s);return o.delete(t),o})}};return e.jsx(X,{testId:"modal-configure-connectors",title:c.formatMessage(w.title),isOpen:b,onClose:r,showCloseButton:!0,size:"custom",className:"max-w-[640px]",children:e.jsxs("div",{className:"flex max-h-[80vh] flex-col gap-4",children:[e.jsx("div",{children:e.jsx(Z,{name:"search",value:f,onChange:t=>O(t.target.value),placeholder:c.formatMessage(w.searchPlaceholder,{count:C.length}),ariaLabel:c.formatMessage({id:"NWbmR6",defaultMessage:"Search connectors"})})}),e.jsx("div",{className:"text-sm font-medium",children:e.jsx(A,{id:"2m/8vc",defaultMessage:"Connectors ({count})",values:{count:j.length}})}),e.jsx("div",{className:"bg-token-main-surface flex-1 overflow-y-auto",children:v.length===0?e.jsx(we,{}):v.map(t=>{const a=R(t.connector.id),u=I.has(t.connector.id);return e.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-3",children:[t.connector.kind==="platform"&&e.jsx(xe,{connector:t.connector,size:"small",className:"shadow-xxs h-fit rounded-[10px] border p-2"}),t.connector.kind==="context"&&e.jsx("span",{className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm",children:t.connector.icon}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:t.connector.name}),t.connector.description?e.jsx("div",{className:"text-token-text-tertiary truncate text-xs",children:t.connector.description}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u?e.jsx(H,{className:"h-4 w-4"}):null,e.jsx(B,{checked:a,onCheckedChange:()=>D(t.connector.id),disabled:u,"aria-label":c.formatMessage({id:"8ejEtk",defaultMessage:"Enable {name}"},{name:t.connector.name})})]})]},t.connector.id)})}),e.jsxs("div",{className:"flex w-full items-center",children:[v.length!==0&&e.jsx(P,{color:"primary-inverse",children:e.jsx(G,{href:"/admin/ca",className:"text-xs",children:e.jsx(A,{id:"4Szs/A",defaultMessage:"Add or manage connectors"})})}),e.jsx("div",{className:"ms-auto",children:e.jsx(P,{onClick:r,children:e.jsx(A,{id:"0NAzDq",defaultMessage:"Done"})})})]})]})})},we=()=>e.jsxs("div",{className:"flex min-h-[260px] flex-col items-center justify-center gap-3 p-6 text-center","aria-live":"polite",children:[e.jsx("div",{className:"grid place-items-center rounded-full border p-3",children:e.jsx(he,{className:"text-token-text-tertiary h-5 w-5","aria-hidden":!0})}),e.jsx("div",{className:"text-sm font-medium",children:e.jsx(A,{id:"kaOW76",defaultMessage:"No connectors enabled yet"})}),e.jsx(G,{href:"/admin/ca",className:"text-xs",children:e.jsx(P,{color:"primary-inverse",children:e.jsx(A,{id:"MA5e0o",defaultMessage:"Add connectors"})})})]}),w=U({title:{id:"allowedConnectorsSection.title",defaultMessage:"Configure connectors"},searchPlaceholder:{id:"allowedConnectorsSection.searchPlaceholder",defaultMessage:"Search {count} connectors (on/off)"},gdriveFileUploadLabel:{id:"allowedConnectorsSection.gdriveFileUploadLabel",defaultMessage:"Google Drive"},gdriveFileUploadDescription:{id:"allowedConnectorsSection.gdriveFileUploadDescription",defaultMessage:"Upload Google Drive files in messages sent to ChatGPT."},sharepointFileUploadLabel:{id:"allowedConnectorsSection.sharepointFileUploadLabel",defaultMessage:"Microsoft OneDrive (work/school)"},sharepointFileUploadDescription:{id:"allowedConnectorsSection.sharepointFileUploadDescription",defaultMessage:"Upload SharePoint and OneDrive for Business files in messages sent to ChatGPT."},onedrivePersonalFileUploadLabel:{id:"allowedConnectorsSection.onedrivePersonalFileUploadLabel",defaultMessage:"Microsoft OneDrive (personal)"},onedrivePersonalFileUploadDescription:{id:"allowedConnectorsSection.onedrivePersonalFileUploadDescription",defaultMessage:"Upload personal OneDrive files in messages sent to ChatGPT."}}),Oe=()=>{const n=se(),m=$(),i=J(),l=te(),r=m?.residencyRegion==="no_constraint"&&!i,c=_(n,"614413305"),b=_(n,"773249106"),g=_(n,"417039829"),C=_(n,"2509278897"),p=_(n,"3940160259"),f=_(n,"3507761600"),O=ne(),j=oe(),v=ae(),N=re(),S=ie(),{enabled:I}=K(Q[Y.GITHUB_CONNECTOR]),k=m?.isCBP()??!1,L=le(),R=ce(),D=de(),t=W(),a=me();return{isCBP:k,isRbacEnabled:D,githubConnectorEnabled:I,isInSupportedDrRegion:l,isSharedProjectsEnabled:b,showAgentInternetAccessToggle:f,showHiveToggle:g,showDeepResearchToggle:p,isAppleIntelligenceToggleEnabled:r&&C,isAppleIntelligenceMdmToggleEnabled:c,includeFeatures:O,includeModels:j,includeBetaSettings:v,includeBetaSettingsAdvanced:N,includeGizmoPermissions:S,isMDMEnabled:L,includeAgentMode:R,includeConnectorPermissions:t,includeThinkingMini:a}},Te=({ariaLabel:n,role:m,permissionName:i,handleSaveRole:l,disabled:r=!1,disabledReason:c})=>{const b=y();if(i==="codex_github_connector")return e.jsx(Ie,{});const g=e.jsx(B,{size:"normal","aria-label":n,checked:r?!1:m.permissions.includes(i),onCheckedChange:C=>{let p=[...m.permissions];C?p.push(i):p=p.filter(f=>f!==i),l({...m,permissions:p})},disabled:r});return r&&c?e.jsx(ue,{label:b.formatMessage(c),children:g}):g},Ie=()=>{const{enabled:n}=K(Q[Y.GITHUB_CONNECTOR]);return e.jsx(B,{checked:n,disabled:!0,"aria-hidden":!0})},Le="https://help.openai.com/en/articles/11750701-rbac",We=({role:n,onSave:m})=>{const i=y(),l=$(),r=J(),c=Oe(),{data:b}=pe((()=>{if(l==null)throw new Error("Account must not be null");const s=l.getWorkspaceId();if(s==null)throw new Error("Workspace ID must not be null");return s})()),g=W(),{permissionsBySection:C,totalPermissionsCount:p}=d.useMemo(()=>{const o=ge({isCanvasEnabled:!0,isSearchEnabled:n.permissions.includes(T.SearchAccess),isEnterprisey:l?.isEnterprisey()??!1,...c,isQuorum:r,legacyModelsEnabled:b?.beta_settings.legacy_models??!1,includeConnectorPermissions:g,isCodexEnabledInRBACRole:n.permissions.includes(T.AllowCodexAccess)}).map(h=>({...h,entries:h.entries.filter(F=>F.rbac)})).filter(h=>h.entries.length>0),x=o.flatMap(h=>h.entries).length;return{permissionsBySection:o,totalPermissionsCount:x}},[l,c,n.permissions,b?.beta_settings,g,r]),[f,O]=d.useState(""),j=C.map(s=>({...s,entries:s.entries.filter(o=>{const x=typeof o.title=="string"?o.title:i.formatMessage(o.title),h=o.description?typeof o.description=="string"?o.description:i.formatMessage(o.description,o.descriptionValues):"";return o.rbac&&([x,h].join(" ").toLowerCase().includes(f.toLowerCase())||o.permissionName.toLowerCase().includes(f.toLowerCase()))})})).filter(s=>s.entries.length>0),{toggleAllConnectorsPermissionForRole:v,isPending:N}=Ne({workspaceId:l?.getWorkspaceId()??""}),{connectorsWithPermission:S,isLoading:I}=Me({accountId:l?.id??"",workspaceId:l?.getWorkspaceId()??"",roleId:n.id,enabled:g}),k=Array.from(S.values()??[]).filter(s=>s.connector.status!=="DISABLED_BY_ADMIN"),L=d.useMemo(()=>[E.CONTEXT_CONNECTOR_GDRIVE,E.CONTEXT_CONNECTOR_O365_PERSONAL,E.CONTEXT_CONNECTOR_O365_BUSINESS].filter(s=>!!b?.beta_settings[s]),[b?.beta_settings]),R=je({workspaceId:l?.getWorkspaceId()??"",roleId:n.id,connectorIds:L,enabled:g}),D=d.useMemo(()=>{const o=Array.from(k.values()??[]).filter(h=>h.permissions.includes(T.UseConnector)),x=Object.entries(R.results??{}).filter(([h,F])=>F.includes(T.UseConnector));return[...o,...x]},[k,R.results]),[t,a]=d.useState(!1),u=s=>{const o=s.permissionName,x=typeof s.title=="string"?s.title:i.formatMessage(s.title);if(s.permissionName===T.UseConnector){const h=D.length>0;return e.jsxs(e.Fragment,{children:[t&&e.jsx(Re,{platformConnectorsWithPermission:S,contextConnectorsWithPermission:R.results,workspaceId:l?.getWorkspaceId()??"",roleId:n.id,onClose:()=>a(!1)}),e.jsx(z,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-md",children:x}),s.description&&e.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof s.description=="string"?s.description:i.formatMessage(s.description,s.descriptionValues)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(I||N)&&e.jsx(H,{}),s.nestedKey&&(L.length>0||k.length>0)&&e.jsx("div",{className:"text-token-text-tertiary text-sm",children:e.jsx(P,{color:"primary-inverse",onClick:()=>a(!0),children:e.jsx(A,{id:"workspaceSettings.roles.selectNestedPermission",defaultMessage:"Select..."})})}),e.jsx(B,{size:"normal","aria-label":x,checked:h,onCheckedChange:F=>v({id:n.id,state:F}),disabled:N||I})]})]})},o)]})}return e.jsx(z,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-md",children:x}),s.description&&e.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof s.description=="string"?s.description:i.formatMessage(s.description,s.descriptionValues)})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Te,{ariaLabel:x,role:n,permissionName:s.permissionName,handleSaveRole:m,disabled:s.disabled,disabledReason:s.disabledReason})})]})},o)};return e.jsxs(Ee,{children:[e.jsx("div",{className:"text-token-text-secondary text-sm",children:i.formatMessage(_e.customRoleDescription,{link:s=>e.jsx(G,{className:"underline",target:"_blank",rel:"noreferrer",href:Le,children:s})})}),e.jsx("div",{className:"flex flex-row items-center justify-between",children:e.jsx(fe,{inputClassName:"w-[250px] rounded-full! text-sm",value:f,onChange:s=>{O(s.target.value)},placeholder:i.formatMessage({id:"hRuTvi",defaultMessage:"Search {count} permissions"},{count:p})})}),j.map(s=>e.jsx(ve,{title:s.title,description:s.description,descriptionValues:s.descriptionValues,children:e.jsx(Se,{children:s.entries.map(o=>u(o))})},String(s.title.defaultMessage)))]})},_e=U({customRoleDescription:{id:"I9hJih",defaultMessage:"Custom role permissions override workplace-level settings. A user’s effective permissions are the sum of all their assigned custom roles. Not all settings are available as role-based permissions. <link>Learn more</link>"},save:{id:"LE9GJk",defaultMessage:"Save"},searchPlaceholder:{id:"EaN6oB",defaultMessage:"Search permissions"}}),Ge=({onClose:n,onSave:m,isCreate:i,defaultData:l})=>{const r=y(),[c,b]=d.useState(l?.name||""),[g,C]=d.useState(l?.description||""),[p,f]=d.useState(""),[O,j]=d.useState(!1),v=async()=>{if(!c.trim()){f(r.formatMessage(M.roleNameError));return}j(!0);try{await m({name:c,description:g}),n()}catch{}finally{j(!1)}};return e.jsx(X,{testId:"modal-upsert-role",size:"custom",className:"max-w-lg text-sm",isOpen:!0,onClose:n,showCloseButton:!0,type:"success",title:r.formatMessage(i?M.createRoleTitle:M.editRoleTitle),primaryButton:e.jsx(P,{color:"primary",onClick:()=>v(),loading:O,children:r.formatMessage(M.buttonSaveLabel)}),secondaryButton:e.jsx(P,{onClick:n,color:"secondary",children:r.formatMessage(M.buttonCancelLabel)}),children:e.jsxs("form",{className:"flex flex-col gap-6",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:r.formatMessage(M.roleNameLabel)}),e.jsx("input",{type:"text",className:`border-token-border-primary text-token-text-primary focus:border-token-brand focus:ring-token-brand bg-token-bg-primary mt-1 block w-full rounded-md border px-3 py-2 text-sm ${p?"border-token-text-status-error":""}`,placeholder:r.formatMessage(M.roleNameLabel),value:c,onChange:N=>{b(N.target.value),f("")}}),p&&e.jsx("span",{className:"text-token-text-status-error mt-1 text-xs",children:p})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:r.formatMessage(M.descriptionLabel)}),e.jsx("span",{className:"text-token-text-tertiary ms-1 text-sm font-medium",children:r.formatMessage(M.optionalLabel)}),e.jsx("input",{type:"text",className:"border-token-border-primary text-token-text-primary focus:border-token-brand focus:ring-token-brand bg-token-bg-primary mt-1 block w-full rounded-md border px-3 py-2 text-sm",placeholder:r.formatMessage(M.descriptionLabel),value:g,onChange:N=>C(N.target.value)})]}),e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-primary mb-1 flex w-full flex-row gap-4 rounded-xl p-4",children:[e.jsx(be,{className:"icon"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:r.formatMessage(M.infomationTitle)}),e.jsx("div",{className:"text-token-text-secondary",children:r.formatMessage(M.informationText)})]})]})]})})},M=U({createRoleTitle:{id:"xmlnWv",defaultMessage:"New custom role"},editRoleTitle:{id:"6A6tgB",defaultMessage:"Edit custom role"},roleNameLabel:{id:"VGBBHP",defaultMessage:"Role name"},optionalLabel:{id:"KR/EbO",defaultMessage:"(optional)"},descriptionLabel:{id:"BnuWZw",defaultMessage:"Description"},infomationTitle:{id:"L1pBDh",defaultMessage:"What's a custom role?"},informationText:{id:"DvDdnE",defaultMessage:"Roles are a great way to control which features a user can access. When assigned, the user’s permissions will be calculated as the sum of their custom roles."},buttonCancelLabel:{id:"rMxszm",defaultMessage:"Cancel"},buttonSaveLabel:{id:"JELOdt",defaultMessage:"Save"},roleNameError:{id:"iyN7K7",defaultMessage:"Role name is required"}}),Ae="role-workspace-member",qe=n=>n.id.startsWith(Ae)&&n.predefined_role;export{Te as P,We as R,Ge as U,Re as a,qe as i,Oe as u};
//# sourceMappingURL=hqwd0ma0qy0nz1ln.js.map
