const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/e0cf2nztzmm3evd7.js","assets/lu2xqwqmjc95q6j6.js","assets/hml6mmd5fyx85si7.js","assets/root-c0w5lvnh.css","assets/l29qldloj3xqr7yu.js","assets/fzrn137102spawew.js","assets/dq9j3pioxqah4sfs.js","assets/rseqzngxzbdt1oxg.js","assets/conversation-small-gcvo4yhm.css"])))=>i.map(i=>d[i]);
import{C as U,em as J,en as K,eo as _,B as W,b as X,mX as w,d as E,ap as q,ay as G,bg as Q,aq as Y}from"./hml6mmd5fyx85si7.js";import{R as m,j as t,r as h}from"./lu2xqwqmjc95q6j6.js";import{at as Z,iS as ee,t as te,iT as se}from"./rseqzngxzbdt1oxg.js";import{u as re,D as ne}from"./jh0uazsebnwe42qa.js";import{u as le,U as ae,a as T}from"./f2icac4qflq2ca2c.js";import{s as oe}from"./l29qldloj3xqr7yu.js";import"./fi4t5vltimyk5jia.js";import"./hbgl5asz88evcs5w.js";import"./jrr3dx16va5h9kau.js";import"./b4dvi1xom4p5x1vj.js";var $={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},V=m.createContext&&m.createContext($),ie=["attr","size","title"];function ce(e,s){if(e==null)return{};var r=de(e,s),n,l;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(l=0;l<o.length;l++)n=o[l],!(s.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function de(e,s){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(s.indexOf(n)>=0)continue;r[n]=e[n]}return r}function y(){return y=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},y.apply(this,arguments)}function D(e,s){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);s&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function O(e){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?D(Object(r),!0).forEach(function(n){ue(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ue(e,s,r){return s=me(s),s in e?Object.defineProperty(e,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[s]=r,e}function me(e){var s=pe(e,"string");return typeof s=="symbol"?s:s+""}function pe(e,s){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,s);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(e)}function H(e){return e&&e.map((s,r)=>m.createElement(s.tag,O({key:r},s.attr),H(s.child)))}function B(e){return s=>m.createElement(fe,y({attr:O({},e.attr)},s),H(e.child))}function fe(e){var s=r=>{var{attr:n,size:l,title:o}=e,p=ce(e,ie),i=l||r.size||"1em",c;return r.className&&(c=r.className),e.className&&(c=(c?c+" ":"")+e.className),m.createElement("svg",y({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,n,p,{className:c,style:O(O({color:e.color||r.color},r.style),e.style),height:i,width:i,xmlns:"http://www.w3.org/2000/svg"}),o&&m.createElement("title",null,o),e.children)};return V!==void 0?m.createElement(V.Consumer,null,r=>s(r)):s($)}function k(e){return B({attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"},child:[]}]})(e)}function z(e){return B({attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"},child:[]},{tag:"path",attr:{d:"M7 12V7H6v5h1z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"},child:[]}]})(e)}const he=q(()=>Y(()=>import("./e0cf2nztzmm3evd7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(e=>e.JsonViewer));function ze({threadId:e,threadUserId:s}){return le(ae.isDebugModalOpen)&&t.jsx(U,{testId:"modal-sonic-debug",isOpen:!0,onClose:()=>T.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:t.jsx(ve,{threadId:e,threadUserId:s??void 0,onClose:()=>T.toggleDebugModalOpen()})})}const xe=(e,s)=>{const r=JSON.stringify(s,null,2),n=new Blob([r],{type:"application/json"}),l=window.URL.createObjectURL(n),o=document.createElement("a");o.href=l,o.download=e,o.click(),window.URL.revokeObjectURL(l)},R="<|im_start|>",F="<|im_sep|>",I="<|im_end|>",je="<|fim_suffix|>",ge="<|meta_sep|>";function A({prompt:e}){const[s,r]=h.useState({}),n=[],l=[];let o=0;for(;;){const i=e.indexOf(R,o);if(i===-1)break;const c=e.indexOf(F,i);if(c===-1)break;let a=e.indexOf(I,c);const f=e.indexOf(je,c);if(f!==-1&&(a===-1||f<a)&&(a=f),a===-1)break;const x=e.substring(i+R.length,c).replace(ge," channel="),N=e.substring(c+F.length,a);l.push(i);const b=s[i];n.push(t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("button",{onClick:()=>r(j=>({...j,[i]:!j[i]})),children:b?t.jsx(z,{size:14}):t.jsx(k,{size:14})}),t.jsxs("span",{className:"font-semibold",children:["[",x,"]"]})]}),t.jsx("div",{className:E("whitespace-pre-wrap",b&&"line-clamp-2 truncate"),children:N})]},i)),o=a+I.length}function p(i){const c={};for(const a of l)c[a]=i;r(c)}return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"absolute end-0 top-0 flex items-center gap-2 text-xs font-semibold",children:[t.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>p(!0),children:[t.jsx(k,{size:14})," Collapse All"]}),"/",t.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>p(!1),children:[t.jsx(z,{size:14})," Expand All"]})]}),t.jsx("div",{className:"flex flex-col gap-3",children:n})]})}const v=G.div`mb-[-5px] pb-0.5 font-semibold uppercase border-b-2 ${({$isSelected:e})=>e?"border-black dark:border-white":"border-transparent"}`;function ve({threadId:e,threadUserId:s,message:r,onClose:n}){const[l,o]=h.useState(r?"message":"json"),{data:p,isLoading:i,refetch:c}=re({threadId:e,threadUserId:s,refetchOnMount:"always"}),a=p?.thread;if(h.useEffect(()=>{o(r?"message":a?.turns.length?`turn${a?.turns.length-1}`:"thread")},[a?.turns.length,r]),!i&&!a&&!r)return t.jsxs(ne,{onClickRetry:()=>c(),children:["Failed to load."," "]});if(i)return t.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const f=a?.turns,x=a?.turns[a.turns.length-1],N=x?.artifacts__?.model_snapshots?.default_id,b=x?.artifacts__?.settings?.model_response?.completion_model?.model,j=N??b,C=x?.artifacts__?.eval_preset,M=s&&e?ee(s,e):null,P=r?.metadata?.__internal?.debug?.render_for_completion_result_decoded;return t.jsx("div",{className:"flex flex-col gap-2 font-mono text-xs break-words",children:t.jsxs(J,{orientation:"vertical",value:l,onValueChange:u=>o(u),children:[t.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[t.jsxs(K,{className:"flex items-center justify-start gap-3 p-2",children:[r&&t.jsx(_,{value:"message",children:t.jsx(v,{$isSelected:l==="message",children:"Message"})},"message"),P&&t.jsx(_,{value:"render_for_completion",children:t.jsx(v,{$isSelected:l==="render_for_completion",children:"Prompt"})},"render_for_completion"),a&&t.jsx(_,{value:"thread",children:t.jsx(v,{$isSelected:l==="thread",children:"Thread"})},"thread"),f?.map((u,d)=>t.jsxs(h.Fragment,{children:[t.jsx(_,{value:`turn${d}`,children:t.jsxs(v,{$isSelected:l===`turn${d}`,children:["Turn[",d,"]"]})},d),u.artifacts__?.debug_ddtrace_urls?.map(g=>t.jsx(v,{$isSelected:!1,children:t.jsxs("a",{target:"_blank",href:g,className:"text-nowrap",rel:"noreferrer",children:["Trace[",d,"] â†—"]})},g))]},d))]}),t.jsxs("div",{className:"flex items-center justify-end",children:[a&&t.jsxs(W,{size:"small",color:"secondary",onClick:()=>xe("thread.json",a),children:[t.jsx(Z,{className:"icon-sm"})," thread.json"]}),t.jsx(X,{onClick:n})]})]}),t.jsxs("div",{className:"flex items-center gap-2 px-2",children:[j&&t.jsxs(t.Fragment,{children:[t.jsx(S,{name:"Model",id:j,className:"shrink-0"})," ",t.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),C&&C!=="production"&&t.jsxs(t.Fragment,{children:[t.jsx(S,{name:"Eval Preset",id:C,className:"shrink-0"}),t.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),M&&t.jsx(t.Fragment,{children:t.jsx(S,{name:"Permalink",id:M,className:"flex-shrink-1"})})]}),f?.map((u,d)=>{const g=u.model_response?.text;return t.jsxs(w,{value:`turn${d}`,className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[t.jsxs("div",{className:E("flex flex-col gap-2 p-2",(u.index??0)%2===1&&"bg-token-main-surface-secondary"),children:[t.jsx(A,{prompt:u.artifacts__?.debug_info?.main_model_response?.prompt_string??""}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold",children:"[assistant]"}),t.jsx("div",{"data-testid":"assistant-response",className:"whitespace-pre-wrap",children:oe(g??"")??g})]})]})," "]},d)}),a&&t.jsx(w,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:t.jsx(L,{data:a,collapsed:4,jsonFiltersKey:"thread"})}),r&&t.jsx(w,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:t.jsx(L,{data:r,collapsed:4,jsonFiltersKey:"message"})}),P&&t.jsx(w,{value:"render_for_completion",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:t.jsx(A,{prompt:P??""})})]},a?.turns.length??"message")})}function L({data:e,collapsed:s,jsonFiltersKey:r}){const[n,l]=h.useState(s??!0);return t.jsxs("div",{className:"flex flex-col items-start gap-1",children:[t.jsx("button",{onClick:()=>l(!n),className:"flex items-center gap-1",children:n?t.jsxs(t.Fragment,{children:[t.jsx(z,{size:14})," Expand all"]}):t.jsxs(t.Fragment,{children:[t.jsx(k,{size:14})," Collapse all"]})}),t.jsx("div",{className:"w-full",children:t.jsx(he,{jsonFiltersKey:r,json:e,jsonViewProps:{collapsed:n,shortenTextAfterLength:0}},String(n))})]})}function S({name:e,id:s,className:r}){const n=Q(),l=h.useCallback(o=>{te(s,n,o)},[s,n]);return t.jsxs("div",{className:E("flex items-center gap-2 truncate",r),children:[t.jsxs("span",{className:"font-semibold text-nowrap",children:[e,":"]}),t.jsx("span",{title:s,className:"truncate text-gray-500 dark:text-white",children:s}),t.jsx(se,{onCopy:l})]})}export{L as DebugJsonViewer,ze as DebugModal,ve as DebugModalContents};
//# sourceMappingURL=ljs8acqpop7gkpem.js.map
