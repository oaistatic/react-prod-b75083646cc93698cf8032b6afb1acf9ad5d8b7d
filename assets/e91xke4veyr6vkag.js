import{ab as jt,j as G,r as C,e as Ut}from"./lu2xqwqmjc95q6j6.js";import{d as D,c as N,E as S,D as E,b as K,A as Qe,q as X,F as Wt,V as we,R as z,W as Ae,G as Xe,P as ke,g as et,h as tt,S as qt,t as Kt,v as zt,a as Oe,w as $t,x as Yt,y as Zt,n as Jt,z as W}from"./ndox4jgq2pedhhgi.js";import{n as Qt,s as Re,o as Xt,p as en,q as tn,r as nn,t as rn,v as on,w as sn}from"./iv9cwo4pw9mxn1rf.js";import{d as nt,eb as he,n as cn,bg as an}from"./hml6mmd5fyx85si7.js";import{pU as ln,mU as rt,pV as fn,cf as un,jK as dn,iE as hn}from"./rseqzngxzbdt1oxg.js";import{x as mn,y as gn,z as pn,A as Cn,B as xn,C as wn}from"./ibcsr9sfusjfjjf0.js";import{a as An,Z as kn}from"./jy1u8exw8iz2slve.js";import{b as bn,h as En,d as Sn,e as Mn,f as vn,g as Ln,j as yn,k as Bn,l as Dn,m as Tn,n as ae,o as Nn}from"./l1uu5qm215xg1y5k.js";import{u as On}from"./em6xteal3laxzbp5.js";const me=D.define(),ot=N.define({create:()=>null,update:(e,t)=>{const n=t.effects.find(s=>s.is(me));return n?n.value:e}}),Rn=e=>E.line({class:"bg-[Highlight]!"}).range(e),Gn=e=>E.line({class:"streaming-line-overlay before:content-['*'] before:bg-white/50 dark:before:bg-gray-750/50"}).range(e),Fn=N.define({create:()=>E.none,update:(e,t)=>{e=e.map(t.changes);const n=t.state.field(ot);if(n==null)return E.none;const s=t.state.doc,o=n+1;if(o>s.lines)return E.none;const r=s.line(o),i=Rn(r.from),c=Array.from({length:s.lines-o},(l,f)=>Gn(s.line(o+1+f).from));return E.set([i,...c])},provide:e=>S.decorations.from(e)}),In=e=>[ot.init(()=>e),Fn],st=D.define(),it=D.define(),ct=D.define(),at=D.define(),ge=(e,t)=>e.doc.line(t).from,Z=(e,t,n,s)=>{const o=ge(t,n),r=E.line({attributes:{class:nt("transition-colors bg-transparent",s===1&&"bg-yellow-100 dark:bg-yellow-500/50")}}).range(ge(t,n));return e.update({add:s===3?[]:[r],filter:i=>i!==o})},Hn=N.define({create(){return E.none},update(e,t){for(const n of t.effects){const{value:s}=n;if(n.is(st))return Z(e,t.state,s,0);if(n.is(it))return Z(e,t.state,s,1);if(n.is(ct))return Z(e,t.state,s,2);if(n.is(at))return Z(e,t.state,s,3)}return e.map(t.changes)},provide:e=>S.decorations.from(e)}),_n=[Hn];async function Vn(e,t,n=500){await new Promise(o=>e.requestMeasure({read:()=>{},write:()=>o(void 0)})),e.dispatch({effects:st.of(t)});const s=ge(e.state,t);e.dispatch({effects:S.scrollIntoView(s,{y:"center"})}),requestAnimationFrame(()=>{e.dispatch({effects:it.of(t)})}),setTimeout(()=>{e.dispatch({effects:ct.of(t)}),setTimeout(()=>{e.dispatch({effects:at.of(t)})},150)},n),e.focus()}function Pn(e){return e.toString().length}function jn(e,t,n){return s=>{if(!s.docChanged)return s;const o=Pn(s.state.doc);if(o<=e)return s;n&&t&&ln(n,t);const r=s.state.doc.sliceString(0,e),i=s.startState.update({changes:{from:0,to:s.startState.doc.length,insert:r}});return rt.logEvent("Canvas Codemirror Max Length",{maxLength:e,newLength:o}),[i]}}function Un(e,t,n){return[K.transactionFilter.of(jn(n,e,t))]}const lt=Qe.define();function Wn(){return S.updateListener.of(e=>{if(!e.docChanged||e.state.readOnly)return;const t=e.state.doc;t.length>0&&t.sliceString(t.length-1)!==`
`&&e.view.dispatch({changes:{from:t.length,to:t.length,insert:`
`},annotations:lt.of(!0)})})}class k{constructor(t,n,s,o){this.fromA=t,this.toA=n,this.fromB=s,this.toB=o}offset(t,n=t){return new k(this.fromA+t,this.toA+t,this.fromB+n,this.toB+n)}}function I(e,t,n,s,o,r){if(e==s)return[];const i=ee(e,t,n,s,o,r),c=be(e,t+i,n,s,o+i,r);t+=i,n-=c,o+=i,r-=c;const l=n-t,f=r-o;if(!l||!f)return[new k(t,n,o,r)];if(l>f){const u=e.slice(t,n).indexOf(s.slice(o,r));if(u>-1)return[new k(t,t+u,o,o),new k(t+u+f,n,r,r)]}else if(f>l){const u=s.slice(o,r).indexOf(e.slice(t,n));if(u>-1)return[new k(t,t,o,o+u),new k(n,n,o+u+l,r)]}if(l==1||f==1)return[new k(t,n,o,r)];const a=dt(e,t,n,s,o,r);if(a){const[u,d,h]=a;return I(e,t,u,s,o,d).concat(I(e,u+h,n,s,d+h,r))}return qn(e,t,n,s,o,r)}let q=1e9;function qn(e,t,n,s,o,r){const i=n-t,c=r-o;if(q<1e9&&Math.min(i,c)>q*16)return Math.min(i,c)>q*64?[new k(t,n,o,r)]:Ge(e,t,n,s,o,r);const l=Math.ceil((i+c)/2);le.reset(l),fe.reset(l);const f=(h,g)=>e.charCodeAt(t+h)==s.charCodeAt(o+g),a=(h,g)=>e.charCodeAt(n-h-1)==s.charCodeAt(r-g-1),u=(i-c)%2!=0?fe:null,d=u?null:le;for(let h=0;h<l;h++){if(h>q)return Ge(e,t,n,s,o,r);const g=le.advance(h,i,c,l,u,!1,f)||fe.advance(h,i,c,l,d,!0,a);if(g)return Kn(e,t,n,t+g[0],s,o,r,o+g[1])}return[new k(t,n,o,r)]}class ft{vec=[];len;start;end;reset(t){this.len=t<<1;for(let n=0;n<this.len;n++)this.vec[n]=-1;this.vec[t+1]=0,this.start=this.end=0}advance(t,n,s,o,r,i,c){for(let l=-t+this.start;l<=t-this.end;l+=2){const f=o+l;let a=l==-t||l!=t&&this.vec[f-1]<this.vec[f+1]?this.vec[f+1]:this.vec[f-1]+1,u=a-l;for(;a<n&&u<s&&c(a,u);)a++,u++;if(this.vec[f]=a,a>n)this.end+=2;else if(u>s)this.start+=2;else if(r){const d=o+(n-s)-l;if(d>=0&&d<this.len&&r.vec[d]!=-1)if(i){const h=r.vec[d];if(h>=n-a)return[h,o+h-d]}else{const h=n-r.vec[d];if(a>=h)return[a,u]}}}return null}}const le=new ft,fe=new ft;function Kn(e,t,n,s,o,r,i,c){let l=!1;return!P(e,s)&&++s==n&&(l=!0),!P(o,c)&&++c==i&&(l=!0),l?[new k(t,n,r,i)]:I(e,t,s,o,r,c).concat(I(e,s,n,o,c,i))}function ut(e,t){let n=1;const s=Math.min(e,t);for(;n<s;)n=n<<1;return n}function ee(e,t,n,s,o,r){if(t==n||t==r||e.charCodeAt(t)!=s.charCodeAt(o))return 0;let i=ut(n-t,r-o);for(let c=t,l=o;;){const f=c+i,a=l+i;if(f>n||a>r||e.slice(c,f)!=s.slice(l,a)){if(i==1)return c-t-(P(e,c)?0:1);i=i>>1}else{if(f==n||a==r)return f-t;c=f,l=a}}}function be(e,t,n,s,o,r){if(t==n||o==r||e.charCodeAt(n-1)!=s.charCodeAt(r-1))return 0;let i=ut(n-t,r-o);for(let c=n,l=r;;){const f=c-i,a=l-i;if(f<t||a<o||e.slice(f,c)!=s.slice(a,l)){if(i==1)return n-c-(P(e,c)?0:1);i=i>>1}else{if(f==t||a==o)return n-f;c=f,l=a}}}function pe(e,t,n,s,o,r,i,c){const l=s.slice(o,r);let f=null;for(;;){if(f||i<c)return f;for(let a=t+i;;){P(e,a)||a++;let u=a+i;if(P(e,u)||(u+=u==a+1?1:-1),u>=n)break;const d=e.slice(a,u);let h=-1;for(;(h=l.indexOf(d,h+1))!=-1;){const g=ee(e,u,n,s,o+h+d.length,r),p=be(e,t,a,s,o,o+h),m=d.length+g+p;(!f||f[2]<m)&&(f=[a-p,o+h-p,m])}a=u}if(c<0)return f;i=i>>1}}function dt(e,t,n,s,o,r){const i=n-t,c=r-o;if(i<c){const l=dt(s,o,r,e,t,n);return l&&[l[1],l[0],l[2]]}return i<4||c*2<i?null:pe(e,t,n,s,o,r,Math.floor(i/4),-1)}function Ge(e,t,n,s,o,r){const i=n-t,c=r-o;let l;if(i<c){const d=pe(s,o,r,e,t,n,Math.floor(i/6),50);l=d&&[d[1],d[0],d[2]]}else l=pe(e,t,n,s,o,r,Math.floor(c/6),50);if(!l)return[new k(t,n,o,r)];const[f,a,u]=l;return I(e,t,f,s,o,a).concat(I(e,f+u,n,s,a+u,r))}function ht(e,t){for(let n=1;n<e.length;n++){const s=e[n-1],o=e[n];s.toA>o.fromA-t&&s.toB>o.fromB-t&&(e[n-1]=new k(s.fromA,o.toA,s.fromB,o.toB),e.splice(n--,1))}}function zn(e,t,n){for(;;){ht(n,1);let s=!1;for(let o=0;o<n.length;o++){let r=n[o],i,c;(i=ee(e,r.fromA,r.toA,t,r.fromB,r.toB))&&(r=n[o]=new k(r.fromA+i,r.toA,r.fromB+i,r.toB)),(c=be(e,r.fromA,r.toA,t,r.fromB,r.toB))&&(r=n[o]=new k(r.fromA,r.toA-c,r.fromB,r.toB-c));const l=r.toA-r.fromA,f=r.toB-r.fromB;if(l&&f)continue;const a=r.fromA-(o?n[o-1].toA:0),u=(o<n.length-1?n[o+1].fromA:e.length)-r.toA;if(!a||!u)continue;const d=l?e.slice(r.fromA,r.toA):t.slice(r.fromB,r.toB);a<=d.length&&e.slice(r.fromA-a,r.fromA)==d.slice(d.length-a)?(n[o]=new k(r.fromA-a,r.toA-a,r.fromB-a,r.toB-a),s=!0):u<=d.length&&e.slice(r.toA,r.toA+u)==d.slice(0,u)&&(n[o]=new k(r.fromA+u,r.toA+u,r.fromB+u,r.toB+u),s=!0)}if(!s)break}return n}function $n(e,t,n){for(let s=0,o=0;o<e.length;o++){let r=e[o];const i=r.toA-r.fromA,c=r.toB-r.fromB;if(i&&c||i>3||c>3){const l=o==e.length-1?t.length:e[o+1].fromA,f=r.fromA-s,a=l-r.toA;let u=Ie(t,r.fromA,Math.min(f,5)),d=Fe(t,r.toA,Math.min(a,5)),h=r.fromA-u,g=d-r.toA;if(!i||!c){const p=Math.max(i,c),[m,w,M]=i?[t,r.fromA,r.toA]:[n,r.fromB,r.toB];h&&g&&(p>h&&t.slice(u,r.fromA)==m.slice(M-h,M)?(r=e[o]=new k(u,u+i,r.fromB-h,r.toB-h),u=r.fromA,d=Fe(t,r.toA,Math.min(l-r.toA,5))):p>g&&t.slice(r.toA,d)==m.slice(w,w+g)&&(r=e[o]=new k(d-i,d,r.fromB+g,r.toB+g),d=r.toA,u=Ie(t,r.fromA,Math.min(r.fromA-s,5))),h=r.fromA-u,g=d-r.toA)}if(h||g)r=e[o]=new k(r.fromA-h,r.toA+g,r.fromB-h,r.toB+g);else if(i){if(!c){const p=_e(t,r.fromA,r.toA);let m;const w=p<0?-1:He(t,r.toA,r.fromA);p>-1&&(m=p-r.fromA)<=a&&t.slice(r.fromA,p)==t.slice(r.toA,r.toA+m)?r=e[o]=r.offset(m):w>-1&&(m=r.toA-w)>=f&&n.slice(r.fromA-m,r.fromA)==n.slice(w,r.toA)&&(r=e[o]=r.offset(-m))}}else{const p=_e(n,r.fromB,r.toB);let m;const w=p<0?-1:He(n,r.toB,r.fromB);p>-1&&(m=p-r.fromB)<=a&&n.slice(r.fromB,p)==n.slice(r.toB,r.toB+m)?r=e[o]=r.offset(m):w>-1&&(m=r.toB-w)>=f&&n.slice(r.fromB-m,r.fromB)==n.slice(w,r.toB)&&(r=e[o]=r.offset(-m))}s=r.toA}}return ht(e,3),e}let F;try{F=new RegExp("[\\p{Alphabetic}\\p{Number}]","u")}catch{}function mt(e){return e>48&&e<58||e>64&&e<91||e>96&&e<123}function gt(e,t){if(t==e.length)return 0;const n=e.charCodeAt(t);return n<192?mt(n)?1:0:F?!Ct(n)||t==e.length-1?F.test(String.fromCharCode(n))?1:0:F.test(e.slice(t,t+2))?2:0:0}function pt(e,t){if(!t)return 0;const n=e.charCodeAt(t-1);return n<192?mt(n)?1:0:F?!xt(n)||t==1?F.test(String.fromCharCode(n))?1:0:F.test(e.slice(t-2,t))?2:0:0}function Fe(e,t,n){if(t==e.length||!pt(e,t))return t;for(let s=t,o=t+n;;){const r=gt(e,s);if(!r)return s;if(s+=r,s>o)return t}}function Ie(e,t,n){if(!t||!gt(e,t))return t;for(let s=t,o=t-n;;){const r=pt(e,s);if(!r)return s;if(s-=r,s<o)return t}}function He(e,t,n){for(;t!=n;t--)if(e.charCodeAt(t-1)==10)return t;return-1}function _e(e,t,n){for(;t!=n;t++)if(e.charCodeAt(t)==10)return t;return-1}const Ct=e=>e>=55296&&e<=56319,xt=e=>e>=56320&&e<=57343;function P(e,t){return!t||t==e.length||!Ct(e.charCodeAt(t-1))||!xt(e.charCodeAt(t))}function Yn(e,t,n){return q=(n?.scanLimit??1e9)>>1,zn(e,t,I(e,0,e.length,t,0,t.length))}function wt(e,t,n){return $n(Yn(e,t,n),e,t)}function Zn(e){const{start:t,end:n}=e.positionBefore,{start:s,end:o}=e.positionAfter;return new k(t,n,s,o)}class ${constructor(t,n,s,o,r){this.changes=t,this.fromA=n,this.toA=s,this.fromB=o,this.toB=r}offset(t,n){return t||n?new $(this.changes,this.fromA+t,this.toA+t,this.fromB+n,this.toB+n):this}get endA(){return Math.max(this.fromA,this.toA)}get endB(){return Math.max(this.fromB,this.toB)}static buildFromTextdocDiff(t){const s=t.edits.map(Zn);return s.sort((r,i)=>r.fromA-i.fromA),Ce(s,X.of(t.contentBefore.split(`
`)),X.of(t.contentAfter.split(`
`)),0,0)}static build(t,n,s){const o=wt(t.toString(),n.toString(),s);return Ce(o,t,n,0,0)}static updateA(t,n,s,o,r){return We(Ue(t,o,!0,s.length),t,n,s,r)}static updateB(t,n,s,o,r){return We(Ue(t,o,!1,n.length),t,n,s,r)}}function Ve(e,t,n,s){const o=n.lineAt(e),r=s.lineAt(t);return o.to==e&&r.to==t&&e<n.length&&t<s.length?[e+1,t+1]:[o.from,r.from]}function Pe(e,t,n,s){const o=n.lineAt(e),r=s.lineAt(t);return o.from==e&&r.from==t?[e,t]:[o.to+1,r.to+1]}function Ce(e,t,n,s,o){const r=[];for(let i=0;i<e.length;i++){const c=e[i],[l,f]=Ve(c.fromA+s,c.fromB+o,t,n);let[a,u]=Pe(c.toA+s,c.toB+o,t,n);const d=[c.offset(-l+s,-f+o)];for(;i<e.length-1;){const h=e[i+1],[g,p]=Ve(h.fromA+s,h.fromB+o,t,n);if(g>a+1&&p>u+1)break;d.push(h.offset(-l+s,-f+o)),[a,u]=Pe(h.toA+s,h.toB+o,t,n),i++}r.push(new $(d,l,Math.max(l,a),f,Math.max(f,u)))}return r}const J=1e3;function je(e,t,n,s){let o=0,r=e.length;for(;;){if(o==r){let a=0,u=0;o&&({toA:a,toB:u}=e[o-1]);const d=t-(n?a:u);return[a+d,u+d]}const i=o+r>>1,c=e[i],[l,f]=n?[c.fromA,c.toA]:[c.fromB,c.toB];if(l>t)r=i;else if(f<=t)o=i+1;else return s?[c.fromA,c.fromB]:[c.toA,c.toB]}}function Ue(e,t,n,s){const o=[];return t.iterChangedRanges((r,i,c,l)=>{let f=0,a=n?t.length:s,u=0,d=n?s:t.length;r>J&&([f,u]=je(e,r-J,n,!0)),i<t.length-J&&([a,d]=je(e,i+J,n,!1));const h=l-c-(i-r);let g;const[p,m]=n?[h,0]:[0,h];o.length&&(g=o[o.length-1]).toA>=f?o[o.length-1]={fromA:g.fromA,fromB:g.fromB,toA:a,toB:d,diffA:g.diffA+p,diffB:g.diffB+m}:o.push({fromA:f,toA:a,fromB:u,toB:d,diffA:p,diffB:m})}),o}function We(e,t,n,s,o){if(!e.length)return t;const r=[];for(let i=0,c=0,l=0,f=0;;i++){const a=i==e.length?null:e[i],u=a?a.fromA+c:n.length,d=a?a.fromB+l:s.length;for(;f<t.length;){const m=t[f];if(m.toA+c>u||m.toB+l>d)break;r.push(m.offset(c,l)),f++}if(!a)break;const h=a.toA+c+a.diffA,g=a.toB+l+a.diffB,p=wt(n.sliceString(u,h),s.sliceString(d,g),o);for(const m of Ce(p,n,s,u,d))r.push(m);for(c+=a.diffA,l+=a.diffB;f<t.length;){const m=t[f];if(m.fromA+c>h&&m.fromB+l>g)break;f++}}return r}const H=Wt.define({combine:e=>e[0]}),At=D.define(),B=N.define({create(){return null},update(e,t){for(const n of t.effects)n.is(At)&&(e=n.value);return e}}),Jn="bg-red-100 dark:bg-red-600/30",Qn="bg-green-100 dark:bg-green-600/30",Ee=we.fromClass(class{deco;gutter;constructor(e){({deco:this.deco,gutter:this.gutter}=ze(e))}update(e){(e.docChanged||e.viewportChanged||Xn(e.startState,e.state)||er(e.startState,e.state))&&({deco:this.deco,gutter:this.gutter}=ze(e.view))}},{decorations:e=>e.deco});ke.low(et({class:"cm-changeGutter",markers:e=>e.plugin(Ee)?.gutter||tt.empty}));function Xn(e,t){return e.field(B,!1)!=t.field(B,!1)}function er(e,t){return e.facet(H)!=t.facet(H)}const qe=E.line({class:`cm-changedLine ${Qn}`}),tr=E.mark({class:"cm-changedText"}),nr=E.mark({tagName:"ins",class:"cm-insertedLine"}),rr=E.mark({tagName:"del",class:"cm-deletedLine"}),Ke=new class extends Xe{elementClass="cm-changedLineGutter"};function or(e,t,n,s,o,r){const i=n?e.fromA:e.fromB,c=n?e.toA:e.toB;let l=0;if(i!=c){o.add(i,i,qe),o.add(i,c,n?rr:nr),r&&r.add(i,i,Ke);for(let f=t.iterRange(i,c-1),a=i;!f.next().done;){if(f.lineBreak){a++,o.add(a,a,qe),r&&r.add(a,a,Ke);continue}const u=a+f.value.length;if(s)for(;l<e.changes.length;){const d=e.changes[l],h=i+(n?d.fromA:d.fromB),g=i+(n?d.toA:d.toB),p=Math.max(a,h),m=Math.min(u,g);if(p<m&&o.add(p,m,tr),g<u)l++;else break}a=u}}}function ze(e){const t=e.state.field(B),{side:n,highlightChanges:s,markGutter:o}=e.state.facet(H),r=n=="a",i=new z,c=o?new z:null,{from:l,to:f}=e.viewport;for(const a of t){if((r?a.fromA:a.fromB)>=f)break;(r?a.toA:a.toB)>l&&or(a,e.state.doc,r,s,i,c)}return{deco:i.finish(),gutter:c&&c.finish()}}const sr=D.define({map:(e,t)=>e.map(t)});N.define({create:()=>E.none,update:(e,t)=>{for(const n of t.effects)if(n.is(sr))return n.value;return e.map(t.changes)},provide:e=>S.decorations.from(e)});const xe=D.define({map:(e,t)=>t.mapPos(e)});class ir extends Ae{constructor(t){super(),this.lines=t}eq(t){return this.lines==t.lines}toDOM(t){const n=document.createElement("div");return n.className="cm-collapsedLines",n.textContent="⦚ "+t.state.phrase("$ unchanged lines",this.lines)+" ⦚",n.addEventListener("click",s=>{const o=t.posAtDOM(s.target);t.dispatch({effects:xe.of(o)});const{side:r,sibling:i}=t.state.facet(H);i&&i().dispatch({effects:xe.of(cr(o,t.state.field(B),r=="a"))})}),n}ignoreEvent(t){return t instanceof MouseEvent}get estimatedHeight(){return 27}}function cr(e,t,n){let s=0,o=0;for(let r=0;;r++){const i=r<t.length?t[r]:null;if(!i||(n?i.fromA:i.fromB)>=e)return o+(e-s);[s,o]=n?[i.toA,i.toB]:[i.toB,i.toA]}}const ar=N.define({create(){return E.none},update(e,t){e=e.map(t.changes);for(const n of t.effects)n.is(xe)&&(e=e.update({filter:s=>s!=n.value}));return e},provide:e=>S.decorations.from(e)});function lr({margin:e=3,minSize:t=4}){return ar.init(n=>fr(n,e,t))}function fr(e,t,n){const s=new z,o=e.facet(H).side=="a",r=e.field(B);let i=1;for(let c=0;;c++){const l=c<r.length?r[c]:null,f=c?i+t:1,a=l?e.doc.lineAt(o?l.fromA:l.fromB).number-1-t:e.doc.lines,u=a-f+1;if(u>=n&&s.add(e.doc.line(f).from,e.doc.line(a).to,E.replace({widget:new ir(u),block:!0})),!l)break;i=e.doc.lineAt(Math.min(e.doc.length,o?l.toA:l.toB)).number}return s.finish()}S.styleModule.of(new qt({".cm-mergeView":{overflowY:"auto"},".cm-mergeViewEditors":{display:"flex",alignItems:"stretch"},".cm-mergeViewEditor":{flexGrow:1,flexBasis:0,overflow:"hidden"},".cm-merge-revert":{width:"1.6em",flexGrow:0,flexShrink:0,position:"relative"},".cm-merge-revert button":{position:"absolute",display:"block",width:"100%",boxSizing:"border-box",textAlign:"center",background:"none",border:"none",font:"inherit",cursor:"pointer"}}));const ur=S.baseTheme({".cm-mergeView & .cm-scroller, .cm-mergeView &":{height:"auto !important",overflowY:"visible !important"},"&light.cm-merge-a .cm-changedText, &light .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ee443366, #ee443366) bottom/100% 2px no-repeat"},"&dark.cm-merge-a .cm-changedText, &dark .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ffaa9966, #ffaa9966) bottom/100% 2px no-repeat"},"&light.cm-merge-b .cm-changedText":{background:"linear-gradient(#22bb2266, #22bb2266) bottom/100% 2px no-repeat"},"&dark.cm-merge-b .cm-changedText":{background:"linear-gradient(#88ff8866, #88ff8866) bottom/100% 2px no-repeat"},".cm-insertedLine, .cm-deletedLine":{textDecoration:"none"},".cm-deletedChunk":{paddingLeft:"6px","& .cm-chunkButtons":{position:"absolute",insetInlineEnd:"5px"},"& button":{border:"none",cursor:"pointer",color:"white",margin:"0 2px",borderRadius:"3px","&[name=accept]":{background:"#2a2"},"&[name=reject]":{background:"#d43"}}},".cm-collapsedLines":{padding:"5px 5px 5px 10px",cursor:"pointer"},"&light .cm-collapsedLines":{color:"#444",background:"linear-gradient(to bottom, transparent 0, #f3f3f3 30%, #f3f3f3 70%, transparent 100%)"},"&dark .cm-collapsedLines":{color:"#ddd",background:"linear-gradient(to bottom, transparent 0, #222 30%, #222 70%, transparent 100%)"},".cm-changeGutter":{width:"3px",paddingLeft:"1px"},"&light.cm-merge-a .cm-changedLineGutter, &light .cm-deletedLineGutter":{background:"#e43"},"&dark.cm-merge-a .cm-changedLineGutter, &dark .cm-deletedLineGutter":{background:"#fa9"},"&light.cm-merge-b .cm-changedLineGutter":{background:"#2b2"},"&dark.cm-merge-b .cm-changedLineGutter":{background:"#8f8"}}),ue="unknown",dr=new class extends Xe{elementClass="cm-deletedLineGutter"},hr=ke.low(et({class:"cm-changeGutter",markers:e=>e.plugin(Ee)?.gutter||tt.empty,widgetMarker:(e,t)=>t instanceof bt?dr:null}));function mr(e){const t=X.of(e.textdocDiff.contentBefore.split(`
`));return[ke.low(Ee),xr(e.language),ur,S.editorAttributes.of({class:"cm-merge-b"}),H.of({highlightChanges:e.highlightChanges!==!1,markGutter:e.gutter!==!1,syntaxHighlightDeletions:e.syntaxHighlightDeletions!==!1,mergeControls:e.mergeControls!==!1,side:"b"}),te.init(()=>t),e.gutter!==!1?hr:[],e.collapseUnchanged?lr(e.collapseUnchanged):[],B.init(()=>$.buildFromTextdocDiff(e.textdocDiff))]}const kt=D.define(),te=N.define({create:()=>X.empty,update(e,t){for(const n of t.effects)n.is(kt)&&(e=n.value.doc);return e}}),U=new WeakMap;class bt extends Ae{constructor(t){super(),this.buildDOM=t}dom=null;eq(t){return this.dom==t.dom}toDOM(t){return this.dom||(this.dom=this.buildDOM(t))}}function gr(e,t,n){if(U.has(t.changes)){const r=he(U.get(t.changes)).get(n?.name??ue);if(r)return r}const s=r=>{const{highlightChanges:i,syntaxHighlightDeletions:c,mergeControls:l}=e.facet(H),f=r.state.field(te).sliceString(t.fromA,t.endA),a=document.createElement("div");if(a.className=`cm-deletedChunk ${Jn}`,l){const m=a.appendChild(document.createElement("div"));m.className="cm-chunkButtons";const w=m.appendChild(document.createElement("button"));w.name="accept",w.textContent=e.phrase("Accept"),w.onmousedown=v=>{v.preventDefault(),pr(r,r.posAtDOM(a))};const M=m.appendChild(document.createElement("button"));M.name="reject",M.textContent=e.phrase("Reject"),M.onmousedown=v=>{v.preventDefault(),Cr(r,r.posAtDOM(a))}}const u=a.appendChild(document.createElement("del")),d=t.changes;let h=0,g=!1;function p(m,w,M){for(let v=m;v<w;){let y=w,_=!1;const L=M+(g?" cm-deletedText":"");if(i&&h<d.length){const x=Math.max(0,g?d[h].toA:d[h].fromA);x<=y&&(y=x,g&&h++,_=!0)}if(y>v){const x=document.createTextNode(f.slice(v,y));if(L){const V=u.appendChild(document.createElement("span"));V.className=L,V.appendChild(x)}else u.appendChild(x)}v=y,_&&(g=!g)}}if(c&&n){const m=n.parser.parse(f);let w=0;mn(m,{style:M=>gn(e,M)},(M,v,y)=>{M>w&&p(w,M,""),p(M,v,y),w=v}),p(w,f.length,"")}else p(0,f.length,"");return a},o=E.widget({block:!0,side:-1,widget:new bt(s)});return U.has(t.changes)?he(U.get(t.changes)).set(n?.name??ue,o):U.set(t.changes,new Map([[n?.name??ue,o]])),o}function pr(e,t){const{state:n}=e,s=t??n.selection.main.head,o=e.state.field(B).find(l=>l.fromB<=s&&l.endB>=s);if(!o)return!1;let r=e.state.sliceDoc(o.fromB,Math.max(o.fromB,o.toB-1));const i=e.state.field(te);o.fromB!=o.toB&&o.toA<=i.length&&(r+=e.state.lineBreak);const c=Kt.of({from:o.fromA,to:Math.min(i.length,o.toA),insert:r},i.length);return e.dispatch({effects:kt.of({doc:c.apply(i),changes:c}),userEvent:"accept"}),!0}function Cr(e,t){const{state:n}=e,s=t??n.selection.main.head,o=n.field(B).find(c=>c.fromB<=s&&c.endB>=s);if(!o)return!1;let i=n.field(te).sliceString(o.fromA,Math.max(o.fromA,o.toA-1));return o.fromA!=o.toA&&o.toB<=n.doc.length&&(i+=n.lineBreak),e.dispatch({changes:{from:o.fromB,to:Math.min(n.doc.length,o.toB),insert:i},userEvent:"revert"}),!0}function $e(e,t){const n=new z;for(const s of e.field(B))n.add(s.fromB,s.fromB,gr(e,s,t));return n.finish()}const xr=e=>N.define({create:t=>$e(t,e),update(t,n){return n.state.field(B,!1)!=n.startState.field(B,!1)?$e(n.state,e):t},provide:t=>S.decorations.from(t)}),Et=D.define(),Q=N.define({create:()=>{},update(e,t){for(const n of t.effects)if(n.is(Et))return n.value;return e}});class wr extends Ae{toDOM(){const t=document.createElement("span");return t.className=bn.modelCursor,t}}const Ar=we.fromClass(class{decorations;constructor(e){this.decorations=this.buildDecorations(e)}update(e){(e.docChanged||e.viewportChanged||e.state.field(Q)!==e.startState.field(Q))&&(this.decorations=this.buildDecorations(e.view))}buildDecorations(e){const t=new z,n=e.state.field(Q);if(!n)return E.none;const{doc:s}=e.state,{modelCursorPosition:o,modelSelectionPositionRange:r}=n;if(o!=null)o>=0&&o<=s.length&&t.add(o,o,E.widget({widget:new wr,side:1}));else if(r!=null){const{start:i,end:c}=r;i>=0&&c<=s.length&&i<c&&t.add(i,c,E.mark({class:`${An} bg-[Highlight]!`}))}return t.finish()}},{decorations:e=>e.decorations}),kr=e=>[Q.init(()=>e),Ar],ne=D.define(),Se=N.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(ne))return n.value;return e}});function St(e,t){const{selectionStart:n,selectionEnd:s}=t,[o,r]=n.from>s.from?[s.from,n.to]:[n.from,s.to];e.dispatch({selection:Oe.create([Oe.range(o,r)]),effects:ne.of(t)})}function br(e,t){St(e,{selectionStart:t,selectionEnd:t}),e.focus();const s=()=>{e.dispatch({effects:ne.of(null)}),window.removeEventListener("mouseup",s)};return window.addEventListener("mouseup",s),!0}function Er(e,t){const n=e.state.field(Se);if(n){const s={...n,selectionEnd:t};St(e,s)}return!0}const Sr=we.fromClass(class{constructor(e){this.view=e,this.updateCursor()}update(e){e.transactions.some(t=>t.effects.some(n=>n.is(ne)))&&this.updateCursor()}updateCursor(){this.view.state.field(Se)?this.view.dom.classList.add("cm-line-number-dragging"):this.view.dom.classList.remove("cm-line-number-dragging")}}),Mr=S.theme({".cm-gutters":{cursor:"default"},"&.cm-line-number-dragging .cm-gutters":{cursor:"text"}});function vr(){return[Se,Sr,Mr,zt({domEventHandlers:{mousedown:br,mousemove:Er}})]}const Ye=Qe.define();function Mt(e,t){return e==null?[]:mr({highlightChanges:!1,gutter:!1,syntaxHighlightDeletions:!0,mergeControls:!1,language:t,textdocDiff:e})}function de(e,t,n){const s=e.reconfigure(Mt(t,n??null));if(t==null)return[s];const o=$.buildFromTextdocDiff(t);return[s,At.of(o)]}const Lr=({currentlyStreamingLineIndex:e,value:t,textdocDiff:n,placeholderContent:s,languageCompartment:o,languageCompartmentInit:r,editableCompartment:i,readOnlyCompartment:c,editableInit:l,handleChange:f,handleBlur:a,handleSave:u,extensionsProp:d,editorTheme:h,comments:g,maxLength:p=fn,intl:m,toaster:w,modelCursor:M,unifiedMergeViewCompartment:v,hideLineNumbers:y=!1})=>{const _=[$t(s),...p!=Number.POSITIVE_INFINITY?[Un(m,w,p)]:[],En(),o.of(r??[]),i.of([S.editable.of(l)]),c.of([K.readOnly.of(!l)]),Yt(),K.allowMultipleSelections.of(!0),Sn(),pn(),...y?[]:[vr(),Zt(),Cn({markerDOM:L=>{const x=document.createElement("span"),V=jt.createRoot(x),re=L?G.jsx(un,{className:"icon-sm text-token-text-tertiary"}):G.jsx(dn,{className:"icon-sm text-token-text-tertiary"});return V.render(re),x}})],kr(M),v.of(Mt(n,r?.language??null)),...d??[],..._n,Jt.of([...vn,...Ln,...xn,...yn,...Bn,Dn]),Mn(),h,Qt(g),Wn(),In(e??null),S.updateListener.of(f),S.domEventHandlers({blur:a,keydown(L){(L.key==="s"||L.key==="S")&&L.metaKey&&u?.()},paste(L){const x=L.clipboardData?.getData("text/plain");x!=null&&rt.logEvent("Canvas Codemirror Paste",{textLength:x.length})}})];return K.create({doc:t,extensions:_})};function yr({state:e,parent:t,onUpdateState:n}){const s=(o,r)=>{r.update(o);const i=r.state;n(i)};return new S({state:e,parent:t,dispatchTransactions:s})}const Br="_codemirror_hsqxh_1",Dr="_preview_hsqxh_26",Ze={codemirror:Br,preview:Dr},Tr=S.theme({".cm-tooltip-autocomplete":{backgroundColor:"var(--main-surface-primary)",color:"var(--text-primary)",border:"1px solid var(--border-light)",borderRadius:"6px",padding:"4px",boxShadow:"0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)"},".cm-tooltip-autocomplete > ul > li":{borderRadius:"5px",color:"var(--text-primary)"},".cm-tooltip-autocomplete > ul > li[aria-selected]":{backgroundColor:"var(--main-surface-secondary)",color:"var(--text-primary)"},".cm-tooltip-autocomplete > ul > li:hover":{backgroundColor:"var(--selection)",color:"#ffffff"},".cm-completionMatchedText":{textDecoration:"none",fontWeight:"700"}}),Nr=S.theme({".cm-scroller":{fontFamily:"ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace !important"}}),Or=S.theme({"&":{backgroundColor:"transparent"}}),Je=e=>[Nr,Or,Tr,wn(Tn(e),{fallback:!0})],Rr=e=>{const[t]=C.useState(()=>new W),n=cn();C.useEffect(()=>{e.current?.dispatch({effects:t.reconfigure(Je(n))})},[n,t,e]);const[s]=C.useState(()=>t.of(Je(n)));return s},vt=({id:e,children:t,comments:n,commentingOn:s,currentlyStreamingLineIndex:o,hoveredCommentId:r,focusedCommentId:i,placeholder:c="",readonlyReason:l,language:f,value:a,textdocDiff:u,extensions:d,maxLength:h,onBlur:g,onSave:p,onChange:m,editorRef:w,width:M,modelCursor:v,isPreview:y,hideLineNumbers:_=!1})=>{const L=C.useRef(null),x=C.useRef(null),V=Ut(),re=an(),[Bt,Me]=C.useState(null),oe=C.useRef(null),[{width:Dt},Tt]=On(),[j]=C.useState(()=>new W),[se]=C.useState(()=>new W),[ie]=C.useState(()=>new W),[O]=C.useState(()=>new W),ve=C.useRef(m);ve.current=m;const Nt=C.useCallback(({docChanged:A,state:b,transactions:R})=>{for(const T of R)if(T.annotation(Ye)===!0||T.annotation(lt)===!0)return;if(A){const T=b.doc.toString();oe.current=T,ve.current?.(b)}},[]),Le=C.useRef(g);Le.current=g;const Ot=C.useCallback(()=>Le.current?.(),[]),ye=C.useRef(p);ye.current=p;const Rt=C.useCallback(()=>ye.current?.(),[]),Gt=async A=>A?await Nn(A):null,Be=C.useCallback(async A=>{const b=await Gt(A);b&&x.current?.dispatch({effects:[j.reconfigure(b),...de(O,u,b?.language)]})},[j,O]),Ft=Rr(x),It=C.useCallback(A=>{if(A===oe.current){oe.current=null;return}const{current:b}=x;if(!b)return;const R=b.state.doc,T=R.toString(),Ne=ee(T,0,T.length,A,0,A.length),_t=A.slice(Ne),Vt={from:Ne,to:R.length,insert:_t},ce=f!=null?ae(f):null,Pt=b.state.update({changes:Vt,effects:[Re.of(n??[]),me.of(o??null),...ce!=null?[j.reconfigure(ce)]:[],...de(O,u,ce?.language)],annotations:Ye.of(!0)});b.update([Pt])},[n,o,f,j,u,O]);C.useImperativeHandle(w,()=>({UNSAFE_setValue:It,codeViewRef:x,highlightLine:(A,b)=>Vn(he(x.current),A,b)})),C.useEffect(()=>{Be(f)},[f,Be]),C.useEffect(()=>{const A=f==null?null:ae(f);x.current?.dispatch({effects:de(O,u,A?.language)})},[O,u]);const Y=l?.isReadonly===!0;C.useEffect(()=>{x.current?.dispatch({effects:[se.reconfigure(S.editable.of(!Y)),ie.reconfigure(K.readOnly.of(Y))]})},[Y,se,ie]),C.useEffect(()=>{(s==null||Xt(s))&&x.current?.dispatch({effects:en.of(s??null)})},[s]),C.useEffect(()=>{x.current?.dispatch({effects:Re.of(n??[])})},[n]),C.useEffect(()=>{x.current?.dispatch({effects:tn.of(r)})},[r]),C.useEffect(()=>{x.current?.dispatch({effects:nn.of(i)})},[i]),C.useEffect(()=>{x.current?.dispatch({effects:Et.of(v)})},[v]),C.useEffect(()=>{x.current?.dispatch({effects:me.of(o??null)})},[o]),C.useEffect(()=>{const A=L.current;if(A==null)return;const b=f==null?null:ae(f),R=Lr({currentlyStreamingLineIndex:o,value:a,placeholderContent:c,editableCompartment:se,readOnlyCompartment:ie,editableInit:!Y,languageCompartment:j,languageCompartmentInit:b??null,handleChange:Nt,handleBlur:Ot,handleSave:Rt,extensionsProp:d,editorTheme:Ft,intl:V,toaster:re,maxLength:h,comments:n??[],modelCursor:v,textdocDiff:u,unifiedMergeViewCompartment:O,hideLineNumbers:_});Me(R);const T=yr({state:R,parent:A,onUpdateState:Me});return x.current=T,()=>{T.destroy()}},[e,d,c]);const Ht=C.useCallback(()=>x.current,[x]),De=[],Te=[];return C.Children.forEach(t,A=>{if(!C.isValidElement(A))return;const{type:b}=A;if(b===yt)De.push(A);else if(b===Lt)Te.push(A);else throw new Error("Invalid Codemirror child: "+JSON.stringify(b))}),G.jsx(rn.Provider,{value:Ht,children:G.jsx(on.Provider,{value:Bt,children:G.jsxs(sn.Provider,{value:Dt,children:[G.jsxs("div",{className:"relative z-0 flex h-full max-w-full",children:[G.jsx("div",{id:e,className:nt(Ze.codemirror,y&&Ze.preview,kn.composer,"flex h-full w-full flex-col items-stretch"),ref:hn(L,Tt),style:{width:M}}),Te]}),De]})})})},Lt=({children:e})=>e,yt=({children:e})=>e;vt.EditorChildren=Lt;vt.ContextChildren=yt;export{vt as C};
//# sourceMappingURL=e91xke4veyr6vkag.js.map
