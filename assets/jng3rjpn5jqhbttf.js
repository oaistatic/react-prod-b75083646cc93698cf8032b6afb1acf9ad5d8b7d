import{bg as R,j8 as K,p0 as L,lo as B,p1 as N,bw as q,le as U,p2 as Q,eE as $,lI as z}from"./hml6mmd5fyx85si7.js";import{l as G,e as H,a as b,r as e,j as r,ai as J,h as V,N as X}from"./lu2xqwqmjc95q6j6.js";import{W as Y}from"./b20i0znhwjqysk1s.js";import{l as Z,m as tt,h as st,W as et,n as rt,o as ot,j as at}from"./ktoofw7mjru0a6r5.js";import{ex as nt,ey as d,ez as x}from"./rseqzngxzbdt1oxg.js";import{u as it}from"./msab1t9ew5jwzw5m.js";import{u as ut,W as mt}from"./f6knvt2j41ilvchg.js";import{u as ct}from"./k1vf300nfu1glkjf.js";import"./cqyjjngibokvfw83.js";import"./ogr5nmy9hq7gfgq0.js";import"./mc1n5d2hvi71ywqx.js";import"./n0u5fqw2jde51umw.js";import"./nhs24pb9s8hnfshq.js";import"./dth89wjzf9gy8rh3.js";import"./kwjkd9zyf9vouy1r.js";import"./dc45v808kg6x38y7.js";import"./fsu81ov1h2xmh0dx.js";import"./blhqqdzhd9z6fst7.js";import"./eywlrsjhpmu02zoa.js";import"./itjugg22bqh0ueps.js";import"./kkw9h7dq0af4udcb.js";import"./e3c6g208bapx5eab.js";import"./d8r48c27g352nr7t.js";import"./dp7t1jmnbbend843.js";import"./e0cf2nztzmm3evd7.js";import"./l29qldloj3xqr7yu.js";import"./fzrn137102spawew.js";import"./dq9j3pioxqah4sfs.js";import"./99iw5y145xpdn59x.js";import"./fi4t5vltimyk5jia.js";import"./kyavoy07nhuntf5e.js";import"./ezlg48t9e1qt7u4e.js";import"./ipg3e8rb8w1bw4eb.js";import"./im6z424k5kcvyn27.js";import"./fvbnr0u7cjvlf5r4.js";import"./fc2c76vpc3m2kj8q.js";import"./isqkn4xlzoktkvfr.js";import"./em6xteal3laxzbp5.js";import"./oevbdyhdaqh4lk1q.js";import"./cll46xg89nxc0ghy.js";function lt({taskId:t,onClose:u}){const o=G(),l=R(),n=H(),m=b(),{data:s,error:y}=Z(t,{refetchOnWindowFocus:!0,refetchOnMount:!0}),{isLoading:w}=tt(t),W=st(({getTurnsForTask:a})=>a(t)),c=K(),M=nt.useCurrentImage()!=null,S=it(),f=e.useMemo(()=>c?new B(N()):new L,[c]),g=q(U(f)),[C,p]=e.useState([]),[j,h]=e.useState(!1),{focusedAssistantTurn:i,setFocusedAssistantTurnId:E}=ut({taskId:t,task:s?.task,currentUserTurn:s?.current_user_turn??null,currentAssistantTurn:s?.current_assistant_turn??null}),v=s?.task?.current_turn_id,k=!!s?.task.has_unread_turn&&v===s.current_assistant_turn?.id,_=s?.current_assistant_turn?.turn_status==="completed";e.useEffect(()=>{if(!c)return;const a=s?.task?.title;if(a){const O=document.title;return document.title=a,()=>{document.title=O}}},[c,s?.task?.title]),e.useEffect(()=>{k&&_&&et.markTurnAsRead(t).then(()=>{o.invalidateQueries({queryKey:["wham","tasks"]}),o.invalidateQueries({queryKey:["wham","task",t]})})},[k,_,t,o]),ct(),rt([{key:"newTask",action:()=>{m("/codex",{state:{focusComposer:!0}})},actionMessageDescriptor:n.formatMessage({id:"wham.keyboardActions.newTask",defaultMessage:"New task"}),group:x.Chat,keyboardBinding:[d.Mod,d.Shift,"o"]},{key:"closeTask",action:()=>{m("/codex")},actionMessageDescriptor:n.formatMessage({id:"wham.keyboardActions.closeTask",defaultMessage:"Close task"}),group:x.Chat,keyboardBinding:[d.Escape],enabled:!M&&!S}]);const T=C.length>0,A=e.useCallback(({force:a=!1}={})=>{if(a||!T&&g){p([]),u();return}h(!0)},[u,T,g]),P=i?ot(i.turn_status):!1,D=i?.sibling_turn_ids?.includes(s?.current_assistant_turn?.id??"")||i?.id===s?.current_assistant_turn?.id,F=!s?.current_diff_task_turn,I=P&&(D||F);return y?(l.danger({id:"wham.task-details.error",defaultMessage:"Error loading task",description:"Error message for failed to load task details"},{id:`wham-task-details-error-${t}`,hasCloseButton:!0,duration:3,toastId:"wham_task_page_content_error"}),r.jsx(J,{to:"/codex"})):r.jsx(Q.Provider,{value:f,children:r.jsx(mt,{permissions:"write",taskId:t,turnId:s?.current_assistant_turn?.id??"",confirmClose:j,setConfirmClose:h,task:s?.task,focusedAssistantTurn:i,pastTurns:W,clearComments:()=>p([]),setComments:p,comments:C,canFollowUp:I,handleClose:A,setFocusedAssistantTurnId:E,loadingTurnMapping:w})})}function pt(){const t=b(),u=V(),{taskId:o}=X();at();const l=u.state??{},{backgroundLocation:n}=l,m=e.useCallback(()=>{t(n?-1:"/codex")},[n,t]);return o?r.jsx($,{children:r.jsx(Y,{children:r.jsx(lt,{taskId:o,onClose:m})})}):null}const Zt=()=>[{title:"Codex"}],ts=z(function(){return r.jsx(pt,{})});export{ts as default,Zt as meta};
//# sourceMappingURL=jng3rjpn5jqhbttf.js.map
