import{j as e,M as z,r as x}from"./lu2xqwqmjc95q6j6.js";import{l as B,hK as R,d as i,a as $,c as F,B as G,iu as H,g3 as K,cR as N,ef as W,eL as O,gG as Q,P as X,T as q,g as J,aN as V}from"./hml6mmd5fyx85si7.js";import{gX as Y,jv as w,jw as Z,jx as I,jy as S}from"./rseqzngxzbdt1oxg.js";import{S as U}from"./hbgl5asz88evcs5w.js";function ee({message:t,simulatedDuration:r=8*60*1e3,maxFill:s=100}){t?.metadata?.model_slug!=="o1-pro"&&(r=20*60*1e3);const n=t?.create_time?new Date(t.create_time*1e3):Date.now(),o=Y(+n,r);return e.jsx(w,{percentage:Math.min(o,s),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:`${(100-o)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:8})}function te({title:t,content:r,buttons:s,time:n,icon:o,size:l="default",progressBar:c,disabled:a=!1,onClick:d}){const f=l==="small"?`w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ${a?"":"gap-4"}`:"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",b=d?"cursor-pointer":"",g=l==="small"?"text-[15px]":"",p=B(R);return e.jsxs("div",{className:i("relative inline-flex flex-col items-start justify-start rounded-2xl border","bg-token-bg-primary border-token-border-default box-content rounded-2xl border bg-clip-padding px-5 py-4",!p&&"mx-[calc(--spacing(-2)-1px)] -my-[1px] @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",f,b,g),onClick:d,children:[e.jsxs("div",{className:i("flex flex-col items-start justify-start self-stretch",l!=="small"&&"gap-1.5"),children:[e.jsxs("div",{className:i("inline-flex items-start justify-start self-stretch",l!=="small"&&"gap-2"),children:[e.jsx("div",{className:i("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:t}),e.jsx("div",{className:"relative h-6 w-6"}),!a&&(o||e.jsx(U,{className:"relative h-6 w-6"}))]}),e.jsx("div",{className:i("flex w-full flex-col items-start justify-start",l==="small"&&"mt-[-2px]"),children:e.jsx("div",{className:i("inline-flex w-full items-start justify-start self-stretch rounded-sm",l==="small"?"gap-1":"gap-2.5 py-1"),children:e.jsx("div",{className:i("w-full leading-relaxed font-normal",a?"text-token-text-tertiary":"text-token-text-secondary"),children:r})})})]}),c?e.jsxs("div",{className:i("mb-2 inline-flex items-center justify-between self-stretch",s?.length&&"mt-[-10px]"),children:[c,s]}):e.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[n&&e.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:n}),e.jsx("div",{className:"flex gap-2",children:s})]})]})}function se({message:t}){const r=t?.metadata?.tournament_progress??0;return e.jsx(w,{percentage:r,className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:`${(100-r)/100*5}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:8})}function ae({errorNotice:t,onOpenSidebarSummarizer:r,isReceivingUpdates:s,lastMessage:n,latestTitle:o,summarizationHeadline:l}){const c=$(),a=F(c,"4094234945");return e.jsxs("div",{className:"flex pb-2",children:[e.jsx(te,{buttons:s?[e.jsx(G,{onClick:d=>{d.stopPropagation(),r()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:e.jsx("div",{className:"px-1",children:e.jsx(z,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:l,icon:s?e.jsx("div",{className:""}):null,content:s?`${o}...`:n?.metadata?.finished_text??"",size:"small",disabled:!s,onClick:r,progressBar:s?a?e.jsx(se,{message:n}):e.jsx(ee,{message:n}):null}),t]})}const re=/\*\*(.*?)(?:\*\*|\n|$)/g,ne=t=>{let r=null,s;for(;(s=re.exec(t))!=null;)r=s[1].trim();return r},le=()=>null;function me({messages:t,isStreaming:r,isCompletionRequestInProgress:s,hasActiveRequest:n,isLastMessage:o,isFinalTurn:l,isFeedbackEnabled:c,clientThreadId:a,currentGroupedMessageIndex:d,turnIndex:f}){const[b,g]=x.useState(""),[p,k]=x.useState(!1),C=H(a)?.value===K.STREAMING,T=Z(N(a)),m=W(t),M=m?.id,y=m?.metadata?.initial_text,E=m?.metadata?.summarization_headline,h=t.map(u=>O(u)).join(`

`),{toggleThreadSidebar:v}=Q(),_=x.useCallback(()=>{v({type:"summarizer",clientThreadId:a,currentGroupedMessageIndex:d,turnIndex:f})},[v,a,d,f]);x.useEffect(()=>{const u=ne(h);u?g(u):y!=null&&g(y)},[h,y]),x.useEffect(()=>{h.length>0&&k(!0)},[h]),x.useEffect(()=>{p&&X.logEvent("Tool: Received a8km123 message",{client_thread_id:a,message_id:M,conversationId:N(a)})},[p]);const P=l&&o&&(C||r),A=le()!=null,D=q.isLastActorMessage(J(a),t[0].id),L=!!V(a,u=>u?.sharedConversationMetadata),j=I(t[0],D,A,s||n,L);return!T&&m?.metadata?.finish_details?.type==="interrupted"&&m?.metadata?.finish_details?.reason!=="server_timeout"||m?.clientMetadata?.err?e.jsx("div",{children:j&&e.jsx(S,{errorState:j,nodeId:t[0].id,isFeedbackEnabled:c,clientThreadId:a,isUserTurn:!1})}):e.jsx(ae,{errorNotice:j&&e.jsx(S,{errorState:j,nodeId:t[0].id,isFeedbackEnabled:c,clientThreadId:a,isUserTurn:!1}),onOpenSidebarSummarizer:_,isReceivingUpdates:P,lastMessage:m,latestTitle:b,summarizationHeadline:E})}export{me as default};
//# sourceMappingURL=gf9wva602wkkhkfr.js.map
