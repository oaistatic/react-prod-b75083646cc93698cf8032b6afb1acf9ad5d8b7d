import{r as _,j as o,A,M as k}from"./lu2xqwqmjc95q6j6.js";import{a as T,c as D,aN as $,cP as U,mF as B,a$ as P,fH as z,d as j,jE as L,P as w,T as I}from"./hml6mmd5fyx85si7.js";import{bA as O,bB as E,bC as W,aQ as C,bD as G,bE as V,bF as q,bk as Q}from"./rseqzngxzbdt1oxg.js";import{F as R}from"./j8xxu9jjbt2cwo9f.js";function F(e,t){const l=new RegExp(`<\\s*${t}\\s*>([\\s\\S]*?)<\\s*/\\s*${t}\\s*>`,"i"),d=e.match(l);return d&&d[1]?d[1].trim():e}function Y(e){if(e===void 0)return;const t="Content Snippet:",l=e.indexOf(t);return l===-1?e:e.substring(l+t.length).trim()}function Z(e,t){t.text=Y(e.contents),e.documentId?.includes("ks--slack")||t.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/(issues|pull)\/\d+/)?(t.text=void 0,t.name=`#${t.name}`):t.cloud_doc_url?.startsWith("https://docs.google.com/spreadsheets/")&&t.text!==void 0?t.text=F(t.text,"sheet_summary"):t.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&t.text!==void 0?t.text=F(t.text,"git_summary"):t.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&t.text!==void 0&&(t.text=F(t.text,"code_summary")),t.text&&(t.text=t.text.slice(0,250))}function oe({turnIndex:e,clientThreadId:t,variant:l="sidebar"}){const d=T(),g=D(d,"1424158285"),[x,r]=$(t,i=>[I.getTurnContentReferences(i,e),I.getConversationTurnAtIndex(i,e).messages]),p=U(t),u=_.useMemo(()=>({turnIndex:e,clientThreadId:t}),[t,e]),f=_.useMemo(()=>{const i=[],m=new Set;return x.forEach(s=>{s.type==="file"&&!m.has(s.id)?(i.push({id:s.id,name:s.name,cloud_doc_url:s.cloud_doc_url??s.extra?.cloud_doc_url,text:s.text,authors:s.medical_file_reference?.authors_display,publication_year:s.medical_file_reference?.publication_year,journal_name:s.medical_file_reference?.journal_name,doi:s.medical_file_reference?.doi}),m.add(s.id)):s.type==="file_navlist"&&s.items.forEach(c=>{m.has(c.id)||(i.push({name:c.name,cloud_doc_url:c.cloud_doc_url,text:c.description,id:c.id,lastModifiedTime:c.last_modified_time}),m.add(c.id))})}),i},[x]),a=B(p),b=_.useMemo(()=>{if(!a||l==="bottom")return[];const i=[],m=new Set;for(const s of r)if(s.author.role===P.Tool&&s.author.name==="file_search"&&s.content.content_type===z.TetherBrowsingDisplay){const c=O(s.content.result),v=s.metadata?.cloud_doc_urls??[];c.chunks.forEach((n,h)=>{if(!n.documentId||m.has(n.documentId))return;m.add(n.documentId);let y;n.metadata.cloud_doc_url?y=n.metadata.cloud_doc_url.toString():h<v.length?y=v[h]:n.documentId.endsWith("--google")&&(y=`https://drive.google.com/file/d/${n.documentId.split("--")[1]}`);const S=n.metadata["File last modified at"]??n.metadata["File created at"],M={id:n.documentId,name:n.title,cloud_doc_url:y,text:n.contents,lastModifiedTime:S?S.toString():void 0};Z(n,M),i.push(M)})}return i},[a,r,l]);return o.jsx(A,{children:o.jsxs("div",{className:j("bg-token-main-surface-primary flex w-full flex-col",l==="sidebar"&&"mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)]"),children:[o.jsx(N,{title:o.jsx(k,{id:"dlVlo6",defaultMessage:"Citations"}),items:f,clientThreadId:t,sectionId:"citations",analyticsMetadata:u}),!g&&o.jsx(N,{title:o.jsx(k,{id:"njZblE",defaultMessage:"Search Results"}),items:b,clientThreadId:t,sectionId:"search-results",analyticsMetadata:u})]})})}function N({title:e,items:t,scrollToHeader:l,shouldAnimateScroll:d,clientThreadId:g,analyticsMetadata:x,sectionId:r}){const p=_.useRef(null),u=_.useMemo(()=>x?{...x,sectionId:r,numResultsInSection:t.length}:void 0,[x,t.length,r]);return _.useEffect(()=>{p.current&&l&&setTimeout(()=>{p.current&&p.current.scrollIntoView({behavior:d?"smooth":"instant"})},300)},[l,d]),!t||t.length===0?null:o.jsxs("div",{ref:p,children:[o.jsx(E,{className:"border-token-border-sharp bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex h-[calc(var(--header-height,3.5rem)+1px)] items-center border-b px-6 pt-4 pb-4 text-sm font-medium",children:e}),o.jsx("div",{className:"flex list-none flex-col px-3 py-2",children:t.map((f,a)=>o.jsx(E,{index:a,children:o.jsx(H,{positionInSection:a,item:f,analyticsMetadata:u,clientThreadId:g},a)},`${e}-${a}`))})]})}function H({item:e,analyticsMetadata:t,positionInSection:l,clientThreadId:d}){const g=L(),x=T(),r=D(x,"1424158285"),p=r?e.journal_name:e.name,u=W(e.cloud_doc_url??"");let f=p??o.jsx(k,{id:"bqY3sN",defaultMessage:"File"}),a=u?.Icon??(e.cloud_doc_url?C:G);!e.cloud_doc_url&&!V(e.id)&&(f=o.jsx(k,{id:"hGgoxF",defaultMessage:"Source"}),a=C);const[b,i]=_.useState(!1),m=e.cloud_doc_url?e.cloud_doc_url:"";r&&m.length>0&&(a=({className:h})=>o.jsx(Q,{url:m,className:j(h,"object-cover"),size:32,minSize:20,fallback:o.jsx(C,{className:h})}));const s=_.useCallback(()=>{t&&w.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",{...t,positionInSection:l,sourceType:u?.type,hasUrl:!!e.cloud_doc_url})},[t,e.cloud_doc_url,u?.type,l]),c=_.useCallback(()=>{t&&w.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",{...t,positionInSection:l,sourceType:u?.type,hasUrl:!!e.cloud_doc_url})},[t,e.cloud_doc_url,u?.type,l]),v=e.doi!==void 0;return o.jsx(o.Fragment,{children:o.jsxs("a",{href:e.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:s,className:j("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",b&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"line-clamp-1 flex h-6 items-center gap-2 text-xs",children:[a&&o.jsx(a,{className:"icon-sm bg-token-main-surface-primary rounded-full object-cover"}),f]}),r&&o.jsx("div",{className:"line-clamp-2 text-sm font-bold break-words",children:e.name}),r&&o.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[o.jsx("span",{className:"italic",children:e.authors}),o.jsx("span",{className:"ms-1 not-italic",children:e.publication_year})]}),r&&v&&o.jsx("div",{className:"line-clamp-2 text-sm break-words",children:e.doi}),(e.text??e.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[e.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(q,{date:new Date(e.lastModifiedTime.trim())}),e.text&&" â€” "]}),e.text]}),g?null:o.jsx(R,{className:j("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",b&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:d,fileId:e.id,fileName:e.name,fileCloudDocUrl:e.cloud_doc_url,isFollowupMenuOpen:b,setIsFollowupMenuOpen:i,trackFileSourceFollowup:c})]})})}export{oe as ChatScreenRetrievalResultsFlyoutContent,N as SourcesListGroup};
//# sourceMappingURL=bppy256d7j81mqnq.js.map
