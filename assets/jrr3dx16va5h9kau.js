import{r as f,u as q,j as M,m as A,q as F}from"./lu2xqwqmjc95q6j6.js";import{jC as H,b$ as $}from"./rseqzngxzbdt1oxg.js";import{er as c,q$ as l,ca as v,ee as N,bX as p,hS as T,gg as w,V as y,ev as D}from"./hml6mmd5fyx85si7.js";const x={width:1,height:1};function at(t,e,n=x){if(!t||!e)return null;const{width:r,height:s}=e;if(r===0||s===0)return null;const o=r/s,a=n.width/n.height;if(Math.abs(o-a)<1e-6)return null;let i=50,h=50;const{center_x_percent:P,center_y_percent:C}=t;if(o>a){const d=o-a;i=(P*o-a/2)/d*100,i=Math.max(0,Math.min(100,i))}else{const d=1/o,_=1/a,L=d-_;h=(C*d-_/2)/L*100,h=Math.max(0,Math.min(100,h))}return`${i.toFixed(1)}% ${h.toFixed(1)}%`}var E=(t=>(t.SCALLION="scallion",t.SCALLION_RC="scallion-rc",t.SCALLION_RC0="scallion-rc0",t.SCALLION_RC1="scallion-rc1",t.SCALLION_RC2="scallion-rc2",t.CHIVE="chive",t.CHIVE_RC="chive-rc",t.CHIVE_RC0="chive-rc0",t.CHIVE_RC1="chive-rc1",t))(E||{});const it=async({queryKey:t})=>{const[e,n]=t;if(n.length<2)return[];const r=new URLSearchParams({query_fragment:n});return c.get(`${l}/suggestions?${r.toString()}`).then(s=>s.suggestions).catch(()=>[])};function O(t){return{settings_overrides:{search_results:{search_engines:t.use_labrador?{bing:{}}:{bing:{ranking_model:null,rrf_alpha:1,rrf_input_threshold:0},labrador:null}},model_response:{enable_multimodal:t.show_image_to_model,completion_model:t.completion_model&&t.completion_model!=="production"?{model:t.completion_model,clip_model:"@mmapi",direct_connection_urls:[]}:{}}},base_config:t.base_config??E.SCALLION,eval_preset:t.eval_preset}}async function ut({threadId:t,threadUserId:e,routePrefix:n}){let r=l;n&&(r=r+n);const s=new URL(`${r}/threads/${t}/with_turns`);return e&&s.searchParams.append("thread_user_id",e),await c.get(s.toString())}async function ct(t){const e=new FormData;return e.append("feedback",JSON.stringify({thread_id:t.threadId,turn_index:t.turnIndex,rating:t.rating,search_query:t.searchQuery,text:t.text,model_instructions:t.modelInstructions,tags:t.tags,user_email:t.userEmail})),t.screenshot&&e.append("file",new File([t.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),c.post(`${l}/feedback/turns`,e)}async function j(t,e){return c.post(`${l}/threads/${t}/turns/${e}/images_try_hard`)}async function lt(t){const e=new FormData;return t.screenshot&&e.append("file",new File([t.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),e.append("feedback",JSON.stringify({thread_id:t.threadId,url:t.url,title:t.title,snippet:t.snippet,rating:t.rating,search_query:t.searchQuery,text:t.text,tags:t.tags,user_email:t.userEmail,turn_index:t.turnIndex})),c.post(`${l}/feedback/links`,e)}function ht(t){const e=O(t.agentSettingsOverrides);c.post(`${l}/prefetch`,{...e,turn:{user_query:t.query},user_metadata:t.metadata})}class R extends Error{constructor(e){super(e),this.name="TurnError"}}function k(t){return t?t.model_response?.text!=null&&t.model_response.text.length>0:!1}function g(t){return t.execution_status==="fatal_system_error"}function U(t){return t.execution_status==="in_progress"||t.execution_status===null}function Q(t){return u(e=>e.thread?.turns.map(n=>t.reduce((r,s)=>(r[s]=n[s],r),{}))??[],(e,n)=>{if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(!T(e[r],n[r]))return!1;return!0})}function z(){return u(t=>p(t.thread?.turns.flatMap(e=>e.model_response?.citations)),T)}const I={thread:null,error:void 0},u=v(N(()=>({...I}))),V=w(()=>{y.addError(new R("got updateTurn with no current thread"))},1e3),X=w(t=>{y.addError(new R("turn not found"),{turnIndex:t})},1e3),m={threadId:t=>t.thread?.id??null,turns:t=>t.thread?.turns??[],turnCitations:t=>e=>e.thread?.turns[t].model_response?.citations??[],hasResponse:t=>k(t.thread?.turns[0]),firstTurn:t=>t.thread!=null?t.thread.turns[0]:void 0,lastTurn:t=>t.thread!=null?t.thread.turns[t.thread.turns.length-1]:void 0,numTurns:t=>t.thread?.turns.length??0,isLastTurnStreaming:t=>{const e=t.thread!=null?t.thread.turns[t.thread.turns.length-1]:void 0;return e!=null&&U(e)},hasModelResponseText:t=>t.thread?.turns[0]?.model_response?.text!=null,hasFirstTurnError:t=>{const e=t.thread?.turns[0];return!!e&&g(e)},hasTurnError:t=>t.thread?.turns.some(g)??!1,threadError:t=>t.error,__deprecated_sportsWidget:t=>t.thread?.turns[0]?.sports_widget??null},dt={appendTurn(t,e,n){u.setState(r=>{r.thread?.id!==t&&(n?.(t),r.thread={id:t,turns:[]}),r.thread.turns.push(e)})},updateTurn(t,e){u.setState(n=>{const r=n.thread;if(!r){V();return}const s=r.turns[t];if(!s){X(t);return}e(s)})},clearThread(){u.setState(()=>({...I}))},setError(t){u.setState(e=>{e.error=t})},setThread(t,e){u.setState(n=>{n.thread={id:t,turns:e}})}};class W{queue=[];attempted=new Set;isProcessing=!1;enqueue(e){this.queue.push(e),this._processQueue()}async _processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)try{const e=this.queue.shift();if(!e)continue;await this._preload(e)}catch{}this.isProcessing=!1}}_preload(e){return new Promise(n=>{this.attempted.has(e)&&n();const r=new Image;r.onload=()=>{this.attempted.add(e),n()},r.onerror=()=>{this.attempted.add(e),n()},r.src=e})}}const Y=new W;function J(t){const e=f.useRef(t);return D(e.current,t)||(e.current=t),e.current}function K(t,{enabled:e=!0}={}){const n=J(t);f.useEffect(()=>{if(!e||"connection"in navigator&&navigator.connection.type==="cellular")return;const s=setTimeout(()=>{n.forEach(o=>{o&&Y.enqueue(o)})},1e3);return()=>{clearTimeout(s)}},[e,n])}function mt(){const{imageResults:t}=Z();K([...t.map(e=>b(e))])}const G=$((...t)=>j(...t),5e3);function Z(t=!1){const e=Q(["image_results","image_try_hard_status","execution_status"]),n=u(m.threadId),r=p(e.toReversed().flatMap(i=>i.image_results?.entries)).map(i=>({...i,thumbnail_url:i.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:i.content_url.replace(/^http:\/\//,"https://")})),s=u(m.hasModelResponseText),o=e.some(i=>g(i));let a=r.length===0&&!s;return n!=null&&t&&!a&&r.length===0&&e[0]?.image_try_hard_status==="not_attempted"&&(G(n,0),a=!0),t&&e[0]?.image_try_hard_status==="in_progress"&&(a=!0),{imageResults:r,isLoading:a,isErrored:r.length===0&&o}}function _t(){const t=z(),e=u(m.hasTurnError),n=u(m.hasModelResponseText),r=H(t);return{imageResults:r,isLoading:r.length===0&&!n,isErrored:r.length===0&&e}}function B(t){return F({queryKey:["downloadImage",{imageUrl:t}],queryFn:()=>new Promise((e,n)=>{const r=new Image;r.onload=()=>{e({width:r.width,height:r.height})},r.onerror=()=>{n()},r.src=t}),enabled:!!t})}function gt(t){return q(B(t))}const tt=474,S={width:tt,aspectRatio:x};function b(t,e=S){if(t==null||t.is_proxied_image)return;const n=new URL(t.thumbnail_url);if(n.hostname.indexOf(".bing.")===-1)return t.thumbnail_url;const{width:r,height:s,aspectRatio:o}=e;let a=Math.min(r,t.content_size.width),i=s??Math.floor(o?a*(o.height/o.width):a*t.content_size.height/t.content_size.width);return!s&&o&&o.width===o.height&&(a=i=Math.min(a,i)),n.searchParams.delete("pid"),n.searchParams.set("w",a.toString()),n.searchParams.set("h",i.toString()),n.searchParams.set("c","7"),n.searchParams.set("p","0"),n.toString()}function ft(t,e=S){return f.useMemo(()=>b(t,e),[t,e])}const et={type:"spring",stiffness:700,damping:82};function pt({children:t,className:e}){return M.jsx(A.div,{animate:{opacity:1},initial:{width:"100%",height:"100%",translateX:0,translateY:0,opacity:0},whileHover:{width:"103%",height:"103%",translateX:"-1.5%",translateY:"-1.5%"},transition:et,className:e,children:t})}export{x as A,E as B,tt as D,pt as I,m as T,Z as a,gt as b,u as c,g as d,lt as e,it as f,B as g,Q as h,U as i,mt as j,dt as k,ut as l,ft as m,et as n,at as o,ct as p,ht as r,_t as u};
//# sourceMappingURL=jrr3dx16va5h9kau.js.map
