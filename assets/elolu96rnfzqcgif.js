const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/b76ojp4c0euhv280.js","assets/lu2xqwqmjc95q6j6.js","assets/rseqzngxzbdt1oxg.js","assets/hml6mmd5fyx85si7.js","assets/root-c0w5lvnh.css","assets/conversation-small-gcvo4yhm.css","assets/cgxd9hwn2gi2vxix.js","assets/elsxlexcf8f2vdmq.js","assets/gokl7f5tko3axdgv.js","assets/ha5c49xdung77vuc.js"])))=>i.map(i=>d[i]);
import{b5 as da,a as He,u as Ue,iU as ma,jb as bn,ap as Ks,aq as Ys,d as $s,aN as as,kX as pa,l as Js,cB as Qs,P as Z,E as ga,H as Fs,L as Us,eT as fa,t as Ws,ah as yn,eZ as xn,A as qs,aO as ns,pZ as ha,bO as Cn,aH as Pn,aJ as Fe,db as Vs,T as ee,a$ as Mn,oV as Sa,fJ as Tn,bg as kn,aB as oe,fE as De,ct as Aa,p_ as ba,dc as ya,aM as xa,D as wn,k4 as Ca,i as Pa,cs as Ma,ce as Ta,p$ as ka,on as wa,dd as Ra,c$ as _a,b7 as va,h2 as Ba,dI as Ea,oY as ja,dL as Da,r as A,c as ne,c4 as Xt,q0 as Fa,gP as Zt,gO as Ua,f0 as Ha,q1 as Ia,cA as La,fz as Na,fC as en,kl as Oa,b6 as za,hA as Ga,d9 as Wa,fN as Hs,cb as qa,cV as Va,cf as Ka,fD as Ya,ok as $a,ld as sn,fB as Ja,q2 as Qa,bw as X,le as Xa,og as Za,oh as er,iu as sr,cR as ss,g3 as tn,lg as tr,de as Se,df as z,iW as nr,f6 as nn,q3 as on,jm as Is,cj as Ae,dU as or,mA as ar,q4 as an,f8 as ts,pJ as rr,pK as lr,l4 as ir,k7 as cr,oj as ur,ol as dr,hl as mr,ow as pr,iV as Ls,q as gr,m as fr,oy as hr,q5 as Sr,f3 as Ar,q6 as br,cT as Ns,kY as yr,q7 as xr,q8 as Cr,k6 as Pr,lp as Mr,q9 as Tr,g as rn,eK as kr,qa as wr,lf as Rr,jk as v,j2 as _r,qb as vr,aU as Br,aZ as ln,gZ as Er,qc as jr,fA as cn,gg as Dr,qd as Fr,qe as Ur,qf as un,qg as Hr,mu as Ir,qh as Lr,e$ as Nr,nW as Or,k as zr,U as Gr,c3 as Wr,dg as qr,fQ as dn,qi as Vr,V as Kr,s as Yr,N as $r,cC as Jr,j1 as Qr,qj as Xr,qk as Zr,ql as el,ko as sl,pE as tl,bZ as nl}from"./hml6mmd5fyx85si7.js";import{e as Xs,r as c,j as s,M as G,b as ol,a as al}from"./lu2xqwqmjc95q6j6.js";import{kv as rl,kw as ll,kx as Os,B as Rn,a8 as _n,Q as vn,ky as il,kz as H,kA as be,kB as i,kC as cl,kD as ul,fK as dl,kE as ml,kF as Bn,kG as pl,kH as gl,kI as fl,kJ as hl,kK as Sl,kL as Al,kM as bl,kN as yl,kO as xl,kP as Cl,kQ as mn,kR as Pl,kS as Ml,kT as Tl,kU as kl,kV as wl,kW as Rl,kX as _l,kY as vl,kZ as Bl,k_ as El,k$ as jl,l0 as Dl,l1 as Fl,l2 as Ul,gY as Hl,l3 as Il,l4 as Ll,l5 as Nl,l6 as Ol,l7 as zl,l8 as Gl,l9 as Wl,la as ql,lb as Vl,lc as Kl,ld as Yl,le as $l,lf as Jl,lg as Ql,lh as Xl,li as Zl,lj as ei,lk as si,ll as ti,lm as ni,ln as En,lo as oi,lp as ai,lq as ri,bL as li,lr as jn,q as ii,ls as ci,lt as ui,$ as pn,lu as di,lv as mi,e4 as pi,aj as gi,lw as fi,lx as hi,ly as Si,lz as Ai,lA as bi,fI as yi,lB as xi,lC as Ci,lD as Pi,lE as Mi,lF as Ti,lG as ki,lH as wi,lI as Ri,lJ as _i,iO as vi,lK as Bi,lL as Ei,ec as je,lM as gn,lN as ji,lO as Di,lP as Fi,X as Ui,lQ as Hi,lR as Ii,lS as Li,lT as Ni,lU as Oi,bJ as zi,gT as Gi,lV as Wi,lW as qi,lX as zs,cK as Vi,lY as Ki,lZ as fn,l_ as Yi,l$ as $i,m0 as Gs,m1 as Ji,m2 as Qi,m3 as Xi,cJ as Zi,m4 as ec,m5 as hn,m6 as sc,gv as Sn,cH as tc,aQ as nc,m7 as oc,m8 as ac,m9 as rc,ma as lc,mb as ic,mc as cc,md as uc,me as dc,mf as mc,mg as pc,mh as gc,mi as fc,mj as hc,mk as Sc,ml as Ac,mm as bc,mn as yc,mo as xc,mp as Cc,mq as Pc,mr as Mc,h1 as Tc,ms as An}from"./rseqzngxzbdt1oxg.js";import{P as kc,u as wc}from"./kcqshnk26ykm1u4n.js";import{u as Rc}from"./fibktxptqydbr54o.js";import{getTabScreenshot as _c}from"./6a3e5rtr9pyzi31y.js";import{u as vc}from"./ogr5nmy9hq7gfgq0.js";import{P as Bc,u as Ec,h as jc}from"./cqyjjngibokvfw83.js";import{A as Dc}from"./ik8y7nlve9mzjttb.js";const os="month",Dn="year";function Fc(){const o=da(),n=He(),u=Xs(),{markAsViewed:p}=Ue(rl),{initialBillingDetails:m}=Rc(o,!0),r=c.useMemo(()=>({...o?.subscriptionAnalyticsParams,referrer:document.referrer}),[o]);async function x(){try{await il(m,r)}catch{}}const{shouldShowBanner:t,discountValue:a,discountDuration:h}=ll();if(c.useEffect(()=>{t&&a&&h&&Os.logShowReferrerRedemptionBanner()},[t,a,h]),!t||!a||!h)return null;const P=Uc(u,m,a,h),D=Hc(u,m,a,h),j=s.jsxs("div",{className:"grow",children:[s.jsx("div",{className:"mb-0.5 font-semibold",children:P}),s.jsx("span",{className:"text-token-text-secondary",children:D})]});return s.jsx(Rn,{onPrimaryCtaClick:()=>{p(),Os.logClickReferrerRedeemButton(),x()},primaryCtaText:s.jsx(G,{...ma(n)}),onDismiss:()=>{p(),Os.logCloseReferrerRedemptionBanner()},content:j})}function Uc(o,n,u,p){const{currencySymbol:m}=_n(vn(),n.currency),r=p?p.period:os,x=p?p.num_periods:1,t=m.code.defaultMessage?.toString()??bn,a=o.formatNumber(u.value,{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:2});let h;return r===os?h=x===1?s.jsx(G,{id:"referrerRedemptionBannerTitleForSingleMonth",defaultMessage:"Your {discount} credit is ready",values:{discount:a}}):s.jsx(G,{id:"referrerRedemptionBannerTitleForPluralMonths",defaultMessage:"Redeem your {discount} referral reward",values:{discount:a}}):r===Dn&&(h=x===1?s.jsx(G,{id:"referrerRedemptionBannerTitleForSingleYear",defaultMessage:"Redeem your {discount} referral reward",values:{discount:a}}):s.jsx(G,{id:"referrerRedemptionBannerTitleForPluralYears",defaultMessage:"Redeem your {discount} referral reward",values:{discount:a}})),h}function Hc(o,n,u,p){const{currencySymbol:m}=_n(vn(),n.currency),r=p?p.period:os,x=p?p.num_periods:1,t=m.code.defaultMessage?.toString()??bn,a=o.formatNumber(u.value,{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:2});let h;return r===os?h=x===1?s.jsx(G,{id:"referrerRedemptionBannerContentForSingleMonth",defaultMessage:"Your referral link was used â€” claim your free month of Plus."}):s.jsx(G,{id:"referrerRedemptionBannerContentForPluralMonths",defaultMessage:"Your referral link earned you {discount} off {num_months} months of Plus.",values:{discount:a,num_months:x}}):r===Dn&&(h=x===1?s.jsx(G,{id:"referrerRedemptionBannerContentForSingleYear",defaultMessage:"Your referral link earned you {discount} off a year of Plus.",values:{discount:a}}):s.jsx(G,{id:"referrerRedemptionBannerContentForPluralYears",defaultMessage:"Your referral link earned you {discount} off {num_years} years of Plus.",values:{discount:a,num_years:x}})),h}const Ic=Ks(()=>Ys(()=>import("./b76ojp4c0euhv280.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(o=>o.JawboneNotificationsBanner)),Lc=c.memo(function({className:n}){const{store:u}=H(),p=u.useIsHeaderContentAreaPopulated(),r=u.useContentAreaId(be.HeaderTop)===i.AgentModeAnnouncementBanner?"z-0":cl.PromptTextareaHeader;return s.jsx("div",{className:$s(n??"absolute start-0 end-0 bottom-full",r),children:s.jsx(ul,{shouldRender:p,contentArea:be.Header,children:s.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[s.jsx(Nc,{}),s.jsx(Oc,{})]})})})});function Nc(){const{store:o}=H(),n=o.useSharedProps(h=>h?.clientThreadId),u=o.useContentAreaId(be.HeaderTop),p=dl(),m=as(n,h=>h?.modelId),r=ml.useStore(),x=pa(),t=Js(Qs);let a;switch(u){case i.ProjectConversationTaskNoFileAccess:a=s.jsx(qc,{});break;case i.AdvancedVoiceOnMobileAnnouncement:a=s.jsx(wl,{clientThreadId:n});break;case i.S09KM1:a=null;break;case i.BannerSignup:a=s.jsx(Wc,{});break;case i.BannerTermsDisclaimer:a=s.jsx(Vc,{});break;case i.NewUserBannerTermsDisclaimer:a=s.jsx(Kc,{});break;case i.PromptTextareaAction:a=s.jsx(Yc,{});break;case i.BannersRateLimit:a=s.jsx($c,{});break;case i.BannersBeaconUI:a=s.jsx(Jc,{});break;case i.BannerSidekickAnnouncement:a=s.jsx(kl,{});break;case i.SearchBrowserExtensionAnnouncement:a=s.jsx(Tl,{});break;case i.MoonshineAnnouncement:a=s.jsx(Ml,{});break;case i.SearchBrowserExtensionReactiveAnnouncement:a=s.jsx(Pl,{});break;case i.BannerMemoryAlmostFull:a=s.jsx(mn,{memoryAlmostFullVariant:!0});break;case i.BannerMemoryFull:a=s.jsx(mn,{});break;case i.Box:a=s.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",s.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",s.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case i.JawboneAnnouncement:p?a=s.jsx(Ic,{}):a=null;break;case i.JawboneMaxActiveAnnouncement:p?a=s.jsx(Cl,{}):a=null;break;case i.PromoRedemptionAnnouncement:a=s.jsx(kc,{});break;case i.OperatorAnnouncement:a=s.jsx(xl,{});break;case i.BannerPlusUpsell:a=s.jsx(yl,{});break;case i.ReferrerRedemptionAvailableAnnouncement:a=s.jsx(Fc,{});break;case i.RefereeRedemptionAvailableAnnouncement:a=s.jsx(bl,{});break;case i.ReferralProgramUpsellAnnouncement:a=s.jsx(Al,{});break;case i.TatertotIntakeFormAnnouncement:a=!1;break;case i.StudentsUpsellAnnouncement:a=s.jsx(Sl,{});break;case i.ModelDeprecationBanner:a=hl(m);break;case i.TeamsContextualAnswersUpsell:a=s.jsx(fl,{});break;case i.KanziConfig:a=!1;break;case i.AgentModeAnnouncementBanner:a=x&&!t&&s.jsx(gl,{});break;case i.LanguageUpsellBanner:a=s.jsx(pl,{onDismissSideEffect:()=>{Z.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),r.closeBanner()},onPrimaryCtaClickSideEffect:()=>{Z.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),r.closeBanner()}});break;default:a=null;break}return a}function Oc(){const{store:o}=H(),n=o.useContentAreaId(be.HeaderBottom);let u;switch(n){case Bn.DallePromptControls:u=s.jsx(Gc,{});break;default:u=null;break}return u}const zc=Ks(()=>Ys(()=>import("./elsxlexcf8f2vdmq.js"),__vite__mapDeps([7,1,3,4,2,5])).then(o=>o.default));function Gc(){const{store:o}=H(),n=o.useSharedProps(u=>u?.composerController);return n?s.jsx(zc,{composerController:n}):null}function Wc(){const{store:o}=H(),n=o.useSharedProps(m=>m?.clientThreadId),u=ga(),p=jl();return n?u?s.jsx(Dl,{threadId:n,showSignUp:p}):s.jsx(Fl,{threadId:n,showLogin:p}):null}function qc(){return c.useEffect(()=>()=>{Fs.getItem(Us.TasksHasSeenProjectDisclaimerBanner)||Fs.setItem(Us.TasksHasSeenProjectDisclaimerBanner,!0)},[]),s.jsx(Rn,{icon:s.jsx(fa,{}),title:s.jsx(G,{id:"ibX3g7",defaultMessage:"Tasks canâ€™t access project files"}),content:s.jsx(G,{id:"fm94Tm",defaultMessage:"Thereâ€™s a task in this conversation â€” just FYI, it wonâ€™t be able to access project files."}),onDismiss:()=>{Fs.setItem(Us.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Vc(){const{store:o}=H(),n=o.useSharedProps(u=>u?.clientThreadId);return n?s.jsx(El,{threadId:n}):null}function Kc(){const{store:o}=H(),n=o.useSharedProps(u=>u?.clientThreadId);return n?s.jsx(Bl,{threadId:n}):null}function Yc(){const{store:o}=H(),n=o.useSharedProps();return n?s.jsx(vl,{...n}):null}function $c(){const{store:o}=H(),n=o.useSharedProps(p=>p?.clientThreadId),u=o.useSharedProps(p=>p?.composerController);return!n||!u?null:s.jsx(_l,{clientThreadId:n,composerController:u})}function Jc(){const{store:o}=H(),n=o.useSharedProps(m=>m?.openFileDialog),u=o.useSharedProps(m=>m?.clientThreadId),p=o.useSharedProps(m=>m?.composerController);return!u||!p||!n?null:s.jsx(Rl,{clientThreadId:u,openFileDialog:n})}const Qc=5,Xc=c.memo(function(n){return Zc(n),eu(n),Ul({clientThreadId:n.clientThreadId,composerController:n.composerController,openFileDialog:n.openFileDialog}),su(),null});function Zc(o){const{store:n}=H(),u=n.useSetSharedProps();Ws(()=>{u(o)},[o,u])}function eu(o){const{clientThreadId:n,canContinue:u}=o,{store:p}=H(),m=He(),r=c.useRef({top:p.useContentAreaApi(be.HeaderTop),bottom:p.useContentAreaApi(be.HeaderBottom)}).current,x=Hl(n),{shouldShowBannerSignup:t,shouldShowBannerTermsDisclaimer:a}=tu(n),{isOpen:h}=Il(),P=Ll(n),D=Nl(n),j=Ol(o);zl(o);const Y=Gl(),ye=Wl(o),{shouldShowMemoryFull:le,shouldShowMemoryAlmostFull:xe}=ql(n),ie=Vl(o),$=Kl(n),Ce=Yl(n),f=wc(),{eligible:k}=Ue($l),q=Jl(),se=Ql(),d=Xl(),I=Zl(),ce=ei(n),Pe=si(n),rs=ti(),ls=ni(n),B=as(n,ue=>ue?.modelId),R=yn(n),ae=xn(),V=En(),{eligible:is}=Ue(qs.hasSeenAgentModeAnnouncementBanner),Ie=is&&V&&ae!==Vs;Ws(()=>{a?r.top.set(i.BannerTermsDisclaimer):h?r.top.set(i.NewUserBannerTermsDisclaimer):B&&R?.kind===ns.GizmoInteraction&&R.gizmo&&ha(B,R.gizmo)?r.top.set(i.ProjectConversationTaskNoFileAccess):ie.eligible?r.top.set(i.AdvancedVoiceOnMobileAnnouncement):P?r.top.set(i.BannersRateLimit):D?r.top.set(i.BannersBeaconUI):rs?r.top.set(i.BannerPlusUpsell):$?r.top.set(i.JawboneAnnouncement):Ce?r.top.set(i.JawboneMaxActiveAnnouncement):j.eligible?r.top.set(i.BannerSidekickAnnouncement):Y?r.top.set(i.MoonshineAnnouncement):ye?r.top.set(i.SearchBrowserExtensionReactiveAnnouncement):f?r.top.set(i.PromoRedemptionAnnouncement):k?r.top.set(i.OperatorAnnouncement):d?r.top.set(i.ReferralProgramUpsellAnnouncement):u?r.top.set(i.PromptTextareaAction):t?r.top.set(i.BannerSignup):xe&&Cn(m,"1206459705").get("upsell_variant","control")!=="control"?r.top.set(i.BannerMemoryAlmostFull):le?r.top.set(i.BannerMemoryFull):q?r.top.set(i.ReferrerRedemptionAvailableAnnouncement):se?r.top.set(i.RefereeRedemptionAvailableAnnouncement):I?r.top.set(i.StudentsUpsellAnnouncement):ce?r.top.set(i.ModelDeprecationBanner):Pe?r.top.set(i.TeamsContextualAnswersUpsell):ls?r.top.set(i.LanguageUpsellBanner):Ie?r.top.set(i.AgentModeAnnouncementBanner):r.top.set(null)},[r,ae,u,a,h,t,P,j,le,ie,Ie]),Ws(()=>{x&&r.bottom.set(Bn.DallePromptControls)},[r,x])}function su(){const{store:o}=H();c.useEffect(()=>()=>{o.reset()},[o])}function tu(o){const n=He(),{isUnauthenticated:u}=Pn(),p=Fe(n,"3637408529",{disableExposureLog:!0}),r=Fe(n,"3637408529").get("no_auth_banner_signup_rate_limit",Qc),x=p.get("should_show_no_auth_signup_banner",!0),t=oi(j=>j.bannerDisclaimerClientThreadId),a=ai(),h={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[P,D]=as(o,j=>[ee.getConversationTurns(j).filter(Y=>Y.role===Mn.User).length,nu(ee.getCurrentNode(j)?.message)]);return o&&(h.shouldShowBannerTermsDisclaimer=D&&u&&P===1&&!a&&(t==null||t===o),h.shouldShowBannerSignup=x&&D&&u&&P>0&&P%r===0),h}function nu(o){return o?.author.role===Mn.Assistant&&Sa(o)}function ou({modelSupportedImageMimeTypes:o}){const n=Js(Qs),u=Tn(),p=kn(),m=Xs();return n?s.jsx(oe.Item,{icon:ri,onClick:async()=>{const r=await _c();if(r)try{const x=atob(r.base64image),t=x.length,a=new Uint8Array(t);for(let P=0;P<t;P++)a[P]=x.charCodeAt(P);const h=new File([a],r.filename,{type:r.mimetype});li.uploadFile(u,h,o,m,p,void 0,void 0,De.Multimodal)}catch{}},children:s.jsx(G,{id:"HiFPUD",defaultMessage:"Attach screenshot"})},"attach_screenshot"):null}function au({clientThreadId:o,modelSupportedImageMimeTypes:n,openFileDialog:u,historyDisabled:p,isDisabled:m,highlightTooltip:r,disabledReason:x,currentModelName:t,isLoadingConnectors:a,connectorConfig:h,onSelectConnector:P,onConnectorOauthRedirect:D,showLabel:j,showUpsell:Y,hideBorder:ye,isSmall:le,showMenuForNoAuth:xe,visualTreatment:ie}){const $=Aa(),{gdriveStatus:Ce,o365Status:f}=ba(),{isUnauthenticated:k}=Pn(),q=p?"text-white":r?"text-brand-blue-800":"",se=!Y&&(Ce!=="false"||f!=="false"||$),d=k?jn:ii,I=s.jsx(d,{"aria-label":"",className:$s("icon",q)}),ce=n.length>0,Pe=se?s.jsx(ui,{clientThreadId:o,icon:I,showLabel:k&&j,modelSupportedImageMimeTypes:n,isLoadingConnectors:a,connectorConfig:h,onSelectConnector:P,onConnectorOauthRedirect:D,openFileDialog:u,isDisabled:m,highlightTooltip:r,disabledReason:x,currentModelName:t}):s.jsx(Bc,{isSmall:le,hideBorder:ye,clientThreadId:o,openFileDialog:u,showLabel:j,showUpsell:Y,icon:I,isDisabled:m,highlightTooltip:r,disabledReason:x,currentModelName:t,visualTreatment:ie,showMenuForNoAuth:xe,modelSupportsImages:ce});return s.jsx(ci,{showBackground:r,className:"bg-brand-blue-800/20",children:Pe})}const ru=Ks(()=>Ys(()=>import("./gokl7f5tko3axdgv.js"),__vite__mapDeps([8,1,3,4,2,5,9])).then(o=>o.GithubOnboardingModal)),lu=()=>null,iu=3e3,cu="manage-prompts";function Pu({onCreateNewCompletion:o,onContinueGenerating:n,account:u,currentModelId:p,currentModelConfig:m,disableDraftPersistence:r=!1,areModelsLoading:x,clientThreadId:t,isNewThread:a,isCompletionInProgress:h,disabled:P=!1,disabledReason:D,canPause:j=!1,canContinue:Y=!1,isInteractableSharedThread:ye,headerClassName:le,hideHeader:xe,onlyAllowImageUploads:ie,layoutMode:$,modelsData:Ce}){"use forget";pn.markStart("PromptTextarea"),pn.markRendered("PromptTextarea");const f=He(),[k,q]=ol(),se=al(),d=ya();di(d),mi();const I=xa(),ce=u?.isTeam(),Pe=u?.isEnterprisey(),rs=u?.isBusiness(),ls=u?.isEdu(),B=wn(f),R=Xs(),ae=kn(),V=Tn(),is=pi.useStore(),Ie=!!(ce||Pe||rs||ls),[ue,Fn,Un,Hn,In,Ln,Nn]=as(t,e=>[ee.getCurrentLeafId(e),ee.getRequestId(e),ee.findNode(e,l=>!!l.message.metadata?.b1de6e2_s),ee.getIsNewConversation(e),ee.lastUserMessage(e)?.metadata?.system_hints?.includes(A.Agent),!!e?.interruptionInProgress&&!!ee.getCurrentNode(e)?.message.metadata?.n7jupd_message,e?.startedWithMcp]),{gizmoEditorData:cs,mode:Zs,getGizmoId:us}=Ca(),et=Pa(),Le=Ma(),On=gi(),J=Ta(t),Ne=!!ka(),zn=fi.useIsEnabled(t),Oe=!!wa(),S=xn(),_=Ra(),Gn=En(),Wn=Ue(qs.hasSeenAgentModeAnnouncementBanner),te=!_a()&&va(f).getLayer("3081064739").get("composer-plus-menu",!1),st=Ba.useState(({locked:e})=>e),qn=Ea(),tt=ja(),{connectionInstanceData:ds,isLoading:Vn}=Da({skip:!qn}),{selectedSources:nt,selectedMCPSources:ze,addSource:ms}=hi(t);c.useEffect(()=>{const e=k.get("add_source");e&&S&&(ms(e),k.delete("add_source"),q(k))},[S,ms,k,q]);const{eligible:ot,isLoading:at}=Ue(qs.hasSeenTatertotNux);c.useEffect(()=>{S===A.Tatertot&&ne(f,"1586944302")&&ot&&!at&&Xt(f,Si)},[S,ot,at,f]);const rt=Ai(f);Fa({skip:!rt,productSku:Zt.PROMPT_TEXT_AREA});const{platformConnectors:ps}=Ua(rt&&(ze?.size??0)>0,Zt.PROMPT_TEXT_AREA),{allAutoConnectors:Kn}=Ha({getDisabledAutoConnectors:!1});Ia({platformConnectors:ps,enabled:Kn.length>0&&Ie});const lt=c.useMemo(()=>Array.from(ze??[]).map(e=>ps.get(e)).filter(e=>e!==void 0),[ps,ze]),gs=c.useRef(0),Ge=c.useRef(!1);let C=yn(t),We=C&&"gizmo"in C?C.gizmo:void 0;const Yn=La(),de=We?.gizmo.id??Yn,it=Na(de),$n=bi(),ct=yi(t),[L,qe]=c.useState(null);L!==null&&(C={gizmo:L,gizmo_id:L.gizmo.id,kind:ns.GizmoInteraction},We=L);const me=en(m,C,S),Me=Oa(),Jn=Me!=null,ut=za(f).flags,Ve=ut?.includes(Ga.NoAuthEnableFileUploads),{systemHints:fs}=Wa(),Qn=!ne(f,"3084799213"),dt=Hn||(In??!1)||Qn,mt=!st&&(C==null||C?.kind===ns.PrimaryAssistant||C?.kind===ns.GizmoInteraction&&it),w=c.useMemo(()=>mt?fs?.filter(e=>xi({systemHint:e,modelConfig:m,conversationMode:C,isTemporaryChat:Le}))?.filter(e=>e.systemHint!==A.Agent?!0:dt):[],[mt,fs,m,C,Le,dt]),Te=w==null||w.length>0,F=c.useMemo(()=>(S&&w?.find(e=>e.systemHint===S))??null,[w,S]),hs=c.useCallback(e=>{Hs()&&e?.preventDefault(),_(null,{analyticsMetadata:{clientThreadId:t}})},[_,t]),pt=qa(),ke=Va(Ce)?.id??null,pe=c.useCallback((e,l)=>{Z.logEventWithStatsig("Model Switcher Model Changed","chatgpt_model_switcher_model_changed",{from:p,to:e}),Ka(e),pt({modelId:e,location:l})},[p,pt]),gt=c.useCallback(e=>{Hs()&&e?.preventDefault(),pe(ke??"","remove non-default model")},[pe,ke]),Ss=Ci(p,F?.systemHint??null),Xn=!P&&(me!==De.None||x)&&(B||Ve),N=Ya(m,C),As=$a(m,C);let W=sn(e=>e.files);const[bs]=c.useState(()=>Pi());Zs==="magic"?W=W.filter(e=>e.gizmoId!=null):W=W.filter(e=>e.gizmoId==null);const Zn=Mi(),we=W.length>0||Zn,ft=sn(Ja.hasUploadInProgress),eo=Ti(e=>e.selectedApps),so=Pc(),to=ki(t),no=Qa(d),ys=X(()=>Xr(m,no())),xs=Xa(d),Cs=X(xs),ht=!Cs,Ke=!ys&&!ft&&(ht||we),St=(me===De.Multimodal?Za:er)-W.length,At=St<=0,oo=F?.systemHint===A.Research,ao=ne(f,"3544641259"),{selectedRepos:Ps}=wi(t),bt=(oo||Ss)&&ao&&nt?.size===0&&ze?.size===0,yt=Un?.message.metadata?.async_task_id,Ms=Ri(e=>yt?e.tasks[yt]:null),Ts=Ms?.status===_i.RUNNING,xt=sr(ss(t)||t)?.value,ro=xt===tn.STREAMING,lo=xt===tn.REALTIME,Ye=h&&j||ro||lo||Ts,ge=Ke&&!P&&!Oe&&(!Ye||ct)&&!bt,[Ct,io]=c.useState(!1),{targetedContent:Pt,setTargetedContent:$e}=vi(),O=Pt?.isFocusedViewContent&&!On?void 0:Pt;c.useEffect(()=>{!O||vs.composer.autofocusDisabled$()||requestAnimationFrame(()=>requestAnimationFrame(()=>{Se(z(d))}))},[O]);const{getUpsellLabelType:co,getUpsellShowsAttach:uo}=Bi(),{isSingleLine:Q,fullyCollapsedToolMenu:mo,showSlashHint:po,showSelectedModelInComposer:go,showModelsInPlusMenu:fo,showModelSlashCommands:Mt}=nr(),ho=mo&&!te,So=fo&&!te,Ao=Te&&B&&(!ce||!Vn)&&!nn(S)&&!Q,Je=X(Ei(d).isWhisperActive$),bo=!1;c.useEffect(()=>{if(!I?.id)return;const e=on.getAndReset(I.id,J);e&&Is(z(d),e.inputText)},[I?.id,J,d]),c.useEffect(()=>{const e=k.get("prompt")??"";xs()&&e.length>0&&Is(z(d),e)},[xs,d,k]);const ks=c.useCallback(()=>{S!==A.Slurm&&S!=null&&!w?.some(e=>e.systemHint===A.Slurm)||(F==null&&_(A.Slurm),Ae(t,e=>{const l=e.selectedSources?.get(A.Slurm)??new Set;e.selectedSources??=new Map,e.selectedSources.set(A.Slurm,new Set([...l,or.GITHUB_CONNECTOR]))}))},[S,F,t,_,w]);c.useEffect(()=>{if(k.has("github_onboarding")){const e=k.get("github_onboarding");let l=je.ConfigureRepos;e&&[je.ConfigureRepos,je.SyncRepos,je.IndexRepos].includes(e)&&(l=e),tt&&l!==je.ConfigureRepos?ks():Xt(f,ru,{initialState:l,onFinishFlow:ks}),q(g=>(g.delete("github_onboarding"),g))}},[k,q,f,S,F,t,_,w,ks,tt]),c.useEffect(()=>{const e=ar(k),l=S??e[0],g=l===A.Slurm,b=l===A.Research;if(!g&&!b)return;const M=k.getAll("sources");if(!M.length)return;const T=k.get("redirect_source"),y=M.map(K=>K.trim()).filter(an),Ds=new Set(y.filter(K=>!ts(K))),E=new Set(y.filter(ts));Ae(t,K=>{K.selectedSources=new Map([[l,Ds]]),K.selectedMCPSources=new Map([[l,E]]),K.hasModifiedSources=!0}),q(K=>(K.delete("sources"),K)),T==="suggested_ca_prompts"&&Z.logEventWithStatsig("chatgpt_contextual_answers_connector_activated","chatgpt_contextual_answers_connector_activated",{source:"suggested_ca_prompts"})},[t,ms,k,_,q,S]),c.useEffect(()=>{Ct!==ge&&(io(ge),ge&&rr(!0).then(e=>{lr.startEnforcement(e),ir.startEnforcement(e)}))},[ge,Ct,C?.kind,et]);const Qe=cr(m,C),{handleFileAccepted:Tt}=Ec(R,en(m,C,S),N,"mouse",us,Qe?.attachments),yo=c.useCallback((e,l)=>(requestAnimationFrame(()=>{requestAnimationFrame(()=>{Se(z(d))})}),Tt(e,l)),[d,Tt]),U=!P&&!At&&Xn&&Me==null,kt=fs?.some(e=>e.systemHint===A.Slurm),{getInputProps:xo,open:wt}=vc({disabled:!U,noClick:!0,onDropAccepted:yo,onDropRejected:e=>jc(e,R,ae,me),multiple:!0,maxSize:dr,maxFiles:St,...ur(!B||ie?N:As)}),fe=c.useCallback(()=>{U&&(Z.logEventWithStatsig("Open File Viewer","chatgpt_web_file_viewer_opened",{intent:me.toString()}),wt())},[U,wt,me]),Rt=mr(bs),_t=c.useCallback(()=>{pr(z(d)),Rt.clearMessages(),gn(d).resetData();for(const l of W)Ls.remove(V,l.tempId,"none");if(ji.markAllAsSent(),gr(f)){const l=Cn(f,"269676899"),g=l.get("skip_search",!1);if(l.get("clear_all",!1)){const M=[A.Slurm,A.Tatertot,A.Think];g&&M.push(A.Search),M.push(Vs),S&&!M.includes(S)&&_(null)}}},[d,Rt,f,W,V,S,_]),[vt,ws]=Js(e=>[fr(e),Qs(e)]),Co=c.useMemo(()=>{if(ws)return hr;if(vt)return Sr;if(Ar())return br},[ws,vt]),Po=X(Ns.sidebarUrlTrayOpen$),Mo=X(Ns.sidebarUrlTrayForcedOpen$),Bt=X(Ns.context$),To=Bt?.blocked===!0,Et=ws&&Po&&(!To||Mo);Di();const ko=yr(),jt=(e,l)=>{if(e.preventDefault(),P||!Ke&&!l||!C||Ln)return;const g=un(z(d).state.doc),b=g.content,{content:M,attachments:T}=Cc(V,b,m,C,S);Ae(t,y=>{y.hasModifiedSources=!1,y.hasModifiedGithubRepos=!1,y.startedWithMcp===void 0&&(y.startedWithMcp=lt.length>0)}),$n(),o({sourceEvent:e,attachments:T,content:M,contentToSend:g,clientThreadId:t,conversationMode:C,hasSelectedApps:so,isMessageFollowupsEnabled:zn,selectedApps:eo,desktopOrigin:Co,shouldCollectSidebarContext:Et,desktopSidebarContext:Bt,selectedGizmoTag:L,selectedRepos:{selectedAllRepos:Ps.selectedAllRepos,selectedRepos:Ps.selectedRepos?[...Ps.selectedRepos]:null},selectedSources:nt,selectedMCPConnectors:lt,startedWithMcp:Nn===!0,systemHints:S?[S]:[],isN7jupdActive:Ss,isForceAllowCustomMcpModeEnabled:ko,...gn(d).getData(g.content)}),O?.onCreateCompletion?.({serverThreadId:J,currentLeafId:ue}),O?.shouldPersistAcrossMessages!==!0&&$e(void 0),ln.hideThreadHeader();for(const y of W)y.status===Qr.Ready&&is.addFile(y);_t(),Gn&&S===Vs&&Wn.markAsViewed()},wo=e=>{$e(e.targetedReply),e.targetedReply&&Z.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:J,sourceMessageId:e.messageId})},{maybeSetWaitingForRealtimeOnAbort:Dt,isWatingForRealtimeStatusChange:Ro}=Fi(t),Rs=c.useCallback(e=>{Dt(),xr(e,void 0,!0)},[Dt]),Ft=c.useCallback(()=>{O?.onCleared?.({serverThreadId:J,currentLeafId:ue}),$e(void 0),Se(z(d))},[ue,J,O,$e,d]),Re=Cr(m?.tags,C?.kind),{autocompletions$:Ut,shouldShowAutocomplete$:_o}=Ui(d),_e=X(_o);c.useEffect(()=>d.subscribe("input",()=>{Hi(t)&&Ii(t)}),[d,t]);const Ht={Enter:Ni({toaster:ae,isAutocompletionActive:()=>_e&&Ge.current,canSubmit:ge,isTextContentTooLong:ys,requestCompletion:jt}),Escape:Li({canAbortCompletion:j&&h,clientThreadId:t,isAutocompletionActive:()=>_e&&Ge.current,clearAutocompletions:()=>Ut.set([]),abortCompletion:()=>Rs(t),isEmpty:Cs,hasTargetedContent:O!=null,clearTargetedContent:Ft,hasSystemHint:F!=null,removeSystemHint:hs,hasSelectedTarget:L!=null,removeSelectedTarget:()=>qe(null),hasNonDefaultModel:go&&p!==ke,removeNonDefaultModel:gt})},_s=c.useRef(Ht);_s.current=Ht,c.useEffect(()=>{const e=Object.fromEntries(Object.keys(_s.current).map(l=>[l,b=>{const M=_s.current[l];return M?M(b):!1}]));d.registerKeyHandlers(e)},[d]),c.useEffect(()=>d.subscribe("paste",e=>{Oi({filePickerStore:V,event:e,intl:R,toaster:ae,clientThreadId:t,conversationMode:C,currentModelConfig:m,getEditorGizmoId:us,modelSupportedImageMimeTypes:N,activeSystemHintType:S,setActiveSystemHintType:_,ctx:f})}),[R,t,C,m,us,N,d,ae,V,S,_,f]);const It=c.useCallback(e=>{const l=z(d);if(Pr(l,"@"),e===cu){se("/library?tab=prompts");return}if(Ae(t,g=>{g.isUsingPromptTemplate=!0}),Z.logEventWithStatsig("chatgpt_web_prompt_used","chatgpt_web_prompt_used",{referer:"at_cmd",hint:e.system_hint??"none",sources:(e.sources??[]).join(",")}),Mr(l,e.prompt),e.system_hint&&(_(e.system_hint),e.sources?.length)){const g=e.sources.map(y=>y.trim()).filter(an),b=e.system_hint,M=new Set(g.filter(y=>!ts(y))),T=new Set(g.filter(ts));Ae(t,y=>{y.selectedSources=new Map([[b,M]]),y.selectedMCPSources=new Map([[b,T]]),y.hasModifiedSources=!0})}},[d,se,_,t]),vo=Tr(t,bs,N,Qe?.attachments),Bo=c.useCallback(e=>{e.preventDefault(),Rs(t),Z.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:ss(t),currentLeafId:ee.getCurrentNode(rn(t)).message.id,eventSource:"mouse"}),kr()},[t,Rs]),Lt=c.useCallback(()=>{on.set(I?.id,J,zi(d))},[J,I?.id,d]),vs=tr(f);c.useEffect(()=>{cs||vs.composer.autofocusDisabled$()||Se(z(d))},[d]),c.useEffect(()=>{if(N.length>0)for(const l of W)wr(l.fileSpec?.mimeType,As)||Ls.remove(V,l.tempId,"none");else Ls.reset(V)},[p,V]),c.useEffect(()=>{(!Re&&L||Ne)&&qe(null)},[Re,L,Ne]);const Eo=Fe(f,"4031588851"),Nt=Fe(f,"3637408529"),jo=Nt.get("is_in_composer_text_exp",!1),Do=Nt.get("composer_text","MESSAGE_CHATGPT"),Fo=Eo.get("composer_text","MESSAGE_CHATGPT"),Uo=jo?Do:Fo,[Xe,Ho]=(()=>{const e=D?Rr(D):void 0;if(e)return[e.placeholder,e.isLastingDisabledStyle];if(ye)return[v.placeholderWithName,!1];if(O?.placeholderTextOverride!=null)return[O.placeholderTextOverride,!1];if(m?.id===_r)return[v.n7jupdSystemHintPlaceholder,!1];if(F){if(nn(F.systemHint))return Ye?[v.n7jupdActivePlaceholder,!1]:[v.n7jupdSystemHintPlaceholder,!1];switch(F.systemHint){case A.Search:return[v.searchPlaceholder,!1];case A.Think:return[v.thinkPlaceholder,!1];case A.Slurm:return[v.connectorPlaceholder,!1];case A.ApiTool:return[v.apiToolPlaceholder,!1];case A.Research:return[v.researchPlaceholder,!1];case A.Canvas:return[v.canvasPlaceholder,!1];case A.Picture:return[v.picturePlaceholder,!1];case A.PictureV2:return[v.pictureV2Placeholder,!1];case A.ContextualAnswers:return[v.contextualAnswersPlaceholder,!1];case A.Tatertot:return[v.tatertotPlaceholder,!1]}}switch(Uo){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[v.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[v.placeholderAskNameAnythingVariant,!1];default:return[v.placeholderWithName,!1]}})(),Io=it?a?R.formatMessage(Gi.newChatInProject,{projectName:We?.gizmo.display.name??"this project"}):Xe?R.formatMessage(Xe,{name:"ChatGPT"}):"â€‹":Xe?R.formatMessage(Xe,{name:cs!=null?Zs==="magic"?vr:cs.name||"GPT":We?.gizmo.display.name??"ChatGPT"}):"â€‹";c.useEffect(()=>d.subscribe("input",()=>{Br.getState().isThreadHeaderVisible&&ln.hideThreadHeader()}),[d]),c.useEffect(()=>d.subscribe("input",()=>{gs.current=performance.now()}),[d]);const Lo=Er(),Bs=X(()=>Lo&&Ut().some(e=>e.requires_file_upload)),{connectorConfig:re,isLoading:No}=jr(),{onSelectConnector:Ze,onConnectorOauthRedirect:Ot}=Wi({connectorConfig:re,modelSupportedImageMimeTypes:N,modelAcceptedMimeTypes:As,attachmentsProductFeature:Qe?.attachments,onOauthRedirect:Lt});qi(re,Ze);let zt=null;const ve=[],Gt=uo(),Oo=B||Gt||Ve,Be=me===De.None&&!x?zs.ModelNotSupported:At?zs.HasReachedMaxFiles:Me!=null?zs.RateLimitReached:void 0,zo=Fe(f,"853191128"),Go=!B&&ne(f,"3259514411")&&zo.get("is_tatertot_enabled",!1),Wt=N.length>0;if(Q){const e=[s.jsxs(oe.Group,{className:"content-sheet:content-sheet-inset-section",children:[s.jsx(Vi,{openFileDialog:fe,modelSupportsImages:Wt,mode:te?"sheet":void 0,showMenuForNoAuth:!1,isDisabled:!U,disabledReason:Be,currentModelName:m?.title,rateLimitInfo:Me}),B&&s.jsxs(s.Fragment,{children:[U&&Wt&&s.jsx(Ki,{modelSupportedImageMimeTypes:N}),!te&&U&&s.jsx(fn,{includeAction:!0,shortName:!0,connectorConfig:re,onConnectorClick:Ze}),s.jsx(Yi,{}),s.jsx(ou,{modelSupportedImageMimeTypes:N})]})]},"add-files")],l=4,g=!te&&Te&&($i(re)||w&&w.length>l+1),b=B&&U&&s.jsxs(oe.Group,{children:[te&&s.jsx(fn,{includeAction:!0,shortName:!0,connectorConfig:re,onConnectorClick:Ze}),s.jsx(gc,{includeSeparator:!1,includeAction:!0,shortName:!0,connectorConfig:re,onConnectorClick:Ot})]},"connect-apps"),M=[];if(ho&&B)(Te||b)&&M.push(s.jsxs(fc,{layoutMode:$,children:[s.jsx(oe.Group,{children:s.jsx(Gs,{systemHints:w,selectedHintType:S,onSelectHintType:T=>{_(T,{analyticsMetadata:{clientThreadId:t}})}})}),b]},"tools-menu"));else{if(Te){const T=w&&(g?w.slice(0,l):w);e.push(s.jsxs(oe.Group,{children:[s.jsx(Gs,{systemHints:T,selectedHintType:S,onSelectHintType:y=>{_(y,{analyticsMetadata:{clientThreadId:t}})}}),g&&s.jsxs(Ji,{layoutMode:$,children:[s.jsx(oe.Group,{children:s.jsx(Gs,{systemHints:w?.slice(l),selectedHintType:S,onSelectHintType:y=>{_(y,{analyticsMetadata:{clientThreadId:t}})}})}),b]})]},"system-hints"))}b&&(!g||!Te||te)&&e.push(b)}So&&M.push(s.jsx(hc,{layoutMode:$,selectedModelId:p??"",onSelectModelId:T=>{pe(T,"plus menu")}},"models-menu")),M.length>0&&e.push(s.jsx(oe.Group,{children:M},"submenus")),B||e.push(s.jsx(Qi,{},"upsell")),po&&e.push(s.jsx(oe.Group,{children:s.jsx("div",{className:"text-token-text-tertiary p-2 text-center text-sm",children:R.formatMessage({id:"composer.plusMenu.typeSlashForQuickAccess",defaultMessage:"Type '/' for quick access"})})},"slash-hint")),zt=s.jsx(Xi,{mode:te?"sheet":"dropdown",onCloseAutoFocus:T=>{vs.composer.autofocusDisabled$()||(T.preventDefault(),Se(z(d)))},items:e,fileUploadRateLimited:Jn,children:s.jsx(Zi,{disabled:P,clientThreadId:t,rateLimitPopup:Q?null:Me,highlightTooltip:Bs&&!we,label:B?R.formatMessage({id:"composer.plusMenu.label",defaultMessage:"Add files and more"}):R.formatMessage({id:"composer.plusMenu.label.loggedOut",defaultMessage:"Add photos and more"}),secondaryLabel:s.jsx("kbd",{className:"bg-token-bg-tertiary -me-1 inline-grid aspect-square w-4 items-center justify-center rounded-sm text-[11px]",children:s.jsx("span",{children:"/"})}),children:s.jsx(ec,{onDoubleClick:U?fe:void 0,onPointerDown:T=>{if(!Hs())return;const y=hn(f);y.isKeyboardOpen()&&(T.preventDefault(),y.closeKeyboard(()=>{sc(f).open$.set(!0)}))},disabled:Je})})})}else if(Oo){const e=s.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:s.jsx(au,{clientThreadId:t,modelSupportedImageMimeTypes:N,openFileDialog:fe,historyDisabled:Le,highlightTooltip:Bs&&!we,isLoadingConnectors:No,connectorConfig:re,onSelectConnector:Ze,onConnectorOauthRedirect:Ot,showLabel:co()==="all",showUpsell:Gt&&!Ve,showMenuForNoAuth:Ve,isDisabled:!U||Je,disabledReason:Be,currentModelName:m?.title??"",visualTreatment:B?"composer-btn":"legacy"})},"file-upload-button");ve.push(e)}!B&&!Q?(ve.push(s.jsx(Sc,{account:u,clientBootstrapFlags:ut,features:et,currentModelConfig:m,isDisabled:Je,clientThreadId:t,composerController:d,gizmoId:de})),Go&&ve.push(s.jsx(Ac,{composerController:d,clientThreadId:t}))):Ao&&ve.push(s.jsx(bc,{activeSystemHintType:S,systemHints:w,composerController:d,clientThreadId:t,disabled:Je}));const[Wo,qt]=c.useState(!1),qo=Ho||Ro?"disabled":"default",Vo=!ge,Ko=Vr({promptDisabledReason:D,hasPendingFiles:ft,hasTextContent:ht,isTextContentTooLong:ys,hasAsyncTaskPending:to,noSourceSelectedDr:!bt,isDeepResearchTaskStreaming:Ts,isThreadHardBlocked:Oe}),es=Ye?"streaming":Vo?"disabled":"idle",Ee=c.useRef(null),he=c.useRef(null),Yo=ne(f,"222560275")||p&&!p.startsWith("o1")&&!p.startsWith("o3");c.useEffect(()=>{const e=()=>{Ee.current!=null&&Kr.addAction("composer_state_disabled",{threadId:ss(t),disabledReason:Ee.current})};if(Ke&&es==="disabled"){let l="unknown";P?l=D??"component_disabled_unknown":h?l="completion_in_progress":Oe&&(l="thread_hard_blocked"),Ee.current!==l&&(he.current&&clearTimeout(he.current),he.current=setTimeout(e,iu)),Ee.current=l}else Ee.current=null;return()=>{he.current&&(clearTimeout(he.current),he.current=null)}},[t,Ke,es,P,D,h,Oe]);const Es=[];if(O?.label&&Es.push({type:O.type,value:O.label,onRemoveRegion:Ft}),L!==null){const e=!!L.gizmo.tags?.includes(cn.FirstParty);Es.push({type:"mention",value:L.gizmo.display.name,icon:s.jsx(Sn,{isFirstParty:e,src:L.gizmo.display.profile_picture_url,className:"icon"}),onRemoveRegion:()=>{qe(null),Se(z(d))}})}c.useEffect(()=>{_e||(Ge.current=!1)},[_e]);const $o=c.useCallback((e,l,g)=>{Ge.current=e>=0,l&&Is(z(d),g?`${g.title}${g.body}`:"")},[d]),Jo=hn(f),Qo=X(Jo.supportsVirtualKeyboardApi),Vt=_e&&F?.systemHint!==A.Research&&F?.systemHint!==A.Slurm&&F?.systemHint!==A.ApiTool&&!Ss,Xo=e=>{if(e.preventDefault(),e.stopPropagation(),gs.current>0){const l=performance.now()-gs.current;Yr.hist($r.DEFAULT,"final_user_input_to_submit_ms",[],l)}es==="streaming"&&(!ct||Cs)?Ts?qt(!0):Bo(e):jt(e)};c.useEffect(()=>{const e=ss(t),l=u?.normalizedAccountUserId;if(!l||r)return;const g=Dr(b=>{if(Fr(b.doc))Ur(e);else{const M=un(b.doc).content;Hr(e,M,l)}},1e3);return Ir(Lr(d),g)},[u,t,d,r,J]);const{connectedTypes:js}=Nr(),Kt=I&&Or(I),{data:Yt}=zr(Gr.DeveloperMode),Zo=c.useMemo(()=>{const e=[];Q&&e.push({command:"upload",aliases:["file","attach","photo"],title:tc(f,R,!U,Be,m?.title),icon:s.jsx(jn,{"aria-label":"",className:"icon"}),onSelect:fe,disabled:!U});const l=ds?.connection_statuses.filter(g=>g.user_connection_details.activation_status==="activated"&&["google_drive_oauth","google_drive_dwd"].includes(g.user_connection_details.knowledge_connector_type)).map(g=>g.user_connection_details.connection_type)??[];return Kt&&(js.size>0||l.length>0)&&kt&&e.push({command:"all-connectors",title:R.formatMessage({id:"6YT2cp",defaultMessage:"Use all connectors"}),icon:s.jsx(nc,{}),onSelect:()=>{_(A.Slurm,{analyticsMetadata:{clientThreadId:t}}),Ae(t,g=>{const b=g.selectedSources?.get(A.Slurm)??new Set;g.selectedSources??=new Map,g.selectedSources.set(A.Slurm,new Set([...b,...js,...l]))})}}),Yt&&e.push({command:"add-mcp",aliases:["mcp"],title:"Add MCP",icon:s.jsx(oc,{}),onSelect:()=>{se(Wr(qr.Connectors))}}),e},[f,Q,m,U,Be,kt,Yt,ds?.connection_statuses,Kt,js,R,fe,_,t,se]),$t=ne(f,"773249106"),{data:Jt,isLoading:Qt}={data:null,isLoading:!1},ea=c.useMemo(()=>[],[Qt,bo,Jt?.prompts,It]),sa=c.useMemo(()=>dn(()=>{if(!Re)return[];const e=Zr(f),l=el(f),g=Mc(f),{data:b}=e(),{data:M}=l(),{data:T}=g(),y=Tc([...b?.items??[],...M?.list.items?.map(E=>E.resource)??[],...$t?T?.items?.map(E=>E.gizmo)??[]:[]],E=>E.gizmo.id);return(de?y.filter(E=>E.gizmo.id!==de):y).map(E=>({command:E.gizmo.display.name,title:E.gizmo.display.name,disabled:Ne,icon:s.jsx(Sn,{simple:!0,isFirstParty:E.gizmo.tags?.includes(cn.FirstParty)===!0,src:E.gizmo.display.profile_picture_url,className:"icon",alt:""}),onSelect:()=>{Z.logEventWithStatsig("Composer GPT Selected","chatgpt_web_composer_gpt_selected",{gizmo:E.gizmo.id}),qe(E)}}))}),[f,Ne,Re,$t,de]),ta=c.useMemo(()=>dn(()=>{if(!Mt)return[];const e=sl(f),{data:l}=e();if(!l)return[];const g=[];for(const b of l.categories)b.defaultModel!==ke&&g.push({command:b.defaultModel,title:b.label,disabled:!1,icon:s.jsx(An,{className:"icon"}),onSelect:()=>{pe(b.defaultModel,"slash menu")}});for(const b of l.groups)for(const M of b.modelIds){const T=l.models.get(M);if(T&&!T.tags.includes(tl.HIDDEN)){let y=T.title;g.push({command:T.id,title:y,secondary:void 0,trailing:s.jsx(nl,{children:b.label}),noMatchEmpty:!0,matchWeight:.1,disabled:!1,icon:s.jsx(An,{className:"icon"}),onSelect:()=>{pe(T.id,"slash menu")}})}}return g}),[f,ke,pe,Mt]),na=s.jsx(Xc,{canUseInlineTagging:Re,isDisabled:P,clientThreadId:t,currentLeafId:ue,currentRequestId:Fn,canContinue:Y,composerController:d,isNewThread:a,onContinueGenerating:e=>n({event:e,conversationMode:rn(t)?.mode,systemHints:S?[S]:[]}),onResetState:_t,openFileDialog:fe,conversationMode:C,isShowingAutocomplete:Vt}),oa=!Ye&&C!=null&&Yo&&ac.includes(C.kind)&&s.jsx(rc,{clientThreadId:t,onTargetedReply:wo}),aa=Vt&&s.jsx("div",{className:$s("absolute start-0 z-[-1] box-border w-full ps-0",$==="center"?"top-full":"bottom-full",Qo&&"keyboard-open:fixed keyboard-open:bottom-[calc(var(--screen-keyboard-height,0px)+var(--composer-height,100px)+12px)] keyboard-open:px-4"),children:s.jsx(Dc,{composerController:d,onChange:$o})}),ra=s.jsx(yc,{composerController:d,parsedDocumentHandler:vo}),la=!xe&&s.jsx(Lc,{className:le}),ia=s.jsx(lc,{modelSupportedImageMimeTypes:N,uploadType:De.Multimodal,attachmentsProductFeature:Qe?.attachments}),ca=ne(f,"3760395675"),ua=ne(f,"3127600850");return s.jsx(ic.Provider,{value:bs,children:s.jsxs(cc,{defaultOpen:ca,children:[s.jsxs("div",{className:"max-xs:[--force-hide-label:none] relative z-1 flex h-full max-w-full flex-1 flex-col",children:[s.jsx(uc,{onOauthRedirect:Lt}),ua&&s.jsx(lu,{}),la,Ms&&Wo&&s.jsx(dc,{taskId:Ms.taskId,clientThreadId:t,onClose:()=>qt(!1)}),s.jsx(mc,{hasFiles:we,pendingFiles:W,isUploadDisabled:!U,clientThreadId:t,highlightUploadTooltip:Bs&&!we,disableReason:Ko,uploadButtonDisabledReason:Be,currentModelConfig:m,conversationMode:C,state:es,inputState:qo,gizmoId:de,includeSidebarContextTray:Et,isTemporaryChat:Le,placeholder:Io,composerController:d,onSubmit:Xo,replyRegions:Es,leadingAction:zt,legacyFooterActions:ve,activeSystemHint:F,hideSystemHint:st||!B&&!Q,onRemoveSystemHint:hs,onRemoveModel:gt,contextualAnswerUserConnectionData:ds,fileInput:s.jsx("input",{...xo()}),expanded:Q?void 0:!0,expandOnMultilineInput:Q}),s.jsx(pc,{gptsSlashCommands:sa,modelSlashCommands:ta,libraryPromptSlashCommands:ea,slashCommands:Zo,systemHints:w??[],composerController:d,clientThreadId:t,layoutMode:$}),!1,aa]}),ra,na,oa,ia,S&&w&&s.jsx(uu,{availableSystemHints:w,systemHintType:S,onRemoveSystemHint:hs})]})})}const uu=({availableSystemHints:o,systemHintType:n,onRemoveSystemHint:u})=>{const p=o!=null&&o.every(h=>h.systemHint!==n),{externalModelsLoading:m,fullModelsLoading:r}=Jr(),{isBlocked:x}=xc(n),t=He(),a=!wn(t);return c.useEffect(()=>{m||r||(p||x)&&!a&&u()},[p,x,a,u,n,m,r]),null};export{Pu as P,Lc as a};
//# sourceMappingURL=elolu96rnfzqcgif.js.map
