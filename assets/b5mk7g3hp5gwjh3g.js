import{e as U,j as e,M as ft,r as o,o as f,m as P,au as Zs,aq as Fs,G as Vs,A as Le,d as ls,l as xt,n as He,u as qs,s as Gs}from"./lu2xqwqmjc95q6j6.js";import{y as q,h as Ye,O as Ks,P as zs,l as Qs,u as Ws,Q as Ys,C as Xs,e as Js,R as $s,T as en,j as Zt,U as tn,V as sn}from"./iv9cwo4pw9mxn1rf.js";import{e9 as nn,s0 as Je,mU as F,mV as Y,lN as Xe,s1 as ds,s2 as on,ha as an,s3 as rn,s4 as cn,dT as ln,s5 as dn,s6 as un,s7 as mn,qs as $e,aK as fn,ot as hn,s8 as ht,aZ as gn,s9 as pn,sa as Ft,qS as Cn,cE as xn,sb as vn,sc as yn,gx as wn,om as bn,cf as Sn,cb as Be,at as Vt,ax as qt,gC as En,o2 as Mn,gA as Tn,gB as Ln,sd as We,t as jn,a6 as An,d7 as kn,mZ as In,se as Dn,ea as Rn,cD as Ne,sf as Nn,sg as us,sh as Pn,si as _n,sj as gt,sk as Hn,sl as Bn,nc as Pe,sm as On,sn as Un,iO as Zn,so as Fn,c as Vn,sp as qn,sq as Gn,sr as Kn,ss as zn,st as Qn,su as Wn,cz as Yn,cA as Xn,cB as Jn,ox as Gt,cC as Kt,sv as $n,sw as eo,b as to,sx as so,sy as no,sz as oo,sA as zt,mY as Qt,sB as Wt,sC as Ke,sD as ze,sE as Yt}from"./rseqzngxzbdt1oxg.js";import{ah as ao,on as ms,C as io,b as ro,bz as Xt,aP as co,B as Jt,tl as lo,hz as et,d as $,c6 as je,n as uo,e9 as pt,lh as mo,mQ as fo,ao as ho,aN as Ct,T as fs,a$ as $t,V as hs,R as ue,ce as gs,sx as ps,aB as O,kG as es,b5 as go,j as po,ea as Co,b$ as xo,gg as vo,os as yo,ef as wo,gj as bo,a as So,gs as Eo,q7 as Mo,c as To,dc as Lo,df as jo,lp as Ao,P as ko}from"./hml6mmd5fyx85si7.js";import{O as Cs,b as ve,u as Io,c as Do,g as Ro,A as No,a as Po,f as ts,C as Me,D as _o}from"./glo5fx5nh6p199c2.js";import{S as Ho}from"./n7si32a8uoeznh1u.js";import{i as Bo,d as Oo,e as Uo,a as Zo,b as Fo,g as Vo}from"./nv7zjskuxqbd0a8k.js";import{S as qo}from"./clcq5kxjm77x0raa.js";import{Z as Go,N as Ko}from"./jy1u8exw8iz2slve.js";import{E as zo}from"./ndox4jgq2pedhhgi.js";import{i as Qo}from"./d0g29t0qm74gluj7.js";import{a as Wo,g as Yo}from"./cdnu0xlioh6eeshn.js";import{g as ut,S as Xo}from"./bk8slwxjkdlmxjxm.js";import{s as mt,B as Jo}from"./fc2c76vpc3m2kj8q.js";import{S as $o}from"./ipg3e8rb8w1bw4eb.js";import{L as ea}from"./gnhjnh2n0u3gy6qx.js";import{u as ss}from"./nsxv1nyryaz0gxvd.js";import{i as ns}from"./edbh3e4r4nwc2qmv.js";var xs=(t=>(t.Close="close",t.Loaded="loaded",t.Streaming="streaming",t.Download="download",t))(xs||{});const ta=({isOpen:t,dismissModal:n,closeTextdocEditor:s,textdocVersion:a,clientThreadId:l})=>{const r=U(),i=ao(l),d=nn(l),c=ms(),u=Je(a?.textdocId),h=async x=>{F.logButtonClick(Y.SAVE_TO_CHAT_ON_EDITOR_CLOSE),!(a?.versionInt==null||c)&&(d({sourceEvent:x,promptMessage:co("",{canvas:{user_created_textdocs:a!=null&&a.status===ds.ATTACHED_PENDING&&u!=null?[{user_created_temp_textdoc_id:a.textdocId,type:a.type,title:a.title,content:a.content,create_source:u.create_source}]:void 0},open_in_canvas_view:{type:"canvas_textdoc",id:a.textdocId}}),completionMetadata:i?{conversationMode:i}:void 0}),u&&Xe.markAsSent(u.tempTextdocId),n(),s())};return e.jsx(io,{testId:"modal-confirm-close-editor",isOpen:t,size:"custom",className:"max-w-xl",onClose:n,type:"warning",hideSeparator:!0,title:e.jsx("span",{className:"text-xl",children:e.jsx(ft,{id:"jgd5rD",defaultMessage:"Are you sure you want to close?"})}),primaryButton:e.jsx(Xt.Button,{title:r.formatMessage({id:"XE+GiU",defaultMessage:"Save to chat"}),color:"primary",onClick:h}),secondaryButton:e.jsx(Xt.Button,{title:r.formatMessage({id:"MbWco5",defaultMessage:"Don’t save and close"}),color:"secondary",onClick:()=>{F.logButtonClick(Y.CLOSE_WITHOUT_SAVING),u&&Xe.removeTempTextdoc(u.tempTextdocId),n(),s()}}),showCloseButton:!0,closeButton:e.jsx(ro,{onClick:n}),children:e.jsx("div",{className:"text-md text-token-text-secondary -mt-6 pb-2",children:e.jsx(ft,{id:"q9rJ+Y",defaultMessage:"Changes will not be saved unless you save this canvas to your chat."})})})},sa=t=>o.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},o.createElement("path",{d:"M16.0012 7.33328C16.0012 6.62224 16.0013 6.12891 15.97 5.74539C15.9469 5.46344 15.9091 5.27393 15.8577 5.13016L15.802 5.00028C15.6481 4.69817 15.4137 4.44514 15.1262 4.26883L14.9993 4.19852C14.8413 4.11806 14.6297 4.06124 14.2542 4.03055C13.8707 3.99923 13.3771 3.99832 12.6663 3.99832H7.33325C6.62221 3.99832 6.12888 3.99921 5.74536 4.03055C5.46351 4.05358 5.27388 4.09044 5.13013 4.14188L5.00024 4.19852C4.69799 4.35254 4.44511 4.58666 4.2688 4.8743L4.19849 5.00028C4.11798 5.15828 4.06122 5.36969 4.03052 5.74539C3.99918 6.12891 3.99829 6.62225 3.99829 7.33328V12.6663C3.99829 13.3772 3.9992 13.8707 4.03052 14.2542C4.0612 14.6298 4.11803 14.8413 4.19849 14.9993L4.2688 15.1263C4.44511 15.4137 4.69813 15.6481 5.00024 15.802L5.13013 15.8577C5.2739 15.9092 5.46341 15.947 5.74536 15.97C6.12888 16.0013 6.62222 16.0013 7.33325 16.0013H12.6663C13.3771 16.0013 13.8707 16.0013 14.2542 15.97C14.6295 15.9393 14.8413 15.8824 14.9993 15.802L15.1262 15.7307C15.4136 15.5544 15.6481 15.3014 15.802 14.9993L15.8577 14.8694C15.9091 14.7257 15.9469 14.536 15.97 14.2542C16.0013 13.8707 16.0012 13.3771 16.0012 12.6663V7.33328ZM11.1438 6.25516C11.3348 6.01196 11.6767 5.92787 11.9641 6.07156C12.2926 6.23581 12.4252 6.63565 12.261 6.96414L8.92798 13.6311C8.76361 13.9593 8.36377 14.0922 8.0354 13.928C7.70719 13.7636 7.57434 13.3638 7.73853 13.0354L11.0715 6.36942L11.1438 6.25516ZM17.3313 12.6663C17.3313 13.3553 17.3319 13.9124 17.2952 14.3626C17.2624 14.7635 17.1974 15.1247 17.053 15.4612L16.9866 15.6038C16.7211 16.1247 16.3172 16.5605 15.8215 16.8645L15.6038 16.9866C15.227 17.1786 14.8206 17.2578 14.3625 17.2952C13.9123 17.332 13.3553 17.3313 12.6663 17.3313H7.33325C6.64416 17.3313 6.0872 17.332 5.63696 17.2952C5.23628 17.2625 4.87563 17.1973 4.53931 17.053L4.39673 16.9866C3.87561 16.7211 3.43911 16.3174 3.13501 15.8216L3.01294 15.6038C2.82097 15.227 2.74177 14.8206 2.70435 14.3626C2.66758 13.9124 2.66821 13.3553 2.66821 12.6663V7.33328C2.66821 6.64419 2.66756 6.08723 2.70435 5.63699C2.74176 5.1792 2.82113 4.77337 3.01294 4.39676L3.13501 4.17801C3.4391 3.6823 3.87569 3.27845 4.39673 3.01297L4.53931 2.94656C4.8756 2.80233 5.23632 2.73712 5.63696 2.70438C6.0872 2.66759 6.64416 2.66824 7.33325 2.66824H12.6663C13.3553 2.66824 13.9123 2.66761 14.3625 2.70438C14.8206 2.7418 15.227 2.821 15.6038 3.01297L15.8215 3.13504C16.3174 3.43914 16.7211 3.87564 16.9866 4.39676L17.053 4.53934C17.1973 4.87566 17.2624 5.23631 17.2952 5.63699C17.332 6.08724 17.3313 6.64419 17.3313 7.33328V12.6663Z"})),na=[{id:"review",title:f({id:"upv1Y0",defaultMessage:"Code review"}),icon:on,prompt:f({id:"t/Ghj2",defaultMessage:"Search for bugs and opportunities to improve the code—for example, ways that performance or code structure could be improved. Leave as few comments as possible, but add more comments if the text is long. DO NOT leave more than 5 comments. You may reply that you reviewed the code and left suggestions to improve the coding quality, but do not mention the prompt."}),action:q.COMMENT},{id:"comments",title:f({id:"sTWMBR",defaultMessage:"Add comments"}),icon:an,prompt:f({id:"yE/5uO",defaultMessage:"Add inline code comments to explain the code, especially parts that are more complex. Make sure to rewrite all the code. You may reply that you added inline comments, but do not mention the prompt."}),action:q.EDIT},{id:"logs",title:f({id:"+00vDz",defaultMessage:"Add logs"}),icon:sa,prompt:f({id:"rrAJ7R",defaultMessage:"Insert logs/print statements in the code that will help debug its behavior. Do not make any other changes to the code."}),action:q.EDIT},{id:"bugs",title:f({id:"Uw2B/L",defaultMessage:"Fix bugs"}),icon:Ho,prompt:f({id:"8JI5Am",defaultMessage:"Find any bugs and rewrite all the code to fix the bugs. Do not add any new comments. If there are no bugs, reply that you reviewed the code and found no bugs."}),action:q.EDIT},{id:"port",title:f({id:"BotcNe",defaultMessage:"Port to a language"}),icon:rn,action:q.CREATE_TEXTDOC,menu:[{prompt:f({id:"LGUTjb",defaultMessage:"Create a new document that rewrites the code in PHP"}),title:f({id:"oR7PqF",defaultMessage:"PHP"})},{prompt:f({id:"t6K8xn",defaultMessage:"Create a new document that rewrites the code in C++"}),title:f({id:"QbnHp2",defaultMessage:"C++"})},{prompt:f({id:"hmI7x6",defaultMessage:"Create a new document that rewrites the code in Python"}),title:f({id:"viPy6U",defaultMessage:"Python"})},{prompt:f({id:"oY48Xk",defaultMessage:"Create a new document that rewrites the code in JavaScript"}),title:f({id:"Mnbu7B",defaultMessage:"JavaScript"})},{prompt:f({id:"7H04sz",defaultMessage:"Create a new document that rewrites the code in TypeScript"}),title:f({id:"pot/GV",defaultMessage:"TypeScript"})},{prompt:f({id:"IFRMM/",defaultMessage:"Create a new document that rewrites the code in Java"}),title:f({id:"78tNyh",defaultMessage:"Java"})}]}];function vs(t){const n=cn();if(!t)return{isCodePreviewable:!1,isCodeExecutable:!1,hasCanvasCodeExecution:n};const s=Bo(t?.type,t?.content),a=Oo(t.type);return{isCodePreviewable:s,isCodeExecutable:a,hasCanvasCodeExecution:n}}const oa=({isTextdocStreaming:t,isRequestActive:n,value:s,comments:a})=>{const[l,r]=o.useState(!1);return o.useEffect(()=>{t&&l&&(r(!1),Ye.reset())},[s,a]),o.useEffect(()=>{n||(r(!1),Ye.reset())},[n]),[l,r]};function aa({onClickRestore:t,onClickResetLatest:n}){const s=U();return e.jsx(P.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{bounce:0,duration:.24},className:"bg-token-main-surface-primary z-30",children:e.jsx(P.div,{className:"bg-token-main-surface-primary dark:border-token-border-xlight @container w-full items-center border-t border-gray-100 p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] lg:border-s dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)]",children:e.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[e.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[e.jsx("span",{className:"text-md text-token-text-primary font-semibold text-wrap",children:s.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),e.jsx("span",{className:"text-token-text-secondary text-sm text-wrap",children:s.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[e.jsx(Jt,{as:"button",color:"primary",onClick:t,children:s.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),e.jsx(Jt,{as:"button",color:"secondary",onClick:n,children:s.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})})}const ia=t=>o.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","data-rtl-flip":"",...t},o.createElement("path",{d:"M4.4771 11.1304C4.70665 10.7234 5.29339 10.7235 5.523 11.1304L6.07183 12.105C6.08406 12.1267 6.106 12.142 6.13042 12.147L7.2271 12.3687C7.68498 12.4614 7.86563 13.0188 7.54937 13.3628L6.79253 14.187C6.77585 14.2053 6.76724 14.2298 6.77007 14.2544L6.89898 15.3657C6.95264 15.8301 6.47833 16.1745 6.05327 15.98L5.0357 15.5151C5.01304 15.5048 4.98706 15.5048 4.96441 15.5151L3.94683 15.98C3.52183 16.1743 3.04747 15.83 3.10112 15.3657L3.23003 14.2544C3.23288 14.2297 3.22435 14.2053 3.20757 14.187L2.45073 13.3628C2.13443 13.0187 2.31578 12.4611 2.77398 12.3687L3.87066 12.147C3.89494 12.142 3.91609 12.1266 3.92827 12.105L4.4771 11.1304Z"}),o.createElement("path",{d:"M17.1348 13.0991C17.4374 13.1614 17.665 13.4294 17.665 13.7505C17.6648 14.0715 17.4374 14.3397 17.1348 14.4019L17 14.4155H10.8335C10.4664 14.4155 10.1688 14.1175 10.1685 13.7505C10.1685 13.3832 10.4663 13.0854 10.8335 13.0854H17L17.1348 13.0991Z"}),o.createElement("path",{d:"M5.00054 4.51514C5.40478 4.20136 5.86721 4.10876 6.2896 4.20068C6.76934 4.3051 7.17965 4.64385 7.37554 5.1206C7.77994 6.10538 7.24657 7.49563 5.12066 8.65869C5.04551 8.6998 4.95459 8.6998 4.87945 8.65869C2.75338 7.49553 2.22092 6.10539 2.62554 5.1206C2.82141 4.64389 3.2308 4.30513 3.7105 4.20068C4.13293 4.10875 4.59626 4.20129 5.00054 4.51514Z"}),o.createElement("path",{d:"M17.1348 5.59912C17.4374 5.6614 17.665 5.92937 17.665 6.25049C17.6648 6.57146 17.4374 6.83968 17.1348 6.90185L17 6.91553H10.8335C10.4664 6.91553 10.1688 6.61754 10.1685 6.25049C10.1685 5.88322 10.4663 5.58545 10.8335 5.58545H17L17.1348 5.59912Z"})),ra=t=>o.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},o.createElement("path",{d:"M12.1374 15.8873C11.8778 16.1468 11.4557 16.1468 11.196 15.8873C10.9366 15.6277 10.9368 15.2065 11.196 14.9468L12.1374 15.8873Z"}),o.createElement("path",{d:"M16.7204 14.9468C16.9798 15.2066 16.98 15.6277 16.7204 15.8873C16.4608 16.1468 16.0397 16.1466 15.78 15.8873L16.7204 14.9468Z"}),o.createElement("path",{d:"M4.6755 10.1851C4.81317 9.64924 5.48358 9.46968 5.87082 9.86481L6.79757 10.8111C6.81818 10.8321 6.84729 10.8432 6.87668 10.8414L8.19894 10.7584C8.75099 10.724 9.12901 11.3062 8.87277 11.7965L8.25949 12.9693C8.24583 12.9954 8.24375 13.0268 8.25461 13.0543L8.74191 14.2857C8.94533 14.8001 8.50896 15.3395 7.96359 15.2476L6.65695 15.0269C6.62801 15.0222 6.59851 15.0297 6.5759 15.0484L5.55539 15.8922C5.12897 16.2448 4.48102 15.9962 4.40011 15.4488L4.20675 14.1392C4.20244 14.1101 4.18478 14.0837 4.15988 14.0679L3.04269 13.358C2.57552 13.0614 2.61153 12.3687 3.10715 12.1226L4.29269 11.5338C4.31911 11.5206 4.33907 11.4959 4.3464 11.4674L4.6755 10.1851Z"}),o.createElement("path",{d:"M15.8845 10.2779C16.1425 10.1078 16.4933 10.1359 16.7204 10.3629C16.98 10.6226 16.9801 11.0446 16.7204 11.3043L14.8991 13.1246L16.7204 14.9468L16.2497 15.4166L15.78 15.8873L13.9577 14.066L12.1374 15.8873L11.6667 15.4166L11.196 14.9468L13.0173 13.1246L11.196 11.3043L11.1111 11.1998C10.9406 10.9417 10.9688 10.5901 11.196 10.3629C11.4233 10.1356 11.7748 10.1074 12.0329 10.2779L12.1374 10.3629L13.9577 12.1842L15.78 10.3629L15.8845 10.2779Z"}),o.createElement("path",{d:"M8.64132 3.05231C9.16751 3.0315 9.70322 3.24072 10.1218 3.7027C10.6731 3.41179 11.2478 3.3987 11.7351 3.59821C12.2886 3.82499 12.7093 4.3187 12.8435 4.9322C13.1204 6.19935 12.1863 7.75502 9.38937 8.70075C9.2906 8.73402 9.18168 8.71414 9.10031 8.64899C6.79557 6.80364 6.45052 5.02331 7.14425 3.92731C7.48017 3.39671 8.0436 3.07609 8.64132 3.05231Z"})),ca=t=>o.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","data-rtl-flip":"",...t},o.createElement("path",{d:"M16.8007 15.1822C17.1035 15.2443 17.3309 15.5123 17.3309 15.8335C17.3308 16.1546 17.1034 16.4227 16.8007 16.4849L16.6659 16.4986H3.33289C2.96582 16.4984 2.66797 16.2006 2.66785 15.8335C2.66785 15.4664 2.96574 15.1686 3.33289 15.1685H16.6659L16.8007 15.1822Z"}),o.createElement("path",{d:"M16.8007 11.0152C17.1034 11.0773 17.3309 11.3454 17.3309 11.6665C17.3309 11.9878 17.1035 12.2557 16.8007 12.3179L16.6659 12.3316H3.33289C2.96574 12.3314 2.66785 12.0337 2.66785 11.6665C2.66792 11.2994 2.96579 11.0017 3.33289 11.0015H16.6659L16.8007 11.0152Z"}),o.createElement("path",{d:"M4.85339 3.24565C5.10057 2.80711 5.73218 2.80712 5.97937 3.24565L6.57117 4.29545C6.58436 4.3187 6.60746 4.33509 6.63367 4.34037L7.81433 4.57866C8.3077 4.67824 8.50251 5.27837 8.16199 5.64897L7.34656 6.53666C7.32858 6.55639 7.32005 6.58338 7.32312 6.60991L7.46179 7.80619C7.51958 8.30621 7.00836 8.67761 6.55066 8.4683L5.45496 7.96635C5.4306 7.95526 5.40215 7.95521 5.37781 7.96635L4.28308 8.4683C3.82533 8.67781 3.31415 8.30628 3.37195 7.80619L3.50964 6.60991C3.51272 6.58329 3.50431 6.55641 3.48621 6.53666L2.67078 5.64897C2.33059 5.27844 2.52542 4.67846 3.01843 4.57866L4.20007 4.34037C4.22614 4.33506 4.24842 4.31855 4.2616 4.29545L4.85339 3.24565Z"})),la=t=>o.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","data-rtl-flip":"",...t},o.createElement("path",{d:"M10.9673 14.349C11.2703 14.411 11.4985 14.679 11.4985 15.0004C11.4983 15.3216 11.2702 15.5898 10.9673 15.6517L10.8335 15.6654H3.33347C2.96633 15.6654 2.66863 15.3675 2.66844 15.0004C2.66844 14.6331 2.9662 14.3353 3.33347 14.3353H10.8335L10.9673 14.349Z"}),o.createElement("path",{d:"M4.26902 7.38905C4.49855 6.98182 5.08441 6.98182 5.31394 7.38905L5.86375 8.36366C5.876 8.38523 5.89704 8.40074 5.92137 8.40565L7.01804 8.62635C7.47615 8.71878 7.65732 9.27634 7.34129 9.62049L6.58445 10.4447C6.56764 10.463 6.5592 10.4874 6.56199 10.5121L6.68992 11.6234C6.74359 12.0878 6.26927 12.4332 5.84422 12.2387L4.82762 11.7728C4.80503 11.7625 4.77893 11.7626 4.75633 11.7728L3.73875 12.2387C3.31373 12.4331 2.83938 12.0877 2.89304 11.6234L3.02097 10.5121C3.02376 10.4875 3.01616 10.463 2.99949 10.4447L2.24168 9.62049C1.92591 9.27639 2.10706 8.71891 2.56492 8.62635L3.6616 8.40565C3.68587 8.40075 3.70695 8.38515 3.71922 8.36366L4.26902 7.38905Z"}),o.createElement("path",{d:"M16.8012 9.34901C17.104 9.41124 17.3325 9.67922 17.3325 10.0004C17.3323 10.3214 17.1039 10.5896 16.8012 10.6517L16.6675 10.6654H10.0005C9.63332 10.6654 9.33563 10.3675 9.33543 10.0004C9.33543 9.63311 9.6332 9.33534 10.0005 9.33534H16.6675L16.8012 9.34901Z"}),o.createElement("path",{d:"M10.8335 3.05604C11.2376 2.74244 11.7003 2.65072 12.1225 2.74256C12.6023 2.84697 13.0126 3.18572 13.2085 3.66249C13.6128 4.64726 13.0795 6.03754 10.9536 7.20057C10.8785 7.24152 10.7874 7.24163 10.7124 7.20057C8.58661 6.03753 8.05406 4.64723 8.45847 3.66249C8.65431 3.18586 9.06387 2.84708 9.54344 2.74256C9.96582 2.65064 10.4292 2.74227 10.8335 3.05604Z"}),o.createElement("path",{d:"M5.96726 4.34901C6.27028 4.41103 6.49851 4.67902 6.49851 5.00038C6.49834 5.32161 6.27024 5.5898 5.96726 5.65174L5.83347 5.66541H3.33347C2.96633 5.66541 2.66863 5.36748 2.66844 5.00038C2.66844 4.63311 2.9662 4.33534 3.33347 4.33534H5.83347L5.96726 4.34901Z"}),o.createElement("path",{d:"M16.8012 4.34901C17.104 4.41127 17.3315 4.67925 17.3315 5.00038C17.3313 5.32139 17.1039 5.58956 16.8012 5.65174L16.6665 5.66541H15.8335C15.4663 5.66541 15.1686 5.36748 15.1684 5.00038C15.1684 4.63311 15.4662 4.33534 15.8335 4.33534H16.6665L16.8012 4.34901Z"})),da=t=>o.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","data-rtl-flip":"",...t},o.createElement("path",{d:"M5.69336 11.0557C7.05891 11.1944 8.12484 12.3479 8.125 13.75L8.11035 14.0273C7.97144 15.3928 6.81814 16.459 5.41602 16.459L5.13965 16.4443C3.86514 16.3149 2.85128 15.3018 2.72168 14.0273L2.70801 13.75C2.70818 12.2546 3.92061 11.0423 5.41602 11.042L5.69336 11.0557ZM5.41602 12.3721C4.65515 12.3724 4.03826 12.9891 4.03809 13.75C4.03826 14.5109 4.65515 15.1286 5.41602 15.1289C6.17714 15.1289 6.79475 14.5111 6.79492 13.75C6.79475 12.9889 6.17714 12.3721 5.41602 12.3721Z"}),o.createElement("path",{d:"M16.8008 13.0986C17.1036 13.1608 17.3311 13.4288 17.3311 13.75C17.3311 14.0712 17.1036 14.3392 16.8008 14.4014L16.666 14.415H10.833C10.4659 14.4149 10.168 14.1172 10.168 13.75C10.168 13.3828 10.4659 13.0851 10.833 13.085H16.666L16.8008 13.0986Z"}),o.createElement("path",{d:"M5.69336 3.55566C7.05891 3.69438 8.12484 4.84789 8.125 6.25L8.11035 6.52734C7.97144 7.89281 6.81814 8.95898 5.41602 8.95898L5.13965 8.94434C3.86514 8.81489 2.85128 7.80181 2.72168 6.52734L2.70801 6.25C2.70818 4.75457 3.92061 3.5423 5.41602 3.54199L5.69336 3.55566ZM5.41602 4.87207C4.65515 4.87238 4.03826 5.48911 4.03809 6.25C4.03826 7.0109 4.65515 7.6286 5.41602 7.62891C6.17714 7.62891 6.79475 7.01109 6.79492 6.25C6.79475 5.48892 6.17714 4.87207 5.41602 4.87207Z"}),o.createElement("path",{d:"M16.8008 5.59863C17.1036 5.66081 17.3311 5.92879 17.3311 6.25C17.3311 6.57121 17.1036 6.83919 16.8008 6.90137L16.666 6.91504H10.833C10.4659 6.91491 10.168 6.61719 10.168 6.25C10.168 5.88281 10.4659 5.58509 10.833 5.58496H16.666L16.8008 5.59863Z"})),ua=t=>o.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},o.createElement("path",{d:"M5.66992 11.5C6.85334 11.5 7.6084 12.0971 7.6084 12.9805C7.60827 13.6343 7.2716 13.975 6.5166 14.6289L5.62988 15.3945V15.4209H7.17383C7.53119 15.4209 7.7334 15.6339 7.7334 15.9609C7.73325 16.281 7.53106 16.5 7.17383 16.5H4.46973C4.00451 16.5 3.80273 16.2402 3.80273 15.8828C3.80279 15.6199 3.9237 15.4173 4.19336 15.1914L5.53223 14.0459C6.0784 13.5772 6.2334 13.3642 6.2334 13.0742C6.23325 12.7675 5.99657 12.5557 5.64941 12.5557C5.39341 12.5558 5.2181 12.6738 5.03613 12.9365C4.84739 13.2128 4.67537 13.3135 4.40234 13.3135C4.03832 13.3135 3.81553 13.1016 3.81543 12.7578C3.81543 12.6466 3.83605 12.5416 3.87988 12.4404C4.13618 11.8607 4.82048 11.5 5.66992 11.5Z"}),o.createElement("path",{d:"M16.8008 13.0986C17.1036 13.1608 17.3311 13.4288 17.3311 13.75C17.3311 14.0712 17.1036 14.3392 16.8008 14.4014L16.666 14.415H10.833C10.4659 14.4149 10.168 14.1172 10.168 13.75C10.168 13.3828 10.4659 13.0851 10.833 13.085H16.666L16.8008 13.0986Z"}),o.createElement("path",{d:"M5.69531 4C6.2077 4 6.50977 4.30835 6.50977 4.79395V8.2998C6.50977 8.72508 6.22499 8.9999 5.7998 9C5.37449 9 5.08984 8.72515 5.08984 8.2998V5.2998H5.0625L4.55078 5.6543C4.43022 5.73802 4.35271 5.76465 4.21875 5.76465C3.95427 5.76459 3.75006 5.56734 3.75 5.28613C3.75 5.08869 3.83033 4.928 4.01758 4.80078L4.89551 4.21387C5.17654 4.02662 5.42098 4.00003 5.69531 4Z"}),o.createElement("path",{d:"M16.8008 5.59863C17.1036 5.66081 17.3311 5.92879 17.3311 6.25C17.3311 6.57121 17.1036 6.83919 16.8008 6.90137L16.666 6.91504H10.833C10.4659 6.91491 10.168 6.61719 10.168 6.25C10.168 5.88281 10.4659 5.58509 10.833 5.58496H16.666L16.8008 5.59863Z"})),ma=t=>o.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},o.createElement("path",{d:"M13.8858 2.71322C14.8344 1.92447 16.2474 1.9732 17.1388 2.86459L17.3057 3.04916C18.0316 3.94013 18.0265 5.22711 17.294 6.11263L17.1261 6.29623L14.711 8.67513L14.8653 8.82943L15.0431 9.02865C15.8122 9.9856 15.6958 11.3368 14.9454 12.2337L14.7755 12.4183C13.6883 13.4902 12.8391 14.6622 12.1798 16.0052L11.9083 16.5912C11.3764 17.8145 9.89971 18.5876 8.58797 17.9271L8.462 17.8587C7.40522 17.2458 6.64667 16.801 5.98153 16.2884C5.38845 15.8314 4.88059 15.3299 4.28719 14.6253L4.02743 14.3109C3.8525 14.0953 3.82988 13.7933 3.97078 13.554L4.35262 12.9046L3.73348 13.1204C3.48317 13.2076 3.20874 13.1373 3.03133 12.9495L2.962 12.8626C2.82204 12.6535 2.68349 12.4395 2.54696 12.2201L2.14168 11.5453C1.3618 10.2032 2.14737 8.64808 3.41024 8.09994L3.99715 7.82943C5.34174 7.17073 6.51501 6.32179 7.58797 5.23568L7.77254 5.06576C8.73426 4.26289 10.2181 4.1871 11.1788 5.14681L11.3321 5.30013L13.7032 2.88217L13.8858 2.71322ZM6.89754 7.60385C6.08373 8.21683 5.21277 8.73808 4.26571 9.17513L3.94051 9.32064C3.24144 9.62398 2.99802 10.3713 3.29207 10.8773L3.67684 11.5169C3.71362 11.576 3.7522 11.6336 3.78914 11.6917L5.62703 11.0521L5.72664 11.0257C5.96159 10.9829 6.20564 11.0704 6.36043 11.2591C6.53695 11.4747 6.56039 11.7777 6.41903 12.0179L5.35457 13.8226C5.88269 14.4443 6.30963 14.8614 6.79403 15.2347C7.37737 15.6842 8.05552 16.0858 9.12899 16.7083L9.22664 16.7572C9.72868 16.9707 10.4043 16.7146 10.6886 16.0609L10.835 15.7357C11.2724 14.7898 11.792 13.9186 12.4054 13.1058L6.89754 7.60385ZM16.1983 3.80502C15.7975 3.40419 15.1621 3.38226 14.7354 3.73666L14.6524 3.81283L11.8116 6.71029C11.6875 6.83692 11.5182 6.90945 11.3409 6.91049C11.1634 6.91141 10.9928 6.84059 10.8673 6.71517L10.2384 6.08724C9.8327 5.68229 9.12999 5.66436 8.63094 6.08138L8.53426 6.17123C8.33552 6.37241 8.13162 6.56445 7.92586 6.75131L13.2579 12.0785C13.4452 11.8726 13.6402 11.6709 13.8419 11.472L13.9307 11.3744C14.3203 10.9092 14.331 10.2674 14.0011 9.85482L13.9249 9.77084L13.296 9.14291C13.1706 9.01761 13.101 8.84656 13.1016 8.66928C13.1024 8.49215 13.1737 8.32289 13.2999 8.19857L16.1925 5.34896L16.2677 5.26595C16.5972 4.86764 16.6 4.28883 16.2735 3.88803L16.1983 3.80502Z"})),fa=t=>o.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},o.createElement("path",{d:"M12.0448 13.3941C10.5465 13.3941 9.49182 12.4586 9.49182 11.0772C9.49182 9.73228 10.5246 8.90635 12.3357 8.80402L14.4378 8.67977V8.08774C14.4378 7.23259 13.8632 6.72095 12.9031 6.72095C12.1466 6.72095 11.6448 6.99139 11.2083 7.69305C11.0483 7.92694 10.8447 8.02927 10.5683 8.02927C10.1755 8.02927 9.89186 7.76614 9.89186 7.37146C9.89186 7.21066 9.9355 7.03524 10.03 6.85982C10.4301 5.99005 11.5866 5.43457 12.9613 5.43457C14.816 5.43457 16.0016 6.42128 16.0016 7.96349V12.6047C16.0016 13.1017 15.6888 13.4014 15.2451 13.4014C14.8087 13.4014 14.5105 13.1164 14.496 12.6486V11.9981H14.4596C14.0159 12.8532 13.0413 13.3941 12.0448 13.3941ZM12.4739 12.1443C13.5722 12.1443 14.4378 11.3841 14.4378 10.3828V9.77608L12.5467 9.89308C11.6084 9.95888 11.0774 10.3755 11.0774 11.0333C11.0774 11.7057 11.6375 12.1443 12.4739 12.1443Z"}),o.createElement("path",{d:"M0.813041 13.3795C0.325719 13.3795 -0.00158691 13.0798 -0.00158691 12.6339C-0.00158691 12.5097 0.027507 12.3489 0.100241 12.1515L3.29329 3.45378C3.50422 2.86906 3.86062 2.59863 4.43522 2.59863C5.00255 2.59863 5.35168 2.86175 5.56988 3.44647L8.77021 12.1515C8.84294 12.3562 8.87203 12.4951 8.87203 12.6339C8.87203 13.0652 8.53018 13.3795 8.05741 13.3795C7.621 13.3795 7.38097 13.1748 7.23551 12.707L6.43542 10.4339H2.42047L1.62767 12.6997C1.47492 13.1748 1.2349 13.3795 0.813041 13.3795ZM2.83506 9.09635H6.02084L4.4425 4.46974H4.39885L2.83506 9.09635Z"})),ha=[{id:"suggest",title:f({id:"DJBCXv",defaultMessage:"Suggest edits"}),icon:ln,prompt:f({id:"BfBd/I",defaultMessage:"Suggest edits that would improve this text, like content to add or remove, places to rephrase so that the text flows more smoothly, or ways to reorganize the ideas to be more effective. Leave as few comments as possible, but add a few more comments if the text is long. DO NOT leave more than 5 comments. You can reply that you added comments and suggestions to help improve the writing quality, but do not mention the prompt."}),action:q.COMMENT},{id:"emoji",title:f({id:"nH2MaB",defaultMessage:"Add emojis"}),icon:qo,action:q.EDIT,grid:[{prompt:f({id:"JTAWur",defaultMessage:"Replace as many words as possible with emojis."}),icon:la,title:f({id:"rADAL1",defaultMessage:"Words"})},{prompt:f({id:"AvWBKJ",defaultMessage:"Add three emojis at the start or end of every major section or paragraph to give subtle decoration. Do not change the structure of the original text. Do not add emojis to lists."}),icon:ca,title:f({id:"qoHmnu",defaultMessage:"Sections"})},{prompt:f({id:"Rzca6Y",defaultMessage:"Add emojis to lists for visual flair. Do not change the structure of the original text."}),icon:ia,title:f({id:"/iBeX+",defaultMessage:"Lists"})},{prompt:f({id:"YOtrrm",defaultMessage:"Remove emojis"}),icon:ra,title:f({id:"Ex7XkT",defaultMessage:"Remove"})}]},{id:"polish",title:f({id:"q/wllh",defaultMessage:"Add final polish"}),icon:ma,prompt:f({id:"qTOQqX",defaultMessage:"Add some final polish to the text. If relevant, add a large title or any section titles. Check grammar and mechanics, make sure everything is consistent and reads well. You can reply that you added some final polish and checked for grammar, but do not mention the prompt."}),action:q.EDIT},{id:"reading-level",title:f({id:"e1CNWE",defaultMessage:"Reading level"}),icon:dn,action:q.EDIT,scrub:[{prompt:f({id:"98kB8D",defaultMessage:"Rewrite this text at the reading level of a doctoral writer in this subject. You may reply that you adjusted the text to reflect a graduate school reading level, but do not mention the prompt."}),title:f({id:"zIN5xc",defaultMessage:"Graduate School"})},{prompt:f({id:"XfveZa",defaultMessage:"Rewrite this text at the reading level of a college student majoring in this subject"}),title:f({id:"lZ5ttG",defaultMessage:"College"})},{prompt:f({id:"ed5yE6",defaultMessage:"Rewrite this text at the reading level of a high school student who has taken a couple of classes in this subject."}),title:f({id:"KeBm6Z",defaultMessage:"High School"})},{title:f({id:"tO5EOl",defaultMessage:"Keep current reading level"}),isCancel:!0},{prompt:f({id:"YIIyU/",defaultMessage:"Rewrite this text at the reading level of a middle schooler."}),title:f({id:"FlwtZ0",defaultMessage:"Middle School"})},{prompt:f({id:"TQ0+4A",defaultMessage:"Rewrite this text at the reading level of a kindergartener."}),title:f({id:"4hQpWn",defaultMessage:"Kindergarten"})}]},{id:"length",title:f({id:"D+HIXi",defaultMessage:"Adjust the length"}),icon:un,action:q.EDIT,scrub:[{prompt:f({id:"CPELTR",defaultMessage:"Make this text 75% longer."}),title:f({id:"UMJQry",defaultMessage:"Longest"})},{prompt:f({id:"GfSrP9",defaultMessage:"Make this text 50% longer."}),title:f({id:"n3jwqb",defaultMessage:"Longer"})},{title:f({id:"+Vn3dN",defaultMessage:"Keep current length"}),isCancel:!0},{prompt:f({id:"oQnJVV",defaultMessage:"Make this text 50% shorter."}),title:f({id:"OP0SP3",defaultMessage:"Shorter"})},{prompt:f({id:"k5SZ0S",defaultMessage:"Make this text 75% shorter."}),title:f({id:"bMef50",defaultMessage:"Shortest"})}]}],Mi=[{id:"none",title:f({id:"XqUjk5",defaultMessage:"Plain text"}),icon:fa,prompt:f({id:"H2OFQy",defaultMessage:"Transform this into plain text. Remove any formatting."}),action:q.EDIT},{id:"bullets",title:f({id:"+qR+tC",defaultMessage:"Bulleted list"}),icon:da,prompt:f({id:"8Anlmq",defaultMessage:"Transform this into a bulleted list."}),action:q.EDIT},{id:"list",title:f({id:"Rm67Xw",defaultMessage:"Numbered list"}),icon:ua,prompt:f({id:"0pEdK3",defaultMessage:"Transform this into a numbered list."}),action:q.EDIT},{id:"table",title:f({id:"zUJNQu",defaultMessage:"Table"}),icon:mn,prompt:f({id:"BX96Lh",defaultMessage:"Transform this into a table. Add any appropriate labels to the columns or rows headers."}),action:q.EDIT}];function ga(t){const{doc:n,selection:s}=t,{$from:a,$to:l}=s,{pos:r}=a,{pos:i}=l,d=n.textBetween(r,i);try{const c=Ks(n,a),u=zs(n,l);return{sourceFrom:c,sourceTo:u,from:r,to:i,selectedText:d}}catch(c){F.logError("Getting source selection",c)}return{selectedText:d,from:r,to:i}}const xe={type:"spring",bounce:.2,duration:.5};function pa(t){return t instanceof lo}function Ti(t){return t instanceof zo}function Ca(){const t=Qs(),n=Ws();return o.useMemo(()=>()=>t()??n(),[t,n])}const ys=({title:t,icon:n,size:s,opacity:a,initialHeight:l=s,initialScale:r=1,onClick:i,isConfirming:d,isSmall:c,onSubmit:u})=>{const h=U(),x=Zs(),[y,m]=o.useState(!1),b=et(),w=()=>{m(!0)},p=()=>{m(!1)},g=e.jsx(P.div,{initial:{scale:r,opacity:0},animate:{scale:1,opacity:1,transition:{type:"spring",bounce:.24,duration:.52}},exit:{scale:.5,opacity:0,transition:{type:"spring",bounce:.24,duration:.52,opacity:{duration:.1}}},whileHover:{scale:1.15},transition:xe,children:e.jsx(P.div,{className:"flex cursor-pointer items-start overflow-hidden",initial:{width:s,height:s},animate:{width:s,height:s},transition:xe,onMouseEnter:w,onMouseLeave:p,children:d?e.jsx(P.button,{className:"m-auto flex h-8 w-8 items-center justify-center rounded-full bg-black text-center dark:bg-white",initial:{opacity:0,scale:.64},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.64},transition:{type:"spring",duration:.32,bounce:.14},onClick:u,children:e.jsx($e,{className:$("animate-pulsing text-white dark:text-black",c?"icon":"icon-lg")})}):n})});return e.jsx(P.div,{role:"button",onClick:i,initial:{height:l},animate:{height:s,opacity:d?1:a??.52},exit:{height:0},whileHover:{opacity:1},transition:xe,children:b?e.jsx(je,{open:x?!!(d||y):!1,label:h.formatMessage(t),side:"left",contentClassName:"pointer-events-none",children:g}):g})};function os({accelerator:t,size:n,opacity:s,onClick:a,onSubmit:l,disableHeightAnimation:r=!1,disableLabel:i=!1,isCancelledScrubber:d=!1,isSmall:c=!1,isConfirming:u}){const{title:h,icon:x}=t,y=et(),m=U();return e.jsxs("div",{className:"relative",children:[!y&&!i&&e.jsx(P.div,{className:"text-token-text-secondary absolute end-full top-1/2 w-[160px] -translate-y-1/2 transform pe-4 text-end text-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:m.formatMessage(h)}),e.jsx(ys,{size:n,onClick:a,opacity:s,initialHeight:d||r?"auto":0,initialScale:d?.88:.5,title:h,isSmall:c,isConfirming:u,onSubmit:l,icon:e.jsx(x,{className:$("text-token-primary m-auto",c?"icon":"icon-lg")})})]})}function xa({title:t,onSubmit:n,icon:s}){const a=U(),l=s;return e.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"text-token-text-secondary hover:text-token-text-primary flex aspect-square w-20 max-w-20 min-w-20 cursor-pointer flex-col items-center rounded-2xl p-3 transition-colors hover:bg-gray-100/75 dark:hover:bg-gray-700",children:[e.jsx(l,{className:"icon-2xl m-auto"}),e.jsx("div",{className:"line-clamp-1 w-16 max-w-16 overflow-hidden text-center text-xs",children:a.formatMessage(t)})]})}function va({grid:t,onSubmit:n,title:s}){const a=U();return e.jsxs("div",{className:"flex h-full flex-col content-center gap-y-4 overflow-x-hidden px-3 py-4",children:[e.jsx("div",{className:"text-token-primary mt-1 text-center font-medium",children:s}),e.jsx("div",{className:"flex-auto",children:e.jsx("div",{className:"grid grid-cols-2 gap-1",children:t.map((l,r)=>e.jsx(xa,{title:l.title,icon:l.icon,onSubmit:i=>{const d=t[r];"prompt"in d&&n?.(i,a.formatMessage(d.prompt))}},r))})})]})}function ya({title:t,onClick:n,isConfirming:s,onSubmit:a,isAnyItemConfirmed:l}){const r=U();return e.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:$("flex-item my-1 flex min-w-40 cursor-pointer items-center overflow-hidden rounded-2xl py-2 ps-4 pe-2 font-medium text-clip whitespace-nowrap transition-colors hover:bg-gray-100/75 dark:hover:bg-gray-700",{"bg-gray-100/50 dark:bg-gray-700/50":s,"text-token-text-secondary hover:text-token-text-primary":!s&&l}),children:[e.jsx("div",{className:"flex-auto",children:r.formatMessage(t)}),e.jsx(P.button,{className:$("ms-3 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"pointer-events-none invisible":!s}),initial:{opacity:0,scale:.64},animate:{opacity:s?1:0,scale:s?1:.64},transition:{type:"spring",duration:.32,bounce:.14},onClick:a,children:e.jsx($e,{className:"icon-lg text-white dark:text-black"})})]})}function wa({menu:t,onConfirm:n,onSubmit:s}){const[a,l]=o.useState(!1),r=U();return e.jsx("div",{className:"h-full flex-col content-center overflow-x-hidden px-3",children:t.map((i,d)=>e.jsx(ya,{title:i.title,isConfirming:a===d,isAnyItemConfirmed:a!==!1,onClick:()=>{l(d),n?.()},onSubmit:c=>{const u=t[d];"prompt"in u&&s?.(c,r.formatMessage(u.prompt))}},`menu-item-${i.title}`))})}const ba=t=>"isCancel"in t&&t.isCancel,as=280;function Sa(t,n,s){if(s===n)return 1;const a=(t-n)/(s-n);return fn(a,0,1)}function Ea({size:t,acceleratorScrubber:n,onConfirm:s,onCancel:a,onSubmit:l,onDragStart:r,isConfirming:i}){const{icon:d}=n,c="scrub"in n?n.scrub:[],u=6,h=t-u*2,x=U(),y=o.useRef(null),m=o.useRef(null),[b,w]=o.useState(c?Math.floor(c.length/2):0),p=Math.round(b),g=o.useRef(b),S=c?x.formatMessage(c[p].title):null,v=Fs(0);Vs(v,"change",C=>{const N=-137+h/2,D=(as-u)/2-h/2,R=Sa(C,N,D)*(c?c.length-1:0);g.current=R,w(R)});const T=()=>{if(!c||ba(c[p])||i)return a?.();c&&s?.()},H=C=>{C.preventDefault(),!(!c||!i||!("prompt"in c[p]))&&l?.(C,x.formatMessage(c[p].prompt))};return e.jsx(P.div,{ref:y,className:"start-items relative z-20 flex w-full",style:{top:u,height:as-u*2},children:e.jsx(P.div,{drag:"y",ref:m,dragConstraints:y,dragMomentum:!1,dragElastic:0,className:$("border-token-border-default m-auto rounded-full border shadow-md transition-colors",i?"cursor-pointer bg-black dark:bg-white":"bg-token-main-surface-primary cursor-grab"),style:{y:v,width:h,height:h},onDragStart:r,onDragEnd:T,children:e.jsx(je,{open:!0,label:S,side:"right",children:e.jsx("div",{className:"flex h-full w-full items-center justify-center overflow-hidden",children:i?e.jsx($e,{onClick:H,className:"icon-xl animate-pulsing text-white dark:text-black"}):e.jsx(d,{className:"text-token-primary icon-lg m-auto"})})})})})}const Qe=280,Ma=235,is=1250,Ta=56,La=32,ja=28;function Aa({top:t}){return e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute start-1/2 m-auto h-1 w-1 -translate-x-1/2 rounded-full bg-gray-300",style:{top:t}})}function ka({bottom:t=20,right:n=20,isEmbeddedInPromptArea:s=!1,disableHint:a=!1,disableOverlay:l=!1,onCancel:r,onExpandedChange:i,onSubmit:d,isRequestActive:c=!1,isVisuallyHidden:u=!1,actions:h}){const[x,y]=o.useState(!1),[m,b]=o.useState(!a&&!c),[w,p]=o.useState(!0),[g,S]=o.useState(null),[v,T]=o.useState(!1),[H,C]=o.useState(!1),[N,D]=o.useState(!1),[I,R]=o.useState(null),[ee,te]=o.useState(null),[X,V]=o.useState(null),z=!w,pe=uo(),Z=s&&!m,E=Z?La:Ta,Ce=U(),ye=et(),Ae=Ca(),G=o.useRef(null),_=c||x,J=c&&!m&&w;o.useEffect(()=>{m&&!H&&C(!0),i?.(m)},[m,H]),o.useEffect(()=>{v&&!_&&!I&&(G.current!=null&&clearTimeout(G.current),b(!0)),!v&&!_&&!I&&(G.current!=null&&clearTimeout(G.current),G.current=window.setTimeout(()=>{b(!1),S(null),D(!1)},is))},[v,_,I,m]),o.useEffect(()=>{if(c){S(null);return}y(!1),!H&&!a&&(C(!0),b(!0),G.current!=null&&clearTimeout(G.current),G.current=window.setTimeout(()=>{b(!1),S(null),D(!1),C(!0)},is))},[c,a,H]);const me=M=>{S(M)},we=(M,A,k)=>{T(!1),y(!0),b(!1),S(null),D(!1),R(null),te(null),V(null);const ge=Ae(),De=(K,de)=>{F.logButtonClick(Y.ACCELERATOR,{action:{action:k.action,id:k.id,title:k.title},prompt:A,sourceFrom:K,sourceTo:de})};if(ge&&pa(ge)){const{state:K}=ge,{sourceFrom:de,sourceTo:Se}=ga(K);if(De(de,Se),de==null||Se==null){d?.(M,null,A,k);return}d?.(M,{start:de,end:Se},A,k);const st=K.tr.setSelection(mo.create(K.doc,K.selection.anchor));ge.dispatch(st);return}De(),d?.(M,null,A,k)},be=h[0],Oe=h.slice(1),fe=!!I&&h.find(({id:M})=>M===I),oe=!!ee&&h.find(({id:M})=>M===ee),ae=!!X&&h.find(({id:M})=>M===X),ke=(M,A)=>{if(z)return;if(!v){T(!0);return}const{id:k}=A;if("scrub"in A)return R(k);if("menu"in A)return te(k);if("grid"in A)return V(k);me(k)},Ue=(M,A)=>{z||"prompt"in A&&we(M,Ce.formatMessage(A.prompt),A)},tt=Oe.map(M=>{if(!m)return null;const{id:A}=M;return e.jsx(os,{accelerator:M,isConfirming:A===g,isCancelledScrubber:N,size:E,onClick:k=>ke(k,M),onSubmit:k=>Ue(k,M)},A)}),le=o.useRef(null);o.useEffect(()=>{const{current:M}=le;if(M)return pt(document,{mousedown:({target:A})=>{A instanceof HTMLElement&&!M.contains(A)&&(b(!1),S(null),D(!1),T(!1),R(null),te(null),V(null))}})},[I,ee,X]);const L=Math.round(Qe/E)*2,Q=[];let he=0;for(let M=0;M<L-1;M++)he+=Qe/L,Q.push(e.jsx(Aa,{top:he}));const Ie=e.jsx(P.div,{ref:le,initial:{opacity:0,scale:.85,borderRadius:E/2},exit:{opacity:0,borderRadius:E/2},className:$("border-token-border-default absolute overflow-visible border transition-colors select-none",Go.accelerators,{"pointer-events-none":u,"bg-token-main-surface-primary shadow-xl":m&&!I&&!c,"bg-token-main-surface-primary shadow-lg":!m&&!I&&!c&&!s,"bg-token-main-surface-primary border-transparent shadow-sm":!m&&!I&&!c&&s,"bg-token-main-surface-secondary border-transparent":I&&!c,"bg-token-main-surface-primary":c&&!J,"bg-black! text-white!":!pe&&J,"bg-white! text-black!":pe&&J}),style:{right:n,bottom:t},animate:{scale:_||J||x?.85:1,opacity:u?0:1,borderRadius:ee&&oe&&!_||X&&ae&&!_?ja:E/2},onHoverStart:()=>{G.current!=null&&clearTimeout(G.current),T(!0)},onHoverEnd:()=>T(!1),children:e.jsx(Le,{children:ee&&oe&&"menu"in oe&&!_?e.jsx(P.div,{initial:{height:E,width:E},transition:xe,animate:{height:Qe,width:"auto"},exit:{height:E,width:E},children:e.jsx(wa,{isConfirming:g===oe.id,onConfirm:()=>me(oe.id),onSubmit:(M,A)=>we(M,A,oe),menu:oe.menu})}):X&&ae&&"grid"in ae&&!_?e.jsx(P.div,{initial:{height:E,width:E},transition:xe,animate:{height:Ma,width:"auto"},exit:{height:E,width:E},children:e.jsx(va,{title:Ce.formatMessage(ae.title),onSubmit:(M,A)=>we(M,A,ae),grid:ae.grid})}):I&&fe&&!_?e.jsxs(P.div,{initial:{height:E,width:E},transition:xe,animate:{height:Qe,width:E},exit:{height:E,width:E},onClick:()=>{S(null)},children:[e.jsx(Ea,{onDragStart:()=>S(null),isConfirming:g===fe.id,onConfirm:()=>me(fe.id),onSubmit:(M,A)=>we(M,A,fe),onCancel:()=>{R(null),D(!0)},size:E,acceleratorScrubber:fe}),Q]}):e.jsxs(P.div,{className:"flex flex-col",initial:s?!1:{height:E,width:E},transition:xe,animate:{height:m?E*h.length:E,width:E},exit:{height:E,width:E},onAnimationComplete:()=>p(!0),onAnimationStart:()=>p(!1),children:[e.jsx(Le,{children:tt}),e.jsx("div",{className:"flex items-center",style:{width:E,height:E},children:_?J?e.jsx(ys,{title:Ia.cancel,icon:e.jsx(hn,{className:$("animate-pulsing m-auto shrink-0",Z?"h-6 w-6":"h-10 w-10")}),isSmall:Z,opacity:1,size:E,onClick:()=>{S(null),r?.()}}):e.jsx(ht,{size:20,className:"text-token-text-secondary m-auto"}):e.jsx(os,{disableHeightAnimation:s,disableLabel:ye||!m,isCancelledScrubber:N,accelerator:be,isConfirming:g===be.id,opacity:m?void 0:1,isSmall:Z,size:E,onSubmit:M=>Ue(M,be),onClick:M=>ke(M,be)})})]})})});return l||ye?Ie:e.jsxs(e.Fragment,{children:[m&&e.jsx(Cs,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),Ie]})}const Ia=ls({cancel:{id:"Hov840",defaultMessage:"Cancel"}}),Da={type:"spring",bounce:.2,duration:.56},Ra=({clientThreadId:t,turn:n})=>{const s=fo();return e.jsxs(P.div,{className:"absolute start-0 end-0 top-0 z-10 -translate-y-full",children:[e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"bg-vert-light-gradient dark:from-token-main-surface-primary absolute inset-0 -top-5 dark:bg-linear-to-t dark:to-transparent"}),e.jsx(P.div,{className:"flex items-center py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,filter:"blur(8px)",transition:{delay:.4,duration:.72}},transition:Da,children:e.jsx(gn,{clientThreadId:t,onRequestCompletion:ho,groupedMessagesToRender:n.messageGroups,allGroupedMessages:n.messageGroups,allMessages:n.messages,isUserTurn:!0,isFinalUserTurn:!1,isFinalAssistantTurn:!1,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:s})})]},"user-message")},Na=({clientThreadId:t})=>{const{lastUserTurn:n,lastAssistantTurn:s}=Ct(t,l=>{const r=fs.getConversationTurns(l);let i=null,d=null;for(let c=r.length-1;c>0;c--){const u=r[c];if(!i&&u.role===$t.User?i=u:!d&&u.role===$t.Assistant&&(d=u),i&&d)break}return{lastUserTurn:i,lastAssistantTurn:d}}),a=n&&!s?.messages.some(l=>l.recipient?.startsWith(pn));return e.jsx(Le,{initial:!1,children:a&&e.jsx(Ra,{turn:n,clientThreadId:t})})},Pa=({isRequestActive:t=!1,clientThreadId:n,readonlyReason:s,onCancel:a,onSubmit:l,onSubmitAccelerator:r,acceleratorActions:i=[]})=>{const[d,c]=o.useState(!1),[u,h]=o.useState(""),[x,y]=o.useState(!0),m=U(),[b,w]=o.useState(!1),p=et(),g=v=>{l?.(v,u),h("")},S=v=>{if(v.nativeEvent.isComposing)return;const{metaKey:T,shiftKey:H,key:C}=v;C==="Enter"&&u.trim()&&!(H||T)&&(g(v),v.preventDefault())};return e.jsxs(e.Fragment,{children:[d&&!p&&e.jsx(Cs,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),e.jsx("div",{className:"relative mb-3 flex items-end justify-center",children:e.jsxs("div",{className:"relative mx-6 max-w-2xl flex-1",children:[e.jsx(Na,{clientThreadId:n}),e.jsx("div",{className:"flex flex-auto items-start",children:e.jsx("div",{className:$("dark:bg-token-main-surface-secondary flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 ps-6 pe-2",{"rounded-full":x,"rounded-2xl":!x,"bg-transparent":b}),children:e.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[e.jsx(Qo,{placeholder:m.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:t,value:u,className:$("text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent p-0 outline-0 focus:ring-0 focus-visible:ring-0",{"opacity-0":b}),maxRows:4,onChange:({target:{value:v}})=>h(v),onKeyDown:S,onHeightChange:(v,{rowHeight:T})=>y(Math.floor(v/T)<=1)}),u?e.jsx(P.button,{className:$("dark bg-token-main-surface-primary h-8 w-8 rounded-full text-center disabled:bg-[#D7D7D7]",{"self-end":!x}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:g,children:e.jsx($e,{className:"text-token-text-primary h-8 w-8"})}):(i?.length??0)>0&&e.jsx(ka,{disableHint:!0,isVisuallyHidden:s?.isReadonly&&!s.isStreaming,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:t,actions:i,onCancel:a,onExpandedChange:v=>{p||w(v),c(v)},onSubmit:r,right:0,bottom:4})]})})})]})})]})};function _a(t,n){const s=new Set(t.map(d=>d.id)),a=new Set(n.map(d=>d.id)),l=t.filter(d=>!a.has(d.id)).map(d=>({...d,diffStatus:Ft.REMOVED})),r=n.filter(d=>!s.has(d.id)).map(d=>({...d,diffStatus:Ft.ADDED})),i=t.filter(d=>a.has(d.id));return l.concat(r,i)}const Ha=t=>{const{textdocId:n}=t,s=Cn(a=>a?.resolveTempTextdocId[n]??n);return o.useMemo(()=>({...t,textdocId:s}),[s,t])};async function Ba({textdocId:t,newTitle:n}){n!=null&&await ue.safePost("/textdoc/{textdoc_id}/rename",{parameters:{path:{textdoc_id:t}},requestBody:{title:n}}).catch(s=>{hs.addError("renameCanvasTitle Error:",s)})}const Oa=({serverThreadId:t,textdocVersion:n,initialTitle:s="Untitled Document",isEditingTitle:a,setIsEditingTitle:l})=>{const r=xt(),{mutateAsync:i}=He({mutationKey:[t,"textdocs"],mutationFn:Ba,onMutate:async({textdocId:g,newTitle:S})=>{await r.cancelQueries({queryKey:[t,"textdocs"]});const v=r.getQueryData([t,"textdocs"]);return r.setQueryData([t,"textdocs"],T=>{if(!T)return T;const H=new Map(T.persistedTextdocVersionById),C=H.get(g);if(C){const R={...C,title:S??""};H.set(g,R)}const N=T.persistedTextdocVersions.map(R=>R.textdocId===g?{...R,title:S??""}:R),D=new Map(T.persistedTextdocById),I=D.get(g);if(I){const R={...I,title:S??""};D.set(g,R)}return{...T,persistedTextdocVersionById:H,persistedTextdocVersions:N,persistedTextdocById:D}}),{previousTextDocData:v}},retry:2,onError:(g,S,v)=>{v?.previousTextDocData&&r.setQueryData([t,"textdocs"],v.previousTextDocData),hs.addError("Error updating title:",g)},onSettled:()=>{r.invalidateQueries({queryKey:[t,"textdocs"]})}}),d=async g=>{n&&await i({textdocId:n.textdocId??"",newTitle:g})},[c,u]=o.useState(s),h=o.useRef(null),x=o.useRef(c),y=o.useRef(!1);o.useEffect(()=>{a&&h.current&&(h.current.focus(),h.current.select())},[a]);const m=g=>{u(g.target.value)},b=()=>{x.current=c},w=async()=>{y.current||await d(c),y.current=!1,l(!1)},p=g=>{(g.key==="Enter"||g.key==="Escape")&&g.preventDefault(),g.key==="Enter"?g.currentTarget.blur():g.key==="Escape"&&(u(x.current),y.current=!0,g.currentTarget.blur())};return e.jsx("input",{className:"w-[300px] rounded-lg border-none px-3 py-2 outline-hidden focus:ring-0",ref:h,value:c,onChange:m,onFocus:b,onBlur:w,onKeyDown:p,style:{fontSize:"1.125rem",boxSizing:"border-box",backgroundColor:"var(--global-states-light-element-hover, rgba(0, 0, 0, 0.05))"}})};function Ua(t){const{voiceName:n}=xn(),s=t?()=>Za(t.textdocId,n,Yo()):null,a=`${t?.textdocId}.${t?.versionInt}.${n}`;return Wo(s,a)}function Za(t,n,s){return ue.safeGet("/textdoc/{textdoc_id}/synthesize",{parameters:{path:{textdoc_id:t},query:{voice:n,format:s}},skipJsonTransform:!0})}const Fa=({textdocVersion:t,isPersisting:n=!1,isTextdocAttachedPending:s,isTextdocStreaming:a,hasDebug:l,shouldShowPlayButton:r=!1,hideRenameButton:i=!1,toggleDebugView:d,isDebugVisible:c,toggleConsoleVisibility:u,isConsoleOpen:h,clientThreadId:x})=>{const y=U();vn(),Ua(t);const[m,b]=o.useState(!1),w=t?.title??"",p=gs(x)??"",g=Je(t?.textdocId),S=!w||g?.status===yn.INFERRING,v=()=>{b(!0)},[T,H]=o.useState(!1),{container:C,triggerRef:N}=ps({isOpen:T,onClose:()=>H(!1)}),D=[!g&&!i&&!a?e.jsx(O.Item,{icon:wn,onClick:v,children:y.formatMessage({id:"z/PT9T",defaultMessage:"Rename"})},"rename"):null,null,r?e.jsx(O.Item,{icon:bn,onClick:u,children:h?y.formatMessage({id:"owGHqE",defaultMessage:"Close console"}):y.formatMessage({id:"GPb4WX",defaultMessage:"Open console"})},"console"):null,null].filter(Boolean);if(D.length===0)return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex h-6 grow items-center overflow-hidden",children:e.jsx(ve.Title,{className:"@[0px]:hidden @[150px]:block",children:S?e.jsx("div",{className:"w-52",children:e.jsx(es,{lines:1,size:"base",width:100,widthVariance:0})}):w})}),n&&e.jsx(ht,{size:12,className:"text-token-text-tertiary ps-1"})]});const I=t&&e.jsx(O.Portal,{container:C,children:e.jsx(O.Content,{onCloseAutoFocus:R=>R.preventDefault(),children:D})});return e.jsx(e.Fragment,{children:m?e.jsx(Oa,{serverThreadId:p,textdocVersion:t,initialTitle:w,isEditingTitle:m,setIsEditingTitle:b}):e.jsxs(e.Fragment,{children:[!1,e.jsxs(O.Root,{open:T,onOpenChange:H,children:[e.jsxs(O.Trigger,{ref:N,className:"hover:bg-token-surface-hover grid grid-cols-[1fr_auto] border-none bg-transparent! pe-2",children:[e.jsx(ve.Title,{className:"max-w-[270px] truncate overflow-hidden",children:S?e.jsx("div",{className:"w-52",children:e.jsx(es,{lines:1,size:"base",width:100,widthVariance:0})}):w}),e.jsx("div",{className:"flex items-center ps-1",children:n?e.jsx(ht,{size:12,className:"text-token-text-tertiary"}):e.jsx(Sn,{className:"icon-sm text-token-text-tertiary"})})]}),I]})]})})};function Va({textdocVersion:t,clientThreadId:n,color:s}){const{handleCopy:a,Icon:l,copyLabel:r}=Io({textdocVersion:t,clientThreadId:n});return e.jsx(je,{label:r,children:e.jsx(Be,{icon:l,onClick:a,color:s})})}function qa({textdocVersion:t,disabled:n}){const s=U(),{handleFileDownload:a,handleBlobDownload:l,isLoading:r,downloadCopyLabel:i,isDocument:d}=Do(t);return d?e.jsxs(O.Sub,{children:[e.jsx(O.SubMenuTrigger,{icon:Vt,label:i,disabled:r||n}),e.jsx(O.Portal,{children:e.jsxs(O.SubContent,{align:"end",children:[e.jsx(O.Item,{onClick:c=>{c.preventDefault(),a("pdf")},children:s.formatMessage({id:"canvas.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"})}),e.jsx(O.Item,{onClick:c=>{c.preventDefault(),a("docx")},children:s.formatMessage({id:"canvas.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"})}),e.jsx(O.Item,{onClick:c=>{c.preventDefault(),a("md")},children:s.formatMessage({id:"canvas.download-md-button.menu",defaultMessage:"Markdown Document (.md)"})})]})})]}):e.jsx(O.Item,{label:i,icon:Vt,disabled:r||n,onClick:l})}function Ga(t){for(const n of Ka){const s=t.match(n);if(s)return s[0]}return null}const Ka=[/AKIA[0-9A-Z]{16}/,/AIza[0-9A-Za-z_-]{35}/,/^(?:ghp_[A-Za-z0-9]{36}|github_pat_[A-Za-z0-9]{22}_[A-Za-z0-9]{59}|gho_[A-Za-z0-9]{36}|ghu_[A-Za-z0-9]{36}|ghs_[A-Za-z0-9]{36}|ghr_[A-Za-z0-9]{36})$/,/xox[baprs]-[0-9A-Za-z-]+/,/sk-[A-Za-z0-9]{48}/,/SK[0-9a-fA-F]{32}/,/(sk_live_[0-9a-zA-Z]{24})|(sk_test_[0-9a-zA-Z]{24})/,/-----BEGIN PRIVATE KEY-----/],za=`${Xo}...`;function Te(t){return["canvas","textdoc","share",t]}function Qa({isLoading:t,isPublishedVersionLatest:n,sharedTextdoc:s,textdocVersion:a,title:l}){const{textdocId:r}=a,[i,d]=o.useState(!1),c=Ga(a.content),u=(C,N)=>{C&&jn(C,void 0,N).then(()=>{d(!0),setTimeout(()=>{d(!1)},1500)}).catch(()=>{})},h=xt(),{mutate:x,isPending:y}=He({scope:{id:r},mutationFn:C=>ue.safePost("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:C}}}).then(N=>We(N.shared_textdoc)),onSuccess:C=>{h.setQueryData(Te(r),C),u(ut(C.sharedTextdocId))}}),{mutate:m,isSuccess:b}=He({scope:{id:r},mutationFn:C=>ue.safePost("/textdoc/shared/{shared_textdoc_id}/update_to_latest",{parameters:{path:{shared_textdoc_id:C}}}).then(N=>We(N.shared_textdoc)),onSuccess:C=>{h.setQueryData(Te(r),C)}}),{mutate:w}=He({scope:{id:r},mutationFn:({sharedTextdocId:C,access:N})=>ue.safePost("/textdoc/shared/{shared_textdoc_id}/update_access",{parameters:{path:{shared_textdoc_id:C}},requestBody:{shared_textdoc_access:N}}).then(D=>We(D.shared_textdoc)),onMutate:({access:C})=>{const N=Te(r),D=h.getQueryData(N);return h.setQueryData(N,D&&{...D,access:C}),{previousAccess:D?.access}},onSuccess:C=>{h.setQueryData(Te(r),C)},onError:(C,N,D)=>{const I=Te(r),R=h.getQueryData(I);h.setQueryData(I,R&&{...R,access:D?.previousAccess})}}),p=o.useRef(null),g=C=>{p.current?.focus(),s?(F.logButtonClick(Y.COPY_SHARE_LINK,_e(a)),u(ut(s.sharedTextdocId),C)):(F.logButtonClick(Y.CREATE_SHARE_LINK,_e(a)),x(r))},S=C=>{s&&(F.logButtonClick(C===An.PUBLIC?Y.UPDATE_SHARE_LINK_PUBLIC:Y.UPDATE_SHARE_LINK_PRIVATE,_e(a)),w({sharedTextdocId:s.sharedTextdocId,access:C}))},v=s?ut(s.sharedTextdocId):void 0,T=()=>{s&&(F.logButtonClick(Y.UPDATE_SHARE_LINK_TO_LATEST,_e(a)),m(s.sharedTextdocId))},H=c||s?.isAnonifyApiKeyDetected;return e.jsx(Jo,{inputRef:p,isLoading:t,isPublishedVersionLatest:n,sharedObject:s&&{id:s.sharedTextdocId,title:l,access:s.access,versionInt:s.versionInt,isModerationBlocked:s.isModerationBlocked,isAnonifyApiKeyDetected:s.isAnonifyApiKeyDetected},title:l,shareTextPlaceholder:za,shareUrl:v,isCopySuccessful:i,didPublishUpdates:b,isCreateLinkRequestInProgress:y,handleUpdateLatestSharedVersion:T,handlePrivacyChange:S,handlePrimaryButtonClick:g,maybeRenderWarndingContent:()=>e.jsx(e.Fragment,{children:H&&e.jsx(Ya,{})})})}function _e(t){return{textdocType:t.type,textdocId:t.textdocId}}function Wa({textdocVersion:t,isDisabled:n,title:s}){const a=go(),l=U(),r=t?.textdocId,{data:i,isLoading:d}=qs({enabled:!!r&&!n,queryKey:Te(r),queryFn:()=>!r||r.startsWith(In)?Promise.resolve(null):ue.safeGet("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:r}}}).then(p=>p.shared_textdoc&&We(p.shared_textdoc))}),[c,u]=o.useState(!1),{triggerRef:h,container:x}=ps({isOpen:c,onClose:()=>u(!1)}),y=a?.isWorkspaceAccount()&&!a?.features.includes(po.WorkspaceShareLinks);if(n||y||!t)return e.jsx(je,{label:y?l.formatMessage(mt.workspaceSharingDisabled):l.formatMessage(mt.share),children:e.jsx(Be,{disabled:!0,icon:qt})});const m=()=>{F.logButtonClick(Y.OPEN_SHARE_MENU,_e(t))},b=i?.versionInt===t.versionInt&&i?.title===t.title,w=({className:p})=>e.jsxs("div",{className:"relative h-fit w-fit",children:[e.jsx(qt,{className:p}),!b&&i&&e.jsx("div",{className:"absolute end-0 top-[1px] flex items-center gap-1.5",children:e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-blue-400"})})]});return e.jsxs(En,{open:c,onOpenChange:u,children:[e.jsx(je,{label:l.formatMessage(mt.share),children:e.jsx(Mn,{ref:h,asChild:!0,children:e.jsx(Be,{icon:w,onClick:m})})}),e.jsx(Le,{children:c&&e.jsx(Tn,{forceMount:!0,container:x,children:e.jsx(Ln,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:e.jsx(Qa,{title:s,sharedTextdoc:i,isLoading:d,isPublishedVersionLatest:b,textdocVersion:t})})})})]})}function Ya(){return e.jsx(kn,{type:"danger",className:"w-auto md:p-3",children:e.jsx(ft,{id:"8NG6sN",defaultMessage:"There may be an API key in your canvas. If you share the canvas, anyone with the link can see its contents."})})}function Xa({disabled:t=!1,isShowingChanges:n,onMouseEnter:s,onClick:a,onEsc:l}){const r=U(),i=o.useRef(null);return o.useEffect(()=>{if(n){const d=c=>{c.key==="Escape"&&(l?.(),i.current&&i.current===document.activeElement&&i.current.blur())};return window.document.addEventListener("keydown",d),()=>{window.document.removeEventListener("keydown",d)}}},[n,l]),e.jsx(je,{label:!t&&r.formatMessage(n?rs.hideChanges:rs.showChanges),children:e.jsx(Be,{icon:$o,ref:i,disabled:t,onClick:a,onMouseEnter:s,className:$("transition-colors enabled:hover:bg-black/5 dark:enabled:hover:bg-white/10",n&&Ko)})})}const rs=ls({showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}}),Ja=({clientThreadId:t,isHistoricalVersion:n,textdocVersion:s,readonlyReason:a,hasDebug:l,isEmbedded:r,isPersisting:i,isShowingChanges:d,hideRunCode:c=!1,hideHistoryActions:u=!1,hideRenameButton:h=!1,onHoverPrevious:x,onHoverShowChanges:y,onToggleShowChanges:m,onClickPrevious:b,onClickNext:w,onClickCodePreview:p,onClose:g,toggleDebugView:S,toggleConsoleVisibility:v,isCodeRunning:T,isTextdocAttachedPending:H,isTextdocStreaming:C,isConsoleOpen:N,isDebugVisible:D})=>{const I=U(),R=Co(),ee=Je(s?.textdocId),te=s?.title??"",{isCodePreviewable:X,isCodeExecutable:V,hasCanvasCodeExecution:z}=vs(s),pe=!c&&(X||V),Z=s?.versionInt,E=Z!=null&&Z>1,Ce=n,ye=!u,Ae=X&&T,G=s==null||ee!=null||n||a.isStreaming,_=s==null||a.isStreaming;return e.jsxs(ve.Header,{className:$("@container",X&&T&&"bg-transparent!"),children:[e.jsx(ve.CloseButton,{onClick:g}),e.jsx("div",{className:"@container flex flex-1 basis-0 items-center truncate leading-[0]",children:e.jsx(Fa,{hasDebug:l,isConsoleOpen:N,isDebugVisible:D,toggleConsoleVisibility:v,toggleDebugView:S,isPersisting:i,textdocVersion:s,isTextdocAttachedPending:H,isTextdocStreaming:C,shouldShowPlayButton:pe,hideRenameButton:h,clientThreadId:t})}),e.jsxs("div",{className:"flex min-w-0 basis-auto items-center leading-[0] select-none",children:[e.jsx(Va,{clientThreadId:t,textdocVersion:s}),e.jsx(Wa,{isDisabled:G,textdocVersion:s,title:te}),ye&&e.jsx(Le,{children:e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,width:0},transition:{type:"spring",bounce:.24,duration:.4},children:e.jsx(Xa,{disabled:Ae||a.isStreaming||!E,isShowingChanges:d,onMouseEnter:y,onClick:m,onEsc:m})})}),e.jsxs(O.Root,{children:[e.jsx(O.BasicTrigger,{children:e.jsx(Be,{icon:xo})}),e.jsx(O.Portal,{children:e.jsxs(O.Content,{align:"end",children:[e.jsx(O.Item,{icon:Dn,disabled:!E,onClick:b,onMouseOver:x,label:I.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"})}),e.jsx(O.Item,{icon:Rn,disabled:!Ce,onClick:w,label:I.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"})}),e.jsx(O.Group,{children:s&&s.type!==Ne.LOADING&&ee==null&&e.jsx(qa,{disabled:_,textdocVersion:s})})]})})]}),pe&&e.jsx(Uo,{clientThreadId:t,isCodePreviewable:X,isDisabled:!z||a.isTextdocStreaming&&!T,disabledTooltip:z?void 0:I.formatMessage({id:"NTZRWe",defaultMessage:"Code execution for canvas is disabled for your workspace. Contact your admin to enable."}),onClick:p,isCodeRunning:T}),!r&&!R&&e.jsx(ea,{clientThreadId:t})]})]})};function $a(t){const n=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,s=new Set,a=t.matchAll(n);for(const l of a){const r=l[2];try{let i=r;i.startsWith("www.")&&(i="http://"+r),new URL(i),s.add(r)}catch{}}return s}const ei=async({lastVersion:t,textdocId:n,content:s,comments:a})=>{const l=Nn(a,s);return(await ue.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:n}},requestBody:{version:t,content:s,comments:l}})).version},ti=()=>{const t=o.useRef([]),n=o.useRef(null),{mutateAsync:s,isPending:a}=He({mutationKey:["canvas","textdoc","persist"],mutationFn:ei});return[o.useCallback(async(r,i,d)=>{const c=new AbortController,h=(async()=>{const[b]=t.current;try{await b?.promise}catch(w){F.logError("Saving document",w)}if(!c.signal.aborted)try{const w=Math.max(n.current??0,r.versionInt??us);let p="";try{ns(i)?p=i():p=i}catch(T){F.logError("Serializing document",T)}let g=[];try{ns(d)?g=d():g=d}catch(T){F.logError("Adjusting comments",T)}const{textdocId:S}=r;Pn({textdocId:S,basedOnVersionInt:w,content:p,comments:g});const v=await s({textdocId:S,lastVersion:w,content:p,comments:g});_n({textdocId:S,basedOnVersionInt:w,newVersion:v}),n.current=v}catch(w){F.logError("Error saving document",w)}finally{t.current.shift()}})(),x={abort:()=>c.abort(),promise:h},[y,m]=t.current;return m&&(m.abort(),t.current=y?[y]:[]),t.current=y?[y,x]:[x],h},[s]),t,a]},si=3e3,ni=t=>{const[n,s,a]=ti(),l=U(),r=o.useRef(null),i=o.useCallback(vo(async(u,h,x)=>{if(!gt(u))return n(u,h,x);Xe.replaceTempTextdocContent(u.textdocId,typeof h=="string"?h:h())},si,{leading:!1}),[n]),d=Hn(t);return o.useEffect(()=>{if(!d)return;const u=pt(window,{pagehide:()=>i.flush(),beforeunload:x=>{i.flush(),x.returnValue=l.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),h=pt(document,{visibilitychange:()=>i.flush(),keydown:()=>{r.current="keyboard"},mousemove:()=>{r.current!=="mouse"&&i.flush(),r.current="mouse"}});return()=>{r.current=null,h(),u()}},[l,d,i]),o.useEffect(()=>()=>{i.flush()},[t,i]),yo(async()=>{await i.flush(),await Promise.allSettled(s.current?.map(({promise:u})=>u)??[])}),[o.useCallback((u,h,x)=>{const{textdocId:y}=u;return gt(u)||Bn(y),i(u,h,x)},[i]),i.flush,a||d]};function oi(t,n,s){const a=xt(),l=s!=null&&n!=null,{data:r,error:i,fetchNextPage:d,hasNextPage:c,isFetching:u}=Gs(cs(t,n,l)),h=o.useCallback(async()=>{const w=n!=null;await a.prefetchInfiniteQuery(cs(t,n,w))},[a,t,n]);o.useEffect(()=>{const w=n;return()=>{a.removeQueries({queryKey:ws(t,w),exact:!0})}},[a,t,n]);const[x,y,m,b]=o.useMemo(()=>{if(r&&s){const p=r.pages.flatMap(S=>S),g=p.findIndex(S=>"beforeVersion"in s?(S.versionInt??us)<s.beforeVersion:S.versionInt===s.version);if(g!==-1)return[g===p.length-1,p[g],g>0?p[g-1]:null,g<p.length-1?p[g+1]:null]}const w=r?.pages.flatMap(p=>p)??[];return[!0,null,null,w.length===0?null:w[0]]},[r,s]);return o.useEffect(()=>{!u&&l&&c&&x&&d()},[u,l,c,x,d]),o.useEffect(()=>{!y&&i&&Pe(t)},[y,i,t]),{historicalTextdocVersion:y,nextHistoricalTextdocVersion:m,prefetchHistoricalTextdocVersion:h,previousHistoricalTextdocVersion:b}}function ws(t,n=null){return["textdocHistory",t,n]}function cs(t,n,s=!0){return{queryKey:ws(t,n),queryFn:({pageParam:a})=>ai(t,a),initialPageParam:n??void 0,getNextPageParam:a=>{const l=wo(a)?.versionInt;if(l&&l>1)return l},enabled:s,staleTime:1/0,retry:2}}async function ai(t,n){return n===void 0||n<=1?[]:(await ue.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:t},query:{before_version:n}}})).previous_doc_states.map(({id:a,version:l,textdoc_type:r,title:i,content:d,updated_at:c,comments:u,metadata:h})=>({textdocId:a,versionInt:l,messageId:null,title:i,type:Un(r),content:d,status:ds.COMPLETE,createdAt:bo(c),comments:On(u,d),metadata:{content_references:h?.content_references}}))}const Li=({isFullScreen:t=!1,isEmbedded:n=!1,hideHeader:s=!1,hideRunCode:a=!1,isReadonlyFromQueryParam:l=!1,hideRenameButton:r=!1,clientThreadId:i,focusedTextdoc:d,onClose:c,isAnimating:u=!1,width:h,hideBottomComposer:x=!1})=>{const y=So(),{textdocId:m,history:b,showChangesAtVersion:w=null,shouldRunCodeOnOpen:p=!1}=Ha(d),g=U(),[S,v,T]=ni(m),{targetedContent:H}=Zn(),C=Fn(),[N,D]=o.useState(!1),[I,R]=o.useState(!1),ee=Vn(m),te=qn(),X=Ct(i,fs.getRequestId),V=Eo(X),{data:z,isLoading:pe}=Gn(m,w),[Z,E]=o.useState(!1),[Ce,ye]=o.useState(null),Ae=Kn(i),G=o.useRef(null),_=ee?.versions??[],J=_[0]?.versionInt,{historicalTextdocVersion:me,nextHistoricalTextdocVersion:we,previousHistoricalTextdocVersion:be,prefetchHistoricalTextdocVersion:Oe}=oi(m,J,b),fe=zn();o.useEffect(()=>{Ye.reset()},[m]);const oe=_.length>0?_[_.length-1]:null,ae=_.length>1?_[_.length-2]:null,ke=gs(i),{restoreHistoricalTextdocVersion:Ue,optimisticRestoredTextdocVersion:tt}=Qn(ke,oe,me),le=b!=null,L=le?me:oe,Q=w!=null,he=Ys(i,L),Ie=u?null:z,A=(()=>{if(u||L==null)return[];const j=ts(L.comments);return!Q&&me!=null?me.comments:!Q||z==null?j:z.contentBefore!==z.contentAfter?[]:_a(z.commentsBefore,z.commentsAfter)})(),k=L?.type??Ne.LOADING,ge=Wn(),De=gt(L),K=Yn(L),de=Xn(L),Se=Jn(L),st=Se&&!n,bs=ss(te),Ss=ss(V);o.useEffect(()=>{!De&&_.length===0&&ge!==Gt.NATIVE&&(!te&&bs.current||!V&&Ss.current||!te&&!V)&&c?.()},[_.length,te,V]);const{content:W,currentlyStreamingLineIndex:vt}=z?.contentBefore!=null&&!Kt(k)?{content:z.contentBefore,currentlyStreamingLineIndex:null}:Ro(L,ae),Es=$n(ke,Array.from($a(W))),[Ze,nt]=oa({value:W,isRequestActive:V,isTextdocStreaming:K,comments:A}),yt=eo(L),wt=ge===Gt.LAST_TURN||Ze||T;o.useEffect(()=>{to().sendMessage({type:xs.Streaming,streaming:wt})},[wt]);const Ms=({getSerializedDocument:j,getAdjustedComments:B})=>{L&&S(L,j,B)},Ts=j=>{if(!L)return;const B=j.doc.toString();S(L,B,j.field(tn,!1)??[])},bt=(j,B,re,ce,Ee)=>{nt(!0),he({sourceEvent:j,action:re,content:B,userMessageType:Ke.ASK_CHATGPT,sourceRange:ce,selectionMetadata:{selection_type:Ee,selection_position_range:ce}})},St=({id:j})=>{yt(j,Wt.DISMISS),Ye.reset()},Et=async(j,B)=>{nt(!0);const{id:re,at:ce,content:Ee}=B;if(await yt(re,Wt.ACCEPT)===!1)return nt(!1);he({sourceEvent:j,content:Ee,userMessageType:Ke.ACCEPT_COMMENT,sourceRange:ce,action:q.EDIT,selectionMetadata:{selection_type:Zt.SELECTION,selection_position_range:ce}})},ot=(j,B,re,ce)=>{const{action:Ee}=ce;he({sourceEvent:j,action:Ee,content:re,sourceRange:B,userMessageType:Ke.ACCELERATOR,acceleratorMetadata:{action:Ee,id:ce.id,prompt:re},selectionMetadata:B!=null?{selection_type:Zt.SELECTION,selection_position_range:B}:void 0})},Ls=(j,B)=>{he({sourceEvent:j,action:q.EDIT,content:B,userMessageType:Ke.FULL_SCREEN_SUBMIT})},js=so(),Mt=j=>js?.[j]??j,at=()=>Mo(i,void 0,!0),As=()=>{b?ze(m,b):Pe(m)},se=Zo({streamingSource:ge,isRestoring:tt!=null,isRequestActive:V,isTextdocStreaming:K,isReadonlyFromQueryParam:l,isHistoricalVersion:le,isShowingChanges:Q});let Fe=null;const Tt=u||se.isReadonly||Ze,Ve=ms()||Ae||l||De,Lt=()=>u&&A.length>0?Me.ALL_HIDDEN:Ve?Me.COMMENTS_READONLY:se.isReadonly?se.isStreaming?Me.ENABLED:se.isReadonlyFromQueryParam||se.isShowingChanges||se.isHistoricalVersion?Me.COMMENTS_READONLY:Me.ALL_HIDDEN:Me.ENABLED,ks=o.useCallback(async j=>{const{suggestion:B}=await ue.safePost("/textdoc/{textdoc_id}/autocomplete",{parameters:{path:{textdoc_id:m}},requestBody:{content:j}});return B},[m]),jt=t||u||l;let it=[];switch(k){case Ne.LOADING:Fe=e.jsx(_o,{});break;case Ne.DOCUMENT:Fe=e.jsx(Po,{value:W,comments:A,previousValue:ae?.content,getAutocompleteSuggestion:ks,previousComments:ts(ae?.comments),isRewriting:de,isAnimatingFromPreview:u,isSendDisabled:Ve,getStableCommentId:Mt,diff:Ie,isRequestActive:V,isDisabled:se.isReadonly||te,isWaitingForCommentResponse:Ze,hideAccelerators:jt,hideToolbar:Tt,hideEditOverlay:u,commentsMode:Lt(),readonlyReason:se,onBlur:v,onSave:v,onChange:Ms,onCancelRequest:at,targetedContent:H,onAddComment:bt,onAcceptComment:Et,onDismissComment:St,onSubmitAccelerator:ot,onExitShowChanges:As,safeUrls:Es,width:h,modelCursor:Se||K&&!de?L?.modelCursor:void 0,shouldResetSelection:L?.versionInt===1,metadata:ee?.metadata}),it=ha;break;default:Kt(k)&&(Fe=e.jsx(No,{id:"codemirror",getStableCommentId:Mt,language:Fo(k),value:W,comments:A,hideAccelerators:jt,commentsMode:Lt(),hideToolbar:Tt,onSubmitAccelerator:ot,currentlyStreamingLineIndex:vt??null,readonlyReason:se,isRequestActive:V,isSendDisabled:Ve,isWaitingForCommentResponse:Ze,onChange:Ts,onCancelRequest:at,onAddComment:bt,onBlur:v,onSave:v,codemirrorRef:G,onDismissComment:St,onAcceptComment:Et,textdocDiff:Ie??void 0,modelCursor:K&&vt==null?L?.modelCursor:void 0}),it=na)}const Re=o.useRef(null),rt=o.useRef(null),{hasCanvasCodeExecution:ct,isCodeExecutable:At,isCodePreviewable:ie}=vs(L),kt=ct&&ie,It=ct&&At,Is=no(),Dt=o.useCallback(()=>{!Z&&(kt||It)?(E(!0),Re.current?.runCode(k,W)):(Re.current?.stopCode(),E(!1))},[kt,It,Z,W,k]),Rt=oo(()=>{Dt()});o.useEffect(()=>{p&&Rt()},[p,Rt]);const ne=L?.versionInt,Ds=ne!=null&&ne>1,Rs=le,qe=be?.versionInt,lt=we?.versionInt,Ns=()=>{Q?b?ze(m,b):Pe(m):(F.logButtonClick(Y.SHOW_CHANGES,{textdocType:k,textdocId:m,versionInt:ne,latestVersionInt:J}),ne&&Yt(m,ne,b))},Ps=()=>{F.logButtonClick(Y.HISTORY_PREVIOUS,{textdocType:k,textdocId:m,versionInt:ne,latestVersionInt:J,isShowingChanges:Q}),m&&ne&&Ds&&ze(m,{beforeVersion:ne},Q&&qe!=null?qe:void 0)},_s=()=>{F.logButtonClick(Y.HISTORY_NEXT,{textdocType:k,textdocId:m,versionInt:ne,latestVersionInt:J,isShowingChanges:Q}),Rs&&(lt?ze(m,{version:lt},Q?lt:void 0):Q&&J?Yt(m,J,null):Pe(m))},Hs=To(y,"1804926979"),Nt=Ct(i,sn(m)),Bs=Lo(),Pt=Je(L?.textdocId),Os=!s&&e.jsx(Ja,{hideRunCode:a,clientThreadId:i,isHistoricalVersion:le,textdocVersion:L,readonlyReason:se,hasDebug:C,isEmbedded:n,isPersisting:T,isShowingChanges:Q,isConsoleOpen:I,isDebugVisible:N,hideHistoryActions:l,hideRenameButton:r,onHoverPrevious:()=>{Oe(),qe&&fe(m,qe)},onHoverShowChanges:()=>{Oe(),ne&&fe(m,ne)},onToggleShowChanges:Ns,onClickPrevious:Ps,onClickNext:_s,toggleDebugView:()=>D(j=>!j),toggleConsoleVisibility:()=>{I||ko.logEvent("Canvas Open Console Clicked"),R(j=>!j)},onClose:()=>{if(F.logButtonClick(Y.CLOSE_TEXTDOC,{textdocType:L?.type}),Pt&&!t){const{create_source:j,hasUserEdits:B,tempTextdocId:re}=Pt;if(B&&j!==Qt.USER_CREATED_COMPOSER){Bt(!0);return}if(Xe.removeTempTextdoc(re),j===Qt.USER_CREATED_COMPOSER){const ce=jo(Bs);Ao(ce,W)}}c?.()},onClickCodePreview:Dt,isCodeRunning:Z,isTextdocStreaming:K,isTextdocAttachedPending:zt(L)});let _t=null;const Ge=!a&&ct&&(At||ie),dt=Vo(k,W);o.useEffect(()=>{Ge&&dt&&rt.current?.prepareEnvironment(W,dt)},[Ge,dt]),o.useEffect(()=>{ie&&Z&&!K&&Re.current?.runCode(k,W)},[ie,K,W,k]);const Ht=L?.title??"";Ge&&(_t=e.jsx(Xs,{id:m,title:Ht,onChangeBackgroundColor:ye,onCodeRunComplete:()=>E(!1),visuallyHidden:!ie||!Z,disableNetworkRequests:!Is,networkAccessDeniedMessage:g.formatMessage({id:"GE4AJf",defaultMessage:"Network requests in canvas are disabled for your workspace. Contact your admin to enable this feature."}),enableTransition:ie&&k!==Ne.CODE_HTML,isCodeUpdating:K,ref:rt,onRetryCodeRun:()=>Re.current?.runCode(k,W)}));const[Us,Bt]=o.useState(!1),Ot=e.jsx(ta,{isOpen:Us,dismissModal:()=>Bt(!1),closeTextdocEditor:()=>{c?.()},textdocVersion:L,clientThreadId:i}),Ut=e.jsxs(e.Fragment,{children:[Os,e.jsx(ve.Content,{scrollToBottomMode:st?"bottom":"top",shouldScrollToTop:de,isLoading:pe,hideChildren:ie&&Z,overlay:_t,children:Fe}),Ge&&e.jsx(Js,{ref:Re,sandboxRef:rt,textdocId:m,textdocTitle:Ht,textdocContent:W,isTextdocAttachedPending:zt(L),highlightLine:j=>G.current?.highlightLine(j),isRequestActive:V,createTextdocTurn:he,isOpen:I,onOpenChange:R}),e.jsx(Le,{children:le&&!l&&e.jsx(aa,{onClickRestore:Ue,onClickResetLatest:()=>Pe(m)})}),t&&!le&&!x&&!(Z&&ie)&&!Ve&&e.jsx(Pa,{isRequestActive:V,clientThreadId:i,onSubmitAccelerator:ot,onSubmit:Ls,onCancel:at,readonlyReason:se,acceleratorActions:it})]});if(Hs&&Nt&&L){const B=new URLSearchParams(window.location.search).get($s),re=B==null?void 0:parseInt(B);return e.jsxs(e.Fragment,{children:[Ot,e.jsx(ve,{previewBackgroundColor:Ce,isPreviewingCode:ie&&Z,children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"relative flex h-full min-h-0 flex-auto grow flex-col",children:Ut}),e.jsx(en,{hiveId:Nt,clientThreadId:i,textdocVersion:L,ts:re})]})})]})}return e.jsxs(e.Fragment,{children:[Ot,e.jsx(ve,{previewBackgroundColor:Ce,isPreviewingCode:ie&&Z,children:Ut})]})};export{xs as C,ka as D,fa as S,Li as T,na as a,Mi as b,ha as c,Ti as d,ga as g,pa as i,Ca as u};
//# sourceMappingURL=b5mk7g3hp5gwjh3g.js.map
