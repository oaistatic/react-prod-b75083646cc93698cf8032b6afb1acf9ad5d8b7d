const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ek8tw7jcf795a9mu.js","assets/lu2xqwqmjc95q6j6.js","assets/hml6mmd5fyx85si7.js","assets/root-c0w5lvnh.css","assets/rseqzngxzbdt1oxg.js","assets/conversation-small-gcvo4yhm.css","assets/lcspqrt8w4x3pxb4.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{eT as M,d as _,aN as R,gw as x,gv as b,mU as P,fH as F,hk as L,V as O,bg as W,ap as H,aq as V,T as U}from"./hml6mmd5fyx85si7.js";import{r as c,j as n,M as j,m as G,l as z,e as q,o as Q}from"./lu2xqwqmjc95q6j6.js";import{F as Z}from"./f9e1nwa9sca240c5.js";import{bR as B,ei as J,i8 as K,cl as X,b_ as C,al as v,iO as Y,iP as $,iQ as ee,iR as te,d_ as ne,gZ as se}from"./rseqzngxzbdt1oxg.js";import"./ik8y7nlve9mzjttb.js";import"./isxemcalu9537a8n.js";import"./lsmgulr8t4c2ohfe.js";import"./fd9rmcpa6ai71fe6.js";import"./e0pswmo7irlt62pp.js";import"./lierpdayeoiwatcw.js";import"./gnhjnh2n0u3gy6qx.js";import"./ejklrllfl9wcn2za.js";import"./iq82wz84d1fxj03i.js";import"./elolu96rnfzqcgif.js";import"./kcqshnk26ykm1u4n.js";import"./fibktxptqydbr54o.js";import"./6a3e5rtr9pyzi31y.js";import"./ogr5nmy9hq7gfgq0.js";import"./cqyjjngibokvfw83.js";import"./irf8dojj8b02f534.js";import"./f251sy8gvgjvi4td.js";import"./fi4t5vltimyk5jia.js";import"./6638cdnddimyz0n0.js";import"./owyq2pc3j9e6vumq.js";import"./on8091w14zfmyea2.js";import"./ga4ehq2rdu1q6u65.js";import"./lao8y60wfyizx9bl.js";function ae(){const[e,s]=c.useState({undoStack:[],currentIndex:-1});function a(t){s(r=>({undoStack:[...r.undoStack.slice(0,r.currentIndex+1),t],currentIndex:r.currentIndex+1}))}function d(){s(t=>({undoStack:t.undoStack,currentIndex:Math.max(t.currentIndex-1,-1)}))}function i(){s(t=>({undoStack:t.undoStack,currentIndex:Math.min(t.currentIndex+1,t.undoStack.length-1)}))}function o(){s({undoStack:[],currentIndex:-1})}return{currentDrawnShape:e.undoStack.length>0?e.undoStack[e.currentIndex]:null,onNewDrawnShape:a,canUndoDrawing:e.currentIndex>=0,undoDrawing:d,canRedoDrawing:e.currentIndex<e.undoStack.length-1,redoDrawing:i,clearAllDrawings:o}}function ie({mode:e,imageIndex:s,allImages:a,onSwitchImage:d,isLoadingNewImage:i}){const o=s>0,t=c.useCallback(()=>{o&&d(a[s-1])},[o,a,s,d]),r=s<a.length-1,l=c.useCallback(()=>{r&&d(a[s+1])},[r,a,s,d]);return c.useEffect(()=>{function g(u){u.target instanceof HTMLTextAreaElement||e==="default"&&(u.key==="ArrowLeft"?t():u.key==="ArrowRight"&&l())}return document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}},[e,t,l]),n.jsx("div",{className:"text-token-text-secondary flex h-16 w-full items-center justify-center gap-3 font-semibold",children:e==="inpaint"?!i&&n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(j,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),n.jsx("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:n.jsx(M,{className:"icon"})})]}):a.length>1?n.jsxs(n.Fragment,{children:[n.jsx("button",{disabled:!o,className:"disabled:text-token-text-tertiary",onClick:t,children:n.jsx(B,{className:"icon"})}),n.jsx("div",{children:n.jsx(j,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:s+1,numImages:a.length}})}),n.jsx("button",{disabled:!r,className:"disabled:text-token-text-tertiary",onClick:l,children:n.jsx(J,{className:"icon"})})]}):null})}const oe=0,re=64;function ce({imageAsset:e,children:s,containerDimensions:a,isLoadingNewImage:d}){return n.jsxs(G.div,{className:"absolute",style:de(e,a),...K,children:[s,n.jsx("div",{className:_("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",d?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function de(e,s){const{width:a,height:d}=e,{width:i,height:o}=s,t=i-2*oe,r=o-2*re,l=a/d,g=t/r,u=l>g,p=u?t:r*l,f=u?t/l:r,h=(o-f)/2,y=(i-p)/2;return{top:h,left:y,width:p,height:f}}const ue=H(()=>V(()=>import("./ek8tw7jcf795a9mu.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>e.DynamicDrawingCanvas));function We({clientThreadId:e,messageId:s,image:a,allImages:d}){const i=R(e,U.getCurrentNode),o=[x.Dalle,x.t2uay3k].includes(b(i.message))&&!P(i.message),t=z();return c.useEffect(()=>{async function r(l,g){try{const u=await X(t,l);C.setFocusedObject({type:v.Image,image:u[0],allImages:u,messageId:g})}catch(u){O.addError(new Error("Failed to load newly created images:",{cause:u}))}}if(i!=null&&[x.Dalle,x.t2uay3k].includes(b(i.message))&&i.message.content.content_type===F.MultimodalText){const l=L.getImageAssetPointers(i.message);r(l,i.id)}},[t,i]),n.jsx(le,{image:a,allImages:d,isLoadingNewImage:o,clientThreadId:e,messageId:s})}function le({image:e,allImages:s,isLoadingNewImage:a,clientThreadId:d,messageId:i}){const[o,t]=c.useState("default"),[r,l]=c.useState({width:window.innerWidth-Z,height:window.innerHeight}),g=c.useRef(null),[u,p]=c.useState(136),f=ae(),{currentDrawnShape:h,onNewDrawnShape:y,clearAllDrawings:A}=f,k=c.useRef(null),E=q(),S=W(),{setTargetedContent:w}=Y();c.useEffect(()=>{const m=new ResizeObserver(I=>{const{width:D,height:N}=I[0].contentRect;l({width:D,height:N})});return g.current&&m.observe(g.current),()=>{m.disconnect()}},[]),c.useEffect(()=>{function m(I){I.key==="Escape"&&(o==="inpaint"?t("default"):C.close())}return document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m)}},[o]),c.useEffect(()=>(h==null?w({type:"object",placeholderTextOverride:Q({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit imageâ€¦"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:m=>$(m,e)}):w({type:"object",label:E.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async m=>await ee(m,e,k.current?.getImageData(),E,S),onCleared:()=>t("default")}),()=>{w(void 0)}),[e,E,w,h,S]),c.useEffect(()=>{o!=="inpaint"&&A()},[o]),c.useEffect(()=>{t("default")},[e]);const T=s.findIndex(m=>m.asset_pointer===e.asset_pointer);return n.jsxs("div",{ref:g,className:"flex h-full w-full flex-col justify-between",children:[n.jsx(te,{imageAsset:e,mode:o,setMode:t,clientThreadId:d,messageId:i,cursorWidth:u,setCursorWidth:p,inpaintingDrawingState:f,isLoadingNewImage:a}),n.jsx(ie,{mode:o,imageIndex:T,allImages:s,onSwitchImage:m=>{C.setFocusedObject({type:v.Image,image:m,allImages:s,messageId:i})},isLoadingNewImage:a}),n.jsxs(ce,{imageAsset:e,containerDimensions:r,isLoadingNewImage:a,children:[n.jsx(ne,{className:"h-full w-full",alt:se(e),src:e.url,width:e.width,height:e.height,fadeIn:!1}),o==="inpaint"&&n.jsx("div",{className:"absolute inset-0",children:n.jsx(ue,{drawingCanvasRef:k,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:u,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:h,onNewDrawnShape:y})})]})]})}export{We as ImageEditor};
//# sourceMappingURL=km3rlbhpk1cjsz2v.js.map
