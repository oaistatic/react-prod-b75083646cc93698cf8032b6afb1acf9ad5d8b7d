import{R as V,e7 as W,b5 as O,P as q,bg as Q,cX as X,V as k,lI as Y}from"./hml6mmd5fyx85si7.js";import{e as P,r as f,j as c,M as $,h as C,an as K,a as U}from"./lu2xqwqmjc95q6j6.js";import{c as l,S as N,F as v,a as D,C as L,L as G}from"./gwgozeiaqx1b8zio.js";import{u as Z}from"./i4sx5w9qnb2pqgar.js";import{mu as H,mv as J,d9 as ee,dq as ae,mw as I,aK as te,dv as re,dy as se,dk as T,mx as oe,dz as ne}from"./rseqzngxzbdt1oxg.js";import{u as ce}from"./n39npmecfg2nmjo7.js";import{a as le,b as ie}from"./fibktxptqydbr54o.js";import{u as me,B as ue}from"./gj7sgonhawtpcg3l.js";import{S as pe}from"./dy6grwmx1xskr6sg.js";import"./m68celnbq0esehhj.js";import"./iej0cupg2dqkmejt.js";import"./imrgbs6xko452vv3.js";const j="country_code",x="step",M=r=>V.safePost("/accounts/pending_team_workspace",{requestBody:r}),de=({formData:r,onNext:p})=>{const a=P(),[t,m]=f.useState({role:r.role??"",department:r.department??""}),[n,d]=f.useState({}),g=(e,o)=>{m(y=>({...y,[e]:o})),d(y=>({...y,[e]:""}))},S=f.useMemo(()=>{const e=H.map(o=>({label:a.formatMessage(o.displayValue),value:o.id}));return e.sort((o,y)=>o.label.localeCompare(y.label)),e},[a]),s=f.useMemo(()=>{const e=J.map(o=>({label:a.formatMessage(o.displayValue),value:o.id}));return e.sort((o,y)=>o.label.localeCompare(y.label)),e},[a]),i=f.useMemo(()=>[{formType:"select",label:a.formatMessage(l.roleLabel),name:"role",placeholder:a.formatMessage(l.rolePlaceholder),value:t.role,onChange:e=>g("role",e),error:n.role,required:!0,options:s},{formType:"select",label:a.formatMessage(l.workspaceDepartmentLabel),name:"department",placeholder:a.formatMessage(l.workspaceDepartmentPlaceholder),value:t.department,onChange:e=>g("department",e),error:n.department,required:!0,options:S}],[S,n.department,n.role,t.department,t.role,a,s]),u=()=>{const e={};return i.forEach(o=>{o.required&&!t[o.name]&&(e[o.name]=a.formatMessage(l.fieldRequired,{fieldName:o.label}))}),d(e),Object.values(e).every(o=>!o)};return c.jsx(N,{content:c.jsxs(v,{title:a.formatMessage(l.tellUsAboutWorkStepTitle),subTitle:a.formatMessage(l.tellUsAboutWorkStepSubtitle),children:[c.jsx("div",{className:"flex flex-col gap-6",children:i.map(e=>f.createElement(D,{...e,key:e.name}))}),c.jsx(L,{onClick:async()=>{u()&&await p(t)}})]})})},fe={input:"rounded-full!",button:"rounded-full! h-8! w-8! border-none!",buttons:"absolute end-2! gap-0!"},ge=({onNext:r,onPrevious:p,pendingWorkspace:a,initialBillingDetails:t,formData:m})=>{const n=P(),d=ee(),{annualBillingPlan:g}=ae(t.currency),S=Math.floor(100-g.discountedMonthlyCost/g.monthlyCost*100),{selectedPlan:s,setSelectedPlan:i,numSeats:u,setNumSeats:e,promoData:o,TEAM1DOLLAR_COUPON_IsEligible:y,TEAM_FREE_TRIAL_COUPON_IsEligible:_}=me({initialSeats:m?.numSeats,initialPromoCoupon:new URLSearchParams(a?.query_params??"").get(I)??void 0}),h={priceInterval:s,billingDetails:t,numSeats:u,promoData:o},w=y||_,E=y?l.oneDollarPromoTitle:_?l.freeTrialPromoTitle:l.purchaseStepTitle,A=y?l.oneDollarPromoSubtitle:_?l.freeTrialPromoSubtitle:void 0,z=te(isNaN(u)?0:u,d,re);return c.jsx(N,{onPrevious:p?()=>p({...h}):void 0,content:c.jsxs(v,{title:n.formatMessage(E),subTitle:A&&n.formatMessage(A),children:[c.jsxs("div",{className:"flex flex-col gap-6",children:[c.jsx(se,{numSeats:u,minSeats:d,setNumSeats:e,classNames:fe,label:c.jsx($,{...l.seatsCountLabel})}),c.jsxs("div",{className:"flex flex-col gap-1.5",children:[c.jsx(G,{required:!0,children:n.formatMessage(l.planSummaryTitle)}),c.jsxs("div",{className:"border-token-border-default flex flex-col gap-6 rounded-3xl border p-5",children:[!(w&&s===T.FLEXIBLE)&&c.jsx(pe,{ariaLabel:n.formatMessage(l.planTypeLabel),leftItem:{label:c.jsx("div",{className:"flex flex-wrap justify-center gap-1 text-center",children:n.formatMessage(l.annualPlanLabel,{percent:S,span:B=>c.jsx("span",{className:"text-[#10A37F]",children:B})})}),value:T.ANNUAL},rightItem:{label:n.formatMessage(l.monthlyPlanLabel),value:T.FLEXIBLE},value:s,onChange:i}),c.jsx(ue,{numSeats:z,selectedPlan:s,billingDetails:t,totalLabel:l.allPlansTodayTotal,billDate:n.formatMessage(l.today),promoData:o})]})]})]}),c.jsx(L,{onClick:()=>r({...h})})]})})},ye=({formData:r,onNext:p,onPrevious:a})=>{const t=P(),[m,n]=f.useState({workspaceName:r.workspaceName??"",companySize:r.companySize??""}),[d,g]=f.useState({}),S=(e,o)=>{n(y=>({...y,[e]:o})),g(y=>({...y,[e]:""}))},s=oe.map(e=>({label:typeof e.displayValue=="string"?e.displayValue:t.formatMessage(e.displayValue),value:e.id})),i=f.useMemo(()=>[{formType:"input",label:t.formatMessage(l.workspaceNameLabel),name:"workspaceName",placeholder:t.formatMessage(l.workspaceNamePlaceholder),value:m.workspaceName,onChange:e=>S("workspaceName",e),error:d.workspaceName,required:!0,autoFocus:!0},{formType:"select",label:t.formatMessage(l.workspaceCompanySizeLabel),name:"companySize",placeholder:t.formatMessage(l.workspaceCompanySizePlaceholder),value:m.companySize,onChange:e=>S("companySize",e),error:d.companySize,required:!1,options:s}],[d.companySize,d.workspaceName,m.companySize,m.workspaceName,t,s]),u=()=>{const e={};return i.forEach(o=>{o.required&&!m[o.name]&&(e[o.name]=t.formatMessage(l.fieldRequired,{fieldName:o.label}))}),g(e),Object.values(e).every(o=>!o)};return c.jsx(N,{onPrevious:a?()=>a({...m}):void 0,content:c.jsxs(v,{title:t.formatMessage(l.workspaceNameStepTitle),subTitle:t.formatMessage(l.workspaceNameStepSubtitle),children:[c.jsx("div",{className:"flex flex-col gap-6",children:i.map(e=>f.createElement(D,{...e,key:e.name}))}),c.jsx(L,{disabled:!m.workspaceName,onClick:async()=>{u()&&await p({...m})}})]})})};var F=(r=>(r.AboutWork="about-work",r.WorkspaceInfo="workspace-info",r.ConfigurePlan="configure-plan",r))(F||{});const Se=W(Object.values(F),void 0),he=({pendingWorkspace:r})=>{const p=P(),[a,t]=f.useState({workspaceName:r?.workspace_name??void 0,role:r?.role??void 0,department:r?.department??void 0,companySize:r?.company_size??void 0,numSeats:r?.seat_quantity??void 0});ce(new URLSearchParams(r?.query_params??"").get(I)??"");const m=be({data:a}),n=O(),d=C(),g=new URLSearchParams(d.search).get(j)??new URLSearchParams(r?.query_params??"").get(j)??void 0,S=K(),{country:s,userCountry:i}=le({initialCountryCode:g}),u=ie({country:s,currentAccount:n,location:"TeamDirectSignUpFlow"}),e=Se(r?.step_name),{step:o,nextStep:y}=we({initialStep:e&&b.includes(e)?e:void 0});f.useEffect(()=>{r||(()=>{M({step_name:r?.step_name??b[0],query_params:d.search,user_segment:"v1"})})()},[]),f.useEffect(()=>{const h=d.key,E=new URLSearchParams(window.location.search).get("referrer")||document.referrer;q.logEventWithStatsig("Account Pay: Team Direct Sign Up Flow","chatgpt_account_payment_team_direct_sign_up_flow",{...n?.subscriptionAnalyticsParams,referrer:E,initialTab:r?.step_name,currentTab:o,locationKey:h,navigationType:S,initialCountrySelectorCountry:g??s,selectedCountry:u.country??"",selectedCurrency:u.currency??"",userCountry:i??""})},[o]);const _=()=>{switch(o){case"about-work":return c.jsx(de,{formData:a,onNext:async h=>{const w={...a,...h};t(w),await y(w)}});case"workspace-info":return c.jsx(ye,{formData:a,onNext:async h=>{const w={...a,...h};t(w),await y(w)}});case"configure-plan":return c.jsx(ge,{formData:a,initialBillingDetails:u,onNext:async h=>{await m({...a,...h})},pendingWorkspace:r});default:return null}};return c.jsxs(c.Fragment,{children:[c.jsx("title",{children:p.formatMessage(l.teamSignUpPageTitle)}),_()]})},be=({data:r})=>{const{prepareCheckoutSession:p,navigateToCheckout:a}=Z(),t=Q(),m=P(),n=O();return f.useCallback(async({priceInterval:g,billingDetails:S,numSeats:s,promoData:i})=>{try{q.logEvent("Account Pay: Payment Checkout Clicked",{planType:X.TEAM,...n?.subscriptionAnalyticsParams,referrer:document.referrer});const u=await p({plan_name:"chatgptteamplan",team_plan_data:{workspace_name:r.workspaceName??"",price_interval:g,seat_quantity:s},billing_details:S,promo_campaign:g===T.FLEXIBLE?i?.coupon:null,cancel_url:window.location.href});await a(u)}catch(u){k.addError(u),t.warning(m.formatMessage(ne.paymentErrorWarning),{hasCloseButton:!0})}},[n?.subscriptionAnalyticsParams,r.workspaceName,m,a,p,t])},R=(r,p)=>{const a=new URLSearchParams(window.location.search);Object.entries(r).forEach(([m,n])=>{a.set(m,n)});const t=`${window.location.pathname}?${a.toString()}`;p?p(t,{replace:!1}):window.history.replaceState(null,"",t)},b=["configure-plan"],we=({initialStep:r})=>{const p=U(),a=C(),[t,m]=f.useState(()=>{const s=r??b[0];return R({[x]:s}),s}),n=f.useCallback(s=>{m(s),R({[x]:s},p)},[p]),d=f.useRef(null);f.useEffect(()=>{const i=new URLSearchParams(a.search).get(x);i!==d.current&&i&&b.includes(i)&&i!==t&&n(i),d.current=i},[a.search,n,t]);const g=async s=>{let i=t;const u=b.indexOf(t);u>=0&&u<b.length-1&&(i=b[u+1],n(i));try{await M({workspace_name:s.workspaceName,company_size:s.companySize,department:s.department,role:s.role,step_name:i,query_params:a.search,user_segment:"v1"})}catch(e){k.addError(e)}},S=f.useCallback(async s=>{let i=t;const u=b.indexOf(t);u>0&&(i=b[u-1],n(i));try{await M({workspace_name:s.workspaceName,company_size:s.companySize,department:s.department,role:s.role,step_name:i,query_params:a.search,user_segment:"v1"})}catch(e){k.addError(e)}},[a.search,n,t]);return{step:t,nextStep:g,previousStep:S}},je=Y(function({loaderData:p}){const a=C(),t=U();return f.useEffect(()=>{const m=p.pendingWorkspace?.query_params;if(!m)return;const n=new URLSearchParams(a.search),d=new URLSearchParams(m);let g=!1;for(const[S,s]of d)!n.get(S)&&S!==x&&(n.set(S,s),g=!0);g&&t(`${a.pathname}?${n.toString()}`,{replace:!0})},[p.pendingWorkspace?.query_params,a.pathname,a.search,t]),c.jsx(he,{pendingWorkspace:p.pendingWorkspace})});export{je as default};
//# sourceMappingURL=gyo36im2yau9osib.js.map
