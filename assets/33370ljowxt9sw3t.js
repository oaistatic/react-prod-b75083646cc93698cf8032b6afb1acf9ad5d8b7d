import{sc as G,sd as ye,d as w,B as A,ak as j,lA as Y,r1 as De,se as Ne,sf as ie,s5 as P,iG as q,be as Ee,sg as ve,C as Ae,sh as I,si as ee,sj as te,P as h,R as D,sk as le,r2 as ae,sl as de,sm as Ie,sn as Ge,so as Me,c6 as Oe,eT as Re,gg as ze,h0 as We,b2 as Pe,G as ne,X as qe,n2 as Be,sp as Fe,a as He,c as Ke,ay as $e,hV as Qe,lI as Ve}from"./hml6mmd5fyx85si7.js";import{j as e,m as be,e as K,r as u,M as c,d as O,u as B,g as Ye}from"./lu2xqwqmjc95q6j6.js";import{bR as Ze,ei as Xe,gn as Je,mC as U,eh as ke,cf as et,eb as we,go as tt}from"./rseqzngxzbdt1oxg.js";import{r as at}from"./cum7p7o751ibvfco.js";import{S as st}from"./dy6grwmx1xskr6sg.js";import{f as _,d as ot,V as rt,u as nt,O as Z}from"./fu5o644sg5t3q6ai.js";import{L as it}from"./ftitczs0ch82uydr.js";import{S as lt}from"./lsbwf2ru1kd9ka5b.js";import{S as dt}from"./b4dvi1xom4p5x1vj.js";import{T as H}from"./l2fd3uykkvam5v10.js";import{u as ct}from"./nsxv1nyryaz0gxvd.js";import{c as ut,a as gt,u as mt,i as pt}from"./cz3tvo7iwbv2krt2.js";import"./dq9j3pioxqah4sfs.js";import"./edbh3e4r4nwc2qmv.js";import"./galyil7vygq0i5a6.js";import"./hp08qw6yu0x90xkd.js";import"./hxuke67we6ylj0az.js";import"./dc45v808kg6x38y7.js";import"./owyq2pc3j9e6vumq.js";import"./on8091w14zfmyea2.js";import"./cqyjjngibokvfw83.js";import"./ogr5nmy9hq7gfgq0.js";import"./iq82wz84d1fxj03i.js";import"./elolu96rnfzqcgif.js";import"./kcqshnk26ykm1u4n.js";import"./fibktxptqydbr54o.js";import"./6a3e5rtr9pyzi31y.js";import"./ik8y7nlve9mzjttb.js";import"./isxemcalu9537a8n.js";import"./ejklrllfl9wcn2za.js";import"./gnhjnh2n0u3gy6qx.js";import"./e0pswmo7irlt62pp.js";import"./fd9rmcpa6ai71fe6.js";import"./ml28jwjklb12w4ms.js";import"./kj7psz5s4tjdmz6e.js";import"./isqkn4xlzoktkvfr.js";function je(){return" "}const S=G(ye(new Date,1)),E=new Date;function se({onLeft:t,leftDisabled:a,onRight:s,rightDisabled:o,children:n,className:i,borderLess:r=!1,surpressChildrenWrapper:l=!1}){return e.jsxs("div",{className:w("flex items-stretch",i),children:[e.jsx(A,{className:w("disabled:text-token-text-quaternary pe-1",!r&&"border-token-border-medium rounded-e-none border-e-0 disabled:opacity-100"),color:r?"ghost":"secondary",size:"small",onClick:t,disabled:a,icon:Ze}),l?n:e.jsx("span",{className:w("flex grow items-center justify-center px-1 text-sm",!r&&"border-token-border-medium border-t border-b"),children:n}),e.jsx(A,{className:w("disabled:text-token-text-quaternary ps-1",!r&&"border-token-border-medium rounded-s-none border-s-0 disabled:opacity-100"),color:r?"ghost":"secondary",size:"small",onClick:s,disabled:o,icon:Xe})]})}const ht=at(12);function _e({referenceDate:t,setReferenceDate:a,earliestValidDate:s,latestValidDate:o,motionLayoutId:n}){return e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>a(ye(t,1),"subYear"),onRight:()=>a(De(t,1),"addYear"),leftDisabled:Y(new Date)>=Y(t)+1,rightDisabled:Y(new Date)<=Y(t),children:j(t,"y")}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:ht.map(i=>{const r=G(Ne(t,i)),l=ie(r,t),d=P(r,s)||q(r,o);return e.jsxs("button",{disabled:d,onClick:()=>a(r,"select"),className:w("relative h-8 w-full rounded-md",!d&&"hover:bg-token-surface-hover"),children:[l&&e.jsx(be.div,{layoutId:n,className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-md",transition:{duration:.15}}),e.jsx("span",{className:w("relative z-10 transition-colors duration-75",l&&"text-token-main-surface-primary delay-75",!l&&"text-token-text-primary delay-0",d&&"text-token-text-quaternary"),children:j(r,"MMM")})]},i)})})]})}function xt({currentWorkspaceId:t,currentTab:a,onClose:s}){const o=K(),[n,i]=u.useState(!1),[r,l]=u.useState(a==="gptsTab"?"gpt":"user"),[d,m]=u.useState("thisMonth"),[g,M]=u.useState(),b=Ee(p=>p.currentWorkspace?.name)??t,v=new Date,x=ve(new Date,1);return e.jsxs(Ae,{testId:"modal-export",isOpen:!0,onClose:()=>{s(),h.logEvent("Workspace Usage: Export Modal Closed Without Generation")},type:"success",title:e.jsx(c,{...f.title}),showCloseButton:!0,primaryButton:e.jsx(A,{loading:n,onClick:async()=>{i(!0);try{const p=d==="customRange"?{period:g?.period??$.period,period_start:_(g?.referenceDate??$.referenceDate)}:vt(d);h.logEvent("Workspace Usage: Export Generate CSV Clicked",{reportType:r,dateRangeType:d,period:p.period,periodStart:p.period_start});const N=await D.safeGet("/accounts/{account_id}/reporting",{parameters:{path:{account_id:t},query:{...p,report_type:r}}});ot({data:N.csv_content,mimeType:"text/csv",filename:o.formatMessage(f.filename,{workspaceName:b,period:p.period,reportType:r,date:p.period_start})})}finally{i(!1)}s()},children:e.jsx(c,{...f.generateCsvButton})}),children:[e.jsxs(it,{className:"font-medium",children:[e.jsx(c,{...f.dataTypeDropdownLabel}),e.jsx(Je,{triggerClassName:"flex mt-2 border border-token-border-default text-base focus-visible:border-token-border-default w-full justify-between",value:r,onValueChange:p=>l(p),options:[{label:o.formatMessage(f.dataTypeDropdownUsers),value:"user"},{label:o.formatMessage(f.dataTypeDropdownGpts),value:"gpt"}]})]}),e.jsx("div",{className:"mt-6 mb-2 font-medium",children:e.jsx(c,{...f.dateRangeLabel})}),e.jsxs(U.Root,{className:"flex flex-col gap-3",value:d,onValueChange:p=>{m(p),h.logEvent("Workspace Usage: Export Date Range Type Changed",{dateRangeType:p})},children:[e.jsx(U.Item,{value:"thisMonth",label:e.jsx(c,{...f.thisMonthLabel,values:{date:j(v,"MMMM y")}}),children:e.jsx(U.Indicator,{})}),e.jsx(U.Item,{value:"lastMonth",label:e.jsx(c,{...f.lastMonthLabel,values:{date:j(I(v,1),"MMMM y")}}),children:e.jsx(U.Indicator,{})}),e.jsx(U.Item,{value:"thisWeek",label:e.jsx(c,{...f.thisWeekLabel,values:{date:`${j(ee(v),"MMM d")} – ${j(te(v),"MMM d")}`}}),children:e.jsx(U.Indicator,{})}),e.jsx(U.Item,{value:"lastWeek",label:e.jsx(c,{...f.lastWeekLabel,values:{date:`${j(ee(x),"MMM d")} – ${j(te(x),"MMM d")}`}}),children:e.jsx(U.Indicator,{})}),e.jsx(U.Item,{value:"customRange",label:e.jsx(ft,{customRange:g,setCustomRange:M,onClick:()=>m("customRange")}),children:e.jsx(U.Indicator,{})})]})]})}const $={period:"monthly",referenceDate:new Date};function ft({customRange:t,setCustomRange:a,onClick:s}){const o=K(),n=(t??$).period,i=(t??$).referenceDate,r=n==="monthly"?le(i):te(i),l=({period:d,referenceDate:m})=>a((g=$)=>{const M=d??g.period,b=m??g.referenceDate,v=M==="monthly"?G:ee,x=q(b,E)?E:P(b,S)?S:b;return{period:M,referenceDate:v(x)}});return e.jsx(ke,{className:"z-50",alignAgainstAnchor:"start",triggerButton:e.jsxs(A,{size:"small",color:"secondary",contentsFullWidth:!0,onClick:s,children:[t?e.jsx(c,{...f.customRangeDisplay,values:{start:de(t.referenceDate),end:de(r)}}):e.jsx(c,{...f.chooseMonthOrWeekButton}),e.jsx("div",{className:"grow"}),e.jsx(et,{})]}),children:e.jsxs("div",{className:"w-[210px] p-1 text-xs",children:[e.jsx(st,{className:"mb-4 rounded-md",value:n,onChange:d=>{l({period:d}),h.logEvent("Workspace Usage: Export Custom Period Changed",{period:d})},ariaLabel:o.formatMessage(f.customRangePeriodToggleAria),leftItem:{className:"rounded-md",ariaLabel:o.formatMessage(f.chooseDateMonthlyLabel),label:o.formatMessage(f.chooseDateMonthlyLabel),value:"monthly"},rightItem:{className:"rounded-md",ariaLabel:o.formatMessage(f.chooseDateWeeklyLabel),label:o.formatMessage(f.chooseDateWeeklyLabel),value:"weekly"}}),n==="monthly"?e.jsx(_e,{referenceDate:i,setReferenceDate:(d,m)=>{l({referenceDate:d}),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"monthly",change:m})},earliestValidDate:S,latestValidDate:E,motionLayoutId:"workspaceUsage.exportModal.customRange.monthHighlight"}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>{l({referenceDate:I(i,1)}),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"subMonth"})},onRight:()=>{l({referenceDate:ae(i,1)}),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"addMonth"})},leftDisabled:P(I(i,1),S),rightDisabled:q(ae(i,1),E),children:j(i,"MMMM y")}),e.jsx(yt,{referenceDate:i,setReferenceDate:d=>l({referenceDate:d})})]})]})})}const yt=({referenceDate:t,setReferenceDate:a})=>{const s=G(t),o=Ie({start:s,end:le(t)});return e.jsx("div",{className:"flex flex-col gap-1",children:o.map(n=>{const i=Ge(n,t),r=P(n,S)||q(n,new Date);return e.jsxs("button",{disabled:r,onClick:()=>{a(n),h.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"select"})},className:w("relative h-8 w-full rounded-full",!r&&"hover:bg-token-surface-hover"),children:[i&&e.jsx(be.div,{layoutId:`workspaceUsage.exportModal.customRange.weekHighlight.${s.toISOString()}`,className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-full",transition:{duration:.15}}),e.jsx("div",{className:w("relative z-10 flex w-full justify-around transition-colors duration-75",i&&"text-token-main-surface-primary delay-75",!i&&"text-token-text-primary delay-0"),children:Me({start:n,end:te(n)}).map(l=>e.jsx("div",{className:w("w-0 grow",{"text-token-text-quaternary":!ie(l,t)||q(l,new Date)||P(l,S)}),children:j(l,"d")},l.toISOString()))})]},n.toISOString())})})};function vt(t){const a=new Date;return t==="thisWeek"||t==="lastWeek"?{period:"weekly",period_start:_(ee(t==="thisWeek"?a:ve(a,1)))}:{period:"monthly",period_start:_(G(t==="thisMonth"?a:I(a,1)))}}const f=O({title:{id:"workspaceUsage.exportModal.title",defaultMessage:"Export data"},dataTypeDropdownLabel:{id:"workspaceUsage.exportModal.dataTypeDropdownLabel",defaultMessage:"Data type"},dataTypeDropdownUsers:{id:"workspaceUsage.exportModal.dataTypeDropdownUsers",defaultMessage:"Users"},dataTypeDropdownGpts:{id:"workspaceUsage.exportModal.dataTypeDropdownGpts",defaultMessage:"GPTs"},dateRangeLabel:{id:"workspaceUsage.exportModal.dateRangeLabel",defaultMessage:"Date range"},thisMonthLabel:{id:"workspaceUsage.exportModal.thisMonthLabel",defaultMessage:"This month ({date})"},lastMonthLabel:{id:"workspaceUsage.exportModal.lastMonthLabel",defaultMessage:"Last month ({date})"},thisWeekLabel:{id:"workspaceUsage.exportModal.thisWeekLabel",defaultMessage:"This week ({date})"},lastWeekLabel:{id:"workspaceUsage.exportModal.lastWeekLabel",defaultMessage:"Last week ({date})"},chooseMonthOrWeekButton:{id:"workspaceUsage.exportModal.chooseMonthOrWeekButton",defaultMessage:"Choose month or week"},customRangeDisplay:{id:"workspaceUsage.exportModal.customRangeDisplay",defaultMessage:"{start} – {end}"},generateCsvButton:{id:"workspaceUsage.exportModal.generateCsvButton",defaultMessage:"Generate CSV"},customRangePeriodToggleAria:{id:"workspaceUsage.exportModal.customRangePeriodToggleAria",defaultMessage:"Date range period choice"},chooseDateMonthlyLabel:{id:"workspaceUsage.exportModal.chooseDateMonthlyLabel",defaultMessage:"Monthly"},chooseDateWeeklyLabel:{id:"workspaceUsage.exportModal.chooseDateWeeklyLabel",defaultMessage:"Weekly"},filename:{id:"workspaceUsage.exportModal.filename",defaultMessage:"{workspaceName} {period} {reportType} report {date}.csv"}});function Ue({startDate:t,statsSpec:a,data:s,previousData:o}){return e.jsx("div",{className:"border-token-border-default my-6 flex min-h-[80px] w-full rounded-lg border px-2 py-4",children:a.map(({dataKey:n,label:i,helpText:r})=>{const l=s==null?"loading":s[n],d=o==null?"loading":o[n];return e.jsxs("div",{className:"border-token-border-default flex w-0 grow flex-col justify-between border-e px-4 last:me-0 last:border-e-0",children:[e.jsxs("div",{className:"text-token-text-secondary text-sm",children:[e.jsx(c,{...i}),e.jsx(je,{}),r&&e.jsx(Oe,{label:e.jsx("span",{className:"text-token-main-surface-primary font-normal",children:e.jsx(c,{...r})}),side:"top",customBackgroundColorClassName:"bg-token-main-surface-primary-inverse",children:e.jsx(Re,{className:"icon-sm inline"})})]}),e.jsx(rt,{value:l,previousValue:d,hideTrend:ie(t,new Date),className:"h-[28px]"})]},n)})})}function Te({handleSearch:t,clientEventSource:a,className:s}){const n=K().formatMessage(Mt.filterListInputLabel),i=u.useCallback(ze(r=>{t(r),h.logEvent("Workspace Usage: Filter Searched",{queryLength:r.length,trigger:"debouncedTyping",source:a})},250),[]);return e.jsx(We,{className:w("max-w-[300px]",s),ariaLabel:n,placeholder:n,type:"text",name:"search",icon:Pe,iconPosition:"left",saveOnBlur:!0,value:"",onChange:r=>i(r.target.value.trim()),onPressEnter:r=>{const l=r?.trim()??"";t(l),h.logEvent("Workspace Usage: Filter Searched",{queryLength:l.length,trigger:"enterKey",source:a})}})}const Mt=O({filterListInputLabel:{id:"workspaceUsage.filterListInputLabel",defaultMessage:"Search"}}),ce=20,ue=[{cursor:void 0,queryId:void 0}];function Se({getQueryKey:t,loader:a,initialSortDirection:s,spec:o,getData:n,clientEventSource:i}){const[r,l]=u.useState(s),[d,m]=u.useState(ue),[g,M]=u.useState(0),[b,v]=u.useState(),x=B({queryKey:t({order_by_field:r.metric,order_by_direction:r.direction,cursor:d[g]?.cursor,query_id:d[g]?.queryId,page_size:ce}),queryFn:({queryKey:y})=>a(y)}),p=x.data?n(x.data):"loading",N=ct(p),L=p==="loading"&&N.current!=="loading",oe=L?N.current:p;u.useEffect(()=>{x.data?.next_cursor&&x.data?.query_id&&d.length===g+1&&m(y=>[...y,{cursor:x.data?.next_cursor,queryId:x.data?.query_id}])},[x.data,d,g]),u.useEffect(()=>{b==null&&x.data&&(x.data.total_count!=null?v(Math.ceil(x.data.total_count/ce)):v(1))},[x.data,d,b]);const Ce=r.direction==="ASC"?dt:lt;return e.jsxs("div",{className:"mt-4",children:[e.jsxs(H.Root,{className:"border-token-border-medium mb-4 border-b-[0.5px]",children:[e.jsx(H.Header,{children:o.map(({metric:y,label:C,defaultSortDirection:Q="ASC"})=>e.jsxs(H.HeaderCell,{className:"text-[13px] font-medium text-nowrap",onClick:()=>{M(0),m(ue),l(V=>{let F;return y===V.metric?F=V.direction==="ASC"?"DESC":"ASC":F=Q,h.logEvent("Workspace Usage: Table Sort Clicked",{metric:y,direction:F,source:i}),{direction:F,metric:y}})},children:[C,r.metric===y&&e.jsx(Ce,{className:"icon text-token-icon-secondary ms-1 inline"})]},y))}),e.jsx(H.Body,{children:oe&&oe!=="loading"&&oe.map((y,C)=>e.jsx(H.Row,{children:o.map(({metric:Q,render:V},F)=>e.jsx(H.Cell,{className:w(L&&"pt-0 pb-0 [&]:border-0"),divClassName:w("items-center",F>0&&"text-token-text-secondary",!L&&"min-h-[40px]",L&&"h-0 overflow-hidden"),children:V(y[Q],y)},Q))},C))})]}),p==="loading"&&e.jsx("div",{className:"flex h-[860px] items-center justify-center",children:e.jsx(ne,{})}),p!=="loading"&&p.length===0&&e.jsx("div",{className:"flex h-[100px] items-center justify-center",children:e.jsx(c,{...bt.zeroStateMessage})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(se,{onLeft:()=>{M(y=>{const C=y-1;return h.logEvent("Workspace Usage: Pagination Clicked",{direction:"left",pageIndex:C,source:i}),C})},leftDisabled:g<=0,onRight:()=>{M(y=>{const C=y+1;return h.logEvent("Workspace Usage: Pagination Clicked",{direction:"right",pageIndex:C,source:i}),C})},rightDisabled:d[g+1]==null,children:[g+1,"/",b??e.jsx(ne,{})]})})]})}const bt=O({zeroStateMessage:{id:"workspaceUsage.table.zeroStateMessage",defaultMessage:"No results found"}}),R=(t,{toastId:a="chatgpt.usageAnalytics.defaultErrorToastId",message:s}={})=>nt(t,{toastId:a,message:s});function ge(t,a){return B({queryKey:["workspace-analytics-gizmo-stats",{workspaceId:t,startDate:a}],queryFn:R(({queryKey:[s,o]})=>D.safeGet("/accounts/{account_id}/analytics/gizmo_stats",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}async function kt([t,{workspaceId:a,...s}]){return D.safeGet("/accounts/{account_id}/analytics/gizmo_list",{parameters:{path:{account_id:a},query:s}})}const wt={direction:"DESC",metric:"active_users"};function jt({currentWorkspaceId:t,startDate:a}){const[s,o]=u.useState(""),n=_(a),i=u.useCallback(g=>["workspace-analytics-gizmos-list",{workspaceId:t,start_date:n,filter_query:s,...g}],[n,s,t]),r=ge(t,n),l=_(I(a,1)),d=ge(t,l),m=R(kt);return e.jsxs("div",{className:"mb-8",children:[e.jsx(Ue,{startDate:a,data:r.data,previousData:d.data,statsSpec:_t}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Te,{className:"grow",handleSearch:o,clientEventSource:"gizmoList"}),e.jsx(A,{as:"link",to:"/admin/gpts",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(c,{...T.manageGPTs}),e.jsx(we,{className:"icon-sm"})]})})]}),e.jsx(Se,{getQueryKey:i,loader:m,getData:g=>g.gizmos,spec:Tt,initialSortDirection:wt,clientEventSource:"gizmoList"},`${t}.${n}.${s}`)]})}const T=O({totalGpts:{id:"workspaceUsage.gizmoList.stats.totalGpts",defaultMessage:"Total GPTs"},gptsCreatedThisMonth:{id:"workspaceUsage.gizmoList.stats.gptsCreatedThisMonth",defaultMessage:"GPTs Created This Month"},gptsActive:{id:"workspaceUsage.gizmoList.stats.gptsActive",defaultMessage:"GPTs active"},gptsActiveHelpText:{id:"workspaceUsage.gizmoList.stats.gptsActiveHelpText",defaultMessage:"GPTs that have sent at lease one message during this month"},nameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.name",defaultMessage:"Name"},messagesColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.messages",defaultMessage:"Total Messages"},creatorNameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.creatorName",defaultMessage:"Creator Name"},activeUsersColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.activeUsersColumnLabel",defaultMessage:"Active Users"},draftFlag:{id:"workspaceUsage.gizmoList.draftFlag",defaultMessage:"Draft"},manageGPTs:{id:"workspaceUsage.gizmoList.manageGPTs",defaultMessage:"Manage GPTs"}}),_t=[{dataKey:"total_gpt_count",label:T.totalGpts},{dataKey:"gpt_created",label:T.gptsCreatedThisMonth},{dataKey:"active_gpt_count",label:T.gptsActive,helpText:T.gptsActiveHelpText}],Ut=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function me(t){return typeof t=="number"?Ut.format(t):null}const Tt=[{metric:"gpt_name",label:e.jsx(c,{...T.nameColumnLabel}),render:(t,{config_type:a})=>e.jsxs("div",{className:"flex grow items-center justify-between",children:[e.jsx("span",{children:t}),a==="draft"&&e.jsx("span",{className:"text-token-text-secondary text-xs",children:e.jsx(c,{...T.draftFlag})})]})},{label:e.jsx(c,{...T.creatorNameColumnLabel}),metric:"creator_name",render:t=>t},{metric:"messages",label:e.jsx(c,{...T.messagesColumnLabel}),render:me,defaultSortDirection:"DESC"},{metric:"active_users",label:e.jsx(c,{...T.activeUsersColumnLabel}),render:me,defaultSortDirection:"DESC"}];function St({startDate:t,setStartDate:a}){return e.jsx(se,{onLeft:()=>{a(s=>{const o=I(s,1);return h.logEvent("Workspace Usage: Month Changed",{direction:"left",startDate:_(o)}),o})},leftDisabled:P(I(t,1),S),onRight:()=>{a(s=>{const o=ae(s,1);return h.logEvent("Workspace Usage: Month Changed",{direction:"right",startDate:_(o)}),o})},rightDisabled:q(ae(t,1),E),surpressChildrenWrapper:!0,children:e.jsx(Lt,{startDate:t,setStartDate:a})})}function Lt({startDate:t,setStartDate:a}){return e.jsx(ke,{triggerButton:e.jsx(A,{size:"small",color:"secondary",className:"rounded-none border-x-0 border-e-0 px-1",children:j(t,"MMM y")}),children:e.jsx("div",{className:"w-[210px] p-1 text-xs",children:e.jsx(_e,{referenceDate:t,setReferenceDate:(s,o)=>{const n=G(q(s,E)?E:P(s,S)?S:s);a(n),h.logEvent("Workspace Usage: Month Changed",{direction:o,startDate:_(n)})},earliestValidDate:S,latestValidDate:E,motionLayoutId:"workspaceUsage.monthSelector.monthHighlight"})})})}var re,pe;function Ct(){if(pe)return re;pe=1;var t=qe(),a=Be(),s=a(function(o,n,i){t(o,i,n)});return re=s,re}var Dt=Ct();const Nt=Ye(Dt);async function Et({queryKey:[t,{workspaceId:a,startDate:s}]}){return D.safeGet("/accounts/{account_id}/analytics/overview",{parameters:{path:{account_id:a},query:{start_date:s}}})}function At(t,a){return B({queryKey:["workspace-analytics-overview",{workspaceId:t,startDate:a}],queryFn:R(Et)})}async function It({queryKey:[t,{workspaceId:a,startDate:s}]}){return D.safeGet("/accounts/{account_id}/analytics/gizmo_overview",{parameters:{path:{account_id:a},query:{start_date:s}}})}function Gt(t,a){return B({queryKey:["workspace-analytics-gizmo-overview",{workspaceId:t,startDate:a}],queryFn:R(It)})}function Ot(t,a){return B({queryKey:["workspace-analytics-tool-overview",{workspaceId:t,startDate:a}],queryFn:R(({queryKey:[s,o]})=>D.safeGet("/accounts/{account_id}/analytics/tool_overview",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}function X(t,a,s){return u.useMemo(()=>{if(!a)return;const o=Nt(a,"date");return Me({start:t,end:le(t)}).map(n=>{const i=_(n),r=o[i];return r&&r.total>0?{date:r.date,total:r.total,values:r[s]??{}}:{date:i,blank:0}})},[t,a,s])}function Rt(t,a){const s=_(a),o=At(t,s),n=u.useMemo(()=>o.data?.active_user_data?.daily_data.map(({date:N,active_users:L})=>({date:N,total:L,values:{active_users:L}})),[o.data?.active_user_data?.daily_data]),i=X(a,n,"values"),r=X(a,o.data?.messages_data?.daily_data,"messages_by_model"),l=Gt(t,s),d=X(a,l.data?.daily_gizmo_messages_data,"messages_by_gpt"),m=Ot(t,s),g=X(a,m.data?.daily_tool_messages_data,"messages_by_tool"),M=K(),b=u.useMemo(()=>i&&o.data?.active_user_data?{data:i,metrics:{active_users:{displayName:M.formatMessage(zt.activeUsers)}},monthOverMonth:o.data.active_user_data.month_to_month_data}:"loading",[i,M,o.data?.active_user_data]),v=u.useMemo(()=>r&&o.data?.messages_data?{data:r,metrics:he(o.data.messages_data.models),monthOverMonth:o.data.messages_data.month_to_month_data}:"loading",[r,o.data?.messages_data]),x=u.useMemo(()=>d&&l.data?.metrics&&l.data?.month_to_month_data?{data:d,metrics:Object.fromEntries(Object.entries(l.data.metrics).map(([N,L])=>[N,{displayName:L}])),monthOverMonth:l.data.month_to_month_data}:"loading",[d,l.data?.metrics,l.data?.month_to_month_data]),p=u.useMemo(()=>g&&m.data?.tool_list&&m.data?.month_to_month_data?{data:g,metrics:he(m.data.tool_list),monthOverMonth:m.data.month_to_month_data}:"loading",[g,m.data?.month_to_month_data,m.data?.tool_list]);return{dailyActiveUsers:b,dailyMessages:v,dailyGizmoMessages:x,dailyToolMessages:p}}function he(t){return Object.entries(t).sort(([,a],[,s])=>a-s).reduce((a,[s,o])=>(o>0&&(a[s]={displayName:s,total:o}),a),{})}const zt=O({activeUsers:{id:"workspaceUsage.activeUsersMetric",defaultMessage:"Active users"}});function Wt({currentWorkspaceId:t,startDate:a}){const s=K(),o=Rt(t,a),n=!Fe(a,G(new Date));return e.jsxs("div",{className:"mt-10",children:[e.jsx(Z,{title:z.activeUsersChartTitle,data:o.dailyActiveUsers,displayMoM:n,clientEventSource:"activeUsers",hideLegend:!0}),e.jsx(Z,{title:z.messagesChartTitle,data:o.dailyMessages,otherGroupLabel:s.formatMessage(z.otherModels),displayMoM:n,clientEventSource:"totalMessages"}),e.jsx(Z,{title:z.gptMessagesChartTitle,data:o.dailyGizmoMessages,otherGroupLabel:s.formatMessage(z.otherGizmos),displayMoM:n,clientEventSource:"gizmoMessages"}),e.jsx(Z,{title:z.toolMessagesChartTitle,data:o.dailyToolMessages,otherGroupLabel:s.formatMessage(z.otherTools),displayMoM:n,clientEventSource:"toolMessages"})]})}const z=O({activeUsersChartTitle:{id:"workspaceUsage.overview.activeUsersChartTitle",defaultMessage:"Unique active users"},messagesChartTitle:{id:"workspaceUsage.overview.messagesChartTitle",defaultMessage:"Total messages sent"},gptMessagesChartTitle:{id:"workspaceUsage.overview.gptMessagesChartTitle",defaultMessage:"GPT messages sent"},toolMessagesChartTitle:{id:"workspaceUsage.overview.toolMessagesChartTitle",defaultMessage:"Tool messages received"},otherModels:{id:"workspaceUsage.overview.otherModels",defaultMessage:"Other models"},otherGizmos:{id:"workspaceUsage.overview.otherGizmos",defaultMessage:"Other GPTs"},otherTools:{id:"workspaceUsage.overview.otherTools",defaultMessage:"Other Tools"}});function xe(t,a){return B({queryKey:["workspace-analytics-user-stats",{workspaceId:t,startDate:a}],queryFn:R(({queryKey:[s,o]})=>D.safeGet("/accounts/{account_id}/analytics/user_stats",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}async function Pt([t,{workspaceId:a,...s}]){return D.safeGet("/accounts/{account_id}/analytics/user_list",{parameters:{path:{account_id:a},query:s}})}const qt={direction:"DESC",metric:"messages"};function Bt({currentWorkspaceId:t,startDate:a}){const[s,o]=u.useState(""),n=He(),i=Ke(n,"2861925050"),r=u.useMemo(()=>i?[...fe,{label:e.jsx(c,{...k.creditsUsedColumnLabel}),metric:"credits_used",render:J,defaultSortDirection:"DESC"}]:fe,[i]),l=_(a),d=u.useCallback(v=>["workspace-analytics-users-list",{workspaceId:t,start_date:l,filter_query:s,...v}],[l,s,t]),m=xe(t,l),g=_(I(a,1)),M=xe(t,g),b=R(Pt);return e.jsxs("div",{className:"mb-8",children:[e.jsx(Ue,{startDate:a,data:m.data,previousData:M.data,statsSpec:Ft}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Te,{className:"grow",handleSearch:o,clientEventSource:"userList"}),e.jsx(A,{as:"link",to:"/admin",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(c,{...k.manageUsersLink}),e.jsx(we,{className:"icon-sm"})]})})]}),e.jsx(Se,{getQueryKey:d,loader:b,getData:v=>v.users,spec:r,initialSortDirection:qt,clientEventSource:"userList"},`${t}.${l}.${s}`)]})}const k=O({purchasedSeats:{id:"workspaceUsage.userList.stats.purchasedSeats",defaultMessage:"Seats purchased"},claimedSeats:{id:"workspaceUsage.userList.stats.claimedSeats",defaultMessage:"Seats enabled"},claimedSeatsHelpText:{id:"workspaceUsage.userList.stats.claimedSeatsHelpText",defaultMessage:"Users who have accepted their invite and logged in"},activeUsers:{id:"workspaceUsage.userList.stats.activeUsers",defaultMessage:"Active users"},activeUsersHelpText:{id:"workspaceUsage.userList.stats.activeUsersHelpText",defaultMessage:"Users who have sent at least one message during this time period"},pendingInvites:{id:"workspaceUsage.userList.stats.pendingInvites",defaultMessage:"Pending invites"},nameColumnLabel:{id:"workspaceUsage.userList.tableHeader.name",defaultMessage:"Name"},emailColumnLabel:{id:"workspaceUsage.userList.tableHeader.email",defaultMessage:"Email"},messagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.messages",defaultMessage:"Total Messages"},gptMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.gptMessages",defaultMessage:"GPT Messages"},toolMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.toolMessages",defaultMessage:"Tool Messages"},creditsUsedColumnLabel:{id:"workspaceUsage.userList.tableHeader.creditsUsed",defaultMessage:"Credits Used"},manageUsersLink:{id:"workspaceUsage.userList.tableHeader.manageUsersLink",defaultMessage:"Manage users"}}),Ft=[{dataKey:"purchased_seats",label:k.purchasedSeats},{dataKey:"claimed_seat",label:k.claimedSeats,helpText:k.claimedSeatsHelpText},{dataKey:"active_users",label:k.activeUsers,helpText:k.activeUsersHelpText},{dataKey:"pending_invites",label:k.pendingInvites}],Ht=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function J(t){return typeof t=="number"?Ht.format(t):null}const fe=[{metric:"name",label:e.jsx(c,{...k.nameColumnLabel}),render:t=>t},{metric:"email",label:e.jsx(c,{...k.emailColumnLabel}),render:t=>t},{metric:"messages",label:e.jsx(c,{...k.messagesColumnLabel}),render:J,defaultSortDirection:"DESC"},{label:e.jsx(c,{...k.gptMessagesColumnLabel}),metric:"gpt_messages",render:J,defaultSortDirection:"DESC"},{label:e.jsx(c,{...k.toolMessagesColumnLabel}),metric:"tool_messages",render:J,defaultSortDirection:"DESC"}];function Kt(t){return Object.keys(t)}const $t=$e.div`flex space-x-4`,Le={overviewTab:Wt,usersTab:Bt,gptsTab:jt};function Qt(t){return B({queryKey:["workspace-analytics-last-updated",{workspaceId:t}],queryFn:R(({queryKey:[a,s]})=>D.safeGet("/accounts/{account_id}/analytics/last_updated_time",{parameters:{path:{account_id:s.workspaceId}}}))})}const Vt=Kt(Le);function Yt({currentWorkspaceId:t,startDate:a,setStartDate:s,currentTab:o,setTab:n}){const i=Qt(t),[r,l]=u.useState(!1);return e.jsx(gt,{title:e.jsx(c,{...W.title}),actions:e.jsxs(e.Fragment,{children:[e.jsx(St,{startDate:a,setStartDate:s}),e.jsx(A,{className:"ms-2",color:"secondary",size:"small",onClick:()=>{l(!0),h.logEvent("Workspace Usage: Export Modal Opened")},children:e.jsx(c,{...W.exportButton})}),r&&e.jsx(xt,{currentWorkspaceId:t,currentTab:o,onClose:()=>l(!1)})]}),tabsHeader:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($t,{children:Vt.map(d=>e.jsx("a",{className:w("pb-2",o===d?"border-token-text-secondary text-token-text-primary border-b font-medium":"text-token-text-tertiary cursor-pointer font-normal"),onClick:()=>{n(d),h.logEvent("Workspace Usage: Tab Clicked",{tab:d})},children:e.jsx(c,{...W[d]})},d))}),e.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 text-xs",children:[i.data?e.jsxs("span",{children:[e.jsx(c,{...W.dataLastUpdatedLabel}),e.jsx(je,{}),i.data.last_updated_time?j(new Date(i.data.last_updated_time),"MMM d, yyyy"):e.jsx(c,{...W.dataLastUpdatedUnknown})]}):e.jsx(ne,{}),"·",e.jsx(Qe,{href:"https://help.openai.com/en/articles/10875114-user-analytics-for-chatgpt-enterprise",className:"hover:text-token-link-hover underline",children:e.jsx(c,{...W.helpCenterLinkText})})]})]})})}function Zt({currentWorkspaceId:t}){const a=K(),[s,o]=u.useState("overviewTab"),[n,i]=u.useState(G(new Date)),r=Le[s];return u.useEffect(()=>{h.logPageView(),h.logEvent("Workspace Usage: Page Viewed")},[]),e.jsxs(e.Fragment,{children:[e.jsx(tt,{children:e.jsx("title",{children:a.formatMessage(W.title)})}),e.jsx(Yt,{currentWorkspaceId:t,startDate:n,setStartDate:i,currentTab:s,setTab:o}),e.jsx(ut,{children:e.jsx(r,{currentWorkspaceId:t,startDate:n})})]})}const W=O({title:{id:"workspaceUsage.title",defaultMessage:"User Analytics"},overviewTab:{id:"workspaceUsage.overviewTab",defaultMessage:"Overview"},usersTab:{id:"workspaceUsage.usersTab",defaultMessage:"Users"},gptsTab:{id:"workspaceUsage.gptsTab",defaultMessage:"GPTs"},creditsTab:{id:"workspaceUsage.creditsTab",defaultMessage:"Credits"},exportButton:{id:"workspaceUsage.exportButton",defaultMessage:"Export..."},dataLastUpdatedLabel:{id:"workspaceUsage.dataLastUpdatedLabel",defaultMessage:"Data updated"},dataLastUpdatedUnknown:{id:"workspaceUsage.dataLastUpdatedUnknown",defaultMessage:"Unknown"},helpCenterLinkText:{id:"workspaceUsage.helpCenterLinkText",defaultMessage:"Learn more about analytics"}}),Aa=Ve(function(){const a=mt();return pt(),e.jsx(Zt,{...a})});export{Aa as default};
//# sourceMappingURL=33370ljowxt9sw3t.js.map
