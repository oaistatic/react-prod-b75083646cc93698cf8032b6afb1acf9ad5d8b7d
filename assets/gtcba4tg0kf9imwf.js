const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/f8q9ifyvyyh6yaff.js","assets/lu2xqwqmjc95q6j6.js","assets/rseqzngxzbdt1oxg.js","assets/hml6mmd5fyx85si7.js","assets/root-c0w5lvnh.css","assets/conversation-small-gcvo4yhm.css","assets/glhf2v443rhkp7lb.js","assets/l2fd3uykkvam5v10.js"])))=>i.map(i=>d[i]);
import{R as b,a as v,bO as N,c as L,ap as W,a$ as M,eL as B,fH as S,aZ as G,cN as D,bg as K,cR as Q,d as O,B as w,u as V,A as k,mJ as Y,q as z,P as T,aq as H,cj as R,fg as A,aD as X}from"./hml6mmd5fyx85si7.js";import{r as y,l as U,u as $,j as o,M as u,n as J}from"./lu2xqwqmjc95q6j6.js";import{ee as Z,cQ as ee,ef as te,eg as oe,eh as ne,ei as se}from"./rseqzngxzbdt1oxg.js";import{S as re}from"./k5epsa4c8f1mfvu0.js";import"./glhf2v443rhkp7lb.js";import"./l2fd3uykkvam5v10.js";const j="memories/current_memory_undo_id",E={async getCurrentMemoryUndoId(e){return await b.safeGet("/memories/current_memory_undo_id",{parameters:{query:{gizmo_id:e}}})},async undoMemoryWrite(e,t){return await b.safePost("/memories/undo_memory_write",{requestBody:{gizmo_id:e,memory_undo_id:t}})}},ie=W(()=>H(()=>import("./f8q9ifyvyyh6yaff.js").then(e=>e.b),__vite__mapDeps([0,1,2,3,4,5,6,7])));let C=!1;function q(e){return e.find(t=>t.author.role===M.Tool&&t.metadata?.pending_memory_info)}function ae(e){return e.filter((t,n)=>{const s=e[n+1],a=s?.recipient==="assistant"&&s?.author.role===M.Tool&&s?.author.name==="bio"&&B(s).startsWith("Model set context");return t.author.role===M.Assistant&&t.recipient==="bio"&&a}).flatMap(t=>{const n=t.content.content_type;return n===S.Text?t.content.parts:n===S.Code?[t.content.text]:[]}).map(pe)}function le(e){return e.some(t=>t.author.role===M.Assistant&&t.recipient==="bio"&&t.status==="in_progress")}function de(e){return e.find(n=>n.author.role===M.Tool&&n.author.name==="bio"&&n.recipient===M.Assistant)?.metadata?.current_memory_undo_id}function ue(e){const{eligible:t,isLoading:n}=Z(),s=y.useMemo(()=>e.length>0,[e]);y.useEffect(()=>{s&&t&&!n&&G.openModal(D.GlobalMemoryOnboarding)},[s,t,n])}function ce(e){const[t,n]=y.useState(!1);return{isPopoverOpen:t,setIsPopoverOpen:n,handleTogglePopover:r=>{const a=r??!t;n(a),a&&T.logEvent("Memory Update Popover Shown",{updateCount:e.length})}}}function F({memoryWrites:e,popoverState:t,triggerButton:n,isParagen:s,gizmoId:r,memoryUndoId:a,setShowMemoriesModal:d}){return o.jsxs(ne,{open:t.isPopoverOpen,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 max-w-96 min-w-60 text-sm",onOpenChange:i=>t.handleTogglePopover(i),disableAutofocus:!0,triggerButton:n,children:[o.jsx("div",{className:"border-token-border-default bg-token-main-surface-secondary mb-2 rounded-sm border",children:e.map((i,l)=>o.jsx("div",{className:"border-token-border-default border-b px-3 py-2 first-letter:uppercase last:border-b-0",children:i},l))}),s?o.jsx("div",{className:"text-token-text-tertiary text-xs",children:o.jsx(u,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):o.jsxs(o.Fragment,{children:[o.jsx(he,{gizmoId:r,memoryUndoId:a}),o.jsx(I,{onClick:()=>{d(!0),T.logEvent("Memory Update Popover Manage Button Clicked",{updateCount:e.length})},children:o.jsx(u,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage"})})]})]})}function me({clientThreadId:e,pendingMessage:t,memoryWrites:n,popoverState:s,setShowMemoriesModal:r}){const a=K(),d=Q(e),i=ee({clientThreadId:e}),l=n.join(" ");let h=l.slice(0,50).replace(new RegExp("^\\p{L}","u"),m=>m.toLocaleUpperCase()).replace(/\.$/,"");l.length>50&&(h+="...");const p=async m=>{if(!d)throw new Error("Failed to confirm or reject memory update: serverThreadId is not found");const c=t.metadata?.pending_memory_info;R(e,f=>{A.updateTree(f,g=>{g.updateNodeMessageMetadata(t.id,{pending_memory_info:{...c,is_pending:!1,confirm_result:m}})})});try{await b.safePost("/memories/confirm_or_reject",{requestBody:{message_id:t.id,conversation_id:d,is_confirm:m},authOption:X.SendIfAvailable})}catch{a.danger({id:"memory.confirmOrDenyFail",defaultMessage:"Failed to confirm or reject memory update",description:"Error message when confirming or rejecting memory update fails"},{toastId:"memory_confirm_or_deny_fail"}),R(e,g=>{A.updateTree(g,_=>{_.updateNodeMessageMetadata(t.id,{pending_memory_info:c})})})}};return o.jsxs("div",{className:"flex items-start",children:[o.jsx("div",{className:"text-token-text-tertiary inline-block text-sm font-semibold outline-hidden",children:o.jsx(u,{id:"MemoryActionResult.memoryConfirmation",defaultMessage:"Update memory? {memoryText}",values:{memoryText:o.jsx("div",{className:"inline-block py-1",onMouseOver:()=>s.handleTogglePopover(!0),onMouseOut:()=>s.handleTogglePopover(!1),children:o.jsx(F,{memoryWrites:n,popoverState:s,triggerButton:o.jsx("button",{className:O("text-start font-normal",s.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:o.jsx(u,{id:"MemoryActionResult.memoryWrapper",defaultMessage:"“{memoryWrites}”",values:{memoryWrites:h}})}),setShowMemoriesModal:r})})}})}),o.jsx(w,{className:"text-token-text-tertiary hover:text-token-text-primary ms-3",size:"small",color:"secondary",disabled:i,onClick:()=>{p(!0)},children:o.jsx(u,{id:"MemoryActionResult.confirm",defaultMessage:"Yes"})}),o.jsx(w,{className:"text-token-text-tertiary hover:text-token-text-primary ms-2",size:"small",color:"secondary",disabled:i,onClick:()=>{p(!1)},children:o.jsx(u,{id:"MemoryActionResult.deny",defaultMessage:"No"})})]})}function fe({memoryWrites:e,popoverState:t,isParagen:n,memoryUndoId:s,gizmoId:r,setShowMemoriesModal:a,showTooltip:d}){const i=te(),{eligible:l,markAsViewed:h,isLoading:p}=V(k.hasSeenMemoryUpdatedTooltip),m=!Y(),[c,f]=y.useState(!1),g=v(),x=z(g)?.hasPlusFeatures();return y.useEffect(()=>{!p&&l&&i&&d===!0&&!C?(f(!0),C=!0):!p&&!l&&f(!1)},[d,p,l,i]),e.length===0?null:o.jsxs("div",{className:"flex items-center",children:[o.jsx(oe,{announcementKey:k.hasSeenMemoryUpdatedTooltip,show:c,onDismiss:()=>{h(),T.logEventWithStatsig("Memory Updated Tooltip Dismissed","memory_updated_tooltip_dismissed")},dismissOnOutsideClick:!0,side:m?"bottom":"left",sideOffset:4,theme:"bright",badge:"none",title:o.jsx(u,{id:"MoonshineV2Tooltip.heading",defaultMessage:"Memory in ChatGPT has changed"}),description:o.jsxs(o.Fragment,{children:[x?o.jsx(u,{id:"MoonshineV2Tooltip.description",defaultMessage:"ChatGPT can now reference all chats, but you can still manage individual saved memories."}):o.jsx(u,{id:"MoonshineV2Tooltip.description.freeMoonshine",defaultMessage:"ChatGPT can now reference recent chats, but you can still manage individual saved memories."}),o.jsx("br",{}),o.jsx("a",{href:"https://help.openai.com/en/articles/10303002-how-does-memory-use-past-conversations",target:"_blank",rel:"noopener noreferrer",className:"underline",children:o.jsx(u,{id:"MoonshineV2Tooltip.learnMoreLink",defaultMessage:"Learn more"})},"learn-more-link")]}),children:o.jsx("div",{style:{width:1,height:1}})}),o.jsx("div",{className:"inline-block",onMouseOver:()=>t.handleTogglePopover(!0),onMouseOut:()=>t.handleTogglePopover(!1),children:o.jsx(F,{memoryWrites:e,popoverState:t,isParagen:n,gizmoId:r,memoryUndoId:s,triggerButton:o.jsxs("button",{className:O("my-1 flex items-center gap-1 text-sm font-semibold outline-hidden",t.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:[o.jsx(re,{className:"mb-[-1px]"}),e.length===1?o.jsx(u,{id:"MemoryActionResult.memoryWriteSingular.New",defaultMessage:"Updated saved memory"}):o.jsx(u,{id:"MemoryActionResult.memoryWritePlural.New",defaultMessage:"Updated saved memories"})]}),setShowMemoriesModal:a})})]})}function ye(e){const t=q(e),n=t?.metadata?.pending_memory_info?.confirm_result;return t==null?null:n===!0?"confirmed":n===!1?"denied":"pending"}function ve({messages:e,clientThreadId:t,gizmoId:n,isParagen:s}){const r=ae(e),a=ce(r),d=le(e),i=de(e);ue(r);const l=q(e),h=v(),m=N(h,"3983984123").get("is_memory_undo_enabled",!1);L(h,"1900515849");const c=y.useRef(!1),f=U();y.useEffect(()=>{d&&c.current===!1&&(c.current=!0),!d&&!l&&i&&c.current&&f.invalidateQueries({queryKey:[j,n]})},[d,l,i,n,f]);const{data:g}=$({queryKey:[j,n],queryFn:()=>E.getCurrentMemoryUndoId(n),enabled:m&&!d&&!l}),[_,x]=y.useState(!1),P=ye(e);return P==="denied"?null:o.jsxs(o.Fragment,{children:[P==="pending"?o.jsx(me,{clientThreadId:t,memoryWrites:r,popoverState:a,setShowMemoriesModal:x,pendingMessage:l}):o.jsx(fe,{memoryWrites:r,popoverState:a,isParagen:s,memoryUndoId:g?.current_memory_undo_id===i?i:void 0,setShowMemoriesModal:x,showTooltip:c.current&&r.length>0}),_&&o.jsx(ie,{initialGizmoId:n,onClose:()=>x(!1)})]})}function I({children:e,disabled:t,onClick:n}){return o.jsxs("button",{className:"hover:bg-token-main-surface-secondary flex w-full items-center justify-between rounded-sm px-3 py-2 font-semibold",disabled:t,onClick:n,children:[e,o.jsx(se,{className:"icon text-token-text-tertiary -me-1"})]})}function he({gizmoId:e,memoryUndoId:t}){const n=v(),r=N(n,"3983984123").get("is_memory_undo_enabled",!1),a=U(),{isPending:d,mutate:i}=J({mutationFn:l=>E.undoMemoryWrite(e,l),onSuccess:()=>{a.invalidateQueries({queryKey:[j,e]})}});return!r||!t?null:o.jsx(I,{disabled:d,onClick:()=>{t&&i(t)},children:o.jsx(u,{id:"qeyS8G",defaultMessage:"Undo"})})}function pe(e){const t=["The user ","The user's ","User ","User's "];for(const n of t)if(e.startsWith(n))return e.slice(n.length);return e}export{ve as MemoryActionResult};
//# sourceMappingURL=gtcba4tg0kf9imwf.js.map
