import{r as d,j as e,g as ve,e as te,m as _,A as Q}from"./lu2xqwqmjc95q6j6.js";import{t as ge,ce as q,T as G,g as J,eW as je,G as se,C as ne,aB as ye,d as oe,hk as Ce,B as Me}from"./hml6mmd5fyx85si7.js";import{W as be}from"./99iw5y145xpdn59x.js";import{jF as we,jG as Se,dJ as ke,jH as Ne,iI as w,jI as De,b1 as Ie,jJ as ae,iJ as $e,jK as R,cf as A,jL as _e,jM as Ee,jN as W,jO as Oe,gQ as Te}from"./rseqzngxzbdt1oxg.js";import{S as Ve}from"./h4l33ad0t7yj9qpv.js";import{u as Ae,g as Fe}from"./nqhms3hjv4xx51bl.js";import{u as Be,g as Le}from"./kwkdy8yi68wn8j9i.js";import{r as Pe}from"./bim6j1enukewtwft.js";import"./fi4t5vltimyk5jia.js";import"./gdia3no5klrjgyrj.js";import"./ifbdwgrs45s6gn7j.js";import"./k5epsa4c8f1mfvu0.js";import"./oqyy1xfq5y51tstr.js";function We(s,t){const a={},r=(n,c="")=>{Object.entries(n).forEach(([h,v])=>{const x=c?`${c}.${h}`:h;v&&typeof v=="object"&&!Array.isArray(v)?r(v,x):v&&(typeof v=="number"||typeof v=="string"||v==null)&&(a[x]=v)})};r(s);const i={},l=n=>i[n]||={},m=n=>{if(n!=null){if(typeof n=="number")return n;if(typeof n=="string")return new Date(n).getTime()}};Object.keys(a).forEach(n=>{const c=a[n];if(c==null)return;const h=n.split(".").pop(),v=[[/^(.*)_start_time$/,"start",x=>x[1]],[/^(.*)_end_time$/,"end",x=>x[1]],[/^(.*)_sent_time$/,"start",x=>x[1]],[/^(.*)_success_time$/,"end",x=>x[1]],[/^(.*)_time$/,"start",x=>x[1]]];for(const[x,D,M]of v){const b=h.match(x);if(b){const g=M(b),F=l(g);F[D]=m(c);break}}});const u=[];Object.entries(i).forEach(([n,{start:c,end:h}])=>{c!==void 0&&h!==void 0?u.push({name:n,start:c,end:h,duration:h-c}):c!==void 0&&u.push({name:n,start:c,end:c,duration:0,noEnd:!0})});let p=u;if(t&&t.length){const n=new Set(t);p=p.filter(c=>n.has(c.name))}return p.sort((n,c)=>n.start-c.start||n.name.localeCompare(c.name)),p}const H=["text-blue-400","text-green-400","text-purple-400","text-orange-400","text-red-400","text-pink-400","text-yellow-400","text-gray-500","text-blue-300","text-green-300"],Ue=({json:s,focusNames:t,width:a,barHeight:r=18,rowGap:i=6,paddingX:l=50,paddingTop:m=20})=>{const u=d.useRef(null),[p,n]=d.useState(a||600);ge(()=>{if(!a){const o=()=>{if(u.current){const f=u.current.clientWidth;n(Math.max(300,f))}};return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)}},[a]);const c=d.useMemo(()=>We(s,t),[s,t]),[h,v]=d.useState({}),x=d.useCallback(o=>h[o]!==!1,[h]),D=d.useCallback(o=>v(f=>({...f,[o]:f[o]===!1})),[]),M=d.useMemo(()=>c.filter(o=>x(o.name)),[c,x]),b=M.length>0,g=b?Math.min(...M.map(o=>o.start)):0,F=b?Math.max(...M.map(o=>o.end)):1,I=Math.max(F-g,1),B=m+c.length*(r+i)+i+32,ce=(c.length?Math.max(...c.map(o=>o.name.length)):0)*7+16+16,E=Math.max(l,ce),le=l,L=(p-E-le)/I,[de,Y]=d.useState(null),[O,X]=d.useState({visible:!1,x:0,y:0,lines:[]}),Z=(o,f)=>{if(!u.current)return;const j=u.current.getBoundingClientRect(),y=f.clientX-j.left,T=f.clientY-j.top,N=(o.start-g).toFixed(2),$=o.noEnd?void 0:(o.end-g).toFixed(2),P=$?[`start: ${N} ms`,`end: ${$} ms`,`dur: ${o.duration.toFixed(2)} ms`]:[`start: ${N} ms`];X({visible:!0,x:y+10,y:T+10,lines:P})},ue=()=>X(o=>({...o,visible:!1})),me=d.useMemo(()=>{if(!b)return[0,I];const o=new Set;M.forEach(j=>{o.add(j.start-g),o.add(j.end-g)});const f=Array.from(o).sort((j,y)=>j-y);return f[0]!==0&&f.unshift(0),f[f.length-1]!==I&&f.push(I),f},[M,g,I,b]);return e.jsxs("div",{ref:u,className:"relative w-full",style:a?{width:`${a}px`}:void 0,children:[e.jsxs("svg",{width:p,height:B,className:"font-sans",children:[c.map((o,f)=>{const j=m+f*(r+i),y=x(o.name)?E+(o.start-g)*L:0,T=x(o.name)?Math.max(o.duration*L,1):0,N=H[f%H.length],$=de===f?"opacity-80":"opacity-100",P=o.duration===0,K=!!o.noEnd,xe=S=>{x(o.name)&&(Y(f),Z(o,S))},pe=S=>{x(o.name)&&Z(o,S)},fe=()=>{Y(null),ue()};return e.jsxs("g",{onMouseEnter:xe,onMouseMove:pe,onMouseLeave:fe,children:[e.jsx("foreignObject",{x:0,y:j,width:E-8,height:r,requiredExtensions:"http://www.w3.org/1999/xhtml",children:e.jsx("div",{className:"pointer-events-auto box-border flex h-full items-center justify-end gap-1 pe-1 text-[12px] text-neutral-900 select-none",children:e.jsxs("label",{className:"flex cursor-default items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:x(o.name),onChange:()=>D(o.name),className:"cursor-pointer"}),e.jsx("span",{children:o.name})]})})}),x(o.name)&&(K?(()=>{const S=j+r/2,V=r*.6/2,he=[`${y},${S-V}`,`${y+V},${S}`,`${y},${S+V}`,`${y-V},${S}`].join(" ");return e.jsx("polygon",{points:he,fill:"currentColor",className:`${N} ${$}`})})():P?e.jsx("line",{x1:y,x2:y,y1:j,y2:j+r,stroke:"currentColor",strokeWidth:2,className:N}):e.jsx("rect",{x:y,y:j,width:T,height:r,fill:"currentColor",className:`${N} ${$}`})),x(o.name)&&e.jsxs("text",{x:y+(K?r*.6:T)+4,y:j+r/2+4,fill:"currentColor",className:"text-xs text-neutral-700",children:[o.duration.toFixed(2)," ms"]})]},o.name)}),me.map(o=>{const f=E+o*L;return e.jsx("line",{x1:f,x2:f,y1:m-3,y2:B-32,stroke:"currentColor",strokeWidth:1,className:"text-gray-200"},o)}),e.jsx("text",{x:p/2,y:B-6,textAnchor:"middle",fill:"currentColor",className:"text-xs text-neutral-600",children:"Time since first event (ms)"})]}),O.visible&&e.jsx("div",{className:"pointer-events-none absolute z-10 rounded bg-black/90 px-1.5 py-1 font-mono text-xs whitespace-nowrap text-white",style:{left:O.x,top:O.y},children:O.lines.map((o,f)=>e.jsx("div",{children:o},f))})]})};var U,ee;function Re(){if(ee)return U;ee=1;var s=Pe(),t=we(),a=s(function(r,i,l){return r+(l?" ":"")+t(i)});return U=a,U}var ze=Re();const Qe=ve(ze);function qe({conversationId:s}){const t=q(s),a=G.getCurrentNode(J(s))?.id,r=Se();return ke()?e.jsx(k,{conversationId:t??s,parentMessageId:a,status:r}):null}function k(s){const t=s?.status?.modes,[a,r]=d.useState(!1),[i,l]=d.useState(),m=d.useCallback(n=>{l(n),r(!0)},[]),u=te(),p=d.useCallback(()=>r(!1),[]);return e.jsxs(e.Fragment,{children:[e.jsx(je,{contentAlign:"center",triggerButton:e.jsx(k.Trigger,{}),children:t?t.map(n=>d.createElement(k.Item,{...s,key:n.display_name,voiceStatusMode:n,onShowModal:m})):e.jsx("div",{role:"progressbar","aria-valuetext":u.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:e.jsx(se,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),e.jsx(k.Modal,{conversationId:s.conversationId,disabledModeMetadata:i,isOpen:a,onClose:p})]})}k.Modal=function(t){const a=t.disabledModeMetadata?.buttons??[],r=Be({buttons:a,conversationId:t.conversationId,onClick:t.onClose}),i=e.jsx(Ne,{children:t.disabledModeMetadata?.description_markdown});return e.jsx(ne,{testId:"modal-voice-mode",title:t.disabledModeMetadata?.title,description:i,isOpen:t.isOpen,onClose:t.onClose,type:"success",primaryButton:r.primary,secondaryButton:r.secondary})};k.Trigger=d.forwardRef(function(t,a){const r=w(i=>i.voiceMode);return e.jsxs(De,{ref:a,...t,children:[Qe(r)??e.jsx(se,{}),e.jsx(Ie,{className:"icon text-token-text-tertiary"})]})});k.Item=function({conversationId:t,parentMessageId:a,voiceStatusMode:r,onShowModal:i}){const{disabled_mode_metadata:l,mode:m}=r,{startVoiceMode:u}=Ae(),p=q(t),n=d.useCallback(async()=>{l?i(l.disabled_message):u(Fe({serverThreadId:p,parentMessageId:a,isAdvancedMode:m==="advanced"&&!l,eventSource:"voice_mode_picker",clientThreadId:t,gizmoId:G.getGizmoId(J(t)),skipCacheReason:"debug-button-clicked"}))},[t,l,m,i,a,p,u]);return e.jsx(ye.Item,{onClick:n,children:e.jsxs("div",{children:[r.display_name,e.jsx("div",{className:"text-token-text-tertiary text-xs",children:r.description})]})})};function vt({conversationId:s}){const t=w(i=>i.voiceSessionId),a=w(i=>{const{sessionCreateTime:l,sessionConnectedTime:m}=i.metrics;return l&&m?m.getTime()-l.getTime():null}),r=d.useCallback(i=>i>=1e3?`${(i/1e3).toFixed(2)}s`:`${i.toFixed(0)}ms`,[]);return e.jsx("div",{className:"relative h-full",children:e.jsx(_.div,{className:"border-s-token-sidebar-surface-secondary bg-token-main-surface-secondary absolute hidden h-full max-w-[500px] overflow-y-auto rounded-xl border-s pt-4 shadow-inner md:block",initial:{opacity:0,x:520,width:"0px"},animate:{opacity:1,x:0,width:"500px",left:"-520px"},exit:{opacity:0,x:520,width:"0px",left:"0px"},transition:{type:"tween"},children:e.jsx(Q,{children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(qe,{conversationId:s})}),e.jsxs("div",{className:"p-4 py-2 text-sm",children:[e.jsx(C,{name:"Voice Session ID",text:t??"n/a"}),e.jsx(Ge,{conversationId:s}),e.jsx(C,{name:"Connect Latency",text:a!==null?r(a):"n/a"}),e.jsx(Je,{})]}),e.jsxs("div",{className:"flex h-full w-full flex-col flex-nowrap gap-4",children:[e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-col flex-nowrap gap-4",children:[e.jsx(Ye,{}),e.jsx(Ze,{})]})}),e.jsx(Xe,{})]})]})})})})}function Ge({conversationId:s}){const t=q(s),a=t&&J(t),r=G.getTree(a),l=w(c=>c.server.messages.findLast(h=>h.type===ae.ConversationUpdate))?.payload.parent_message_id,m=l?r.findNode(c=>c.message.author.role==="assistant"&&Ce.isMultimodalTextMessage(c.message),l):void 0,{model_definition_slug:u,model_definition_virtual_model_id:p}=m?.message.metadata?.__internal??{},n=[u,p].filter(Boolean).join(", ")??"pending model response";return e.jsx(C,{name:"Model ID",text:n,allowWrap:!0})}function Je(){const[s,t]=d.useState(!1),[a,r]=d.useState({}),i=$e(),l=d.useCallback(()=>{t(m=>!m)},[]);return d.useEffect(()=>{s&&Le(i).then(r)},[s,i]),e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"cursor-pointer font-semibold text-blue-500 hover:underline",onClick:l,children:s?"Hide Client Metrics Chart":"Show Client Metrics Chart"}),e.jsxs(ne,{testId:"modal-client-metrics",title:"Client Metrics",isOpen:s,onClose:()=>t(!1),size:"fullscreen",showCloseButton:!0,children:[e.jsx(Ue,{json:a}),e.jsx("pre",{className:"bg-token-bg-tertiary text-token-text-secondary m-4 overflow-x-auto rounded-md p-2 text-[10px] font-semibold",children:JSON.stringify(a,null,2)})]})]})}function Ye(){const[s,t]=d.useState("timestamp"),[a,r]=d.useState("asc"),i=w(n=>n.server.messages.filter(c=>c.type===ae.Performance)),l=i[i.length-1],m=d.useCallback(n=>n>=1e3?`${(n/1e3).toFixed(2)}s`:`${n.toFixed(1)}ms`,[]),u=d.useMemo(()=>l?[...l.payload.metrics].sort((n,c)=>{const h=s==="name"?n.name.localeCompare(c.name):n.ms-c.ms;return a==="asc"?h:-h}):[],[l,s,a]);if(!l)return null;const p=n=>{n===s?r(a==="asc"?"desc":"asc"):(t(n),r("asc"))};return e.jsx(ie,{title:"Performance",children:e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(z,{text:"Metric"}),s==="name"?a==="asc"?e.jsx(R,{}):e.jsx(A,{}):null]}),e.jsxs("div",{className:"flex cursor-pointer flex-row items-center",onClick:()=>p("timestamp"),children:[e.jsx(z,{text:"Timestamp"}),s==="timestamp"?a==="asc"?e.jsx(R,{}):e.jsx(A,{}):null]}),u.map(n=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:n.name},n.name),e.jsx("span",{className:"bg-token-main-surface-tertiary line-clamp-1 rounded-lg p-0.5 px-1 font-mono text-xs",children:m(n.ms)},n.name+n.ms)]}))]})})}function Xe(){const s=w(t=>t.server.messages);return e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-token-text-secondary px-4 py-2 text-lg font-semibold",children:"Messages"}),e.jsx("div",{className:"grow",children:e.jsx(be,{children:e.jsx(_.ul,{className:"flex w-full flex-col",initial:"initial",animate:"animate",exit:"exit",variants:re,transition:{delayChildren:.25,staggerChildren:.05},children:s.map((t,a)=>e.jsx(He,{index:a,message:t},a))})})})]})}function Ze(){const s=w(u=>u.server.connectionState),t=w(u=>u.dev.room),[a,r]=d.useState("Unknown"),i=t?.localParticipant,l=t?.numParticipants??"Unknown",m=t?.activeSpeakers??[];return d.useEffect(()=>{if(i){const u=p=>{r(p)};return i.on("connectionQualityChanged",u),()=>{i.off("connectionQualityChanged",u)}}},[i]),e.jsxs(ie,{title:"Room",open:!1,children:[e.jsx(C,{name:"Connection Quality",text:String(a)}),e.jsx(C,{name:"Connection State",text:String(s)}),e.jsx(C,{name:"Participants",text:l}),e.jsx(C,{name:"Speakers",text:m.length}),e.jsx(Ke,{})]})}function Ke(){const s=w(c=>c.dev.room),[t,a]=d.useState(null),[r,i]=d.useState(null),[l,m]=d.useState(null),u=s?.getActiveDevice("audioinput"),p=s?.getActiveDevice("audiooutput"),n=s?.getActiveDevice("videoinput");return d.useEffect(()=>{async function c(){const h=await W.getLocalDevices("audioinput"),v=await W.getLocalDevices("audiooutput"),x=await W.getLocalDevices("videoinput"),D=h.find(g=>g.deviceId===u),M=v.find(g=>g.deviceId===p),b=x.find(g=>g.deviceId===n);a(D?.label??"Unknown"),i(M?.label??"Unknown"),m(b?.label??null)}c()},[u,p,n]),e.jsxs(e.Fragment,{children:[e.jsx(z,{text:"Devices"}),l?e.jsx(C,{icon:_e,name:"Video Input",text:l}):null,e.jsx(C,{icon:Ee,name:"Audio Input",text:t??"Unknown"}),e.jsx(C,{icon:Ve,name:"Audio Output",text:r??"Unknown"})]})}function ie({title:s,titleClassName:t,children:a,open:r}){const[i,l]=d.useState(r??!0);return e.jsxs("div",{children:[e.jsxs("h3",{className:oe("text-token-text-secondary flex cursor-pointer items-center py-2 text-lg font-semibold",t),onClick:()=>l(!i),children:[e.jsx("span",{children:s}),e.jsx("span",{className:"ms-2",children:i?e.jsx(A,{className:"icon-sm"}):e.jsx(R,{className:"icon-sm"})})]}),e.jsx(Q,{initial:!1,children:i&&e.jsx(_.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{height:"auto",opacity:1},collapsed:{height:0,opacity:0}},transition:{duration:.3,ease:"easeInOut"},layout:!0,children:a},"content")})]})}function z({text:s}){return e.jsx("h4",{className:"py-2 text-sm font-semibold",children:s})}function C(s){return e.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[e.jsx("span",{className:"opacity-85",children:s.icon?e.jsx(s.icon,{className:"h-[0.75rem] w-[0.75rem]"}):e.jsxs("span",{className:"text-sm",children:[s.name,":"]})}),s.content??e.jsx("span",{className:oe(["bg-token-main-surface-tertiary rounded-lg p-0.5 px-1 font-mono text-xs",!s.allowWrap&&"line-clamp-1"]),children:s.text})]})}function He({index:s,message:t}){const[a,r]=d.useState(!1),i=te();let l=null;switch(t.source){case"remote":l=Te;break;case"local":l=Oe;break}const m=d.useCallback(u=>{u.stopPropagation(),u.preventDefault(),r(p=>!p)},[]);return e.jsx(_.div,{className:"border-token-bg-tertiary w-full border-t px-4 py-0",variants:re,children:e.jsxs("div",{className:"bg-token-main-surface-secondary flex w-full flex-col gap-1 rounded-lg",children:[e.jsx("div",{className:"text-token-text-secondary font-mono text-[0.65rem] font-semibold",children:e.jsxs("div",{className:"flex w-full cursor-pointer flex-row flex-nowrap items-center justify-between hover:text-red-500",onClick:m,children:[e.jsxs("div",{className:"flex flex-row flex-nowrap items-center",children:[e.jsx(l,{className:"text-token-text-secondary me-2 h-3 w-3"}),e.jsx("span",{children:`| ${s+1} | ${i.formatDate(t.timestamp,{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:2})} | ${t.type}`})]}),e.jsx("div",{className:"flex max-h-[20px] flex-row flex-nowrap items-center",children:e.jsx(Me,{className:"rounded-full p-0",color:"ghost",size:"small",onClick:m,children:e.jsx(A,{className:`transform transition-transform ${a?"rotate-180":""}`})})})]})}),e.jsx(Q,{children:a?e.jsx(_.pre,{initial:{opacity:0,transform:"blur(4px)"},animate:{opacity:1,transform:"blur(0px)"},exit:{opacity:0,transform:"blur(4px)"},className:"bg-token-bg-tertiary text-token-text-secondary mb-1 overflow-x-auto rounded-md p-0 text-[10px] font-semibold",children:JSON.stringify(t.payload,null,2)}):null})]})})}const re={hidden:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:100}};export{vt as VoiceModeDevPanel};
//# sourceMappingURL=hsdpku6847ofw5vq.js.map
