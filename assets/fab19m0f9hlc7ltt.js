const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/tjh4axf25w6zyz2r.js","assets/lu2xqwqmjc95q6j6.js","assets/rseqzngxzbdt1oxg.js","assets/hml6mmd5fyx85si7.js","assets/root-c0w5lvnh.css","assets/conversation-small-gcvo4yhm.css","assets/f251sy8gvgjvi4td.js","assets/iq82wz84d1fxj03i.js","assets/elolu96rnfzqcgif.js","assets/kcqshnk26ykm1u4n.js","assets/fibktxptqydbr54o.js","assets/6a3e5rtr9pyzi31y.js","assets/ogr5nmy9hq7gfgq0.js","assets/cqyjjngibokvfw83.js","assets/ik8y7nlve9mzjttb.js","assets/isxemcalu9537a8n.js","assets/ejklrllfl9wcn2za.js","assets/lao8y60wfyizx9bl.js"])))=>i.map(i=>d[i]);
import{d as O,B as ye,bb as Me,F as je,x as Re,L as ae,jh as se,s5 as ke,lO as ie,iG as Ne,ji as re,a as ge,b5 as Ae,aJ as Ge,bO as me,ay as Ee,n as Pe,aH as fe,J as Ue,O as De,W as Te,Q as ze,V as ee,s6 as I,aN as Le,gs as Oe,P as Be,T as te,g as he,R as Fe,cj as He,fg as qe,s7 as We,ce as $e,s8 as oe,s9 as Ve,sa as Ke,pe as Je,cP as Qe,c4 as Xe,ap as Ye,aq as Ze}from"./hml6mmd5fyx85si7.js";import{j as n,m as F,e as q,a as et,r as a,A as tt,l as xe,b as nt}from"./lu2xqwqmjc95q6j6.js";import{I as Y,D as pe,u as at}from"./dzgy4ha1wayftibt.js";import{pm as st,gX as it,d6 as rt,ah as ot,aq as lt,an as H,as as ct,at as ut,am as dt,pR as gt,pS as mt,ag as ft,bu as Se,c9 as we,pT as ht,fu as ne,hm as xt}from"./rseqzngxzbdt1oxg.js";import{C as ve}from"./oevbdyhdaqh4lk1q.js";import{I as pt}from"./ga4ehq2rdu1q6u65.js";import{D as St}from"./ckfi4ewp3npyfeir.js";import{C as wt}from"./cvhvuzqgknunygm1.js";import"./isxemcalu9537a8n.js";import"./gjid53jxmuj8a8kw.js";import"./grgafnin9dqj3keo.js";const Ie=({children:e,isDimensionsUnknown:t})=>n.jsxs(F.div,{className:O(["relative max-w-[480px] rounded-2xl",t&&"aspect-square overflow-hidden"]),children:[n.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),n.jsx("div",{className:"relative h-full",children:e})]}),vt=({children:e,isDimensionsUnknown:t,width:i,height:o})=>n.jsxs(F.div,{layout:!0,transition:{duration:.3,ease:"easeInOut"},exit:{opacity:0,transition:{duration:.1,ease:"easeInOut"}},className:O(["relative max-w-[480px] overflow-hidden rounded-2xl",t&&"aspect-square"]),style:{width:i??"auto",height:o??"auto"},children:[n.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),n.jsx("div",{className:"relative h-full",children:e})]}),It=()=>{const e=q(),t=et();return n.jsxs("div",{className:"absolute start-0 bottom-0 flex w-full items-center justify-between bg-white/10 p-4",children:[n.jsxs("div",{className:"flex min-w-0 flex-col",children:[n.jsx("span",{className:"text-sm font-medium text-white",children:e.formatMessage({id:"PlfJ+x",defaultMessage:"Creation might take a moment"})}),n.jsx("span",{className:"text-sm font-normal text-white/80",children:e.formatMessage({id:"4JG8yC",defaultMessage:"Upgrade to create faster"})})]}),n.jsx(ye,{size:"medium",color:"primary-inverse",onClick:()=>Me(t,"Image Gen Latency Upsell"),children:e.formatMessage(je.getPlus)})]})};function _t(e){const[t,i]=Re(ae.ImageGenProgressUpsellV2,null,s=>s!=null&&typeof s=="object"&&(typeof s.lastSeenUpsellAt=="number"||s.lastSeenUpsellAt==null)&&(typeof s.lastUsedImageGen=="number"||s.lastUsedImageGen==null)&&(typeof s.lastMessageId=="string"||s.lastMessageId==null)&&(typeof s.lastCanBeSeen=="boolean"||s.lastCanBeSeen==null)),o=t&&t.lastSeenUpsellAt?se(t.lastSeenUpsellAt):null,r=t&&t.lastUsedImageGen?se(t.lastUsedImageGen):null,c=e?t&&t.lastMessageId===e?t.lastCanBeSeen:(o==null||ke(o,ie(new Date,3)))&&r!=null&&Ne(r,ie(new Date,1)):!1;return{canBeSeen:c,markImageGenUsed:()=>{if(e){const s={lastSeenUpsellAt:c?re(new Date):t?.lastSeenUpsellAt??null,lastUsedImageGen:re(new Date),lastMessageId:e??null,lastCanBeSeen:c};i(s),localStorage.setItem(ae.ImageGenProgressUpsellV2,JSON.stringify(s))}}}}function bt(){const[t,i]=a.useState(new Date);a.useEffect(()=>{i(new Date)},[]);const o=it(+t,12e4);return n.jsx(rt,{percentage:o,sizeOverride:30,thickness:1/15,className:"text-white",backgroundStrokeClassName:"stroke-white/20",transitionDuration:`${(100-o)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}const _e=({isGettingStarted:e,messageId:t})=>{const i=ge(),r=Ae()?.isFree()??!1,{canBeSeen:c,markImageGenUsed:l}=_t(t),s=r&&c&&Ge(i,"1997515563").get("should_show_image_gen_latency_upsell",!1);st(()=>{l()});const d=q(),g=a.useMemo(()=>e?d.formatMessage({id:"SxQKjt",defaultMessage:"Getting started"}):d.formatMessage({id:"Y3ETLn",defaultMessage:"Creating image"}),[e,d]),u=me(i,"3019066937").get("should_show_cot_header",!1),w=a.useMemo(()=>e?n.jsx(ve,{size:30,arcPercentage:.2,strokeWidth:2}):n.jsx(bt,{}),[e]);return n.jsxs("div",{className:O("absolute inset-0 flex justify-between px-6 py-6",s?"items-start":"items-end"),children:[n.jsxs(tt,{mode:"popLayout",children:[u&&n.jsx(F.span,{className:O("flex items-center gap-1 align-middle text-lg",!e&&"text-white"),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,overflow:"hidden",whiteSpace:"nowrap"},transition:{duration:.1,ease:"easeInOut"},children:g},g),n.jsx("div",{className:"flex flex-1 items-center justify-end",children:w})]}),s&&n.jsx(It,{})]})},le=Ee.div`invisible absolute top-3 flex gap-1 group-hover/paragen-image:visible z-2
  ${({$rightAlign:e})=>e?"end-3":"start-3"}
  ${({$alwaysVisible:e})=>e?"visible":""}`,Ct=({imageUrl:e})=>{const[t,i]=a.useState(void 0),o=q(),r=ot(),c=a.useCallback(()=>{const l=new Date;return`${o.formatDate(l,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}.png`},[o]);return n.jsxs("div",{className:"group/paragen-image absolute inset-0 z-3",children:[n.jsxs(le,{$alwaysVisible:!0,children:[t!==!1&&n.jsx(Y,{icon:lt,selected:t===!0,variant:"large",onClick:l=>{l.stopPropagation(),H.paragenImageRated({liked:!0,analyticsContext:r}),i(!0)}}),t!==!0&&n.jsx(Y,{icon:ct,selected:t===!1,variant:"large",onClick:l=>{l.stopPropagation(),H.paragenImageRated({liked:!1,analyticsContext:r}),i(!1)}})]}),n.jsx(le,{$alwaysVisible:!0,$rightAlign:!0,children:n.jsx(Y,{icon:ut,variant:"large",onClick:l=>{l.stopPropagation(),H.paragenDownload({analyticsContext:r}),dt({url:e,fileName:c()})}})})]})};function be({withLottie:e}){const i=q().formatMessage({id:"imagegen.progressIndicator.ariaLabel",defaultMessage:"Generating image..."});return n.jsx("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full","aria-label":i,children:n.jsx(ve,{size:40,arcPercentage:.2,children:n.jsx(St,{animate:e,matchTextColor:!0,className:"h-6 w-6"})})})}const Ce=300,yt=1.3,ce=.05,Mt=/blur\(([\d.]+)px\)/,jt={duration:Ce/1e3,ease:"linear"};function Z(e,t,i){e.sort((l,s)=>l.lastSrcReceivedTime-s.lastSrcReceivedTime);const o=new Array(e.length).fill(0);for(let l=0;l<=e.length;l+=1){const s=l-1,d=l,g=e[s]?.availablePercentComplete??0,u=e[d]?.availablePercentComplete??1;if(t>=g&&t<=u&&g!==u){const w=(t-g)/(u-g);o[s]=1-w,o[d]=w}}const r=o[o.length-1],c=o[o.length-2];return r===1&&c===0&&(o[o.length-2]=.01),i&&t<=e[0]?.availablePercentComplete&&(o[0]=1),o}const Rt=({alt:e,src:t,availablePercentComplete:i,onAnimationUpdate:o,ignoreFirstChunk:r=!1,isTransparent:c=!1,dimensions:l,onError:s,unconstrainedWidth:d=!1,progressLoaderProps:g})=>{const u=Pe(),w=a.useMemo(()=>`url(${u?gt:mt})`,[u]),[v,A]=a.useState(!1),[_,h]=a.useState(1e3),[b,k]=a.useState(i??0),[f,S]=a.useState(i===1?1:0),G=a.useRef(performance.now()),j=a.useRef(0),x=a.useRef([]),[U,P]=a.useState([0]),[B,z]=a.useState(i===1),L=a.useRef(!1),D=a.useRef(null),R=b===1,M=i===1&&B,N=l?l.width/l.height:1;a.useEffect(()=>{!v&&i&&(A(!0),j.current=performance.now())},[v,i]),a.useEffect(()=>{const C=x.current[x.current.length-1]?.src;if(t&&t!==C){const m=x.current.findIndex(y=>y.availablePercentComplete===i);m!==-1?x.current[m]={src:t,availablePercentComplete:i??0,lastSrcReceivedTime:performance.now()}:x.current.push({src:t,availablePercentComplete:i??0,lastSrcReceivedTime:performance.now()}),P(Z(x.current,b,r))}},[t,b,r,i]);const E=a.useCallback(()=>{D.current&&i&&(h(M?Ce:(performance.now()-G.current)*yt),(!r||L.current||i>=ce)&&i!==1&&S(i),L.current=!0,G.current=performance.now(),g?.setHasImageReady(!0))},[i,M,r,g]),K=a.useCallback(C=>{const m=parseFloat(C.height)/100;o?.(m),k(m),P(Z(x.current,parseFloat(C.height)/100,r))},[o,r]),W=a.useCallback(C=>{const m=C.filter.toString().match(Mt)?.[1]??"0",p=(16-parseFloat(m))/16,J=1-f,X=f+J*p;o?.(X),k(X),P(Z(x.current,X,r))},[r,f,o]);if(!v)return n.jsx(Ie,{isDimensionsUnknown:!0,children:n.jsx(be,{withLottie:!0})});const V={duration:_/1e3,ease:"linear"},T=i!==1||!c;return n.jsxs("div",{className:O("relative z-0 cursor-pointer overflow-hidden",N<1?"max-w-[400px]":"max-w-[480px]",!R&&"pointer-events-none",!L.current&&"bg-token-main-surface-secondary",d&&"max-w-full"),"aria-label":e,style:{aspectRatio:N},children:[!g?.shouldHideDiagonalShimmer&&i&&i<ce&&n.jsx("div",{className:"absolute inset-0 z-3 w-full overflow-hidden",children:n.jsx("div",{className:"absolute start-[-150%] top-[-150%] h-[400%] w-[400%]",children:n.jsx("div",{className:"diagonal-sweep-gradient h-full w-full"})})}),n.jsxs(F.div,{className:"absolute start-0 end-0 top-0 z-2 w-full overflow-hidden transition-[mask] ease-linear",initial:M?!1:{height:"0%"},animate:R?{height:"100%"}:{height:`${f*100}%`},onUpdate:M?void 0:K,transition:M?{duration:0,ease:"linear"}:V,style:R?void 0:{mask:"linear-gradient(rgb(0,0,0) 0%, rgb(0,0,0) calc(100% - 24px), rgba(0,0,0,0) 100%)"},children:[t&&n.jsx("img",{ref:D,src:t,onLoad:E,onError:s,alt:e,className:"absolute top-0 z-1 w-full",style:{aspectRatio:N}}),c&&n.jsx("div",{className:"absolute inset-0 z-0 w-full overflow-hidden opacity-0 transition-opacity duration-300 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100",children:n.jsx("div",{className:"absolute inset-0 bg-repeat",style:{backgroundImage:w,backgroundSize:"auto"}})})]}),n.jsx(F.div,{className:"relative z-1 w-full overflow-hidden",initial:{filter:"blur(16px)"},animate:M?{filter:"blur(0px)"}:void 0,transition:M?jt:void 0,onUpdate:M?W:void 0,style:{aspectRatio:N},children:x.current.map((C,m)=>{const y=U[m],p=C.availablePercentComplete===1;return y!==0||p?n.jsx("img",{src:C.src,alt:e,style:{opacity:y,willChange:"opacity",aspectRatio:N},className:!M&&g?.shouldShowPulseAnimation?"bg-scale-pulse":"",onLoad:p?()=>z(!0):void 0},C.src):null})}),n.jsx(F.div,{className:"absolute inset-0 z-0 scale-110 overflow-hidden blur-2xl",style:{aspectRatio:N},children:T&&x.current.filter((C,m)=>U[m]!==0).map(C=>n.jsx("img",{src:C.src,alt:e,className:"absolute top-0 w-full"},C.src))})]})},kt=({imageAssetPointer:e,serverThreadId:t})=>{const[i,o]=a.useState(void 0),r=ft(),c=e.metadata?.watermarked_asset_pointer,l=a.useRef(!1),{isUnauthenticated:s}=fe();return a.useEffect(()=>{if(r&&c&&!l.current){l.current=!0;const g=Ue(c);De(g,void 0,s,t,!1).then(u=>{u.status===Te.Success&&o(u.download_url)}).catch(u=>{u instanceof ze||ee.addError(new Error(`Could not fetch watermarked image with ID ${c} from file service`,{cause:u}))})}},[r,c,s,t,null]),i},ue=2,Q=({pointer:e,altLabel:t,isEditorAvailable:i,onPercentageRendered:o,messageId:r,imageIndex:c,clientThreadId:l,serverThreadId:s,onEditorClick:d,compact:g,progressLoaderProps:u})=>{const w=xe(),[v,A]=a.useState(void 0),_=a.useRef(void 0),h=e.metadata?.generation?.gen_id,b=e.metadata?.generation?.height??void 0,k=e.height,f=(b??0)/k,S=a.useRef({}),[G]=nt(),{isUnauthenticated:j}=fe(),[x,U]=a.useState(!1),P=a.useContext(pe),B=e.width/e.height,z=kt({imageAssetPointer:e,serverThreadId:s}),D=a.useCallback((m=!1)=>{!m&&_.current===e.asset_pointer||(_.current=e.asset_pointer,Se.fetch(w,{asset:e,conversationId:s,force:m,isUnauthenticated:j}).then(y=>{A(y)}).finally(()=>{_.current=void 0}))},[e,w,s,j,null]);a.useEffect(()=>{const m=e.asset_pointer!==v?.asset_pointer;(!v||m)&&D()},[v,e.asset_pointer,D]);const R=a.useMemo(()=>we({pointer:v,conversationId:s,messageId:r,source:P?"paragen":"chat",imageIndex:c.toString()}),[v,s,r,P,c]),M=a.useRef(f);a.useEffect(()=>{f===1&&M.current<1&&H.renderingComplete({analyticsContext:R})},[f,R]);const N=a.useCallback(()=>{v&&d?.({image:v,messageId:r,analyticsContext:R})},[v,r,d,R]),E=a.useMemo(()=>({width:e.width,height:e.height}),[e]),K=a.useCallback(()=>{const m=(S.current[e.asset_pointer]??0)+1;if(S.current[e.asset_pointer]=m,S.current[e.asset_pointer]>ue)return ee.addAction("image-gen-asset-error",{name:"retries-exhausted",conversation_id:s,asset_pointer:e.asset_pointer,max_retries:ue});ee.addAction("image-gen-asset-retry",{name:"retry-attempted",conversation_id:s,asset_pointer:e.asset_pointer,current_retry:m}),S.current[e.asset_pointer]=m,D(!0)},[e.asset_pointer,D,s]),W=a.useCallback(m=>{m===1&&U(!0),o?.(m)},[o]),$=a.useRef(null),V=a.useRef(null);a.useEffect(()=>{if($.current&&u?.setContainerSize){const m=$.current.getBoundingClientRect(),y={width:m.width,height:m.height},p=V.current;(!p||p.width!==y.width||p.height!==y.height)&&(V.current=y,u.setContainerSize(y))}},[u]);const T=v?.url,C=z??T;return n.jsx(ht.Provider,{value:R,children:n.jsxs("div",{ref:$,className:O("group/imagegen-image relative w-full overflow-hidden",B<1?"max-w-[400px]":"max-w-[480px]",g?"rounded-lg":"rounded-2xl",P&&"max-w-full",r===G.get("image")&&"[view-transition-name:var(--vt-active-image)]"),id:`image-${r}`,style:{aspectRatio:B},onClick:i?N:void 0,tabIndex:0,children:[z&&n.jsx("img",{alt:t,className:"absolute inset-0 z-1 opacity-0",src:z}),n.jsx(Rt,{alt:t,src:T,availablePercentComplete:f,onAnimationUpdate:W,isEditorAvailable:i,ignoreFirstChunk:!0,isTransparent:e.metadata?.generation?.transparent_background,dimensions:E,onError:K,unconstrainedWidth:P,progressLoaderProps:u},h),u?.state&&u?.state!==I.Complete&&!x&&u?.hasImageReady&&n.jsx(_e,{isGettingStarted:!1,messageId:r}),x&&!g&&(P?n.jsx(Ct,{imageUrl:T??""}):n.jsx(pt,{imageAssetPointer:T,imageUrl:C,messageId:r,clientThreadId:l,serverThreadId:s,shouldShowOverflow:z!==void 0}))]},h)})},Nt=({imageGenerationState:e,isInterrupted:t,asyncMessage:i,imageAssetPointer:o,altLabel:r,clientThreadId:c,serverThreadId:l,onEditorClick:s,isEditorAvailable:d,setAnimationPercentage:g,messageId:u})=>{const[w,v]=a.useState(null),A=w==null,[_,h]=a.useState(!0),b=e===I.Thinking||e===I.AsyncGenerating&&!i?.metadata?.is_visually_hidden_from_conversation,k=e===I.Generating||e===I.Complete;return a.useEffect(()=>{b&&h(!1)},[b]),t?null:n.jsxs(n.Fragment,{children:[(b||!_)&&n.jsx(vt,{isDimensionsUnknown:A,width:w?.width,height:w?.height,children:A&&n.jsx(_e,{isGettingStarted:!0,messageId:u})}),k&&n.jsx(F.div,{className:"pb-2",variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:_?"visible":"hidden",exit:"hidden",children:o&&n.jsx(Q,{pointer:o,altLabel:r,isEditorAvailable:d,onPercentageRendered:g,messageId:u,clientThreadId:c,serverThreadId:l,imageIndex:0,onEditorClick:s,progressLoaderProps:{state:e,setContainerSize:v,hasImageReady:_,setHasImageReady:h,shouldHideDiagonalShimmer:!0,shouldShowPulseAnimation:!0}})})]})};function At({title:e,description:t,shimmer:i}){return!e&&!t?null:n.jsxs("div",{className:"border-token-border-default my-2 max-w-[480px] min-w-72 rounded-2xl border p-6",children:[!!e&&n.jsx("p",{className:O("text-lg font-medium",i&&"loading-shimmer-pure-text-inverted",!!t&&"mb-1"),children:e}),!!t&&n.jsx("p",{children:t})]})}const Gt=({cotMessages:e,visualPercentComplete:t,isInterrupted:i=!1,state:o})=>{const c=q().formatMessage({id:"imagegen.thinkingHeader.interrupted",defaultMessage:"Stopped creating image"}),l=o===I.Complete||t===1,s=a.useMemo(()=>{if(i)return c;if(!e)return;if(l)return e.complete;if(t){const d=Object.keys(e.generating);for(let g=0;g<d.length;g+=1){const u=parseFloat(d[g]);if(t<u)return e.generating[d[g]]}}else return e.thinking;return e.complete},[e,c,i,l,t]);return s&&n.jsx(wt,{latestHeadline:s,isComplete:l||i,showChunkIcon:!1,isExpandDisabled:!0})},Et=({pointersToRender:e,altLabel:t,isEditorAvailable:i,updatePercentageRendered:o,toolCallMessage:r,toolOutputMessageIds:c,clientThreadId:l,serverThreadId:s,handleEditorClick:d})=>{const g=ne.useStore(),u=ne.useSelectedIndex();a.useEffect(()=>{g.setSelectedIndex(Math.max(c.findIndex(f=>f===r?.metadata?.selected_image_message_id),0))},[]);const w=a.useRef({}),v=a.useCallback(f=>S=>{w.current[f]=S;const G=Object.keys(w.current).length,j=Object.values(w.current).reduce((x,U)=>x+U,0);o?.(j/G)},[o]),[A,_]=a.useState(null),h=Le(l,te.getRequestId),b=Oe(h);a.useEffect(()=>{!b&&A!=null&&r!=null&&s!=null&&(de(r.id,c[A],l,s),_(null))},[b]);const k=a.useCallback(f=>{g.setSelectedIndex(f);const S=Object.values(w.current);Be.logEventWithStatsig("chatgpt_image_switched","chatgpt_image_switched",{conversationId:s,messageId:c[f],imageIndex:f.toString(),isLoading:(S.length===0||S.some(x=>x<1)).toString()});const j=te.getConversationLastTurn(he(l))?.messages.find(x=>x.id===r?.id)!=null;r!=null&&s!=null&&(j&&b?_(f):de(r.id,c[f],l,s))},[r,c,l,s,g,b,_]);return n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Q,{pointer:e[u],altLabel:t,isEditorAvailable:i,messageId:c[u],imageIndex:u,clientThreadId:l,serverThreadId:s,onEditorClick:d},c[u]),n.jsx("div",{className:"flex flex-col gap-2",children:e.map((f,S)=>n.jsx(Pt,{pointer:f,altLabel:t,isSelected:S===u,onClick:()=>k(S),onPercentageRendered:f.metadata?.generation?.gen_id?v(f.metadata.generation.gen_id):void 0,messageId:c[S],imageIndex:S,clientThreadId:l,serverThreadId:s},c[S]))})]})},Pt=({pointer:e,altLabel:t,isSelected:i,onClick:o,onPercentageRendered:r,messageId:c,imageIndex:l,clientThreadId:s,serverThreadId:d})=>n.jsxs("button",{type:"button",onClick:o,className:"relative w-14 rounded-lg p-1",children:[n.jsx("div",{className:O(i&&"opacity-70"),children:n.jsx(Q,{pointer:e,altLabel:t,isEditorAvailable:!1,onPercentageRendered:r,messageId:c,imageIndex:l,clientThreadId:s,serverThreadId:d,compact:!0})}),i&&n.jsx("div",{className:"border-token-border-default pointer-events-none absolute inset-0 rounded-xl border-2"})]});async function de(e,t,i,o){const r=await Fe.safePost("/image-gen/message-select",{requestBody:{message_id:e,selected_image_message_id:t,conversation_id:o}}),c=r.id;c!=null&&He(i,l=>{qe.updateTree(l,s=>{s.updateNodeMessage(c,r)})})}function Ut(e){const t=e.find(l=>l.author.role==="tool"&&l.author.name===We&&l.content.content_type==="text"),[i,...o]=t?.content.content_type==="text"?t.content.parts:[],r=o.pop(),c=o.length;return i&&r&&o.length>0?{thinking:i,complete:r,generating:o.reduce((l,s,d)=>{const g=(d+1)/c;return l[g.toFixed(2)]=s,l},{})}:void 0}const Dt=e=>{const t=q(),{size:i="image",count:o=1}=e||{};return o>1?{thinking:t.formatMessage({id:"cdnmKo",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"aTbInH",defaultMessage:"Creating images. May take a moment."}),"0.67":t.formatMessage({id:"WRM3Yw",defaultMessage:"Creating images. May take a moment."}),"1.00":t.formatMessage({id:"8ZydRG",defaultMessage:"Creating images. May take a moment."})},complete:t.formatMessage({id:"XQ81dl",defaultMessage:"Images created"})}:i==="xlimage"?{thinking:t.formatMessage({id:"y7op2E",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"cdrDJH",defaultMessage:"Creating image. May take a moment."}),"0.67":t.formatMessage({id:"RP4bRn",defaultMessage:"Adding details"}),"1.00":t.formatMessage({id:"o36MSQ",defaultMessage:"Finishing touches"})},complete:t.formatMessage({id:"QsnnBN",defaultMessage:"Image created"})}:{thinking:t.formatMessage({id:"6c7+kN",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"DP6/8y",defaultMessage:"Creating image"}),"0.67":t.formatMessage({id:"k9y1TT",defaultMessage:"Creating image"}),"1.00":t.formatMessage({id:"GpR7v3",defaultMessage:"Creating image"})},complete:t.formatMessage({id:"l2Izz4",defaultMessage:"Image created"})}},Tt=Ye(()=>Ze(()=>import("./tjh4axf25w6zyz2r.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17])).then(e=>e.ImageGenConversationLightboxNew)),zt=[I.Empty,I.Errored],Qt=({messages:e,clientThreadId:t,isLastTurnInConversation:i,isParagen:o=!1})=>{const r=$e(t),l=q().formatMessage({id:"imagegen.message.altLabel",defaultMessage:"Generated image"}),{messageIds:s,imageAssetPointers:d}=a.useMemo(()=>oe(e),[e]),g=e.find(Ve),u=ne.useSelectedIndex(),w=d?.[u]?.metadata?.generation?.gen_size,v=Dt({size:w??"image",count:d?.length??1}),A=a.useMemo(()=>Ut(e)??v,[e,v]),_=e.find(E=>E.metadata?.image_gen_async),h=a.useMemo(()=>Ke(e,i),[e,i]),b=a.useRef(!1),k=a.useRef(!1),f=a.useRef(null),S=a.useMemo(()=>we({pointer:d[u],conversationId:r,messageId:s[u],source:o?"paragen":"chat",imageIndex:u.toString()}),[d,s,u,r,o]);a.useEffect(()=>{if(!b.current&&(h===I.Thinking||h===I.Generating))b.current=!0,f.current=performance.now();else if(b.current&&!k.current)if(h===I.Complete){const E=f.current?performance.now()-f.current:void 0;H.generationSuccess({analyticsContext:S,durationMs:E}),k.current=!0}else h===I.Errored&&(H.generationFailure({analyticsContext:S,errorReason:"assistant_error"}),k.current=!0)},[h,S]);const G=e[e.length-1],j=a.useMemo(()=>G&&Je(G),[G]),x=ge(),{onRequestCompletion:U}=xt(),B=Qe(t)?.id??null,z=me(x,"3019066937").get("should_use_new_ui",!1),L=at({clientThreadId:t})&&h===I.Complete,[D,R]=a.useState(0),M=xe(),N=a.useCallback(async({image:E,analyticsContext:K})=>{const W=he(t),$=W?te.getConversationTurns(W).flatMap(p=>p.messages):e,{imageAssetPointers:V,messageIds:T}=oe($,{skipSort:!0}),m=(o?[E]:await Promise.all(V.map(p=>Se.fetch(M,{asset:p,conversationId:r})))).map((p,J)=>({id:p.metadata?.generation?.gen_id??T[J],archived:!1,transformationId:p.metadata?.generation?.gen_id??null,url:p.url,assetPointer:p.asset_pointer,thumbnail:null,width:p.width,height:p.height,title:null,conversationId:r,messageId:T[J]}));H.editorClick({sourceOperation:E.metadata?.dalle?.edit_op??"none",analyticsContext:K});const y=m.findIndex(p=>p.assetPointer===E.asset_pointer);Xe(x,({onClose:p})=>n.jsx(Tt,{images:m,initialIndex:y===-1?0:y,onClose:p,onRequestCompletion:U,clientThreadId:t,currentModelId:B}))},[e,r,x,U,t,B,M,o]);return zt.includes(h)?null:n.jsx(pe.Provider,{value:o,children:n.jsx("div",{className:"flex flex-col",children:z?n.jsx(Nt,{imageGenerationState:h,isInterrupted:j,asyncMessage:_,imageAssetPointer:d[0],altLabel:l,clientThreadId:t,serverThreadId:r,onEditorClick:N,setAnimationPercentage:R,isEditorAvailable:L,messageId:s[0]}):n.jsxs(n.Fragment,{children:[h!==I.Unavailable&&h!==I.AsyncGenerating&&h!==I.AsyncHanging&&n.jsx("div",{className:"pb-3",children:n.jsx(Gt,{cotMessages:A,visualPercentComplete:D,isInterrupted:j,state:h})}),h===I.Thinking&&!j&&n.jsx(Ie,{isDimensionsUnknown:!0,children:n.jsx(be,{withLottie:!0})}),h===I.AsyncGenerating&&!_?.metadata?.is_visually_hidden_from_conversation&&n.jsx(At,{shimmer:!0,title:_?.metadata?.ui_card_title,description:_?.metadata?.ui_card_description}),(h===I.Generating||h===I.Complete)&&!j&&n.jsx("div",{className:"pb-2",children:d.length>1?n.jsx(Et,{pointersToRender:d,altLabel:l,isEditorAvailable:L,updatePercentageRendered:R,toolCallMessage:g,toolOutputMessageIds:s,clientThreadId:t,serverThreadId:r,handleEditorClick:N}):n.jsx(Q,{pointer:d[0],altLabel:l,isEditorAvailable:L,onPercentageRendered:R,messageId:s[0],imageIndex:0,clientThreadId:t,serverThreadId:r,onEditorClick:N})})]})})})};export{Qt as ImageGenMessage};
//# sourceMappingURL=fab19m0f9hlc7ltt.js.map
