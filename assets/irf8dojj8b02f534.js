const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/g389dlsfevmplm8p.js","assets/lu2xqwqmjc95q6j6.js","assets/hml6mmd5fyx85si7.js","assets/root-c0w5lvnh.css","assets/h4l33ad0t7yj9qpv.js","assets/ifbdwgrs45s6gn7j.js","assets/rseqzngxzbdt1oxg.js","assets/conversation-small-gcvo4yhm.css","assets/cdnu0xlioh6eeshn.js","assets/gy64pge8qevmvg7e.js","assets/gtcba4tg0kf9imwf.js","assets/k5epsa4c8f1mfvu0.js","assets/glhf2v443rhkp7lb.js","assets/l2fd3uykkvam5v10.js","assets/fco9icd83yq33j7k.js","assets/grgafnin9dqj3keo.js","assets/o9a5ly6ceyr8cas8.js","assets/otivj6rkrc1y06pq.js","assets/mbo24hq56wugb9b1.js","assets/bppy256d7j81mqnq.js","assets/j8xxu9jjbt2cwo9f.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,l as zs,e as is,R as dn,b as gn,M as X,A as mn,d as pn}from"./lu2xqwqmjc95q6j6.js";import{ap as ee,aq as le,d as V,a as rs,bg as $s,l as cs,cB as ls,c as D,pd as hn,ea as fn,cR as ke,D as bn,e0 as vn,pe as Ns,aJ as Qs,aZ as xn,fH as Pe,mP as Sn,P as K,aj as Tn,G as Cn,g$ as yn,aM as In,aS as us,nW as Mn,be as _n,d$ as wn,u as En,A as An,aN as re,i6 as ts,ef as we,hj as jn,mG as kn,n9 as Rn,r as Re,a$ as j,cs as Pn,i5 as Fn,cE as Un,cF as Bn,cP as Nn,mN as Dn,mF as On,mO as Gn,n4 as Hn,jE as Wn,bw as ds,aH as Vn,fa as Ln,o6 as qn,ce as zn,iu as $n,g3 as Ee,gs as Qn,mQ as Jn,ot as Xn,cj as Y,h4 as Zn,aU as Kn,gv as Yn,gw as ea,dP as sa,bO as ta,jS as Ae,js as na,pf as gs,fg as aa,gG as oa,aQ as ia,hk as ra,B as ca,cQ as la,eL as ns,mV as ua,T as C,pg as da,g2 as ga,ay as ma,m as pa,h2 as ha,dd as fa}from"./hml6mmd5fyx85si7.js";import{fq as Js,fr as ba,fs as Xs,ft as va,fu as xa,es as Z,ax as Zs,fv as Sa,ap as Ta,aq as Ca,ar as ya,as as Ia,fw as Ma,fx as _a,el as wa,fy as Ea,bd as Aa,b7 as ja,aS as ka,c0 as Ra,fz as Pa,fA as Fa,fB as Ua,fC as Ba,fD as Na,fE as Da,fF as Oa,fG as Ga,cX as Ds,fH as Ha,bN as Os,fI as Wa,fJ as Va,fK as La,fL as qa,fM as Gs,fN as za,c3 as Hs,fO as $a,fP as Qa,fQ as Ja,fR as Xa,fS as Za,fT as Ka,fU as Ya,fV as eo,cZ as so,fW as to,fX as no,c_ as Ks,fY as ao,fZ as oo,aZ as io,f_ as ro,f$ as co,g0 as lo,g1 as uo,g2 as Ws,g3 as go,g4 as mo,g5 as po,g6 as ho,g7 as fo,g8 as bo,g9 as vo,ga as xo,gb as So,gc as To,gd as Co,ge as yo,gf as Io,gg as Vs,gh as Mo,ak as _o,gi as wo,gj as Eo,gk as Ao,gl as jo,gm as as}from"./rseqzngxzbdt1oxg.js";import{u as ko,a as Ro}from"./isxemcalu9537a8n.js";const Po=ee(()=>le(()=>import("./g389dlsfevmplm8p.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])).then(a=>a.VoicePlayButton)),Fo=ee(async()=>()=>null),Uo=({alwaysShow:a,isUserTurn:t,children:o})=>{const s=c.useRef(null);return c.useEffect(()=>{const i=s.current;i&&(a?requestAnimationFrame(()=>{i&&(i.style.maskPosition=a?"0% 0%":"")}):i.style.maskPosition="")},[a]),e.jsx("div",{className:V("flex",!a&&"absolute start-0 end-0 flex",t?"justify-end":"min-h-[46px] justify-start"),children:e.jsx("div",{ref:s,className:V("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex flex-wrap items-center gap-y-4 p-1 select-none",!t&&"touch:w-[calc(100%+--spacing(3.5))] -mt-1 w-[calc(100%+--spacing(2.5))]",a&&!t&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(a||t)&&"duration-500 group-hover/turn-messages:delay-300",!t&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-size:300%_100%] [mask-position:100%_0%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],t&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:o})})},Bo=({activeVariantIndex:a,clientThreadId:t,conversationMode:o,lastMessage:s,messages:i,numVariants:h,onChangeIndex:l,onRate:g,showCanvasButton:r,showCopyButton:d,showPagination:_,showPlayButton:I,showRatingButtons:O,showRegenerateButton:ue,turn:S,turnIndex:de,parentPrompt:se})=>{const k=rs(),L=is(),f=$s(),Fe=zs(),q=cs(ls),y=D(k,"1894790777"),v=s?.clientMetadata?.rating,G=s?.clientMetadata?.requestId,{imageGenMessages:R,canvasMessage:u,enableImageGenPostSharing:Ue,enableMessageSliceSharing:Be,hasErrorInTurn:Ne,isIncomplete:P}=va(i),T=xa.useSelectedIndex(),z=i.filter(hn).filter(w=>w.recipient==="all"),H=R.length>0,F=u!=null,De=fn(),te=ke(t),Oe=bn(k),$=vn(),Ge=H&&z.length===0&&R.some(Ns),ne=i.some(w=>w.metadata?.n7jupd_message),ae=te!=null&&!Ne&&!P&&!ne&&Oe&&!$&&!q;let Q=null;ae&&(Ue||Be?Q=e.jsx(Oo,{clientThreadId:t,imageGenMessageId:R[T]?.id,messages:i}):De&&Qs(k,"1547743984").get("show_share_button_inline",!1)&&(Q=e.jsx(Z,{onClick:()=>{te&&xn.openSharingModal(te)},label:L.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Zs})));const ge=(s?.content.content_type===Pe.Text||s?.content.content_type===Pe.MultimodalText)&&Sa(s?.content.parts.join(`
`));return s&&Sn(s)&&!Ns(s)?null:e.jsxs(e.Fragment,{children:[_&&e.jsx(Xs,{currentPage:a,onChangeIndex:l,length:h}),d&&!Ge&&e.jsx(Ys,{onClick:w=>{Js(k,t,de,f,w,"mouse",Fe)}}),O&&!H&&e.jsxs(e.Fragment,{children:[v!=="thumbsDown"&&e.jsx(Z,{size:q?"small":"med",onClick:()=>g("thumbsUp"),disabled:v==="thumbsUp",selected:v==="thumbsUp",icon:v==="thumbsUp"?Ta:Ca,label:L.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),v!=="thumbsUp"&&e.jsx(Z,{size:q?"small":"med",onClick:()=>g("thumbsDown"),disabled:v==="thumbsDown",selected:v==="thumbsDown",icon:v==="thumbsDown"?ya:Ia,label:L.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),I&&s&&z.length>0&&!y&&e.jsx(Po,{conversationId:t,message:s,iconClassName:"icon",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),r&&!H&&!F&&!y&&!q&&!ge&&e.jsx(Ma,{clientThreadId:t,turn:S}),Q,!1,ue&&s&&e.jsx(Do,{clientThreadId:t,conversationMode:o,lastMessage:s,messages:i,hasImageGenMessage:H,parentPrompt:se}),y&&e.jsx(_a,{showPlayButton:!!(I&&s&&z.length>0),showCanvasButton:!H&&r,showJujutsuButton:ae&&D(k,"3096078201"),showBranchButton:ae&&D(k,"3550297692"),turnIndex:de,clientThreadId:t,messages:i,imageGenMessageId:R[T]?.id,lastMessage:s,turn:S,requestId:G}),!y&&e.jsx(wa,{children:({openScheduleModal:w,isScheduled:me,isSchedulable:He})=>!me&&He?e.jsx(Z,{icon:Ea,label:L.formatMessage({id:"l12ujd",defaultMessage:"Schedule"}),onClick:w}):null}),!1,!1,null]})},No=({activeVariantIndex:a,clientThreadId:t,numVariants:o,onAnticipateEdit:s,onChangeIndex:i,onEnterEdit:h,showCopyButton:l,showEditMessageButton:g,showPagination:r,turnIndex:d})=>{const _=rs(),I=$s(),O=zs();return e.jsxs(e.Fragment,{children:[l&&e.jsxs(e.Fragment,{children:[!1,e.jsx(Ys,{onClick:S=>{Js(_,t,d,I,S,"mouse",O)}})]}),g&&e.jsx(ba,{onAnticipateEdit:s,onEnterEdit:h}),r&&e.jsx(Xs,{currentPage:a,onChangeIndex:i,length:o})]})},Do=({clientThreadId:a,conversationMode:t,messages:o,hasImageGenMessage:s,lastMessage:i,parentPrompt:h})=>{const l=Ra({clientThreadId:a,conversationMode:t}),g=Pa(a,i),r=c.useCallback(({sourceEvent:d,requestedModelId:_,appendMessages:I,extraStreamParams:O})=>{i&&l({sourceEvent:d,nodeId:i.id,requestedModelId:_,appendMessages:I,extraStreamParams:O})},[i,l]);return s?e.jsx(Fo,{messages:o,onModelSelect:r}):e.jsx(Fa,{className:"text-token-text-secondary hover:bg-token-bg-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:a,message:i,onModelSelect:r,canRegenerateResponse:g,parentPrompt:h})},Ys=({onClick:a})=>{const[t,o]=c.useState(!1),s=Aa(),i=is(),h=c.useCallback(l=>{l.stopPropagation(),K.logEvent("ChatGPT Turn Action Copy Clicked"),a(l),o(!0),setTimeout(()=>{s()&&o(!1)},2e3),Tn.logEvent("chatgpt_turn_action_copy")},[s,a]);return e.jsx(Z,{icon:t?ja:ka,onClick:h,label:i.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function Oo({clientThreadId:a,imageGenMessageId:t,messages:o}){const[s,i]=c.useState(!1),h=is(),l=c.useMemo(()=>t?"media_generation":"message_slice",[t]),g=o?.map(d=>d.id)??void 0,r=ko({clientThreadId:a,imageGenMessageId:t,messageSliceIds:g});return c.useEffect(()=>{K.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action",attachment_type:l})},[l]),e.jsx(Z,{onClick:async()=>{i(!0);try{await r()}finally{i(!1)}K.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action",attachment_type:l,...t?{message_id:t}:{}})},label:h.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:s?Cn:Zs,disabled:s})}const Go=ee(()=>le(()=>import("./gtcba4tg0kf9imwf.js"),__vite__mapDeps([10,2,1,3,6,7,11,12,13])).then(a=>a.MemoryActionResult)),Ho=ee(()=>le(()=>import("./fco9icd83yq33j7k.js"),__vite__mapDeps([14,1,2,3,15,6,7,16])).then(a=>a.AutomationSourceHeader)),Ls=ee(()=>le(()=>import("./otivj6rkrc1y06pq.js"),__vite__mapDeps([17,1,2,3,6,7,18])).then(a=>a.TextMessageEditor)),Wo=ee(()=>le(()=>import("./bppy256d7j81mqnq.js"),__vite__mapDeps([19,1,2,3,6,7,20])).then(a=>a.ChatScreenRetrievalResultsFlyoutContent)),qs=80,Vo=16;function os(){return{minHeight:`calc(100dvh - ${Io}px - 120px)`}}function Lo(a){const{turnIndex:t,isFinalTurn:o,clientThreadId:s,onRequestCompletion:i,currentModelId:h,scrollToMessageId:l,dateHeaderType:g,hideUserActions:r}=a,d=rs(),_=yn(d,s),I=Ua(d),O=In(),ue=c.useContext(us),S=cs(ls),de=!!O&&Mn(O),se=_n(wn.isBusinessWorkspace),k=yo(),{eligible:L}=En(An.hasSeenAudioParagenPrompt),[f,Fe,q]=re(s,n=>{const m=C.getConversationTurnAtIndex(n,t),b=t>0?C.getConversationTurnAtIndex(n,t-1):null,p=b?.role===j.User&&b.messages.some(A=>A.metadata?.visually_hide_response_from_conversation);return[m,p,b]},{disablePerfDetector:o}),{messages:y,messageGroups:v}=f,G=Ba(n=>n.size===0?-1:v.findIndex(m=>m.type===ts?m.groups.some(b=>b.messages.some(p=>n.has(p?.id))):m.messages.some(b=>n.has(b?.id)))),R=y[0],u=we(y),Ue=c.useMemo(()=>v.some(n=>n.type===jn.SearchGPTQuery),[v]),[Be,Ne]=c.useState(!1),P=c.useMemo(()=>y.some(n=>n.metadata?.n7jupd_message),[y]),{messages:T,visibleMessages:z,messageGroups:H,lastMessageToRender:F}=c.useMemo(()=>{const n=G!==-1&&G+1<v.length,m=n?v.slice(0,G+1):v,b=n?m.flatMap(p=>p.type===ts?p.groups.flatMap(A=>A.messages):p.messages):y;return{messages:b,visibleMessages:b.filter(kn),messageGroups:m,lastMessageToRender:we(b)}},[y,v,G]),De=G!==-1,te=D(d,"1887864177"),Oe=Na(),$=re(s,n=>C.getLastMessageSystemHints(n)),Ge=Rn(),ne=$?.includes(Re.Tatertot)&&D(d,"28816792")&&Ge,{capabilitySuggestionsEnabled:ae}=Da(ne),Q=c.useMemo(()=>({clientThreadId:s,turnIndex:t,messageId:u?.id}),[s,t,u?.id]),[ge,w]=c.useState(!1),[me,He]=c.useState(!1),et=c.useContext(Oa)!=null,x=f.role===j.User,ms=Pn(),oe=Fn(s),We=f.gizmoId??oe,Ve=Un(We).data,Le=We&&!Bn(We)?Ve:void 0,st=Le&&f.gizmoId!=null&&f.gizmoId!==oe&&D(d,"1418300125"),qe=Nn(s),tt=Dn(s),ps=On(qe),nt=Gn(qe,tt),ze=Hn(),[$e,at,ot,hs,Qe,it,Je,rt,fs,ct,U,pe,he,lt,ut,B]=re(s,n=>{const m=C.getParentPromptNode(n,R.id),b=m?.message.clientMetadata?.variantsInStreamInfo??(m?.message.metadata?.paragen_variant_choice?void 0:m?.message.metadata?.paragen_variants_info),p=C.getVariantIds(n,R.id),A=C.getCurrentVariantId(n,R.id),ln=A?p.indexOf(A):0,un=b&&n?.tree!=null&&p.some(N=>{const{errType:Bs}=n.tree.getLeafFromNode(N).message.clientMetadata??{};return Bs!=null&&Bs!=="info"}),_e=C.getConversationTurns(n);return[m,C.isMessageTurnEnded(n,u?.id),un,da(n?.mode,Ve?.gizmo.id),_e.findIndex(N=>N.role===j.User)===t,Vs(_e,N=>N.role===j.User)===t,_e.findIndex(N=>N.role===j.Assistant)===t,Vs(_e,N=>N.role===j.Assistant)===t,C.getRequestId(n,u?.id),b,p,ln,!!n?.continuingFromSharedPostId,n?.currentLeafId,C.getSuperWidgetMessages(n,t)[0],C.lastUserMessage(n)]},{disablePerfDetector:o}),fe=Wn(),be=ds(()=>{const n=ga(_);return n?.value===Ee.STREAMING||n?.value===Ee.REALTIME}),dt=T.some(n=>n.content.content_type===Pe.MultimodalText),gt=Qs(d,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:bs}=Vn(),vs=f.messages.map(n=>n.id),M=c.useRef(null);qo({clientThreadId:s,turn:f,turnIndex:t,conversationTurnWrapperRef:M});const xs=!I&&(l?.length??0)>2&&l!=="finalAgentTurn"&&o&&k,ve=x?we(z):void 0,Xe=ve?.id,mt=c.useCallback(()=>{Xe&&(K.logEvent("Edit Prompt",{id:Xe,threadId:ke(s)}),Ln(d,"chatgpt_edit_prompt"),w(!0))},[d,Xe,s]),pt=c.useCallback(()=>{w(!1)},[]),Ss=qn()??!1,{onChangeRating:ht}=Ga({clientThreadId:s,currentModelConfig:qe}),ft=n=>{if(!u)return;ht({nodeId:u.id,messageId:u.id,rating:n});const m=Ss&&v.some(b=>b.type!==ts&&b.messages?.some(ua));K.logEventWithStatsig(n==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:u.id,threadId:ke(s),model:h,rating:n,...Ss?{isCATriggered:m}:{}}),He(!0)},[bt]=c.useState(()=>Date.now()),vt=zn(s),Ts=$n(s)?.value,xt=Ts===Ee.STREAMING,St=Ts===Ee.REALTIME,Tt=fs!=null,Ct=Qn(fs),yt=Ds.useState(n=>Ds.isReplayInProgress(n,lt)),E=!at&&Ct||De||St||yt&&o,Cs=Jn(),ys=c.useRef(!1),It=Xn({clientThreadId:s}),Mt=Ha(s,u)&&!It,[,_t]=gn(),{isOpen:xe}=Os(),Is=Ro();c.useEffect(()=>{const m=new URLSearchParams(window.location.search).get("message");!(m!=null&&vs.includes(m))||!M.current||(M.current.scrollIntoView({behavior:"instant"}),_t(p=>(p.delete("message"),p),{replace:!0,preventScrollReset:!0}))},[]),c.useEffect(()=>{if(I)return;const b=new URLSearchParams(window.location.search).get("message")!=null;if(ys.current||b||l===void 0||!M.current||Is){l==="finalAgentTurn"&&o&&Y(s,p=>{p.scrollToMessageId=void 0});return}(vs.includes(l)||l==="finalAgentTurn"&&o)&&(ys.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(M.current)if(l==="finalAgentTurn"&&o)M.current.scrollIntoView({behavior:"instant",block:"end"}),Y(s,p=>{p.scrollToMessageId=void 0});else{const p=M.current.offsetHeight;let A=0;xe?A=-8:p>qs&&(A=qs-p),M.current.style.scrollMarginTop=`${A+Vo}px`,M.current.scrollIntoView({behavior:"smooth"})}})}))},[l,M.current,xe,Is]);const{showDebugConversationTurns:wt}=Zn(),Et=Wa(s),At=!fe&&!he&&!ms&&!x,jt=F?.author.role===j.Assistant?F:null,kt=F?.metadata?.system_hints?.includes(Re.Research);Va({isCompletionRequestInProgress:E,isUserTurn:x,message:jt});const{isOpen:Rt}=Os(),Pt=La(),Se=qa(hs),Ft=Kn(n=>n.voiceFeedbackThread),Ms=vt===Ft,Ut=u?.metadata?.async_source,Te=o&&Tt,J=be||E||xt,Ze=!ge&&!fe&&!he&&!Se&&!Rt&&f.role!==j.Developer&&!(f.role===j.User&&r)&&!(o&&Ms&&J)&&!(Te&&J)&&!(o&&be&&Ut)&&!(J&&P)&&!u?.metadata?.is_auto_proceed_message&&!u?.metadata?.is_takeover_ended_message&&u?.content?.content_type!==Pe.SuperWidget,Bt=!Ze&&!(Te&&J)&&(fe||he)&&!S,Nt=T.some(n=>Yn(n)===ea.l1239dk1),Ke=re(s,n=>{const m=new Set;return C.getParentPromptNode(n,R.id)?.message.metadata?.attachments?.forEach(p=>{p.mime_type?.startsWith("image/")||m.add(p.context_connector_info?.context_connector??"file")}),m}),Ye=sa(),es=ta(d,"110789670");let W;Ye.isLoading?W=void 0:Ye.canUpgradeGDrive&&Ke.has(Ae.GDRIVE)&&es.get("enabled",!1)?W=Ae.GDRIVE:Ye.canUpgradeSharepoint&&Ke.has(Ae.O365_BUSINESS)&&es.get("enabled",!1)?W=Ae.O365_BUSINESS:Ke.has("file")&&es.get("enabled",!1)&&(W="general");const Dt=Te&&!E&&!S&&!fe&&!he&&!Nt&&(te||Oe||ae||ne||!!W),ie=u!=null&&(!se||nt||de||ze)&&!Se&&!bs&&!ms&&!u.metadata?.b1de6e2_s,_s=be||E,[Ot,Gt]=c.useState(!1),Ht=!!(B?.metadata?.dictation&&B?.metadata?.dictation_asset_pointer&&!B?.metadata?.dictation_edited),Wt=!!(!L||Ot||B?.metadata?.audio_paragen_result||Gs(B?.id)),ws=Ht&&!Wt,Es=ws&&(!se||ze)&&ie&&!_s&&!S&&!xe&&B!=null&&Je&&D(d,"51772912"),Vt=za(B?.id,Es),As=Es&&Vt,Ce=!Se&&At&&o&&ct?.num_variants_in_stream===2&&U.length<=2&&!u?.clientMetadata?.inlineComparisonRating&&!ot&&!ws&&!Gs(B?.id),js=!As&&(!se||ze)&&ie&&(Te||o&&Ms)&&!_s&&!S&&!xe&&!P,ks=!((E||be)&&o)&&U.length>1&&!Ce,Rs=x&&T.some(n=>Hs(n)?.shouldHideContent),Lt=x&&ve!=null&&!Se&&!dt&&!Rs&&!bs&&!kt&&!S,qt=u!=null&&(u.clientMetadata?.disclaimers??[]).length===0&&!S,ye=we(q?.messages.filter(na)),zt=gs(ue)&&Je&&(!$||$.length===0||$.includes(Re.Search)),Ps=c.useCallback(n=>{Y(s,m=>{aa.setCurrentBranch(m,U[n])}),K.logEvent("Change Active Node",{intent:"toggle_between"}),D(d,"4126691920")&&$a({parent_prompt_id:$e?.id??"",prev_branch_id:U[pe],next_branch_id:U[n]},ke(s))},[s,U,pe,$e?.id,d]),$t=Qa(f,T,wt),{toggleThreadSidebar:Fs}=oa(),Ie=u?.id,Qt=c.useCallback(()=>{Ie&&Fs({type:"retrievalResults",clientThreadId:s,turnIndex:t,messageId:Ie})},[Ie,Fs,s,t]),Jt=c.useMemo(()=>Ja(f,ps,!!oe),[ps,oe,f]),Xt=c.useMemo(()=>T.some(n=>Hs(n)?.canRetry===!1),[T]),Zt=u?.metadata?.n7jupd_button_type,Kt=P&&u!=null&&u.id!=null&&!Zt,Yt=P&&o&&J,en=P&&o;if(!$t&&!Ce)return xs?e.jsx("div",{style:os()}):null;if(Fe)return null;const sn=F?.metadata?.followup_prompts?F.metadata.followup_prompts.map(n=>({text:n,type:ia.Reply})):[],tn=F?.metadata?.category_suggestions,nn=F?.metadata?.action_suggestions,an=!T.some(n=>ra.getAudioAssetPointers(n).length>0)&&!oe&&!Xt&&!S,on=!E&&T.some(n=>n.author.role===j.Assistant&&n.metadata?.onboarding?.main_usages),ss=T.find(n=>!!n.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Us=!Rs&&(!o||!E)&&!S;if(Et&&!o&&z.length===0&&!P)return null;let Me="none";x&&Qe&&(Me="first"),x&&!Qe&&(Me="large"),o&&(Me="last");const rn=x&&!Ze&&!S?"mb-10":S&&!x&&o?"pb-[40px]":void 0,cn=D(d,"1424158285");return e.jsx(Xa.Provider,{value:Je,children:e.jsxs(Za,{children:[e.jsx(Ka,{dateHeaderType:g,turn:f}),e.jsxs("article",{className:V("text-token-text-primary w-full focus:outline-none",!I&&l==="finalAgentTurn"&&k?"opacity-0":"",{hidden:et&&Qe},x?"scroll-mt-(--header-height)":"scroll-mt-[calc(var(--header-height)+min(200px,max(70px,20svh)))]"),tabIndex:-1,style:xs?os():void 0,ref:M,dir:"auto","data-turn-id":f.id,"data-testid":`conversation-turn-${t}`,"data-scroll-anchor":!I&&o,"data-turn":x?"user":"assistant",children:[e.jsx(Ya,{role:f.role,gizmo:Le}),e.jsx(eo,{role:f.role,children:e.jsxs(so,{horizontalPadding:Ce?"none":"standard",verticalPadding:Me,children:[Ce?e.jsxs(e.Fragment,{children:[e.jsx(to,{isFeedbackEnabled:ie,variantIds:U,conversationTurnMountTime:bt,...a}),gt&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(ca,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{la.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(no,{className:"text-token-text-secondary me-1"}),e.jsx(X,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsxs(Ks,{tabIndex:-1,className:V("group/turn-messages focus-visible:outline-hidden",Be&&"super-widget-visible",rn,xo({isUserTurn:x})),children:[st&&e.jsx(ao,{gizmo:Le}),zt&&e.jsx(oo,{clientThreadId:s,threadContent:ut?.content??null,query:ye?ns(ye):null,triggeredSearch:Ue,onNavLinksWidgetDidShow:n=>{n&&Ne(!0)}}),!x&&e.jsx(Go,{messages:T,clientThreadId:s,gizmoId:Ve?.gizmo.id}),Pt&&x&&e.jsx(Ho,{clientThreadId:s,messages:T}),ge&&ve?e.jsx(Ls,{message:ve,clientThreadId:s,onRequestCompletion:i,onExitEdit:pt,disabled:Cs}):e.jsx(io,{allMessages:y,groupedMessagesToRender:H,allGroupedMessages:v,...a,isUserTurn:x,isFinalUserTurn:it,isFinalAssistantTurn:rt,isCompletionRequestInProgress:E,isFeedbackEnabled:ie,isFinalTurn:o,hasActiveRequest:Cs,hasN7JUPD:P,query:ye?ns(ye):null}),Jt&&(cn?e.jsx(Wo,{turnIndex:t,clientThreadId:s,variant:"bottom"}):e.jsx(ro,{handleShowRetrievalResults:Qt,clientThreadId:s,turnIndex:t,responseComplete:!J})),Kt&&e.jsx(co,{message:u,clientThreadId:s,turnIndex:t,referenceMessageId:u.id,responseComplete:!o||!E}),on&&e.jsx(lo,{clientThreadId:s}),ss&&ss.length>0&&!E&&e.jsx(uo,{clientThreadId:s,examples:ss}),Ze&&e.jsx(Uo,{isUserTurn:x,alwaysShow:!0,children:x?S?null:e.jsx(No,{activeVariantIndex:pe,clientThreadId:s,numVariants:U.length,onAnticipateEdit:Ls.prefetch,onChangeIndex:Ps,onEnterEdit:mt,showCopyButton:Us,showEditMessageButton:Lt,showPagination:ks,turnIndex:t}):e.jsxs(e.Fragment,{children:[e.jsx(Bo,{activeVariantIndex:pe,clientThreadId:s,conversationMode:hs,lastMessage:u,messages:T,numVariants:U.length,onChangeIndex:Ps,onRate:ft,showCanvasButton:Mt,showCopyButton:Us,showPagination:ks,showPlayButton:qt,showRatingButtons:ie,showRegenerateButton:an,turn:f,turnIndex:t,parentPrompt:$e}),e.jsx(Ws,{clientThreadId:s,message:u,turnIndex:t}),js&&e.jsx(go,{canShowInlineMessageFeedback:me,clientThreadId:s,messageForRating:u}),!1]})}),Yt&&e.jsx(mo,{clientThreadId:s}),en&&e.jsx(po,{clientThreadId:s,messages:T}),Bt&&e.jsx(Ws,{clientThreadId:s,message:u,turnIndex:t}),js&&e.jsx(ho,{canShowInlineMessageFeedback:me,clientThreadId:s,messageForRating:u,allGroupedMessages:v,currentModelId:h}),e.jsx(mn,{mode:"wait",children:As&&e.jsx(fo,{lastUserMessageId:B.id,setIsDismissed:Gt})}),Dt&&(W?e.jsx(bo,{clientThreadId:s,connectorToUpsell:W,analyticsMetadata:Q}):e.jsx(vo,{followups:sn,actionSuggestions:nn,categorySuggestions:tn,clientThreadId:s,lastMessageId:Ie,analyticsMetadata:Q,isTatertotFollowupsEnabled:ne}))]}),e.jsx(So,{clientThreadId:s,turn:f,isFinalTurn:o}),e.jsx(To,{clientThreadId:s,turn:f,isFinalTurn:o})]})})]})]})})}const qo=({clientThreadId:a,turn:t,turnIndex:o,conversationTurnWrapperRef:s})=>{const i=Co();c.useEffect(()=>{if(!i)return;const h=new IntersectionObserver(l=>{l.forEach(g=>{g.isIntersecting?Y(a,r=>{r.turnIdsInViewpoint=[...r.turnIdsInViewpoint??[],{turnId:t.id,turnIndex:o,role:t.role}]}):Y(a,r=>{r.turnIdsInViewpoint=r.turnIdsInViewpoint?.filter(({turnId:d})=>d!==t.id)})})},{root:null,threshold:.1});return s.current&&h.observe(s.current),()=>{Y(a,l=>{l.turnIdsInViewpoint=l.turnIdsInViewpoint?.filter(({turnId:g})=>g!==t.id)}),h.disconnect()}},[a,s,i,t.id,t.role,o])},ti=dn.memo(Lo);function ni(){const[a,t]=cs(i=>[pa(i),ls(i)]),o=Mo(),s=_o();return a&&!t&&!o&&!s}function ai({className:a,textClassName:t}){const o=c.useContext(us),s=ds(()=>as()),i=ha.useStore(),h=fa(),l=gs(o);function g(r){if(as.set(r),r!=="answer"){const d=i.getActiveSystemHintType();d&&d!==Re.Search&&h(null)}}return l?e.jsxs("div",{className:V("flex gap-8.5",a),children:[e.jsx(je,{className:t,$selected:s==="answer",onClick:()=>g("answer"),children:e.jsx(X,{...ce.chatTab})}),e.jsx(je,{className:t,$selected:s==="web",onClick:()=>g("web"),children:e.jsx(X,{...ce.linksTab})}),e.jsx(je,{className:t,$selected:s==="images",onClick:()=>g("images"),children:e.jsx(X,{...ce.imagesTab})}),e.jsx(je,{className:t,$selected:s==="videos",onClick:()=>g("videos"),children:e.jsx(X,{...ce.videosTab})})]}):null}const je=ma.button`
  ${({$selected:a})=>a?"text-token-text-primary font-medium":"text-token-text-tertiary hover:text-token-text-secondary"}
`,zo={answer:()=>null,web:jo,images:Ao,videos:Eo};function $o({userMessages:a,superWidgetMessageContents:t,tab:o,scrollToMessageId:s}){const i=c.useRef({});function h(r,d="smooth"){const _=i.current[r];_&&_.scrollIntoView({behavior:d,block:"start"})}c.useEffect(()=>{requestAnimationFrame(()=>{if(a.length>0){const r=a[a.length-1];r&&h(r.id,"instant")}})},[]),c.useEffect(()=>{setTimeout(()=>{s&&h(s)},50)},[s]);const l=zo[o],g=o==="web"||o==="videos";return e.jsx("div",{className:V("flex w-full flex-col pt-4",g?"gap-4":"gap-10"),children:wo(a.length,r=>e.jsxs("div",{className:"w-full",children:[r>0&&e.jsx("hr",{className:"border-heavy w-full pb-1.5"}),e.jsx("div",{className:V(g?"mb-2.5":"mb-6","flex scroll-mt-4 justify-start text-base",r>0&&"mt-2.5"),ref:d=>{i.current[a[r].id]=d},children:e.jsx(Qo,{userMessage:a[r]})}),t[r]?e.jsx(l,{content:t[r],turnIndex:r}):e.jsx("div",{style:os(),children:e.jsx("div",{className:"result-streaming pulse",children:e.jsx("span",{})})})]},r))})}function Qo({userMessage:a}){const t=ns(a);return t?e.jsx("div",{dir:"auto",className:"text-token-text-tertiary flex max-w-[var(--user-chat-width,70%)] min-w-0 text-start text-sm",children:e.jsx(X,{...ce.resultsFor,values:{prefix:o=>e.jsx("span",{className:"shrink-0",children:o}),query:e.jsx("span",{className:"min-w-0 flex-1 truncate",children:t}),trailingQuote:o=>e.jsx("span",{"aria-hidden":"true",className:"shrink-0",children:o})}})}):null}function oi({clientThreadId:a,children:t}){const o=c.useContext(us),s=ds(()=>as()),[i,h,l]=re(a,g=>[C.getUserMessages(g).filter(r=>!r.metadata?.is_visually_hidden_from_conversation),C.getSuperWidgetMessages(g),g?.scrollToMessageId]);return gs(o)?e.jsxs("div",{children:[e.jsx("div",{className:s==="answer"?"block":"hidden",children:t}),e.jsx(Ks,{children:s!=="answer"&&e.jsx($o,{userMessages:i,superWidgetMessageContents:h.map(g=>g.content),tab:s,scrollToMessageId:l},s)})]}):t}const ce=pn({chatTab:{id:"CSsJbp",defaultMessage:"Chat"},linksTab:{id:"U43uU/",defaultMessage:"Links"},imagesTab:{id:"ZY9oIP",defaultMessage:"Images"},videosTab:{id:"C8mH8+",defaultMessage:"Videos"},resultsFor:{id:"c0kUok",defaultMessage:"<prefix>Results for “</prefix>{query}<trailingQuote>”</trailingQuote>"}});export{ti as C,ai as S,oi as a,ni as u};
//# sourceMappingURL=irf8dojj8b02f534.js.map
