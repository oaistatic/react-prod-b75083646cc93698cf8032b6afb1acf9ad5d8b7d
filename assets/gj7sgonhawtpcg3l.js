import{r as C,h as Te,R as Ve,a as Xe,e as $,j as e,M as m}from"./lu2xqwqmjc95q6j6.js";import{d9 as Z,df as ee,dg as k,dh as F,di as G,dj as K,dk as z,dl as Ye,dm as Se,dn as Q,dp as be,dq as Me,dr as Pe,ds as je,dt as j,du as _,aK as qe,dv as Ge,aX as ce,B as me,dw as de,dx as H,dy as ue,dz as S,dA as ge,dB as _e,dC as Ce,dD as Ke}from"./rseqzngxzbdt1oxg.js";import{b5 as te,aZ as he,a as Ee,aM as Ne,bg as we,cX as ze,bT as Qe,aU as Je,P as O,C as fe,b4 as Ze,d as J,d_ as q,D as Ae,I as ve,V as ae,ay as et}from"./hml6mmd5fyx85si7.js";import{c as ke}from"./iej0cupg2dqkmejt.js";import{u as se,P as tt}from"./n39npmecfg2nmjo7.js";import{u as at}from"./imrgbs6xko452vv3.js";import{u as Le}from"./i4sx5w9qnb2pqgar.js";import{a as st,b as nt,u as ot}from"./fibktxptqydbr54o.js";const lt=ke(z),rt=({promoData:l,initialPromoCoupon:c,initialSeats:T}={})=>{const b=Z(),f=ee()??c,{data:o}=se(f??"");let t=l;!l&&o&&(t=o);const u=t?.coupon===k&&t.state==="eligible",g=t?.coupon===F&&t.state==="eligible",a=typeof window<"u"?new URLSearchParams(window?.location.search):new URLSearchParams,r=a.get(G),s=a.get(K),p=u?z.FLEXIBLE:s&&lt(s)?s:z.FLEXIBLE,[x,d]=C.useState(p),[i,h]=C.useState(T??(r&&!isNaN(parseInt(r,10))?parseInt(r,10):Math.max(Ye,b)));return{promoData:t,selectedPlan:x,setSelectedPlan:d,numSeats:i,setNumSeats:h,minTeamSeats:b,TEAM1DOLLAR_COUPON_IsEligible:u,TEAM_FREE_TRIAL_COUPON_IsEligible:g}};var Be=(l=>(l.FLEXIBLE="month",l.ANNUAL="year",l))(Be||{});const xe=ke(Be),yt=l=>{const c=C.useRef(!1),T=Te(),b=T.hash.split("#")[1]===Se||T.hash.split("#")[1]===Q,f=te(),o=!c.current&&b&&f&&!l,{country:t}=st(),u=nt({country:t,currentAccount:f,location:"team-workspace-purchase-modal"}),g=ee(),{data:a,isLoading:r}=se(g??""),s=Z(),p=Ve.useRef(void 0);C.useEffect(()=>{o&&(he.setPurchaseWorkspaceData({minimumSeats:s,billingDetails:u,promoData:a}),c.current=!0)},[f,u,s,b,l,g,a,o]),C.useEffect(()=>{const x=p.current;p.current=r,!(r||!c.current)&&x&&he.setPurchaseWorkspaceData({minimumSeats:s,billingDetails:u,promoData:a})},[a,r,s,u])},pe=et.p`text-base font-medium mb-3`,Re=({isOpen:l,onClose:c,onSubmit:T,minimumSeats:b,billingDetails:f,isDirectFlow:o=!1,promoData:t=void 0})=>{const u=te(),{trackSelectedPixels:g}=at({key:ze.TEAM}),{selectedPlan:a,setSelectedPlan:r,numSeats:s,setNumSeats:p,minTeamSeats:x,TEAM1DOLLAR_COUPON_IsEligible:d,TEAM_FREE_TRIAL_COUPON_IsEligible:i}=rt({promoData:t}),[h,P]=C.useState(!1),y=$(),A=f.currency,L=Math.max(b,x),{flexibleBillingPlan:Oe,annualBillingPlan:ne}=Me(A);let E=Oe,oe=null;if(d||i){oe=t?.coupon===k?Pe(A):je(A);let n,M;d?(n={...A===Qe?j.team1dollarMonthlyCostINR:j.team1dollarMonthlyCost},M={...j.team1dollarMonthlyStructure,defaultMessage:`Then ${y.formatMessage(E.currencySign)}${E.monthlyCost} seat/mo after 1 month`,id:"promo.team1dollar.monthlyPlanStructure",description:"Subsequent pricing description for team1dollar promo. Describing the monthly then the annual price after."}):(n={..._.teamFreeTrialMonthlyCost},M={..._.teamFreeTrialMonthlyStructure,defaultMessage:`Then ${y.formatMessage(E.currencySign)}${E.monthlyCost} seat/mo after 1 month`,id:"promo.teamFreeTrial.monthlyPlanStructure",description:"Subsequent pricing description for teamFreeTrial promo. Describing the monthly then the annual price after."}),E={...E,cost:n,costStructure:M,discountedMonthlyCost:oe??E.discountedMonthlyCost}}const N=t?.coupon===k,Fe=t?.coupon===F,R=N||Fe,U=t?.state==="not_eligible"&&R,I=t?.state==="temporary_disabled"&&R,le=t?.state==="offline"&&R,w=qe(isNaN(s)?0:s,L,Ge),B=C.useMemo(()=>u?.subscriptionAnalyticsParams,[u]),D=Je(n=>n.purchaseWorkspaceData);C.useEffect(()=>{const n=D?.referrer??document.referrer;O.logEvent("Account Pay: Select Team Plan Modal Show",{...B,referrer:n})},[B,D?.referrer]);const re=n=>{switch(n){case"month":O.logEvent("Account Pay: Team Plan Selection Clicked",{...B,buttonType:"Continue",numberOfSeats:s,planLength:ge.MONTHLY});break;case"year":O.logEvent("Account Pay: Select Team Plan Modal Clicked",{...B,buttonType:"Continue",numberOfSeats:s,planLength:ge.ANNUAL});break}},ie=(n,M)=>{O.logEventWithStatsig("Account Pay: Select Team Plan Modal Clicked","chatgpt_select_team_plan_modal_continue_to_billing_clicked",{...B,buttonType:"Continue",numberOfSeats:M,planLength:n}),ae.addAction("chatgpt_funnel.team_plan_modal_checkout_initiated",{planLength:n,numberOfSeats:M.toString(),accountId:u?.id}),t?.state==="eligible"&&R&&tt.logCouponApplied(t.coupon)},V=()=>{O.logEvent("Account Pay: Select Team Plan Modal Dismiss",B)},v=Te(),X=C.useMemo(()=>v.hash.split("#")[1]===Q,[v.hash]);if(C.useEffect(()=>{const n=new URLSearchParams;n.set(G,w.toString()),n.set(K,a),n.set("referrer",D?.referrer??document.referrer),t?.coupon&&n.set(ce,t.coupon);const M=o||X?`#${Q}`:`#${Se}`,Ie=`${v.pathname}?${n.toString()}${M}`,Y=new URL(window.location.href).searchParams,De=Y.get(G)===w.toString(),We=Y.get(K)===a,He=t?.coupon==null||Y.get(ce)===t.coupon,$e=window.location.hash===M;(!De||!We||!He||!$e)&&window.history.pushState({from:v.pathname+v.search},"",Ie)},[w,o,X,v.pathname,v.search,v.hash,a,t?.coupon,D?.referrer]),o||X){let n;return U?n=N?j.team1dollarNotEligible:_.teamFreeTrialNotEligible:I?n=N?j.team1dollarTemporarilyDisabled:_.teamFreeTrialTemporarilyDisabled:n=N?j.team1dollarOffline:_.teamFreeTrialOffline,e.jsx(fe,{testId:"modal-workspace-purchase",type:"success",isOpen:l,onClose:()=>{c(),V()},size:"fullscreen",noPadding:!0,removePopoverStyling:!0,showCloseButton:!0,children:e.jsxs("div",{className:"grid grid-flow-row grid-cols-1 md:h-full md:grid-cols-2",children:[e.jsx("div",{className:"flex-column col-span-1 flex justify-center p-5 md:grid-cols-2",children:e.jsxs("div",{className:"flex w-full max-w-[400px] flex-col items-center",children:[e.jsx(Ze,{className:"mt-8 mb-6 h-8 w-8 md:fixed md:start-4 md:top-4 md:mt-0 md:h-6 md:w-6"}),(U||I||le)&&e.jsx("div",{className:"mb-4 w-full","data-testid":"team-promo-banner",children:e.jsx(me,{content:y.formatMessage(n),type:"info"})}),e.jsx("div",{className:"mb-8 text-3xl font-medium md:mt-[120px]",children:e.jsx(m,{id:"selectTeamPlanModal.title",defaultMessage:"Pick your plan"})}),e.jsxs(de,{className:J("col-span-3 mb-6 grid w-full gap-4 md:col-span-2","md:grid-cols-2"),defaultValue:a,onValueChange:M=>{xe(M)&&(r(M),re(M))},children:[e.jsx(H,{billingType:"year",...ne,selectedValue:a,hideSavingsMessage:d||i,hideDetails:!0}),e.jsx(H,{billingType:"month",...E,selectedValue:a,hideDetails:!0,showWelcomeOfferLabel:t?.state==="eligible"})]}),e.jsx(ue,{numSeats:s,minSeats:L,setNumSeats:p}),e.jsx("div",{className:"text-token-text-secondary self-start text-xs",children:y.formatMessage({id:"selectTeamPlanModal.seatsDescription",defaultMessage:"Add more seats at any time. Minimum of {minSeats} seats."},{minSeats:x})})]})}),e.jsx("div",{className:"col-span-3 flex h-full flex-col items-center overflow-hidden p-6 md:col-span-1 md:shadow-lg",children:e.jsxs("div",{className:"flex w-full max-w-[400px] flex-col md:mt-[120px]",children:[e.jsx(pe,{className:"mb-8 text-xl font-medium",children:e.jsx(m,{...S.summaryTitle})}),e.jsx(ye,{numSeats:w,selectedPlan:a,billingDetails:f,totalLabel:S.allPlansTodayTotal,billDate:e.jsx(m,{...S.today}),promoData:t}),e.jsx(q,{title:y.formatMessage(S.continueToBillingButton),onClick:async()=>{P(!0),ie(a,w),g(),await T(a,w),P(!1)},disabled:!1,loading:h,color:"green",className:"w-full rounded-xl"}),e.jsx(q,{title:y.formatMessage(S.cancel),onClick:()=>{c(),V()},color:"ghost",className:"mt-4 w-full rounded-xl"})]})})]})})}const Ue=N?_e:Ce;let W;return U?W=N?j.team1dollarNotEligible:_.teamFreeTrialNotEligible:I?W=N?j.team1dollarTemporarilyDisabled:_.teamFreeTrialTemporarilyDisabled:W=N?j.team1dollarOffline:_.teamFreeTrialOffline,e.jsxs(fe,{testId:"modal-select-team-plan",type:"success",isOpen:l,onClose:()=>{c(),V()},size:"custom",noPadding:!0,removePopoverStyling:!0,className:"max-w-4xl",showCloseButton:!0,hasSeparator:!0,title:y.formatMessage(S.selectTeamPlanModalTitle),children:[(U||I||le)&&e.jsx("div",{className:"px-5 pt-4","data-testid":"team-promo-banner",children:e.jsx(me,{content:y.formatMessage(W),type:"info"})}),e.jsxs("div",{className:"grid grid-flow-row grid-cols-3",children:[e.jsxs("div",{className:"flex-column col-span-3 p-5 md:col-span-2 md:grid-cols-2",children:[e.jsx(ue,{numSeats:s,minSeats:L,setNumSeats:p}),R&&t?.state==="eligible"&&a==="month"&&s>Ue&&e.jsx("div",{className:"text-token-text-secondary mt-1 self-start text-xs","data-testid":"team-promo-overseats-disclaimer",children:e.jsx(m,{...N?j.team1dollarOverSeatsDisclaimer:_.teamFreeTrialOverSeatsDisclaimer})}),e.jsxs(de,{className:J("col-span-3 mt-5 grid gap-4 md:col-span-2","md:grid-cols-2"),defaultValue:a,onValueChange:n=>{xe(n)&&(r(n),re(n))},children:[e.jsx(H,{billingType:"year",...ne,selectedValue:a,hideSavingsMessage:d||i}),e.jsx(H,{billingType:"month",...E,selectedValue:a,showWelcomeOfferLabel:d||i})]})]}),e.jsxs("div",{className:"border-token-main-surface-tertiary bg-token-bg-elevated-secondary col-span-3 flex h-full flex-col overflow-hidden border-s p-6 md:col-span-1",children:[e.jsx(pe,{children:e.jsx(m,{...S.summaryTitle})}),e.jsx(ye,{numSeats:w,selectedPlan:a,billingDetails:f,totalLabel:S.allPlansTodayTotal,billDate:e.jsx(m,{...S.today}),promoData:t}),e.jsx(q,{title:y.formatMessage(S.continueToBillingButton),onClick:async()=>{P(!0),ie(a,w),g(),await T(a,w),P(!1)},disabled:!1,loading:h,color:"primary",className:"w-full rounded-xl"})]})]})]})},ye=({numSeats:l,selectedPlan:c,billingDetails:T,totalLabel:b,billDate:f,promoData:o})=>{const t=$(),{flexibleBillingPlan:u,annualBillingPlan:g}=Me(T.currency),a=u,r=c==="month"?a:g,s=Ke[c],p=(l||0)*(c==="year"?g.monthlyCost*12:a.monthlyCost);let x=(l||0)*r.unitCost,d=p-x,i=0,h=p,P=!1;if((o?.coupon===k||o?.coupon===F)&&o.state==="eligible"&&c==="month"){P=!0;const A=o?.coupon===k?Pe(T.currency):je(T.currency),L=o?.coupon===k?_e:Ce;l<=L?(i=A,h=l*a.monthlyCost,d=h-i,x=i):(i=A+(l-L)*a.monthlyCost,h=l*a.monthlyCost,d=h-i,x=i)}let y;return o?.coupon===F&&o.state==="eligible"&&c==="month"&&(y={title:{id:"promo.teamFreeTrial.temporaryCardHold",defaultMessage:"Temporary card hold",description:"Label for the temporary card hold line item in the billing summary"},description:{id:"promo.teamFreeTrial.temporaryCardHoldDescription",defaultMessage:"Used to verify payment â€” we'll refund it",description:"Description for the temporary card hold line item in the billing summary"},amount:1},x+=1),e.jsxs("div",{className:"flex grow flex-col text-sm",children:[e.jsxs("div",{className:"text-token-text-secondary flex w-full justify-between text-sm",children:[e.jsx("div",{className:"flex",children:e.jsx(m,{...s.name})}),e.jsx("div",{className:"flex",children:e.jsx(m,{...S.allPlansPreDiscountTotal,values:{currencySign:t.formatMessage(r.currencySign),preDiscountTotalAmount:p.toLocaleString()}})})]}),e.jsxs("div",{className:"text-token-text-tertiary flex w-full justify-between text-xs",children:[e.jsx("div",{className:"flex",children:e.jsx(m,{...s.breakdown,values:{numSeats:l}})}),e.jsx("div",{className:"flex",children:e.jsx(m,{...S.breakdownAmount,values:{currencySign:t.formatMessage(r.currencySign),amount:r.monthlyCost}})})]}),y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-token-text-secondary mt-3 flex w-full justify-between text-sm",children:[e.jsx("div",{className:"flex",children:e.jsx(m,{...y.title})}),e.jsx("div",{className:"flex",children:e.jsx(m,{id:"promo.teamFreeTrial.temporaryCardHoldAmount",defaultMessage:"{currencySign}{amount}",description:"Amount for the temporary card hold line item (e.g., $1). Keep the currency sign and numeric amount placeholders; translators may reorder them per locale.",values:{currencySign:t.formatMessage(r.currencySign),amount:y.amount.toLocaleString()}})})]}),y.description&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,{...y.description})})]}),e.jsxs("div",{className:"text-token-text-secondary mt-3 flex w-full justify-between text-sm",children:[e.jsx("div",{className:"flex",children:e.jsx(m,{...S.planDiscountLabel})}),e.jsx("div",{className:J("flex",d>0&&"font-medium text-[#10A37F]"),children:e.jsx(m,{...s.discountAmount,values:{currencySign:t.formatMessage(a.currencySign),discountAmount:d.toLocaleString()}})})]}),(o?.coupon===k||o?.coupon===F)&&o.state==="eligible"&&c==="month"&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,{...o?.coupon===k?j.team1dollarBelowDiscount:_.teamFreeTrialBelowDiscount})}),s.discountDescription&&g.discountedMonthlyCost<g.monthlyCost&&c==="year"&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,{...s.discountDescription,values:{discountPercentage:Math.floor((1-g.discountedMonthlyCost/g.monthlyCost)*100)}})}),e.jsx("hr",{className:"border-token-border-default my-3"}),e.jsxs("div",{className:"flex w-full justify-between text-base font-medium",children:[e.jsx("div",{className:"flex",children:e.jsx(m,{...b})}),e.jsx("div",{className:"flex",children:P?e.jsxs(e.Fragment,{children:[t.formatMessage(r.currencyCode)," ",t.formatMessage(r.currencySign),x.toLocaleString()]}):e.jsx(m,{...s.total,values:{currencyCode:t.formatMessage(r.currencyCode),currencySign:t.formatMessage(r.currencySign),totalAmount:x.toLocaleString()}})})]}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:P?e.jsx(e.Fragment,{children:e.jsx("div",{className:"text-token-text-tertiary mt-2 text-xs",children:e.jsx(m,{id:"ngnBJG",defaultMessage:"After promotional period {currencySign}{amount} per month",values:{currencySign:t.formatMessage(a.currencySign),amount:h.toLocaleString()}})})}):e.jsx(m,{...s.billed,values:{billDate:f}})})]})};function Tt(){const l=te(),c=Xe(),{prepareCheckoutSession:T,navigateToCheckout:b}=Le(),f=Ee(),o=Z(),{initialBillingDetails:t}=ot(l,!0),u=$(),g=Ne(),a=be(u,void 0,g),r=we(),s=ee(),{data:p}=se(s??""),x=async(i,h)=>{if(!Ae(f)){ve(f,{authType:"login",callbackUrl:window.location.href});return}try{const P=await T({plan_name:"chatgptteamplan",team_plan_data:{workspace_name:a,price_interval:i,seat_quantity:h},billing_details:t,promo_campaign:i==="month"?p?.coupon:null});await b(P)}catch(P){ae.addError(P),r.warning(u.formatMessage(S.paymentErrorWarning),{hasCloseButton:!0})}},d=()=>{c("/")};return e.jsx(Re,{isOpen:!0,onClose:d,onSubmit:(i,h)=>x(i,h),isDirectFlow:!0,minimumSeats:o,billingDetails:t,promoData:p})}const St=({isOpen:l,onClose:c,minimumSeats:T,billingDetails:b,existingAccount:f=void 0,promoData:o=void 0})=>{const t=$(),u=we(),g=Ne(),{prepareCheckoutSession:a,navigateToCheckout:r}=Le(),s=Ee(),p=be(t,f,g),x=async(d,i)=>{if(!Ae(s)){ve(s,{authType:"login",callbackUrl:window.location.href});return}try{const h=await a({plan_name:"chatgptteamplan",team_plan_data:{workspace_name:p,price_interval:d,seat_quantity:i,existing_workspace_id:f?.id},billing_details:b,cancel_url:window.location.href,promo_campaign:d==="month"?o?.coupon:null});await r(h)}catch(h){ae.addError(h),u.warning(t.formatMessage(S.paymentErrorWarning),{hasCloseButton:!0})}};return e.jsx(Re,{isOpen:l,onClose:c,onSubmit:(d,i)=>x(d,i),minimumSeats:T,billingDetails:b,promoData:o})};export{ye as B,Tt as T,yt as a,St as b,rt as u};
//# sourceMappingURL=gj7sgonhawtpcg3l.js.map
