import{r as g,j as s,m as H,e as le,d as je,N as we}from"./lu2xqwqmjc95q6j6.js";import{aH as Ae,om as de,on as ue,d as k,mv as ie,oo as ke,A as me,op as Ee,oq as Oe,cC as Ne,aN as X,a as Z,q as pe,dc as ee,i5 as Re,cE as Te,o3 as Be,fA as ze,aO as _e,jE as ge,c as De,gD as Fe,or as Ie,aS as Le,aT as We,d7 as He,bg as Ue,l as Ve,cB as Ge,bw as L,cT as K,eZ as Qe,gO as Ye,u as $e,os as Ke,p as Xe,oi as qe,P as Je,ot as Ze,ou as es,dI as ss,aJ as ts,jJ as re,g as os,db as ns,dS as as,c4 as is,cj as rs,f9 as cs,ov as ls,df as ds,ow as us,lp as ms,de as ps,T as W,ox as gs,mh as Ss,oy as fs}from"./hml6mmd5fyx85si7.js";import{cM as Se,cN as fe,cx as xs,cO as xe,cP as Cs,cQ as hs,cR as ys,cS as Ms,cT as Ps,cU as bs,cv as vs,cV as js,cW as ws,ad as As,cX as ks,cY as Es,cZ as q,c_ as J,c$ as Os,d0 as Ns,X as Rs,d1 as Ts,d2 as Bs,ae as zs,d3 as _s}from"./rseqzngxzbdt1oxg.js";import{P as Ds,a as Fs}from"./elolu96rnfzqcgif.js";import{u as Ce}from"./ejklrllfl9wcn2za.js";import{a as Is}from"./isxemcalu9537a8n.js";function ce({clientThreadId:e,onClick:t}){g.useEffect(()=>{Ee(e)},[e]);const n=le();return s.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:s.jsx(xe,{onClick:()=>{Oe(e),t()},label:n.formatMessage(Vs.moreStarterPrompts)})})}function Ls({starterPrompt:e,starterPrompts:t,index:n,disabled:i,onSelectStarterPrompt:u}){const a=e.theme??e.title,r=xs(),{mutate:c}=ke(),l=e.category==="onboarding"?o=>{c({key:me.hasUsedConversationalOnboardingStarterPrompt}),r(o,e,t,n)}:o=>u?.(o,e,t,n);return s.jsx(xe,{disabled:i,onClick:l,icon:s.jsx(Cs,{category:e.category,useV2Colors:!0}),label:a})}const Ws=5,Hs=3;function he({starterPrompts:e,onSelectStarterPrompt:t,disabled:n,clientThreadId:i,onExpand:u,mobileLayout:a=!1}){const r=a?Hs:Ws,[c,l]=g.useState(r),[o,m]=g.useState(!1),S=g.useRef(null),C=e.length<=c;g.useEffect(()=>{ie(e.slice(0,r),i)},[i]),g.useEffect(()=>{if(!o&&!C&&S.current){const d=S.current,f=d.getBoundingClientRect(),O=f.width,y=Array.from(d.children);let v=0;for(let M=0;M<y.length&&y[M].getBoundingClientRect().right-f.left<=O;M++)v++;l(v),m(!0)}},[e,C,o]);const h=()=>{const d=e.slice(c,e.length).map(f=>({...f,isAdditional:!0}));d.length>0&&ie(d,i),l(e.length),u()};return s.jsxs("div",{"data-testid":"starter-prompt-chips",className:k("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",o&&e.length>0?"opacity-100":"opacity-[0.01]",a?"flex-wrap":"flex-nowrap"),children:[s.jsxs("ul",{className:k("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",C||a?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:S,children:[e.slice(0,c).map((d,f)=>s.jsx(H.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:s.jsx(Ls,{starterPrompt:d,starterPrompts:e,index:f,disabled:n,onSelectStarterPrompt:t})},d.id??f)),a&&e.length>c&&s.jsx(ce,{clientThreadId:i,onClick:h})]}),!a&&e.length>c&&s.jsx(ce,{clientThreadId:i,onClick:h})]})}const Zs=({clientThreadId:e,currentModelId:t,isModelLoaded:n})=>{const[i,u]=g.useState(!1),a=ue(),{prospectiveModelId:r}=fe(e),c=n?t:r??"auto",{promptStarters:l,shouldShowStarterPrompts:o,onSelectStarterPrompt:m}=Ce({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:e,limit:8,modelSlug:c});return s.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:k(o&&!i&&"h-[116px]"),children:o&&l&&s.jsx(he,{starterPrompts:l,onSelectStarterPrompt:m,disabled:a,clientThreadId:e,onExpand:()=>u(!0),mobileLayout:!0})})},Us=({currentModelId:e,clientThreadId:t,isModelLoaded:n})=>{const{isUnauthenticated:i}=Ae(),u=Se(),[a,r]=g.useState(!1),c=de(),l=ue(),{prospectiveModelId:o}=fe(t),m=n?e:o??"auto",{promptStarters:S,shouldShowStarterPrompts:C,onSelectStarterPrompt:h}=Ce({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:m});return s.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:k("hidden max-w-full",!u&&"min-h-[108px]",c?"@lg/thread:block":"lg:block",i&&a||u?"":"h-[70px]"),children:C&&S&&s.jsx(he,{starterPrompts:S,onSelectStarterPrompt:h,disabled:l,clientThreadId:t,onExpand:()=>r(!0)})})},Vs=je({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),et=({clientThreadId:e,isNewThread:t,isGizmoThread:n,isProjectThread:i,isModelLoaded:u,currentModelId:a,onRequestCompletion:r,shouldUseUnifiedComposer:c,onlyAllowImageUploads:l,layoutMode:o})=>{const m=ee(),{pageType:S}=vs(),C=S?.type==="landing-page",h=Ie(S?.type),d=js(e).isOdysseyMode,f=g.useContext(Le),O=We(f),y=He(),v=Ue(),M=le(),x=Z(),N=pe(x);ws(m);const R=Ve(Ge),U=L(K.sidebarUrlTrayOpen$),V=L(K.sidebarUrlTrayForcedOpen$),B=L(K.context$),G=B?.blocked===!0,E=Qe(),Q=R&&U&&(!G||V),{platformConnectors:z}=Ye(),_=$e(me.hasSeenOdysseyConnectorsModal),D=X(e,p=>W.getConversationTurns(p).some(j=>j.messages.some(b=>b.metadata?.n7jupd_message))),Y=ge(),$=Is(),P=(Y||$)&&D;Ke(async()=>{if(Q)return await gs(B,fs,E?[E]:[])});const F=async p=>{if(os(e)?.isLoading!==!1)return;const j=()=>{const w=ds(m);us(w),ms(w,p.contentToSend.content),ps(w)},b=await zs({...p,clientThreadId:e}),I=b.completionMetadata?.systemHints?.includes(ns),T=Array.from(p.selectedSources??[]).filter(w=>w!=="web")[0];if(I&&T&&_.eligible){const w=as[T]??T,ne=z.get(w);if(ne){let ae=!1;is(x,_s,{connector:ne,onConfirm:()=>{_.markAsViewed(),ae=!0,r(b)},onTurnOffConnectors:()=>{rs(e,A=>{A.selectedSources??=new Map,A.selectedSources.set(E,new Set(["web"])),A.selectedMCPSources??=new Map,A.selectedMCPSources.set(E,new Set),A.mentionedSources=new Set,cs({selectedSourcesMap:A.selectedSources,selectedMCPSourcesMap:A.selectedMCPSources,scope:{userId:N?.authUserId,workspaceId:N?.id}})})},onClose:()=>{ae||j()}});return}}R&&ls()?.triggerProductEvent("messageSent"),ye(b.promptMessage?.metadata?.attachments??[])&&r(b)},ye=g.useCallback(p=>{let j=qe;const b=p.reduce((T,oe)=>T+(oe.size??0),0);d&&(j=Xe(x,"1504865540").get("max_file_size_mb",25));const I=b<=j*1024*1024;return I||v.danger(M.formatMessage({id:"odyssey.fileTooLarge",defaultMessage:"The attached files are too large. The maximum size is {maxFileSizeMB}MB."},{maxFileSizeMB:j})),I},[x,M,d,v]),Me=g.useCallback(p=>{Je.logEvent("Continue Completion"),r(As(p))},[r]),Pe=ks.useState(p=>p.isReplayEnabled),be=Ze({clientThreadId:e}),ve=es({clientThreadId:e});if(be)return s.jsx(Es,{safetyLimited:ve});const se=s.jsxs(s.Fragment,{children:[s.jsx(Os,{clientThreadId:e}),s.jsx(q,{verticalMargin:"none",verticalPadding:O?"last-standard":"none",horizontalPadding:R?"none":"standard",children:s.jsx(J,{children:Pe?s.jsx(Ns,{clientThreadId:e},e):P?null:s.jsx(Qs,{clientThreadId:e,currentModelId:a,isNewThread:t,hideHeader:t,onRequestCompletion:F,onContinueGenerating:Me,onlyAllowImageUploads:l,layoutMode:o})})})]}),te=t&&s.jsx("div",{className:k("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:s.jsx(q,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:s.jsx(J,{children:s.jsx(Fs,{className:"block flex-1"})})})});return c?s.jsxs(s.Fragment,{children:[!y&&te,s.jsx("div",{id:"thread-bottom",children:se}),y&&te,t&&!C&&!n&&!h&&!d&&!i&&s.jsx(Gs,{clientThreadId:e,currentModelId:a,isModelLoaded:u})]}):se},Gs=({clientThreadId:e,currentModelId:t,isModelLoaded:n})=>{const i=ee(),u=L(Rs(i).shouldShowAutocomplete$),a=de(),r=ss(),c=Z(),l=Se(),o=ts(c,"1704943789").get("toggleState",re.Off);return s.jsxs("div",{className:k(u&&"hidden"),children:[s.jsx(q,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:s.jsxs(J,{children:[!l&&s.jsxs(s.Fragment,{children:[!1,o!==re.Off&&r&&s.jsx(Ts,{clientThreadId:e,toggleState:o})]}),s.jsx(Us,{clientThreadId:e,currentModelId:t,isModelLoaded:n})]})}),l&&s.jsx("div",{className:k("mt-5 hidden",a?"@lg/thread:block":"lg:block"),children:s.jsx(Bs,{})})]})};function Qs({clientThreadId:e,currentModelId:t,disableDraftPersistence:n=!1,isNewThread:i,onRequestCompletion:u,onContinueGenerating:a,headerClassName:r,hideHeader:c,onlyAllowImageUploads:l,layoutMode:o="bottom"}){const{modelsData:m,externalModelsLoading:S}=Ne(),[C,h,d,f,O]=X(e,P=>{const F=W.getCurrentNode(P);return[F.message.clientMetadata?.errType!=null&&F.message.clientMetadata.errType!=="info",Ss(W.getCurrentNode(P).message),P?.mode,!!P?.continuingFromSharedPostId,P?.continuingFromSharedProjectConversationId!=null]}),y=Z(),v=pe(y),M=ee(),x=hs({clientThreadId:e}),{isOpen:N,onClose:R}=ys({type:"just-hit-rate-limit"}),U=g.useMemo(()=>x?!1:!C&&h,[C,h,x]),V=x,B=Re(e),G=X(e,W.hasRecentPIMWarning),E=Te(B).data,Q=Be(),z=G?"pimBlock":E?.gizmo.tags?.includes(ze.WorkspaceDisabled)&&!Q?"workspaceDisallowsGizmo":m?.models.size===0?"noModelsAvailable":d?.kind===_e.GizmoTest&&d.gizmo_id==null?"noTestGizmoId":null,_=we(),D=ge(),Y=_.action==="moderate",$=De(y,"1860647109");return s.jsxs(s.Fragment,{children:[s.jsx(Ms,{composerController:M,clientThreadId:e,currentModelId:t,isCompletionInProgress:x}),s.jsx("div",{className:"flex justify-center empty:hidden",children:D&&Y&&$?s.jsx(Ps,{}):null}),N?s.jsx(bs,{onClose:R}):null,s.jsx(Ds,{clientThreadId:e,disableDraftPersistence:n,onCreateNewCompletion:u,onContinueGenerating:a,currentModelId:t,account:v,currentModelConfig:Fe(m?.models,t),areModelsLoading:S,isNewThread:i,isCompletionInProgress:x,className:"w-full",canContinue:U,disabled:!!z,disabledReason:z??void 0,canPause:V,isInteractableSharedThread:D||f||O,headerClassName:r,hideHeader:c,onlyAllowImageUploads:l,layoutMode:o,modelsData:m},e)]})}export{Zs as M,Qs as P,et as T};
//# sourceMappingURL=iq82wz84d1fxj03i.js.map
