import{k2 as j,bg as k,c9 as y,B as P,lI as v}from"./hml6mmd5fyx85si7.js";import{e as C,a as _,l as M,N,r as l,u as b,j as e,M as i}from"./lu2xqwqmjc95q6j6.js";import{S as d}from"./hau8z519m4bqvry5.js";import{c6 as q}from"./rseqzngxzbdt1oxg.js";import{b as I}from"./owyq2pc3j9e6vumq.js";import{M as R}from"./shfcuug6yixw1dlw.js";import{e as S,W as T,f as E,w as W}from"./ktoofw7mjru0a6r5.js";import{a as B}from"./grzmcn0q8182ltoo.js";import"./on8091w14zfmyea2.js";import"./cqyjjngibokvfw83.js";import"./ogr5nmy9hq7gfgq0.js";import"./iq82wz84d1fxj03i.js";import"./elolu96rnfzqcgif.js";import"./kcqshnk26ykm1u4n.js";import"./fibktxptqydbr54o.js";import"./6a3e5rtr9pyzi31y.js";import"./ik8y7nlve9mzjttb.js";import"./isxemcalu9537a8n.js";import"./ejklrllfl9wcn2za.js";import"./gnhjnh2n0u3gy6qx.js";import"./e0pswmo7irlt62pp.js";import"./fd9rmcpa6ai71fe6.js";import"./fsu81ov1h2xmh0dx.js";import"./blhqqdzhd9z6fst7.js";import"./lsmgulr8t4c2ohfe.js";import"./gjid53jxmuj8a8kw.js";import"./n0u5fqw2jde51umw.js";import"./k1vf300nfu1glkjf.js";import"./oevbdyhdaqh4lk1q.js";import"./cll46xg89nxc0ghy.js";import"./d8r48c27g352nr7t.js";function F(){const a=C(),o=_(),p=M(),{taskId:s,turnId:r}=N(),[f,c]=l.useState(!1),x=l.useMemo(()=>S(s,r,{refetchInterval:t=>{const u=t.state?.data?.turn?.pull_request_status;switch(u){case null:case void 0:case"not_created":case"creating":return 2e3;case"failed":case"created":case"updated":return!1;default:j(u)}}}),[s,r]),{data:m}=b(x),g=k(),h=async()=>{if(!(!s||!r))try{c(!0),await T.createPr(s,r,Q()),await p.invalidateQueries({queryKey:["wham","task"]})}catch(t){t instanceof E&&W(t,r,a,g)}finally{c(!1)}},n=m?.turn?.pull_request_data?.url;l.useEffect(()=>{n&&(window.location.href=n)},[n]);const w=m?.turn?.pull_request_status==="failed";return e.jsx(R,{children:e.jsx(I,{mobileHeaderRightContent:null,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(B,{className:"absolute start-0 end-0 top-0",children:e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(q,{onClick:()=>{window.opener?(window.opener.focus(),window.close()):o(`/codex/tasks/${s}`)},icon:e.jsx(d,{}),label:a.formatMessage({id:"wham.task.pr.header.title",defaultMessage:"Back to task"})})})}),e.jsx("div",{className:"flex grow items-center justify-center p-4",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(y,{className:"mb-4 h-15 w-15"}),w?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"text-token-text-error flex items-center gap-1",children:e.jsx(i,{id:"wham.task.pr.inProgress.error.description",defaultMessage:"Failed to create pull request. Please try again."})}),e.jsx(P,{color:"secondary",size:"small",icon:d,loading:f,onClick:t=>{t.preventDefault(),t.stopPropagation(),h()},children:e.jsx(i,{id:"wham.task.pr.inProgress.error.button",defaultMessage:"Retry"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"loading-shimmer-pure-text text-lg font-semibold",children:e.jsx(i,{id:"wham.task.pr.inProgress.title",defaultMessage:"Creating pull requestâ€¦"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(i,{id:"wham.task.pr.inProgress.description",defaultMessage:"Pull request will automatically open once it has been created."})})]})]})})]})})})}function Q(){const o=new URLSearchParams(location.search).get("mode");if(o==="draft")return"draft";if(o==="auto_merge")return"auto_merge"}const ge=()=>[{title:"Codex"}],he=v(function(){return e.jsx(F,{})});export{he as default,ge as meta};
//# sourceMappingURL=kd4xqt2om9c4js3s.js.map
