import{gi as o,lI as w,a as y,nj as N,bg as k,nk as M,kK as U,R as f,gh as i,dS as H,dU as L,c1 as x,dg as u,kJ as D,c3 as F,nl as C,P as O,Q as G}from"./hml6mmd5fyx85si7.js";import{e as j,a as v,r as T,j as E,ad as A}from"./lu2xqwqmjc95q6j6.js";import{g as q}from"./gg1s4honclov8kyu.js";import{C as B}from"./oevbdyhdaqh4lk1q.js";const $={OAUTH_SCOPES_MISMATCH:o.OAUTH_FAILED_SCOPE_MISMATCH,EMAIL_DOMAIN_CLAIMED_BY_ANOTHER_WORKSPACE:o.OAUTH_FAILED_EMAIL_DOMAIN_ENFORCEMENT},Z=w(function(){const _=j(),S=y(),s=v(),l=U("installations/select_target"),h=N(),m=k(),g=T.useRef(!1),{mutateAsync:R}=M();return T.useEffect(()=>{if(g.current===!0)return;g.current=!0;async function I(){const p=q()==="popup"||h,P=window.location.href;try{const t=await f.safePost("/aip/connectors/links/oauth/callback",{requestBody:{full_redirect_url:P}});if(!t?.post_auth_url){s(i(o.OAUTH_FAILED_GENERIC));return}const e=new URL(t.post_auth_url,location.origin),r=t?.link?.connector_id===H[L.GITHUB_CONNECTOR],c=e.searchParams.get("github_onboarding")==="sync-repos";if(r&&c){const n=await f.safePost("/aip/connectors/github/search_repos",{requestBody:{query:"",limit:20,next_token:null,link_id:t.link.id}});if(!n||n.repos.length===0){window.open(`${l}?state=${encodeURIComponent(JSON.stringify({client_redirect_to:`${window.location.origin}/?github_onboarding=sync-repos`}))}`,"_self");return}}const d=x(e.hash)===u.Connectors;if(!d){const n=D[t.link.connector_id];n&&e.searchParams.set("add_source",n)}let a;if(d){const n=new URLSearchParams;n.set("connector",t.link.connector_id),r&&!c&&n.set("github_onboarding","configure-repos");const b={...e,search:"",hash:F(u.Connectors).hash+`?${n.toString()}`};a=A(b)}else r&&!c&&e.searchParams.set("github_onboarding","configure-repos"),a=A({pathname:e.pathname,search:e.search,hash:e.hash});if(p){C({success:!0,connectorId:t.link.connector_id,linkId:t.link.id}),window.close();return}O.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_success",{success:!0,type:t.link.connector_id}),s(i(o.CUSTOM_MSG,a,_.formatMessage({id:"Og/gZO",defaultMessage:"{connector} is now connected"},{connector:t.link.name})))}catch(t){const e=t instanceof G?$[t.detail?.error_code]??o.OAUTH_FAILED_GENERIC:o.OAUTH_FAILED_GENERIC;if(p){C({success:!1,connectorId:"",errorType:e}),window.close();return}O.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_error",{errorType:e,success:!1,type:"unknown"}),s(i(e,`#settings/${u.Connectors}`))}}I()},[S,h,l,_,s,m,R]),E.jsx("div",{className:"flex h-screen w-screen items-center justify-center",children:E.jsx(B,{size:36})})});export{Z as default};
//# sourceMappingURL=cqe7nltge85j0vhs.js.map
