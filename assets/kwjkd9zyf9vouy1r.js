import{cG as E,a as S,nv as u,l6 as d,c3 as U,dg as k,nw as L,nx as M}from"./hml6mmd5fyx85si7.js";import{aD as I}from"./rseqzngxzbdt1oxg.js";import{a as v,r as c,X as f}from"./lu2xqwqmjc95q6j6.js";const x=new Set(["google-oauth2","windowslive","apple"]),O="password",P=4*60;function _(t,e){return e?.idp&&x.has(e.idp)?{connection:e.idp,...e.email&&{login_hint:e.email}}:e?.idp==="auth0"?{connection:O,...e.email?{login_hint:e.email}:{[L]:"true"}}:e?.email?{...e.email&&{login_hint:e.email}}:{}}function h(t){if(!t)throw new Error("No session found, cannot enable MFA");if(t.authProvider==="mocked")throw new Error("Mock users can't enable MFA! Please setup Auth0 following the instructions in the README")}function m(t){try{return I(t)}catch{throw new Error("Unable to decode access token")}}function R(t){return t.pwd_auth_time}function g(t){const e=R(t);if(!e)return!0;const o=e/1e3;return Date.now()/1e3-o>P}function b(t){return t[M]?.required==="yes"}function y(t){const{session:e}=E(),o=v(),[l,s]=c.useState(!1),w=e?.user?.idp==="auth0",p=!!e?.user?.mfa,a=S(),A=c.useCallback(async()=>{h(e),s(!0);const i=new URL(t.redirectUrl?`/auth/enroll_mfa?redirect_path=${encodeURIComponent(t.redirectUrl)}`:"/auth/enroll_mfa",window.location.origin).toString();let n=!0;if(e?.accessToken){const r=m(e.accessToken);n=g(r)}if(n){f.signIn(e?.authProvider,{callbackUrl:i},{max_age:"0",...u(d()),..._(a,e?.user)});return}window.location.href=i,s(!1)},[a,e,t.redirectUrl]),T=c.useCallback(async()=>{h(e);const i=new URL("/auth/disable_mfa",window.location.origin).toString();let n=!0;if(e?.accessToken){const r=m(e.accessToken);n=g(r)||!b(r)}if(n){f.signIn(e?.authProvider,{callbackUrl:i},{max_age:"0",..._(a,e?.user),...u(d())});return}o({...U(k.Security),pathname:"/",search:"disable_mfa=true"})},[a,e,o]);return{setupMfa:A,isUsernamePassword:w,isLoggedInWithMfa:p,removeMfa:T,isLoadingRedirect:l}}export{y as u};
//# sourceMappingURL=kwjkd9zyf9vouy1r.js.map
