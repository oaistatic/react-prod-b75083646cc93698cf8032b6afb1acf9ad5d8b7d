import{r as h,l as Me,e as T,j as n,d as Se,A as ke,M as G,R as ve,a as _e}from"./lu2xqwqmjc95q6j6.js";import{ca as ye,a as q,ea as be,aN as Pe,c as z,aJ as Ce,c4 as L,cR as D,o9 as ee,T as V,J as se,R as O,bg as je,q as ae,P as te,g as J,d as F,b as Ie,C as ne,hk as $,fi as Le,G as De,V as U,B as Fe}from"./hml6mmd5fyx85si7.js";import{cj as Ae,ck as Re,f as Te,cl as Oe,cm as X,cn as We,aM as oe,co as A,a5 as Ee,at as Y,cp as Be,cq as Ne,cr as Ge,cs as Ue,ct as $e,cu as Z,am as qe}from"./rseqzngxzbdt1oxg.js";const y=ye(()=>({isOpen:!1,focusedWalnutId:null,presentationMap:{},walnutReaderPromise:null})),ze=s=>{y.setState({isOpen:!0,focusedWalnutId:s})},Ve=()=>{y.setState({isOpen:!1})},Je=()=>{y.setState({isOpen:!1,focusedWalnutId:null,presentationMap:{},walnutReaderPromise:null})},Xe=(s,a)=>{y.setState(e=>{const t=e.presentationMap[s];return t?(t.selectedSlideIdx=typeof a=="function"?a(t.selectedSlideIdx):a,{...e,presentationMap:{...e.presentationMap,[s]:t}}):e})},He=(s,a)=>{y.setState(e=>({...e,presentationMap:{...e.presentationMap,[s]:a}}))},Ke=(s,a)=>{y.setState(e=>{const t=e.presentationMap[s];return t?(t.selectedSheetIdx=typeof a=="function"?a(t.selectedSheetIdx):a,{...e,presentationMap:{...e.presentationMap,[s]:t}}):e})};function Qe(){return{...y(s=>({isOpen:s.isOpen,focusedWalnutId:s.focusedWalnutId,presentationMap:s.presentationMap})),open:ze,close:Ve,reset:Je,setSelectedSlideIdx:Xe,setSelectedSheetIdx:Ke,updatePresentationMap:He}}const p=Se({copyLink:{id:"postSharingModal.copyLink",defaultMessage:"Copy link"},linkCopied:{id:"postSharingModal.linkCopied",defaultMessage:"Link copied!"},failedToGenerateShareLink:{id:"postSharingModal.failedToGenerateShareLink",defaultMessage:"Failed to generate share link"},fromChatGPT:{id:"postSharingModal.fromChatGPT",defaultMessage:"From ChatGPT"},contentUnavailable:{id:"postSharingModal.contentUnavailable",defaultMessage:"Content Unavailable"},unavailableReasonGeneral:{id:"postSharingModal.unavailableReasonGeneral",defaultMessage:"This share link is not available because it doesn’t exist or you don’t have access to it."},unavailableReasonWorkspace:{id:"postSharingModal.unavailableReasonWorkspace",defaultMessage:"This content was shared from a workspace you don’t have access to. Ask the owner to invite you if you’d like to view it."},ok:{id:"postSharingModal.ok",defaultMessage:"OK"},shareLinkVisibleToWorkspaceOnly:{id:"postSharingModal.shareLinkVisibleToWorkspaceOnly",defaultMessage:"The share links are visible to workspace members only."},download:{id:"postSharingModal.download",defaultMessage:"Download"},downloadPdfButtonMenu:{id:"postSharingModal.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"},downloadDocxButtonMenu:{id:"postSharingModal.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"},downloadPptxButtonMenu:{id:"postSharingModal.download-pptx-button.menu",defaultMessage:"Microsoft PowerPoint Document (.pptx)"},downloadFileError:{id:"postSharingModal.downloadFileError",defaultMessage:"Failed to download file. Please try again later."},imageLicenseDisclaimer:{id:"postSharingModal.imageLicenseDisclaimer",defaultMessage:"Only share images you have a license to use. <link>Learn{nbsp}more</link>"},screenshotDisclaimer:{id:"postSharingModal.screenshotDisclaimer",defaultMessage:"Screenshots may contain sensitive information."}});function Ye(s){const a=Le(s,e=>$.getImageAssetPointers(e).length>0);return a?$.getImageAssetPointers(a)[0]:null}function Ze({showLinkCopied:s,isGeneratingShareLink:a,onClick:e,postText:t,showDownloadButton:o,odysseyShareIntent:i,isDownloadingOdyssey:r,onOdysseyFileDownload:l,disabled:d}){const c=T(),w=q(),v=ae(w)?.isWorkspaceAccount();let x=[{id:"copy",icon:a?n.jsx(De,{}):n.jsx(Ee,{}),label:s?c.formatMessage(p.linkCopied):c.formatMessage(p.copyLink),action:"copy"}];v?o&&x.push({id:"download",icon:n.jsx(Y,{}),label:c.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}):x=x.concat({id:"x",href:u=>`https://twitter.com/intent/tweet?url=${encodeURIComponent(u)}&text=${t?encodeURIComponent(t):""}`,icon:n.jsx(Be,{initialFillColor:"var(--text-primary)"}),label:c.formatMessage({id:"postSharingModal.x",defaultMessage:"X"}),action:"share"},{id:"linkedin",href:u=>`https://www.linkedin.com/shareArticle?url=${encodeURIComponent(u)}&text=${t?encodeURIComponent(t):""}`,icon:n.jsx(Ne,{initialFillColor:"var(--text-primary)"}),label:c.formatMessage({id:"postSharingModal.linkedin",defaultMessage:"LinkedIn"}),action:"share"},{id:"reddit",href:u=>`https://www.reddit.com/submit?url=${encodeURIComponent(u)}&title=${t?encodeURIComponent(t):""}`,icon:n.jsx(Ge,{initialFillColor:"var(--text-primary)"}),label:c.formatMessage({id:"postSharingModal.reddit",defaultMessage:"Reddit"}),action:"share"},...o?[{id:"download",icon:n.jsx(Y,{}),label:c.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}]:[]);const k=!!r;return n.jsx(n.Fragment,{children:x.map(u=>u.id==="download"&&i?n.jsx(Ue,{downloading:k,onOdysseyFileDownload:l,disabled:d??!1,icon:u.icon,label:u.label,odysseyShareIntent:i},u.id):n.jsxs("button",{onClick:()=>{e(u),te.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:u.id})},disabled:d,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[n.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:n.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:u.icon})}),n.jsx("div",{className:"w-full text-center text-xs",children:u.label})]},u.id))})}async function es(s,a,e){return se(a.asset_pointer)?(await Oe(s,[a],null,void 0,e))[0]:null}const ss=async(s,a,e)=>{const t=()=>V.findNode(J(a),({message:r})=>r.id===e||!!$.getImageAssetPointers(r).find(l=>l.asset_pointer===s));let o=t();if(!o?.message&&(await Te(a),o=t(),!o?.message))return null;const i=D(a);return{postText:o.message.metadata?.image_gen_title,imageAssetPointer:Ye([o.message]),serverThreadId:i}};async function as(s,a,e,t){const o=se(a.asset_pointer);if(!o)return null;const i=await O.safePost("/share/post",{requestBody:{post_text:e,attachments_to_create:[{kind:"image_share",file_id:o,conversation_id:s,width:t?.width,height:t?.height}]}});return X(i.post.id)}async function ts(s,a,e){const t=await O.safePost("/share/post",{requestBody:{post_text:e,attachments_to_create:[{kind:"message_slice",conversation_id:s,message_ids:a}]}});return X(t.post.id)}function ie(s,a){const e=J(s);return e?{id:"tmp",kind:"message_slice",messages:a.map(o=>{const i=V.findNode(e,({message:r})=>r.id===o);return i?i.message:null}).filter(Boolean)}:null}function re(s){return{id:"tmp",kind:"message_slice",messages:[s.previewMessage]}}function H({postSharingData:s,onClose:a}){const{clientThreadId:e,postText:t,generateShareLinkFn:o,coverImageUrl:i,messageSliceIds:r,odysseyShareIntent:l}=s,d=h.useRef(void 0),[c,w]=h.useState(!1),[S,v]=h.useState(!1),x=T(),k=je(),[u,Q]=h.useState(!0),le=q(),ce=ae(le)?.isWorkspaceAccount();h.useEffect(()=>{te.logEventWithStatsig("Share Post: Post Sharing Modal Shown","chatgpt_post_share_modal_shown")},[]),h.useEffect(()=>{d.current=void 0},[e]);const C=h.useMemo(()=>l?re(l):i||!r||r.length===0?null:ie(e,r),[i,e,r,l]),W=h.useMemo(()=>{const g=J(e);return g?V.getConversationTurns(g).flatMap(M=>M.messages):[]},[e]),{hasImage:de,hasScreenshot:ue}=h.useMemo(()=>{let g=!1,M=!1;if(W.length){const _=W,j=/\.(jpe?g|png|gif|webp|bmp|tiff)$/i,I=f=>{if(!Array.isArray(f))return!1;for(const m of f)if(m.type==="image_inline"&&m.clicked_from_url&&(M=!0),m.type==="file"&&"file_name"in m){const P=m.file_name.toLowerCase();(P.endsWith(".pptx")||j.test(P))&&(g=!0)}};_.forEach(f=>{const m=f.metadata;if(!m)return;const P=[...Object.values(m.n7jupd_crefs_by_file??{}).flat(),...Object.values(m.content_references_by_file??{}).flat()],N=[...m.n7jupd_crefs??[],...m.content_references??[]];I(P),I(N)})}return{hasImage:g,hasScreenshot:M}},[W]),E=D(e),fe=async(g,M)=>{if(!(c||!E)&&E){if(!d.current){w(!0);try{const _=await o();_&&(d.current=_)}catch{k.danger(p.failedToGenerateShareLink,{toastId:"failed_to_generate_share_link"})}finally{w(!1)}}if(d.current){if(g.action==="copy")navigator.clipboard.writeText(d.current),v(!0),k.success(x.formatMessage(p.linkCopied)),setTimeout(()=>{v(!1)},3e3);else if(g.action==="share"&&g.href)window.open(g.href(d.current),"_blank","noopener,noreferrer");else if(g.action==="download"){if(!i)return;qe({url:i,fileName:`${t}.png`})}}}},ge=n.jsx("div",{className:F("flex w-full justify-center rounded-xl",i||C&&l?.isStandaloneAttachment?"max-xs:max-h-[260px] h-[30vh] max-h-[550px] max-sm:max-h-[300px]":"aspect-[1200/630]",!i&&!l?.isStandaloneAttachment&&"outline-token-border-light overflow-hidden shadow-sm outline outline-1"),children:i?n.jsx("img",{src:i,alt:t}):l?.isStandaloneAttachment&&C?n.jsx(We,{attachments:[C],variant:"unfurl",className:"h-full w-full",clientThreadId:e}):C?n.jsx(oe,{attachments:[C],clientThreadId:e,className:"h-full"}):null}),he="normal",[me,B]=h.useState(!1),{presentationMap:pe}=Qe(),b=x.formatMessage(p.downloadFileError),we=async(g,M,_,j)=>{const I=E;if(!(!g||!M||!I))if(B(!0),g.endsWith("md")){if(!j)return;try{const f=await O.safePost("/export_doc/n7jupd",{requestBody:{conversation_id:I,message_id:_,file_id:M,export_type:j},skipJsonTransform:!0});f.ok||(k.danger(b,{toastId:"post_sharing_modal_download_error",loggingTitle:b,loggingDescription:"Error message when a file download fails"}),U.addError("post_sharing_modal_download_error",{statusText:f.statusText,status:f.status}));const m=await f.blob(),P=f.headers.get("Content-Disposition"),N=$e(P)??`Agent.${j}`;Z(m,N)}catch(f){k.danger(b,{toastId:"post_sharing_modal_download_error",loggingTitle:b,loggingDescription:"Error message when a file download fails"}),U.addError(f)}finally{B(!1)}}else{const f=pe[M];if(!f||!f.fileBlob){k.danger(b,{toastId:"post_sharing_modal_download_error",loggingTitle:b,loggingDescription:"Error message when a file download fails"}),U.addError("post_sharing_modal_download_error"),B(!1);return}Z(f.fileBlob,g)}},xe=n.jsxs(n.Fragment,{children:[n.jsx("div",{className:F("flex flex-wrap justify-center space-y-4 space-x-12 max-sm:space-x-6","mt-12 max-sm:mt-6"),children:n.jsx(Ze,{showLinkCopied:S,isGeneratingShareLink:c,disabled:c,onClick:fe,postText:t,showDownloadButton:!!(i||l),odysseyShareIntent:l,isDownloadingOdyssey:me,onOdysseyFileDownload:we})}),ls(de,ue,ce??!1)]});return n.jsx(ke,{onExitComplete:a,children:u&&n.jsx(A.Root,{isOpen:!0,onClose:()=>{Q(!1)},className:"max-w-[664px] px-4",children:n.jsx(A.Overlay,{showBackground:!0,children:n.jsxs(A.Content,{size:"normal",position:"center",className:F("flex flex-col pb-4 focus:outline-hidden",{"max-w-[640px]":he==="normal"}),removePopoverStyling:!1,shadow:"normal",children:[n.jsx(A.Header,{title:t,type:"success",closeButton:n.jsx(Ie,{onClick:()=>Q(!1)})}),n.jsxs("div",{children:[n.jsx("div",{className:F("flex justify-center",!l&&"pointer-events-none"),children:ge}),xe]})]})})})})}function R({clientThreadId:s,coverImageUrl:a,messageSliceIds:e,odysseyShareIntent:t,onClose:o}){const i=h.useMemo(()=>t?re(t):a||!e||e.length===0?null:ie(s,e),[a,s,e,t]);return i&&n.jsx(ne,{testId:"modal-mobile-post-preview",isOpen:!0,onClose:o,type:"success",size:"custom",position:"top",noPadding:!0,contentClassName:"w-full",children:n.jsx("div",{className:"aspect-[4/3] w-full",children:n.jsx(oe,{attachments:[i],clientThreadId:s,className:"h-full"})})})}function gs(){return!!h.useContext(Ae)?.postWithProfile}async function K({postText:s,postTitle:a,clientThreadId:e,generateShareLinkFn:t,renderPreviewFn:o,usePostText:i,useShareLink:r,useShareTitle:l}){if(!D(e))return!1;try{const c=await t();return c?(o&&o(),await navigator.share({text:i?s:void 0,url:r?c:void 0,title:l?a:void 0}),!0):!1}catch{return!1}}async function ns(s,a,e,t,o,i,r=!1){const l=await ss(s,a,e);if(!l?.imageAssetPointer||!l?.serverThreadId)return;const{postText:d,imageAssetPointer:c,serverThreadId:w}=l,S=await es(t,c,w);if(!S)return;const v=()=>as(w,c,d,S);if(i&&z(o,"1138231213")){const x=Ce(o,"2382399797");if(await K({clientThreadId:a,postText:d,generateShareLinkFn:v,usePostText:x.get("navigator_share_text",!1),useShareLink:x.get("navigator_share_link",!1)}))return}L(o,H,{postSharingData:{clientThreadId:a,postText:d,generateShareLinkFn:v,coverImageUrl:S?.url}})}async function os(s,a,e,t,o,i=!1){const r=D(s);if(!r)return;const l=()=>ts(r,a,o);if(t&&z(e,"1138231213")){await K({clientThreadId:s,generateShareLinkFn:l,renderPreviewFn:()=>{L(e,R,{clientThreadId:s,coverImageUrl:void 0,messageSliceIds:a})},useShareLink:!0,useShareTitle:!0,postTitle:o}),ee(e,R);return}L(e,H,{postSharingData:{clientThreadId:s,generateShareLinkFn:l,postText:o,messageSliceIds:a,messageSliceAttachment:void 0}})}const is=async(s,a,e,t)=>{if(!D(a))return;const i=async()=>{const r=await O.safePost("/share/post",{requestBody:{attachments_to_create:[{kind:"odyssey_artifact",file_id:s.fileId,message_id:s.messageId,conversation_id:s.serverThreadId}]}});return X(r.post.id)};if(t&&z(e,"1138231213")){const r=await K({clientThreadId:a,generateShareLinkFn:i,renderPreviewFn:()=>{L(e,R,{clientThreadId:a,generateShareLinkFn:i,coverImageUrl:void 0,messageSliceIds:void 0,odysseyShareIntent:s})},useShareLink:!0,useShareTitle:!1});if(ee(e,R),r)return}L(e,H,{postSharingData:{clientThreadId:a,generateShareLinkFn:i,odysseyShareIntent:s,messageSliceIds:void 0}})};function hs(s){const{assetPointer:a=null,clientThreadId:e,imageGenMessageId:t,messageSliceIds:o,odysseyShareIntent:i}=s,r=!1,l=Me(),d=q(),c=be(),w=Pe(e,S=>S?.title);return h.useEffect(()=>{Re()},[]),h.useCallback(async()=>{t?await ns(a,e,t,l,d,c,r):o?await os(e,o,d,c,w??void 0,r):i&&await is?.(i,e,d,c)},[a,e,t,o,w,l,c,r,i,d])}function rs(s){const a=T();switch(s){case"general":return a.formatMessage(p.unavailableReasonGeneral);case"workspace":return a.formatMessage(p.unavailableReasonWorkspace);default:return a.formatMessage(p.unavailableReasonGeneral)}}function ms({onClose:s,reason:a}){const e=T(),t=_e(),o=()=>{s(),t("/")},i=rs(a);return n.jsx(ne,{testId:"modal-post-sharing-error",isOpen:!0,type:"danger",textCenter:!0,title:e.formatMessage(p.contentUnavailable),description:i,onClose:o,footerContent:n.jsx(Fe,{size:"large",color:"primary",className:"w-full",onClick:o,children:e.formatMessage(p.ok)})})}function ls(s,a,e){const t=[];return e&&t.push(n.jsx(G,{...p.shareLinkVisibleToWorkspaceOnly},"workspace")),a&&t.push(n.jsx(G,{...p.screenshotDisclaimer},"screenshot")),s&&t.push(n.jsx(G,{...p.imageLicenseDisclaimer,values:{nbsp:" ",link:o=>n.jsx("a",{href:"https://help.openai.com/",target:"_blank",rel:"noopener noreferrer",className:"underline",children:o})}},"image")),t.length?n.jsx("p",{className:"text-token-text-tertiary text-center text-sm sm:mt-2",children:t.map((o,i)=>n.jsxs(ve.Fragment,{children:[i>0&&n.jsx(n.Fragment,{children:" "}),o]},i))},"image-disclaimer"):null}export{ms as P,gs as a,Qe as b,Je as r,hs as u};
//# sourceMappingURL=isxemcalu9537a8n.js.map
