import{r as g,j as p,e as d}from"./lu2xqwqmjc95q6j6.js";import{ef as M,s as l,N as T,a as C,c as x,eL as k}from"./hml6mmd5fyx85si7.js";import{CoTChunks as _}from"./l0ivalp7uhq9xacw.js";import{g$ as m}from"./rseqzngxzbdt1oxg.js";import"./cvhvuzqgknunygm1.js";import"./grgafnin9dqj3keo.js";import"./gjid53jxmuj8a8kw.js";import"./nsxv1nyryaz0gxvd.js";import"./f3481c1q9qdfwnf6.js";import"./cll46xg89nxc0ghy.js";import"./ibcsr9sfusjfjjf0.js";import"./ndox4jgq2pedhhgi.js";import"./pbl95wx6493wq92j.js";import"./oevbdyhdaqh4lk1q.js";import"./ckfi4ewp3npyfeir.js";import"./kqu7xjhdd7w6mde0.js";import"./hau8z519m4bqvry5.js";import"./isxemcalu9537a8n.js";const y=(e,t)=>{if(t<=1)return e.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(t<3)return e.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(t<4)return e.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(t>=60){const n=Math.floor(t/60),o=t%60;return`${n}m ${o}s`}return e.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:t})},E=e=>{let t=0;for(const n of e)t+=n.metadata?.finished_duration_sec??0;return t},R=(e,t,n)=>t.length>1?e.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:y(e,n)}):M(t)?.metadata?.finished_text??"",I=(e,t,n=!1)=>{const o=[];let s={type:m.Thought,thought:{summary:"",content:""}};const a=()=>{s.thought.content.trim()&&(o.push(s),s={type:m.Thought,thought:{summary:s.thought.summary,content:""}})},u=e.split(/( {2}\n)|(\n\n)/).filter(i=>i!=null&&i.trim());if(!n&&u.length<2)return o;let c=!1;for(let i=0;i<u.length;i++){const r=u[i].trim();if(r.toLowerCase()==="none"){l.count(T.COT_SUMMARIZER,"num_none_chunks");continue}const f=r.match(/^\*\*(.*)\*\*$/);if(f)a(),s.thought.summary=f[1]??"";else if(r){if(r.startsWith("```")){if(c){s.thought.content+=s.thought.content?`
${r}`:r,a(),c=!1;continue}a(),c=!0}s.thought.content.trim()&&!r.startsWith("\\[")&&!r.startsWith("\\(")&&!c&&a(),s.thought.content+=s.thought.content?`
${r}`:r}}return s?.thought.content.trim()&&o.push(s),n&&t&&o.push({type:m.Recap,content:t}),o},N=(e,t,n)=>{const o=!n,s=g.useMemo(()=>I(e,t,o),[e,t,o]);return g.useEffect(()=>{o&&l.hist(T.COT_SUMMARIZER,"num_cot_chunks",void 0,s.length)},[o]),s},S=({isStreaming:e,finishedText:t,summaryText:n,isFinalAssistantTurn:o})=>{const s=N(n,t,e);return p.jsx(_,{isStreaming:e,isFinalAssistantTurn:o,chunks:s})},O=8,$=`

`,J=({messages:e,isStreaming:t,isFinalAssistantTurn:n})=>{const o=d(),s=C(),a=x(s,"1214379119"),u=E(e);let c="";return e.forEach(i=>{const h=k(i);c+=c?$+h:h}),a&&!t&&!c&&u<O?null:p.jsx(S,{finishedText:R(o,e,u),summaryText:c,isStreaming:t,isFinalAssistantTurn:n})};export{S as LegacyCoT,J as LegacyCoTMessage};
//# sourceMappingURL=b9t2j8xbcrr8hz7a.js.map
