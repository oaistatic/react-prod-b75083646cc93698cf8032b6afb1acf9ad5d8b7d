import{j as e,m as H,M as l,r as p,e as v,l as L,u as Q,n as W}from"./lu2xqwqmjc95q6j6.js";import{gL as K,ef as E,gM as Y,aE as $,gN as J,cf as Z,gv as V}from"./rseqzngxzbdt1oxg.js";import{d as S,c6 as P,c0 as X,bg as F,B as I,P as j,C as O,bz as R,R as T,a as ee,q as se,jC as te,pq as z,ay as ae,aB as y}from"./hml6mmd5fyx85si7.js";import{t as re}from"./glhf2v443rhkp7lb.js";import{T as g}from"./l2fd3uykkvam5v10.js";const oe=80,B=100;function ne(s){return s<B?"bg-[#fcf6e0] text-yellow-500 dark:bg-yellow-600 dark:text-yellow-100":"bg-[rgba(229,76,66,0.16)] text-[#DC2626] dark:bg-[rgba(202,58,49,0.16)] dark:text-[#DC2626]"}function U(s){return K()&&s!=null&&s>oe}function ie({memoryFullPct:s,className:r,children:o,showInfoLabel:a,onManageMemories:i}){return U(s)?e.jsx("div",{className:S("border-token-border-default rounded-lg border p-1 text-sm",r),children:e.jsxs(H.div,{className:S("flex items-center overflow-hidden rounded-sm px-2 py-1.5 whitespace-nowrap",ne(s)),initial:{width:0},animate:{width:`${s}%`},transition:{duration:.5},children:[e.jsx(l,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:s}}),o,a&&e.jsx(P,{interactive:!0,label:s<B?e.jsx("div",{className:"whitespace-normal",children:e.jsx(l,{id:"gxY4wi",defaultMessage:"ChatGPT's almost out of space for new saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:d=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:m=>{m.preventDefault(),i?.()},children:d})}})}):e.jsx("div",{className:"whitespace-normal",children:e.jsx(l,{id:"1JxMf3",defaultMessage:"ChatGPT's out of space for saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:d=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:m=>{m.preventDefault(),i?.()},children:d})}})}),children:e.jsx(X,{className:"icon-sm ms-1"})})]})}):null}function le({memoryFullPct:s,className:r}){return U(s)?e.jsxs("div",{className:S("flex flex-col gap-2",r),children:[e.jsx(ie,{memoryFullPct:s}),e.jsx("div",{className:"text-token-text-secondary ps-3 text-sm",children:s<B?e.jsx(l,{id:"SnInO0",defaultMessage:"<strong>Almost full.</strong> Once full, new memories won't be saved. You can remove existing memories to make room.",values:{strong:a=>e.jsx("strong",{children:a})}}):e.jsx(l,{id:"/LO3dv",defaultMessage:"<strong>You’re out of space.</strong> Remove existing memories to make room for ChatGPT to save new memories.",values:{strong:a=>e.jsx("strong",{children:a})}})})]}):null}function D({description:s,onClose:r,onConfirm:o}){const a=v();return e.jsx(O,{testId:"modal-confirm-reset-memory",isOpen:!0,onClose:r,type:"success",title:a.formatMessage({id:"MemoriesModal.resetModalTitle",defaultMessage:"Are you sure?"}),description:s,primaryButton:e.jsx(R.Button,{title:a.formatMessage({id:"MemoriesModal.resetModalConfirm",defaultMessage:"Clear memory"}),color:"danger",onClick:o,"data-testid":"confirm-reset-memories-button"}),secondaryButton:e.jsx(R.Button,{title:a.formatMessage({id:"MemoriesModal.resetModalCancel",defaultMessage:"Cancel"}),color:"secondary",onClick:r})})}function de({onReset:s,gizmoId:r,memoryName:o}){const[a,i]=p.useState(!1),t=v(),d=F(),m=E(),c=async()=>{j.logEvent("Memory Manage Reset Button Confirmed");try{await T.safeDelete("/settings/clear_account_user_memory",{requestBody:{gizmo_id:r}}),d.success(t.formatMessage({id:"ResetMemoriesButton.resetSuccess",defaultMessage:"Memory cleared."})),s?.(),i(!1)}catch{d.danger({id:"ResetMemoriesButton.resetFailed",defaultMessage:"Failed to clear memory.",description:"Error message for the reset memory modal"},{toastId:"reset_memories_button_reset_failed"})}};return e.jsxs(e.Fragment,{children:[e.jsx(I,{color:"danger-outline",onClick:()=>{j.logEvent("Memory Manage Reset Button Clicked"),i(!0)},"data-testid":"reset-memories-button",children:r?e.jsx(l,{id:"ResetMemoriesButton.resetGizmo",defaultMessage:"Clear this GPT's memory"}):e.jsx(l,{id:"ResetMemoriesButton.resetChatGPT",defaultMessage:"Delete all"})}),a&&(m?e.jsx(D,{description:t.formatMessage({id:"MemoriesModal.resetGizmoModalDescriptionUpdated",defaultMessage:"Deleting your saved memories means {name} may not remember this information going forward. To fully remove this information from {name}'s memory, please delete any related chats. <link>Learn more</link>"},{name:o,link:u=>e.jsx("a",{className:"underline",href:"https://help.openai.com/en/articles/8983136-what-is-memory",children:u})}),onClose:()=>i(!1),onConfirm:c}):e.jsx(D,{description:t.formatMessage({id:"MemoriesModal.resetGizmoModalDescription",defaultMessage:"{name} will forget everything it has remembered from your chats. This cannot be undone."},{name:o}),onClose:()=>i(!1),onConfirm:c}))]})}function me({gizmo:s,memory:r}){const o=v(),a=F(),i=L(),{mutate:t,isPending:d}=W({mutationFn:async f=>{const{success:b}=await T.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:f}},requestBody:{gizmo_id:s?.id}});if(!b)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{i.invalidateQueries({queryKey:z(s?.id)})},onError:()=>{a.danger({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory",description:"Toast message when deleting memory fails"},{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),[m,c]=p.useState(!1),u=o.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsxs(g.Row,{disabled:d,children:[e.jsx(g.Cell,{children:e.jsx("div",{className:"py-2 whitespace-pre-wrap",children:r.content})}),e.jsx(g.Cell,{textAlign:"right",children:e.jsx(g.Actions,{children:e.jsx("button",{onClick:()=>{j.logEvent("Memory Manage Modal Memory Delete Clicked"),c(!0)},"aria-label":u,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(P,{className:"leading-none",label:u,side:"top",children:e.jsx($,{className:"icon-sm"})})})})})]}),m&&e.jsx(J,{isOpen:!0,primaryButtonColor:"danger",title:u,confirmText:o.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{j.logEvent("Memory Manage Modal Memory Delete Confirmed"),t(r.id),c(!1)},onClose:()=>{c(!1)},children:e.jsx(l,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:s?.name??"ChatGPT",title:e.jsx("strong",{children:re(r.content,{length:130,omission:"..."})}),link:f=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:f})}})})]})}function ce({selectedGizmoId:s,onSelect:r,items:o}){const a=o.find(t=>t.id===s);function i(t){return e.jsx(V,{isFirstParty:t.id===void 0,src:t.iconUrl??null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(y.Root,{children:[e.jsx(y.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[a?e.jsxs(e.Fragment,{children:[i(a),e.jsx("span",{className:"text-token-text-primary",children:a.name})]}):e.jsx(l,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(Z,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(y.Portal,{children:e.jsx(y.Content,{children:o.map(t=>e.jsxs(y.Item,{className:"flex items-center gap-3",onClick:()=>{r(t.id)},children:[i(t),t.name]},t.id))})})]})})}const N=ae.div`flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default`;function ue({onClose:s,initialGizmoId:r}){const o=v(),a=L(),i=Y(),[t,d]=p.useState(r),m=ee(),c=se(m),u=c?.hasPlusFeatures(),f=E(),b=c?.hasPaidFeatures()??!1;p.useEffect(()=>{j.logEvent("Memory Modal Shown")},[]);const{data:G,isLoading:w,isError:k,refetch:_}=te(t,!0,i),h=G?.memories,{data:q,refetch:A}=Q({queryKey:["memory_gizmos"],queryFn:()=>T.safeGet("/memories/gizmos"),refetchOnMount:"always"}),C=[{id:void 0,name:"ChatGPT",iconUrl:null},...q?.items.map(({gizmo:n})=>({id:n.id,name:n.display.name,iconUrl:n.display.profile_picture_url??null}))??[]],M=C.find(n=>n.id===t);p.useEffect(()=>{!w&&!k&&t!==void 0&&(!h||h.length===0)&&d(void 0)},[w,k,h,t]);let x;return w?x=e.jsx(N,{children:e.jsx(l,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):k?x=e.jsx(N,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(l,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(I,{color:"secondary",onClick:()=>{_()},children:e.jsx(l,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!h||h.length===0?x=e.jsx(N,{children:e.jsx("div",{className:"max-w-sm text-center",children:i?e.jsx(l,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:M?.name??"ChatGPT"}}):e.jsx(l,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):x=e.jsx(g.Root,{className:"h-full",size:"compact",bordered:!0,children:e.jsx(g.Body,{children:h.map(n=>e.jsx(me,{gizmo:M?{id:M.id,name:M.name}:void 0,memory:n},n.id))})}),e.jsxs(O,{testId:"modal-memories",isOpen:!0,onClose:s,size:"custom",className:"max-w-5xl",type:"success",title:o.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),description:e.jsx("div",{className:"text-token-text-secondary",children:f&&b?o.formatMessage({id:"MemoriesModal.description",defaultMessage:"ChatGPT tries to remember most of your chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:n})}):f?o.formatMessage({id:"MemoriesModal.description.freeMoonshine",defaultMessage:"ChatGPT tries to remember your recent chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:n})}):o.formatMessage({id:"MemoriesModalFree.description",defaultMessage:"ChatGPT remembers useful details about you and your preferences so it can be more helpful. <link>Learn more</link>"},{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:n})})}),showCloseButton:!0,children:[u&&C.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(ce,{selectedGizmoId:t,items:C,onSelect:n=>{a.invalidateQueries({queryKey:z(n)}),d(n)}})}),e.jsx(le,{memoryFullPct:G?.memoryFullPct,className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:x}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(de,{onReset:()=>{_(),A(),t&&d(void 0)},gizmoId:t,memoryName:M?.name??"ChatGPT"})})]})}const ye=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"}));export{ie as M,ue as a,ye as b};
//# sourceMappingURL=f8q9ifyvyyh6yaff.js.map
