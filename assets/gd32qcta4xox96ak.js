import{r as g,j as e,e as D,u as Z,M as l,n as fe,d as J}from"./lu2xqwqmjc95q6j6.js";import{gu as X,iz as Pe,iy as Ie,dw as he,ji as pe,aF as Fe,pN as $,pO as oe,aL as ie,S as We,pP as re,pQ as le}from"./rseqzngxzbdt1oxg.js";import{rU as Ge,rV as Ue,rW as Re,rX as Be,a as W,q as G,dJ as _e,C as E,rY as Y,G as q,kG as F,b2 as qe,c0 as ve,d as K,rZ as L,bg as O,B as y,r_ as je,eX as M,hV as ee,c6 as ye,eT as we,h1 as te,P as T,cY as Ve,r$ as Ye,dN as Ze,aM as Qe,s0 as ze,s1 as He,s2 as Je,s3 as ce,s4 as Xe,bO as $e}from"./hml6mmd5fyx85si7.js";import{S as Ke}from"./isqkn4xlzoktkvfr.js";import{S as et}from"./kk5qbg5kgpw95cl6.js";import{g as tt}from"./nalyc1vn8me3u0k0.js";import{I as de,U as ue}from"./blj9hz7z6p2ddndc.js";import{S as be}from"./hau8z519m4bqvry5.js";import{S as st}from"./dy6grwmx1xskr6sg.js";const at=t=>g.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},g.createElement("path",{d:"M10 2.08496C14.3713 2.08496 17.915 5.62867 17.915 10C17.915 14.3713 14.3713 17.915 10 17.915C5.62867 17.915 2.08496 14.3713 2.08496 10C2.08496 5.62867 5.62867 2.08496 10 2.08496ZM10 6.5C8.067 6.5 6.5 8.067 6.5 10C6.5 11.933 8.067 13.5 10 13.5C11.933 13.5 13.5 11.933 13.5 10C13.5 8.067 11.933 6.5 10 6.5Z"})),P={isOpen:!0,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,shouldIgnoreClickOutside:!0,hideSeparator:!0,noPadding:!0},U={...P,title:e.jsx(Ge,{})},Wt={...P,title:e.jsx(Ue,{})},Gt={...P,title:e.jsx(Re,{})},Ut={...P,title:e.jsx(Be,{})};function Me({onClose:t,footerContent:s,primaryButton:o,secondaryButton:a,pageSize:i=Pe,accountId:n,connectionId:r,connectorType:c,fallbackEstimatedMaxNumUsers:u}){const d=D(),j=W(),m=G(j),[p,w]=g.useState(""),[f,b]=g.useState(0),h=_e(),{data:_,isLoading:k}=X(m?.getWorkspaceId(),f*i,p,i),{data:x,isLoading:S,refetch:C,error:v}=Z({queryKey:["admin_connection_get_access_policy",r],queryFn:()=>M.admin_connection_get_access_policy(n,r)}),A=Math.ceil((_?.total??0)/i);f>=A&&A!==0&&b(Math.max(A-1,0));const[N,De]=g.useState(!1),[Te,Ee]=g.useState(0),Q=Te>0||N,ae=S||k||Q,z=x?.limits?.max_allowed_users??u,H=z===-1,Ae=!h&&(H||(x?.allowed_users.length??0)<z);return c==="google_drive_dwd"?x==null?e.jsx(E,{...P,title:Y(c),onClose:t,testId:"modal-allowed-users-picker",children:e.jsx("div",{className:"flex min-h-64 items-center justify-center p-8",children:e.jsx(q,{})})}):e.jsx(rt,{accountId:n,connectorType:c,connectionId:r,areAllUsersAllowed:x?.allow_all_in_workspace,allowedUserIds:x?.allowed_users,onClose:t,numWorkspaceMembers:_?.total,refetch:C,primaryButton:o,secondaryButton:a,footerContent:s}):e.jsxs(E,{...P,title:Y(c),onClose:t,testId:"modal-allowed-users-picker",children:[e.jsxs("div",{className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsx("div",{className:"mb-3 text-xl font-medium",children:e.jsx(l,{id:"5e46Ss",defaultMessage:"Which workspace members can use this?"})}),e.jsx("div",{className:"text-token-text-secondary mb-4",children:H?e.jsx("p",{children:e.jsx(l,{id:"Ny/DGR",defaultMessage:"You must also select yourself, these changes will be auto-saved"})}):S?e.jsx(F,{lines:1,className:"w-full"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx(l,{id:"Ny/DGR",defaultMessage:"You must also select yourself, these changes will be auto-saved"})}),e.jsx("p",{children:e.jsx(it,{numSelectedUsers:x?.allowed_users.length??0,maxAllowedUsers:z})})]})}),e.jsxs("div",{className:"mb-4 flex flex-row items-center",children:[e.jsxs("div",{className:"group relative",children:[e.jsx("input",{type:"text",value:p,onChange:B=>{w(B.target.value),b(0)},disabled:!!x?.allow_all_in_workspace,placeholder:d.formatMessage({id:"RWqomV",defaultMessage:"Search"}),className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid ps-10"}),e.jsx("div",{className:"absolute start-2 top-0 flex h-full w-8 items-center justify-center",children:e.jsx(qe,{className:"icon text-token-text-tertiary group-focus-within:text-token-text-secondary"})})]}),ae&&e.jsx(q,{className:"ms-4 h-4 w-4"})]}),v&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(ve,{className:"icon inline"}),e.jsx(l,{id:"ZhxtEO",defaultMessage:"Failed to load allowed users."}),e.jsx("button",{onClick:()=>C(),className:"underline",children:e.jsx(l,{id:"y/IEAC",defaultMessage:"Try again"})})]}),e.jsx("div",{className:K("h-[200px] max-h-[600px] overflow-y-auto px-2",x?.allow_all_in_workspace&&"opacity-50"),children:e.jsx("table",{children:e.jsx("tbody",{children:_?.items.length?_.items.map(({id:B,name:Le,email:Oe})=>{const ne=!!x?.allowed_users.includes(B);return e.jsx("tr",{className:"mb-2",children:e.jsx("td",{children:e.jsx(nt,{controlDisabled:!ne&&!Ae||!!x?.allow_all_in_workspace||N,userId:B,isUserEnabled:ne||!!x?.allow_all_in_workspace,accountId:n,connectionId:r,refetch:C,setNumPendingUserOperations:Ee,name:Le,email:Oe})})},B)}):e.jsx("tr",{children:e.jsx("td",{children:e.jsx(l,{id:"n3uhaN",defaultMessage:"No users found"})})})})})}),A>1&&e.jsx("div",{className:"my-4",children:e.jsx(Ie,{currentPage:f,onChangeIndex:b,length:A})}),H&&e.jsx(ot,{allowAllInWorkspace:!!x?.allow_all_in_workspace,controlDisabled:ae||h&&!x?.allow_all_in_workspace,refetch:C,accountId:n,connectionId:r,setShouldBlockOtherInteractions:De})]}),e.jsx(L,{footerContent:s,primaryButton:Q&&o?g.cloneElement(o,{disabled:!0,onClick:()=>{}}):o,secondaryButton:Q&&a?g.cloneElement(a,{disabled:!0,onClick:()=>{}}):a})]})}function nt({userId:t,controlDisabled:s,isUserEnabled:o,refetch:a,setNumPendingUserOperations:i,accountId:n,connectionId:r,name:c,email:u}){const d=D(),j=O(),[m,p]=g.useState(!1),w=async h=>{if(!s){p(!0),i(_=>_+1);try{await M.admin_connection_allow_user(n,r,h),await a()}catch{j.danger(d.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Admin connection allow user error"})}finally{p(!1),i(_=>_-1)}}},f=async h=>{p(!0),i(_=>_+1);try{await M.admin_connection_disallow_user(n,r,h),await a()}catch{j.danger(d.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Admin connection disallow user error"})}finally{p(!1),i(_=>_-1)}},b=e.jsxs("p",{children:[e.jsx("span",{className:"text-token-text-primary",children:c}),e.jsx("span",{className:"text-token-text-tertiary ms-2",children:u})]});return e.jsx(ke,{isLoading:m,id:`is-user-enabled--${t}`,disabled:s,checked:o,onChange:h=>{s||m||(h.currentTarget.checked?w(t):f(t))},label:b})}function ot({allowAllInWorkspace:t,controlDisabled:s=!1,accountId:o,connectionId:a,refetch:i,setShouldBlockOtherInteractions:n}){const r=D(),c=O(),[u,d]=g.useState(!1),j=async m=>{if(!s){d(!0),n(!0);try{await M.admin_connection_update_access_policy(o,a,m),await i()}catch{await i(),c.danger(r.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Access error"})}finally{d(!1),n(!1)}}};return e.jsx(ke,{isLoading:u,id:"enabled-for-everyone-checkbox",checked:t,disabled:s,onChange:m=>{s||j(m.currentTarget.checked)},label:e.jsx("span",{className:"text-token-text-primary ms-2",children:e.jsx(l,{id:"MsFKpF",defaultMessage:"Enable for everyone"})})})}function ke({isLoading:t,...s}){return t?e.jsxs("div",{className:"form-check flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("div",{className:"form-check-label text-token-text-primary",children:s.label})]}):e.jsx(Fe,{...s})}function it({maxAllowedUsers:t,numSelectedUsers:s}){return s>=t?e.jsx(l,{id:"JWJ5gc",defaultMessage:`{numSelectedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        } selected. You cannot select any more.`,values:{numSelectedUsers:s}}):s>0?e.jsx(l,{id:"dYtUgP",defaultMessage:`{numSelectedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        } selected. You can select up to {remainingAllowedUsers} more.`,values:{numSelectedUsers:s,remainingAllowedUsers:t-s}}):e.jsx(l,{id:"nVfqBL",defaultMessage:`Select up to {maxAllowedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        }.`,values:{maxAllowedUsers:t}})}function rt({connectionId:t,connectorType:s,accountId:o,onClose:a,refetch:i,numWorkspaceMembers:n,areAllUsersAllowed:r,allowedUserIds:c,primaryButton:u,secondaryButton:d,footerContent:j}){const m=D(),[p,w]=g.useState(r?"allow_all":"allow_admins"),[f,b]=g.useState(!1),h=O(),{data:_}=X(o,0,void 0,100,void 0,["account-owner","account-admin"]),k=_?.items,x=async()=>{if(!k?.length||f)return;r!==!1&&await M.admin_connection_update_access_policy(o,t,!1);const v=new Set(k.map(N=>N.id));await Promise.all(k.map(N=>M.admin_connection_allow_user(o,t,N.id)));const A=(c??[]).filter(N=>!v.has(N));await Promise.all(A.map(N=>M.admin_connection_disallow_user(o,t,N)))},S=async()=>{f||r||await M.admin_connection_update_access_policy(o,t,!0)},C=async()=>{b(!0);try{await(p==="allow_admins"?x():S()),await i()}catch{h.danger(m.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Error saving"})}finally{b(!1)}};return e.jsxs(E,{...P,title:Y(s),onClose:a,testId:"modal-dwd-allowed-users-picker",children:[e.jsx("div",{className:"px-6 py-4 text-xl font-medium",children:e.jsx(l,{id:"5e46Ss",defaultMessage:"Which workspace members can use this?"})}),e.jsxs(he,{value:p,onValueChange:v=>w(v),className:"flex w-full flex-col gap-2 px-6 py-4",children:[e.jsx(ge,{optionValue:"allow_all",Icon:Ke,optionName:m.formatMessage({id:"vtytpk",defaultMessage:"Everyone"}),subtitle:n!=null?m.formatMessage({id:"15cHOa",defaultMessage:"{count} members"},{count:n}):e.jsx(F,{lines:1}),isSelected:p==="allow_all"}),e.jsx("div",{className:"border-token-border-default border-t"}),e.jsx(ge,{optionValue:"allow_admins",Icon:et,subtitle:k!=null?k.length>3?m.formatList([...k.slice(3).map(v=>v.name??v.email),m.formatMessage({id:"zb4UOk",defaultMessage:"{count} more"},{count:k.length-3})]):m.formatList(k.map(v=>v.name??v.email)):e.jsx(F,{lines:1}),optionName:m.formatMessage({id:"l0D/jy",defaultMessage:"Admins only"}),isSelected:p==="allow_admins"})]}),e.jsx(L,{footerContent:j,primaryButton:u?g.cloneElement(u,{disabled:f,loading:f,onClick:async v=>{await C(),u.props.onClick?.(v)}}):e.jsx(y,{color:"primary",onClick:C,loading:f,disabled:f,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:f&&d?g.cloneElement(d,{disabled:!0,onClick:()=>{}}):d})]})}function ge({optionName:t,optionValue:s,subtitle:o,Icon:a,isSelected:i,disabled:n}){const r=i?at:je;return e.jsxs(pe,{value:s,id:`dwd-allowed-users-option-${s}`,className:K("flex w-full items-center justify-start gap-4",n&&"opacity-50"),disabled:n,children:[e.jsx("div",{className:"bg-token-bg-tertiary flex h-[40px] w-[40px] items-center justify-center rounded-xl",children:e.jsx(a,{className:"icon-lg"})}),e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"text-token-text-primary text-start",children:t}),e.jsx("div",{className:"text-token-text-secondary mt-1 text-start text-sm text-wrap",children:o})]}),e.jsx(r,{className:"icon-lg shrink-0"})]})}const se=g.createContext({triggerLocation:"admin_settings"});se.Provider;const R=()=>{const t=g.useContext(se);if(!t)throw new Error("useTriggerLocation must be used within a TriggerLocationProvider");return t};function lt({accountId:t,connectionId:s,onClose:o,onNext:a,secondaryButton:i,footerContent:n}){const r=D(),c=O(),u=g.useId(),[d,j]=g.useState(""),[m,p]=g.useState(null),[w,f]=g.useState(!1),{triggerLocation:b}=R(),{isLoading:h,refetch:_,data:k}=Z({queryKey:["admin:connection_instance",s],queryFn:async()=>await M.admin_get_connection_instance(t,s)});g.useEffect(()=>{k?.connection_config.knowledge_connector_type==="google_drive_dwd"&&j(k.connection_config.admin_email_address??"")},[k]);const x=k?.connection_config.knowledge_connector_type==="google_drive_dwd"?k.connection_config.service_account_credential_id:void 0,S=d.trim().length>0&&(!!m||x),C=async()=>{if(!(!S||!t||w)){f(!0);try{let v;m&&(v=await m.text()),await M.admin_connection_update_credential(t,s,{admin_email:d,new_service_credential_content:v,credential_id:x&&!v?x:void 0}),c.success(r.formatMessage({id:"q/AX/d",defaultMessage:"Credentials successfully updated."})),a()}catch(v){let A=r.formatMessage({id:"qbD4Az",defaultMessage:"Failed to update credentials."});const N=tt(v);N&&(A=r.formatMessage({id:"pzfjhv",defaultMessage:"Failed to update credentials: {error}"},{error:N.message})),T.logEventWithStatsig("Contextual Answers Admin Connection Config Change Error","chatgpt_contextual_answers_admin_connection_config_change_error",{connectorType:"google_drive_dwd",error:N?.error_type,triggerLocation:b}),c.danger(A,{toastId:"gdrive_dwd_credentials_modal",loggingTitle:"Failed to update credentials",loggingDescription:"Failed to update credentials"})}finally{_(),f(!1)}}};return e.jsx(E,{...U,onClose:o,testId:"modal-gdrive-dwd-credentials",children:h?e.jsx(F,{lines:4,className:"px-6 pt-4 pb-10"}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:v=>{v.preventDefault(),S&&C()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsx("button",{type:"submit",className:"display-none"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"qq+Txa",defaultMessage:"Setup a new connection"})}),e.jsx("div",{className:"text-token-text-secondary mt-2",children:e.jsx(l,{id:"oXAF7U",defaultMessage:"First, read the <link>setup instructions</link>, then upload the service account key provided by Google.",values:{link:v=>e.jsx(ee,{href:oe,className:"underline",onClick:()=>$({link:oe,location:"admin_onboarding_dwd_credentials"}),children:v})}})})]}),e.jsx(ct,{existingServiceKeyId:x,serviceKeyFile:m,setServiceKeyFile:p}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsxs("label",{htmlFor:u,className:"flex flex-row items-center gap-2 text-base font-medium",children:[e.jsx("span",{children:e.jsx(l,{id:"sPqjJA",defaultMessage:"Google Workspace admin email address"})}),e.jsx(ye,{withArrow:!0,side:"top",label:e.jsx("p",{className:"p-1 text-sm",children:e.jsx(l,{id:"4xWSaU",defaultMessage:"Your workspace admin’s email address is required to configure user access and select which shared drives you’d like to sync."})}),children:e.jsx(we,{className:"icon text-token-text-tertiary"})})]}),e.jsx("input",{type:"text",value:d,onChange:v=>j(v.target.value),placeholder:r.formatMessage({id:"+zP1RE",defaultMessage:"admin@example.com"}),id:u,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"})]})]})]}),e.jsx(L,{primaryButton:e.jsx(y,{loading:w,color:"primary",disabled:!S||w,onClick:C,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:i,footerContent:n})]})})}function ct({existingServiceKeyId:t,serviceKeyFile:s,setServiceKeyFile:o}){const a=g.useRef(null),i=g.useId();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-base font-medium",children:e.jsx(l,{id:"gI0O53",defaultMessage:"Service account key"})}),!!t&&!s&&e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(te,{className:"icon-sm"}),e.jsx(l,{id:"B+/4/L",defaultMessage:"Service account key already exists."})]}),!!s&&e.jsx("p",{className:"text-token-text-secondary",children:s.name}),e.jsxs("div",{className:"flex flex-row gap-2",children:[!t&&!s&&e.jsx(y,{color:"primary",type:"button",onClick:()=>a.current?.click(),children:e.jsx(l,{id:"4GjErm",defaultMessage:"Upload key"})}),(!!t&&!s||!t&&!!s)&&e.jsx(y,{color:"secondary",type:"button",onClick:()=>a.current?.click(),children:e.jsx(l,{id:"qV3zuG",defaultMessage:"Replace key"})}),!!t&&!!s&&e.jsx(y,{color:"danger-outline",type:"button",onClick:()=>o(null),children:e.jsx(l,{id:"NFpNok",defaultMessage:"Clear"})})]}),e.jsx("input",{type:"file",className:"hidden",id:i,ref:a,onChange:n=>{n.target.files&&n.target.files.length>0?o(n.target.files[0]):o(null)},accept:".json"})]})}function dt({isOpen:t,onClose:s,connectionId:o,accountId:a,primaryButton:i,secondaryButton:n,footerContent:r}){const{refetch:c,data:u,error:d,isLoading:j}=Z({queryFn:()=>gt({accountId:a,connectionId:o}),queryKey:["admin_connection_list_item_scopes",o,"shared_drive"]});return e.jsxs(E,{...U,isOpen:t,onClose:s,testId:"modal-gdrive-dwd-shared-drive-picker",children:[e.jsx("div",{className:"flex flex-col gap-6 px-6 pt-4 pb-10",children:j?e.jsx(F,{lines:4}):d?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(y,{color:"secondary",icon:be,onClick:()=>c(),children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):e.jsx(e.Fragment,{children:u&&e.jsx(ut,{accountId:a,connectionId:o,sharedDriveDefaultScope:u.default_selection,sharedDriveScopes:u.object_selections,refetch:c})})}),e.jsx(L,{primaryButton:i,secondaryButton:n,footerContent:r})]})}function ut({refetch:t,accountId:s,connectionId:o,sharedDriveDefaultScope:a,sharedDriveScopes:i}){const n=D(),r=O(),{isPending:c,mutate:u}=fe({mutationFn:async d=>await M.admin_connection_update_item_default_scope(s,o,"shared_drive",d),mutationKey:["admin_connection_update_item_default_scope",o,"shared_drive"],onError:()=>{r.danger(n.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to update policy",loggingDescription:"Failed to update policy"})},onSettled:()=>{t()}});return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"CIWfUm",defaultMessage:"How do you want to handle Shared Drives?"})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"BXG6kp",defaultMessage:"Add any Shared Drives you’d like to exclude or include by default."})}),e.jsx(st,{ariaLabel:n.formatMessage({id:"ca.scope-selector.aria-label",defaultMessage:"Select whether Shared drives are included or excluded from syncing by default."}),onChange:d=>{c||u(d)},value:a,leftItem:{ariaLabel:n.formatMessage(V.includeToggleLabel),label:n.formatMessage(V.includeToggleLabel),value:"include"},rightItem:{ariaLabel:n.formatMessage(V.excludeToggleLabel),label:n.formatMessage(V.excludeToggleLabel),value:"exclude"}}),c?e.jsx(F,{lines:3}):a==="include"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"dmDuO6",defaultMessage:"All Shared drives will be synced except for ones you choose to exclude."})}),e.jsx("p",{className:"text-token-text-secondary font-medium",children:e.jsx(l,{id:"buyi/M",defaultMessage:"Excluded Shared drives"})}),e.jsx("ul",{children:i.filter(d=>d.selection==="exclude").map(d=>e.jsx(de,{objectHandle:d.object_handle,objectType:"shared_drive",accountId:s,connectionId:o,scopeChangeIcon:ie,scopeChangeLabel:n.formatMessage({id:"NLi7nF",defaultMessage:"Remove exclusion"}),scopeChangeTarget:"include",onError:()=>{r.danger(n.formatMessage({id:"tdBT+A",defaultMessage:"Failed to remove exclusion. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to remove exclusion",loggingDescription:"Toast message shown when an item (e.g. file, channel, document, etc.) that the admin requested to un-exclude from syncing was unable to be un-excluded."})},onScopeUpdated:()=>{r.success(n.formatMessage({id:"AC/4a7",defaultMessage:"Sucessfully removed exclusion."})),t()}},d.object_handle))}),e.jsx(ue,{objectType:"shared_drive",targetScopeSelection:"exclude",accountId:s,connectionId:o,buttonLabel:n.formatMessage({id:"ThGxVh",defaultMessage:"Exclude"}),onSuccess:()=>{r.success(n.formatMessage({id:"1hsj8s",defaultMessage:"Shared drive has been excluded."})),t()},onError:()=>{r.danger(n.formatMessage({id:"4JkX1y",defaultMessage:"Failed to exclude Shared drive. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to exclude Shared drive",loggingDescription:"Toast message shown an admin tries to exclude a Google Drive Shared drive from being synced, but the operation failed."})}})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"Pa+iyD",defaultMessage:"Only the Shared drives you select will be synced."})}),e.jsx("p",{className:"text-token-text-secondary font-medium",children:e.jsx(l,{id:"e4EV27",defaultMessage:"Included Shared drives"})}),e.jsx("ul",{children:i.filter(d=>d.selection==="include").map(d=>e.jsx(de,{objectHandle:d.object_handle,objectType:"shared_drive",accountId:s,connectionId:o,scopeChangeIcon:ie,scopeChangeLabel:n.formatMessage({id:"/oSk2L",defaultMessage:"Remove inclusion"}),scopeChangeTarget:"exclude",onError:()=>{r.danger(n.formatMessage({id:"JhaVH0",defaultMessage:"Failed to remove inclusion. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to remove inclusion",loggingDescription:"Toast message shown when an item (e.g. file, channel, document, etc.) that the admin requested to un-include from syncing was unable to be un-included."})},onScopeUpdated:()=>{r.success(n.formatMessage({id:"m6h3gf",defaultMessage:"Sucessfully removed inclusion."})),t()}},d.object_handle))}),e.jsx(ue,{objectType:"shared_drive",targetScopeSelection:"include",accountId:s,connectionId:o,buttonLabel:n.formatMessage({id:"At82Iq",defaultMessage:"Include"}),onSuccess:()=>{r.success(n.formatMessage({id:"IMoGWZ",defaultMessage:"Shared drive has been included."})),t()},onError:()=>{r.danger(n.formatMessage({id:"De2z4Y",defaultMessage:"Failed to include Shared drive. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to include Shared drive",loggingDescription:"Toast message shown an admin tries to include a Google Drive Shared drive for syncing, but the operation failed."})}})]})]})}const V=J({includeToggleLabel:{id:"ca.scope-selection.include-by-default",defaultMessage:"Include by default"},excludeToggleLabel:{id:"ca.scope-selection.exclude-by-default",defaultMessage:"Exclude by default"},includeUserDrivesLabel:{id:"pDGrBu",defaultMessage:"Include user-owned files?"}});async function gt({accountId:t,connectionId:s}){const o=[];let a=await M.admin_connection_list_item_scopes(t,s,"shared_drive",null);for(o.push(a);a.page_token!=null;)a=await M.admin_connection_list_item_scopes(t,s,"shared_drive",a.page_token),o.push(a);return{object_type:"shared_drive",default_selection:o[0].default_selection,object_selections:o.flatMap(n=>n.object_selections)}}const mt=t=>g.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},g.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.99976 1.66667C14.602 1.66667 18.3336 5.39745 18.3337 9.99968C18.3337 14.602 14.6021 18.3337 9.99976 18.3337C5.39753 18.3335 1.66675 14.6019 1.66675 9.99968C1.66692 5.39756 5.39764 1.66684 9.99976 1.66667ZM8.17261 7.2321C7.91291 6.9724 7.4909 6.9724 7.2312 7.2321C6.97197 7.49182 6.97169 7.91298 7.2312 8.17253L9.05933 9.99968L7.2312 11.8278C6.9718 12.0874 6.97185 12.5086 7.2312 12.7682C7.4909 13.0279 7.91291 13.0279 8.17261 12.7682L9.99976 10.9401L11.8279 12.7682C12.0876 13.0279 12.5086 13.0279 12.7683 12.7682C13.028 12.5085 13.028 12.0875 12.7683 11.8278L10.9402 9.99968L12.7683 8.17253L12.8533 8.06804C13.0238 7.80998 12.9954 7.45939 12.7683 7.2321C12.541 7.00481 12.1905 6.97659 11.9324 7.14714L11.8279 7.2321L9.99976 9.05925L8.17261 7.2321Z"}));function xt({isOpen:t,onClose:s,connectionId:o,accountId:a,isPostActivation:i,footerContent:n,primaryButton:r,secondaryButton:c}){const u=D(),d=O(),{refetch:j,data:m,error:p,isLoading:w}=Z({queryFn:async()=>await M.admin_connection_list_item_scopes(a,o,"user_drive"),queryKey:["admin_connection_list_item_scopes",o,"user_drive"]}),{isPending:f,mutate:b}=fe({mutationFn:async _=>await M.admin_connection_update_item_default_scope(a,o,"user_drive",_?"include":"exclude"),mutationKey:["admin_connection_update_item_default_scope",o,"user_drive"],onError:()=>{d.danger(u.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}),{toastId:"gdrive_dwd_user_drives_modal",loggingTitle:"Failed to update policy",loggingDescription:"Failed to update policy"})},onSettled:()=>{j()}}),h=m?.default_selection==="include";return e.jsxs(E,{...U,isOpen:t,onClose:s,testId:"modal-gdrive-dwd-user-drives",children:[e.jsx("div",{className:"flex flex-col gap-6 px-6 pt-4 pb-10",children:w?e.jsx(F,{lines:4}):p?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(y,{color:"secondary",icon:be,onClick:()=>j(),children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):i?e.jsx("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:h?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(l,{id:"rWqZ31",defaultMessage:"User owned files in My Drives are being synced."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(mt,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(l,{id:"/dUChW",defaultMessage:"User owned files in My Drives are not being synced."})})]})}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"K4ZFoX",defaultMessage:"How do you want to handle My Drives?"})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"kAW/VW",defaultMessage:"Choose whether you want to sync the My Drive folder for your users."})}),e.jsxs("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:[e.jsx(Ve,{checked:h,disabled:f,"aria-label":u.formatMessage(me.includeUserDrivesLabel),onCheckedChange:()=>{!f&&b(!h)}}),e.jsx("p",{children:e.jsx(l,{...me.includeUserDrivesLabel})}),f&&e.jsx(q,{}),e.jsx("div",{className:"grow"}),e.jsx(ye,{label:e.jsx("p",{children:e.jsx(l,{id:"xJvlxk",defaultMessage:"Enable this setting to sync files in users' individual My Drives."})}),children:e.jsx(We,{className:"icon-lg text-token-text-tertiary"})})]}),e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(ve,{className:"icon-lg"}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"4vN9WK",defaultMessage:"You will not be able to change whether user My Drives are included once the connection starts syncing data."})})]})]})}),e.jsx(L,{footerContent:n,primaryButton:r,secondaryButton:c})]})}const me=J({includeUserDrivesLabel:{id:"75ojp7",defaultMessage:"Include user My Drives?"}});function ft({connectionDisplayInfo:t}){return e.jsxs("span",{className:"bg-token-main-surface-secondary rounded-xl px-2 py-1 font-bold whitespace-nowrap",children:[t.icon_url&&e.jsx("img",{src:t.icon_url,alt:"",className:"icon-sm me-2 inline"}),t.display_name]})}function ht({isOpen:t,onClose:s,onActivate:o,connectionId:a,accountId:i,connectionDisplayInfo:n,footerContent:r,secondaryButton:c,connectorType:u}){const d=D(),j=O(),m=_e(),{triggerLocation:p}=R(),[w,f]=g.useState(!1),b=()=>{f(!0),M.admin_activate_connection_instance(i,a).then(()=>{T.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:u,triggerLocation:p}),j.success(d.formatMessage({id:"y5DD0Z",defaultMessage:"Connection successfully activated."})),o?.(),s?.()}).catch(()=>{j.danger(d.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"review_and_activate_modal",loggingTitle:"Failed to activate connection",loggingDescription:"Failed to activate connection"})}).finally(()=>{f(!1)})},h=e.jsx(y,{color:"primary",loading:w,onClick:b,disabled:m,children:e.jsx(l,{id:"C2dZRO",defaultMessage:"Done"})});return e.jsxs(E,{...P,testId:"modal-review-and-activate",isOpen:t,onClose:s,title:Y(u),children:[e.jsxs("div",{className:"flex flex-col gap-3 px-6 pt-4 pb-10",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"38WXzu",defaultMessage:"Review"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"yQhjtE",defaultMessage:"Confirm everything looks good to you, then click the button to activate the connection and start syncing. "})}),e.jsx(ft,{connectionDisplayInfo:n})]}),e.jsx(L,{primaryButton:m?e.jsx(Ye,{children:h}):h,secondaryButton:c,footerContent:r})]})}function Ce({steps:t,onClose:s}){const o=t.length,[a,i]=g.useState(0),n=t[0]?.connectorType,r=t[0]?.name;g.useEffect(()=>{!n||!r||T.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:n,stepName:r})},[n,r]);const c=u=>{i(u),!(u<0||u>=t.length)&&T.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:t[u].connectorType,stepName:t[u].name})};return a<t.length?t[a].fn({goForward:a<o-1?()=>c(a+1):void 0,goBackward:a>0?()=>c(a-1):void 0,close:s,stepNumber:a,totalSteps:o}):null}const pt=-1;function Se(t){return Ne(t.knowledge_connector_type)}function Ne(t){switch(t){case void 0:return 0;case"slack":case"github":case"notion":case"google_drive_dwd":return pt;case"google_drive_oauth":return 25;case"merge_file_storage":case"sharepoint":return 10}}const Rt={max_instances:0};function _t({onClose:t,backButton:s}){const[o,a]=g.useState(),i=W(),n=G(i);return n?o?e.jsx(jt,{accountId:n.id,connection:o,onClose:()=>t(!0)}):e.jsx(vt,{onClose:t,backButton:s,setConnection:a}):null}function vt({onClose:t,setConnection:s,backButton:o}){const a=D(),i=O(),n=W(),r=G(n),c=g.useId(),{triggerLocation:u}=R();g.useEffect(()=>{T.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_dwd",stepName:"basic_info",triggerLocation:u})},[u]);const[d,j]=g.useState(""),m=d.length>128,p=d.trim().length>0&&!m,[w,f]=g.useState(!1),b=g.useCallback(()=>{!p||!r||w||(f(!0),M.admin_create_connection_instance(r.id,{knowledge_connector_type:"google_drive_dwd",connection_config_id:"--fake-local-id"},d.trim()).then(h=>{s(h)}).catch(()=>{i.danger(a.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"gdrive_dwd_setup_flow",loggingTitle:"Failed to create connection",loggingDescription:"Failed to create connection"})}).finally(()=>{f(!1)}))},[r,d,a,p,w,s,i]);return e.jsxs(E,{...U,onClose:()=>t?.(),testId:"modal-gdrive-dwd-basic-info",children:[e.jsxs("form",{onSubmit:h=>{h.preventDefault(),p&&b()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:c,className:"text-xl font-medium",children:e.jsx(l,{id:"+wLWeZ",defaultMessage:"Enter display name"})}),e.jsx("input",{type:"text",value:d,onChange:h=>j(h.target.value),id:c,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("div",{className:"text-token-text-tertiary text-sm",children:e.jsx(l,{id:"CPXVQO",defaultMessage:"This is the name your members will see in their ChatGPT connectors."})}),m?e.jsx("p",{className:"text-red-500",children:e.jsx(l,{id:"vT7EGU",defaultMessage:"Name is too long."})}):null]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(L,{secondaryButton:o,primaryButton:e.jsx(y,{color:"primary",disabled:!p||w,loading:w,onClick:b,children:e.jsx(l,{id:"lZthRm",defaultMessage:"Save Draft and Continue"})})})]})}function jt({connection:t,accountId:s,onClose:o}){return e.jsx(Ce,{onClose:o,steps:[{connectorType:"google_drive_dwd",name:"credential",fn:({goForward:a,close:i,stepNumber:n,totalSteps:r})=>e.jsx(lt,{onClose:()=>i?.(),accountId:s,connectionId:t.connection_config.connection_config_id,onNext:a??(()=>null),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:n+1,totalSteps:r}})})})},{connectorType:"google_drive_dwd",name:"user_drives",fn:({goForward:a,goBackward:i,close:n,stepNumber:r,totalSteps:c})=>e.jsx(xt,{onClose:()=>n?.(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:a&&e.jsx(y,{color:"primary",onClick:a,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:i&&e.jsx(y,{color:"secondary",onClick:i,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})}),isOpen:!0,isPostActivation:!1})},{connectorType:"google_drive_dwd",name:"shared_drives",fn:({goForward:a,goBackward:i,close:n,stepNumber:r,totalSteps:c})=>e.jsx(dt,{onClose:()=>n?.(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:a&&e.jsx(y,{color:"primary",onClick:a,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:i&&e.jsx(y,{color:"secondary",onClick:i,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})}),isOpen:!0})},{connectorType:"google_drive_dwd",name:"allowed_users",fn:({goForward:a,goBackward:i,close:n,stepNumber:r,totalSteps:c})=>e.jsx(Me,{connectorType:"google_drive_dwd",fallbackEstimatedMaxNumUsers:Se(t.connection_config),onClose:()=>n?.(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:a&&e.jsx(y,{color:"primary",onClick:a,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:i&&e.jsx(y,{color:"secondary",onClick:i,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})})})},{connectorType:"google_drive_dwd",name:"review_and_activate",fn:({goBackward:a,close:i,stepNumber:n,totalSteps:r})=>e.jsx(ht,{isOpen:!0,onClose:()=>i?.(),accountId:s,connectorType:"google_drive_dwd",connectionId:t.connection_config.connection_config_id,connectionDisplayInfo:t.display_info,secondaryButton:a&&e.jsx(y,{color:"secondary",onClick:a,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:n+1,totalSteps:r}})})})}]})}const yt=({domainName:t,intl:s})=>t.trim().toLocaleLowerCase()==="gmail.com"?{valid:!1,errorType:"domainChecker.error.gmail",error:s.formatMessage({id:"domainChecker.error.gmail",defaultMessage:"Personal Google Accounts (e.g. gmail.com) are not supported"})}:{valid:!0},wt=({domainName:t,intl:s})=>{const o=t.trim();if(/^https?:\/\//i.test(o))return{valid:!1,errorType:"domainChecker.error.noHttp",error:s.formatMessage({id:"domainChecker.error.noHttp",defaultMessage:"Do not include http:// or https:// in the domain."})};if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o))return{valid:!1,errorType:"domainChecker.error.noEmail",error:s.formatMessage({id:"domainChecker.error.noEmail",defaultMessage:"Do not use an email address. Use only the domain name."})};if(/[^a-zA-Z0-9.-]/.test(o))return{valid:!1,errorType:"domainChecker.error.invalidCharacters",error:s.formatMessage({id:"domainChecker.error.invalidCharacters",defaultMessage:"Domain contains invalid characters. Only letters, numbers, hyphens, and dots are allowed."})};const a=o.split(".");if(a.length<2)return{valid:!1,errorType:"domainChecker.error.missingDot",error:s.formatMessage({id:"domainChecker.error.missingDot",defaultMessage:"Domain must include at least one dot (e.g., example.com)."})};for(const n of a){if(!n)return{valid:!1,errorType:"domainChecker.error.emptySection",error:s.formatMessage({id:"domainChecker.error.emptySection",defaultMessage:"Domain has empty sections between dots (e.g., '..' or '.com.')."})};if(n.length>63)return{valid:!1,errorType:"domainChecker.error.labelTooLong",error:s.formatMessage({id:"domainChecker.error.labelTooLong",defaultMessage:"Each part of the domain must be 63 characters or less."})};if(!/^[a-zA-Z0-9-]+$/.test(n))return{valid:!1,errorType:"domainChecker.error.invalidLabelCharacters",error:s.formatMessage({id:"domainChecker.error.invalidLabelCharacters",defaultMessage:'Domain label "{label}" has invalid characters.'},{label:n})};if(/^-|-$/.test(n))return{valid:!1,errorType:"domainChecker.error.hyphenPosition",error:s.formatMessage({id:"domainChecker.error.hyphenPosition",defaultMessage:'Domain label "{label}" cannot start or end with a hyphen.'},{label:n})}}const i=a[a.length-1];return i.length<2||!/^[a-zA-Z]+$/.test(i)?{valid:!1,errorType:"domainChecker.error.invalidTLD",error:s.formatMessage({id:"domainChecker.error.invalidTLD",defaultMessage:"Top-level domain must be at least 2 letters."})}:{valid:!0}};function bt({onClose:t,backButton:s}){const[o,a]=g.useState(),i=W(),n=G(i);return n?o?e.jsx(Ct,{accountId:n.id,connection:o,onClose:t}):e.jsx(Mt,{onClose:t,backButton:s,setConnection:a}):null}function Mt({onClose:t,setConnection:s,backButton:o}){const a=D(),i=O(),n=W(),r=G(n),c=g.useId(),{triggerLocation:u}=R();g.useEffect(()=>{T.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_oauth",stepName:"basic_info",triggerLocation:u})},[u]);const d=Qe(),j=g.useMemo(()=>{const x=d?.email?.split("@")[1];return x&&d.email_domain_type!=="social"?x:""},[d]),[m,p]=g.useState(j),[w,f]=g.useState(""),b=g.useCallback(x=>{let{valid:S,error:C,errorType:v}=yt({domainName:x,intl:a});return S&&({valid:S,error:C,errorType:v}=wt({domainName:x,intl:a})),C&&T.logEventWithStatsig("Contextual Answers Admin Connection Config Change Error","chatgpt_contextual_answers_admin_connection_config_change_error",{connectorType:"google_drive_oauth",stepName:"basic_info",error:`invalid_domain-${v}`,triggerLocation:u}),{valid:S,error:C}},[a,u]),[h,_]=g.useState(!1),k=g.useCallback(async()=>{if(!m||!r)return;const{valid:x,error:S}=b(m);if(f(S??""),!!x){_(!0);try{const C=await M.admin_create_connection_instance(r.id,{knowledge_connector_type:"google_drive_oauth",domain_name:m,connection_config_id:"--fake-local-id"});d&&await M.admin_connection_allow_user(r.id,C.connection_config.connection_config_id,d.id),await M.admin_activate_connection_instance(r.id,C.connection_config.connection_config_id),T.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:"google_drive_oauth",connectionId:C.connection_config.connection_config_id,triggerLocation:u}),s(C)}catch{i.danger(a.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"gdrive_oauth_setup_flow",loggingTitle:"Failed to create connection",loggingDescription:"Failed to create connection"})}finally{_(!1)}}},[r,m,a,s,i,d,b,u]);return e.jsxs(E,{...U,onClose:()=>t?.(),testId:"modal-gdrive-basic-info",children:[e.jsxs("form",{onSubmit:x=>{x.preventDefault(),k()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsxs("label",{htmlFor:c,children:[e.jsx("div",{className:"mb-4 text-xl font-medium",children:e.jsx(l,{id:"EbU972",defaultMessage:"Enter your Google Workspace domain"})}),e.jsx("div",{className:"text-token-text-secondary mb-4 text-sm font-normal",children:e.jsx(l,{id:"i83LbI",defaultMessage:"Only users from this Google Workspace domain will be able to connect their account. You domain name should look like example.com"})})]}),e.jsx(ze,{type:"text",value:m,placeholder:"example.com",onChange:x=>{p(x.target.value),f("")},onBlur:()=>{const{error:x}=b(m);f(x??"")},name:c,ariaLabel:"Domain name",className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid",error:w}),e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary mt-6 flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(we,{className:"icon-lg"}),e.jsx("div",{children:e.jsx("div",{className:"text-token-text-secondary text-sm font-medium",children:e.jsx(l,{id:"N7rcxx",defaultMessage:"<link>Read our guide</link> to ensure you’ve added the correct domain name.",values:{link:x=>e.jsx(ee,{href:re,className:"text-token-text-secondary text-sm underline",onClick:()=>$({link:re,location:"admin_onboarding_basic_info"}),children:x})}})})})]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(L,{primaryButton:e.jsx(y,{color:"primary",disabled:m.trim()===""||!!w,loading:h,onClick:k,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:o})]})}function kt({onClose:t,onSuccess:s,connection:o,accountId:a}){const{triggerLocation:i}=R();g.useEffect(()=>{T.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_oauth",stepName:"quickstart",triggerLocation:i})},[i]);const n=async()=>{await M.admin_activate_connection_instance(a,o.connection_config.connection_config_id),T.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:"google_drive_oauth",connectionId:o.connection_config.connection_config_id,adminQuickstart:!0,triggerLocation:i}),s()};return e.jsx(Ze,{connectionId:o.connection_config.connection_config_id,location:"admin_connection_quickstart",isAdminFlow:!0,isAdminQuickstartFlow:!0,onClose:()=>{t?.()},onSuccess:n,accountId:a})}function Ct({connection:t,accountId:s,onClose:o,hasAdminAlreadyConnected:a=!1}){const i=D(),n=[{connectorType:"google_drive_oauth",name:"allowed_users",fn:({goForward:r,close:c})=>e.jsx(Me,{connectorType:"google_drive_oauth",fallbackEstimatedMaxNumUsers:Se(t.connection_config),onClose:()=>c?.(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:a?e.jsx(y,{color:"primary",onClick:()=>o(),children:i.formatMessage(I.finish)}):r&&e.jsx(y,{color:"primary",onClick:r,children:i.formatMessage(I.continue)})})}];return a||n.push({connectorType:"google_drive_oauth",name:"admin_oauth_disclaimer",fn:({goForward:r,goBackward:c,close:u})=>e.jsx(He,{isOpen:!0,onClose:()=>u?.(),isAdminFlow:!0,isAdminQuickstartFlow:!1,secondaryButton:c&&e.jsx(y,{color:"secondary",onClick:c,children:i.formatMessage(I.back)}),primaryButton:e.jsx(y,{color:"primary",onClick:r,children:i.formatMessage(I.continue)})})},{connectorType:"google_drive_oauth",name:"admin_oauth_cta",fn:({goForward:r,goBackward:c,close:u})=>e.jsx(Je,{isOpen:!0,onClose:()=>u?.(),secondaryButton:c&&e.jsx(y,{color:"secondary",onClick:c,children:i.formatMessage(I.back)}),primaryButton:e.jsx(ce,{onSuccess:()=>u?.(!0),onError:()=>r?.(),label:i.formatMessage(I.loginWithGoogle),connectionId:t.connection_config.connection_config_id,connectorType:"google_drive_oauth",location:"admin_flow"})})},{connectorType:"google_drive_oauth",name:"admin_oauth_error",fn:({close:r})=>e.jsx(Xe,{isOpen:!0,onClose:()=>r?.(),primaryButton:e.jsx(ce,{onSuccess:()=>r?.(),label:i.formatMessage(I.reconnect),connectionId:t.connection_config.connection_config_id,connectorType:"google_drive_oauth",location:"admin_flow",isReconnect:!0})})}),e.jsx(Ce,{onClose:o,steps:n})}const I=J({back:{id:"RDaXnk",defaultMessage:"Back"},cancel:{id:"CfN1/v",defaultMessage:"Cancel"},continue:{id:"XGnWba",defaultMessage:"Continue"},loginWithGoogle:{id:"9ImAmL",defaultMessage:"Log in with Google"},reconnect:{id:"0qUCBD",defaultMessage:"Reconnect"},finish:{id:"5Wpd39",defaultMessage:"Finish"}});function Bt({triggerLocation:t,...s}){const o=W(),a=G(o),{data:i,isLoading:n}=X(a?.getWorkspaceId(),0,void 0,1);return i||!n?e.jsx(se.Provider,{value:{triggerLocation:t},children:e.jsx(St,{numUsersInWorkspace:i?.total??0,...s})}):e.jsx(E,{testId:"modal-gdrive-add-workspace-loader",...U,isOpen:!0,onClose:s.onClose,children:e.jsx("div",{className:"flex min-h-64 items-center justify-center p-8",children:e.jsx(q,{})})})}function St({onClose:t,numUsersInWorkspace:s,isDwdEnabled:o}){const a=s>=Ne("google_drive_oauth")&&o,[i,n]=g.useState(a?"gdrive-dwd":"gdrive-oauth"),[r,c]=g.useState(!0),[u,d]=g.useState(),[j,m]=g.useState(!1),p=r&&o&&!u,w=W(),f=G(w),b=async()=>{const _=$e(w,"516806730").get("quickstart_enabled");if(!(i==="gdrive-oauth"&&_)){c(!1);return}if(!(!f?.id||u))try{m(!0),d(await M.admin_create_connection_instance(f.id,{knowledge_connector_type:"google_drive_oauth",domain_name:"",connection_config_id:"--fake-local-id"}))}catch{t()}finally{m(!1)}},{triggerLocation:h}=R();return g.useEffect(()=>{T.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive",stepName:"options",triggerLocation:h})},[h]),e.jsxs(e.Fragment,{children:[e.jsxs(E,{testId:"modal-gdrive-add-workspace",...U,isOpen:p,onClose:t,children:[e.jsx("div",{className:"px-6 pt-4 pb-10",children:e.jsx(Nt,{preferDwd:a,selectedConnector:i,setSelectedConnector:n})}),e.jsx(L,{footerContent:e.jsx(ee,{href:le,className:"text-token-text-secondary text-sm underline",onClick:()=>$({link:le,location:"admin_onboarding_gdrive_options"}),children:e.jsx(l,{id:"ADGK4d",defaultMessage:"Which option is right for my team?"})}),primaryButton:e.jsx(y,{color:"primary",onClick:b,loading:j,disabled:j,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:e.jsx(y,{color:"secondary",onClick:()=>t(),disabled:j,children:e.jsx(l,{id:"5Oo8TW",defaultMessage:"Cancel"})})})]}),!p&&(u&&f?e.jsx(kt,{onClose:()=>{c(!0),d(void 0),t()},onSuccess:()=>{c(!0),d(void 0),t(!0)},connection:u,accountId:f.id}):i==="gdrive-oauth"?e.jsx(bt,{onClose:_=>{t(_),c(!0)},backButton:o&&e.jsx(y,{color:"secondary",onClick:()=>c(!0),children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})})}):i==="gdrive-dwd"?e.jsx(_t,{onClose:_=>{t(_),c(!0)},backButton:e.jsx(y,{color:"secondary",onClick:()=>c(!0),children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})})}):null)]})}function Nt({selectedConnector:t,setSelectedConnector:s,preferDwd:o}){const a=D(),i=e.jsx(xe,{optionValue:"gdrive-oauth",optionName:a.formatMessage({id:"vIdj3/",defaultMessage:"Self-service setup"}),isSelected:t==="gdrive-oauth",checkedBulletPoints:[a.formatMessage({id:"hXiuKC",defaultMessage:"Each member must authenticate their account"})]}),n=e.jsx(xe,{optionValue:"gdrive-dwd",optionName:a.formatMessage({id:"ZNfVoO",defaultMessage:"Admin-managed setup"}),isSelected:t==="gdrive-dwd",checkedBulletPoints:[a.formatMessage({id:"A/omIq",defaultMessage:"Recommended for large teams"}),a.formatMessage({id:"1W662S",defaultMessage:"Centralized setup with service account credentials"})]});return e.jsxs("div",{children:[e.jsx("div",{className:"-mt-2 mb-6 text-start text-lg font-medium",children:e.jsx(l,{id:"JKSyU3",defaultMessage:"Choose how your team connects Google Drive"})}),e.jsx(he,{value:t,onValueChange:r=>s(r),className:"flex w-full flex-col gap-4",children:o?e.jsxs(e.Fragment,{children:[n,i]}):e.jsxs(e.Fragment,{children:[i,n]})})]})}function xe({optionName:t,optionValue:s,isSelected:o,checkedBulletPoints:a,disabled:i}){const n=o?te:je;return e.jsxs(pe,{value:s,id:`connector-group-option-${s}`,className:K("border-token-border-heavy flex w-full justify-between rounded-xl border border-solid p-4",i&&"opacity-50",o&&"border-token-text-primary"),disabled:i,children:[e.jsxs("div",{className:"max-w-96 shrink-0",children:[e.jsx("div",{className:"text-start font-medium",children:t}),e.jsx("div",{className:"font-tertiary mt-1 text-start text-sm",children:a.length&&e.jsx("ul",{className:"text-token-text-secondary mt-1 mb-2 flex-1 list-inside list-disc",children:a.map((r,c)=>e.jsx("li",{className:"text-sm",children:r},c))})})]}),e.jsx(n,{className:"icon-lg shrink-0"})]})}export{Me as A,Gt as C,Rt as D,Bt as G,Ce as M,ht as R,mt as S,Wt as a,lt as b,xt as c,dt as d,ft as e,Ut as f,Se as g,pt as h,R as u};
//# sourceMappingURL=gd32qcta4xox96ak.js.map
