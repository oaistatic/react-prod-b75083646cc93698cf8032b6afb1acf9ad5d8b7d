import{j as n,e as A,r as l,M as Q,g as ee,a as V,s as te,v as se,R as ne,c as E}from"./lu2xqwqmjc95q6j6.js";import{bz as D,d as j,b as ae,aw as oe,P as re,lK as ce,ea as G,aZ as le,eI as ie,a as L,p as Z,eU as J,R as ue,gg as de,c as O,b2 as fe,C as me,q as he,bl as xe}from"./hml6mmd5fyx85si7.js";import{u as ge,F as K}from"./b2qyefngnybfn65l.js";import{u as N,F as w,a as C,b as ye}from"./f9hp974e56z6b242.js";import{gy as X,h6 as pe,hk as ve,pZ as ke,aT as we}from"./rseqzngxzbdt1oxg.js";function be({children:t,rootClassName:e,className:a,description:s,icon:r,isOpen:o=!1,onClose:c,primaryButton:d,secondaryButton:i,size:g="normal",title:f,type:h,noPadding:m=!1,hideSeparator:p=!1,showCloseButton:y=!1,shouldIgnoreClickOutside:u=!1,closeButton:v,isScrollable:k=!0,position:S="center",removePopoverStyling:R=!1,showOverlayBackground:q=!0,shadow:T="normal"}){const _=!!f,M=!!t,H=_&&M&&!p;return n.jsx(D.Root,{testId:"modal-fanny-pack",isOpen:o,onClose:c,shouldIgnoreClickOutside:u,className:e,children:n.jsx(D.Overlay,{showBackground:q,children:n.jsxs(je,{size:g,position:S,className:j("flex flex-col focus:outline-hidden",{"max-w-md":g==="normal"},a),removePopoverStyling:R,shadow:T,children:[n.jsx(D.Header,{icon:r,title:f,type:h,closeButton:y&&(v??n.jsx(ae,{onClick:()=>c(!0)})),description:s,hasSeparator:H}),n.jsxs("div",{className:j("grow",k?"overflow-y-auto":"overflow-y-hidden",{"p-4 sm:p-6":g!=="fullscreen"&&!m,"md:pt-0!":!M}),children:[t,d!=null||i!=null?n.jsx(D.Actions,{primaryButton:d,secondaryButton:i,modalHasContent:M}):null]})]})})})}function je({className:t,children:e,position:a="center",size:s,removePopoverStyling:r=!1,shadow:o="normal"}){return n.jsx("div",{className:j("z-50 h-full w-full overflow-y-auto",s!=="fullscreen"&&"grid grid-cols-[10px_1fr_10px]",s!=="fullscreen"&&a==="center"&&"grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]",s!=="fullscreen"&&a==="bottom"&&"grid-rows-[minmax(10px,1fr)_auto_10px] md:grid-rows-[minmax(20px,1fr)_auto_20px]"),children:n.jsx(oe,{className:j(!r&&"popover","bg-token-main-surface-primary relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full text-start ltr:-translate-x-1/2 rtl:translate-x-1/2",s!=="fullscreen"&&"rounded-2xl",o==="normal"&&"shadow-xl",t),children:e})})}function Ce(){const t=A(),e=N(s=>s.query),a=l.useRef(null);return n.jsx("input",{className:"placeholder:text-token-text-tertiary w-full border-none bg-transparent focus:border-transparent focus:ring-0 focus:outline-hidden",placeholder:t.formatMessage({id:"FannyPack.SearchPlaceholder",defaultMessage:"Search chats..."}),onChange:s=>w.setQuery(s.target.value),onKeyDown:s=>{!s.shiftKey&&(s.key==="ArrowUp"||s.key==="ArrowDown")&&s.preventDefault()},value:e,ref:a})}function F({className:t,isActive:e=!1,icon:a,children:s,onClick:r,onMouseEnter:o,onMouseLeave:c}){const d=N(i=>i.mouseInteractionsDisabled);return n.jsx("div",{className:j("cursor-pointer",t),onMouseEnter:d?void 0:o,onMouseLeave:d?void 0:c,onClick:r,children:n.jsxs("div",{className:j("group relative flex items-center rounded-xl px-4 py-3",e&&"dark:bg-token-main-surface-secondary bg-[#f4f4f4]"),children:[a,n.jsx("div",{className:j("relative grow overflow-hidden whitespace-nowrap",a?"ps-2":""),children:s})]})})}function W(t){return t.formatMessage({id:"fannyPack.DefaultChatTitle",defaultMessage:"New chat"})}function Ne({historyResult:t,index:e}){const a=A(),{item:s,onSelect:r}=t,o=N(c=>c.activeIndex);return n.jsx(F,{isActive:o===e,icon:n.jsx(X,{className:"icon"}),onClick:()=>{C.logClick(s.id,e,"history"),r&&r()},onMouseEnter:()=>w.setActiveIndex(e),onMouseLeave:()=>w.setActiveIndex(void 0),children:n.jsx("div",{className:"text-sm",children:s.title??W(a)})})}function Se({labelResult:t}){return n.jsx("div",{className:"group text-token-text-tertiary relative my-2 px-4 pt-2 text-xs leading-4",children:t.text})}function Re({newChatResult:t,query:e=void 0,index:a}){const{onSelect:s}=t,r=N(o=>o.activeIndex);return n.jsx(F,{isActive:r===a,onClick:()=>{re.logNewChatButtonClicked({location:"Fanny Pack"}),s&&s()},onMouseEnter:()=>w.setActiveIndex(a),onMouseLeave:()=>w.setActiveIndex(void 0),icon:n.jsx(pe,{className:"icon"}),children:n.jsx("div",{className:"text-sm",children:e?n.jsx(Q,{id:"iQsutJ",defaultMessage:'New chat "{query}"',values:{query:e}}):n.jsx(Q,{id:"FannyPack.NewChat",defaultMessage:"New chat"})})})}function Me(t){return l.useMemo(()=>{if(!t)return null;const e=new Date(t*1e3),a=new Date;return e.toDateString()===a.toDateString()?"Today":new Date(new Date().setDate(a.getDate()-1)).toDateString()===e.toDateString()?"Yesterday":e.getFullYear()===a.getFullYear()?e.toLocaleDateString(void 0,{month:"short",day:"numeric"}):e.toLocaleDateString(void 0,{year:"2-digit",month:"numeric",day:"numeric"})},[t])}var B,Y;function Pe(){if(Y)return B;Y=1;var t=ce(),e=/[\\^$.*+?()[\]{}|]/g,a=RegExp(e.source);function s(r){return r=t(r),r&&a.test(r)?r.replace(e,"\\$&"):r}return B=s,B}var Ee=Pe();const Fe=ee(Ee),Ie=8;function _e(t){return t.isArchived?{titleClassName:"text-sm text-token-text-tertiary",titleHighlightedClassName:"text-token-text-secondary font-semibold",messageClassName:"text-xs text-token-text-tertiary",messageHighlightedClassName:"text-token-text-secondary font-medium"}:{titleClassName:"text-sm text-token-text-primary",titleHighlightedClassName:"text-token-text-primary font-semibold",messageClassName:"text-xs text-token-text-secondary",messageHighlightedClassName:"text-token-text-primary font-medium"}}function U({text:t,textToHighlight:e,shouldAdjustStart:a=!1,highlightClassName:s}){const r=l.useMemo(()=>{if(!a||!e)return t;const c=t.toLowerCase().indexOf(e?.toLowerCase());if(c===-1)return t;const d=Math.max(c-Ie,0),i=t.substring(d);return d===0?i:"â€¦"+i},[t,e,a]),o=l.useMemo(()=>{const c=new RegExp(`(${Fe(e)})`,"gi");return r.split(c)},[r,e]);return!e||e.length===0?n.jsx("span",{children:t}):n.jsx("div",{className:"truncate",children:o.map((c,d)=>c.toLowerCase()===e.toLowerCase()?n.jsx("span",{className:s,children:c},d):c)})}function De({searchResult:t,index:e,elementRef:a}){const{item:s,onSelect:r,query:o}=t,c=A(),d=Me(s.updateTime),i=_e(s),f=N(m=>m.activeIndex)===e,h=l.useRef(null);return l.useEffect(()=>{let m;const p=setTimeout(()=>{m=new IntersectionObserver(y=>{y.forEach(u=>{u.isIntersecting&&(C.logImpression(s.source,e,s.conversationId),m&&m.disconnect())})},{threshold:.5}),h.current&&m.observe(h.current)},250);return()=>{m&&m.disconnect(),clearTimeout(p)}},[h,s,o,e]),n.jsx("div",{ref:h,children:n.jsx(F,{isActive:f,icon:s.isArchived?n.jsx(ve,{className:"icon text-token-text-tertiary"}):n.jsx(X,{className:"icon"}),onClick:()=>{C.logClick(s.conversationId,e,s.source),r&&r()},onMouseEnter:()=>w.setActiveIndex(e),onMouseLeave:()=>w.setActiveIndex(void 0),children:n.jsxs("div",{className:"flex items-center",ref:a,children:[n.jsxs("div",{className:"relative grow overflow-hidden whitespace-nowrap",children:[n.jsx("div",{className:i.titleClassName,children:n.jsx(U,{text:s.title&&s.title.length>0?s.title:W(c),textToHighlight:o.length>=3?o:void 0,highlightClassName:i.titleHighlightedClassName})}),n.jsx("div",{className:j("pt-1",i.messageClassName),children:n.jsx(U,{text:s.snippet??"",textToHighlight:o.length>=3?o:void 0,shouldAdjustStart:!0,highlightClassName:i.messageHighlightedClassName})})]}),f&&n.jsx("div",{className:"text-token-text-secondary ps-6 text-xs",children:d})]})})})}function I(){return l.useMemo(()=>({closeFannyPackModal:t=>{C.logClose(t),w.setIsActive(!1)}}),[])}function $(){const t=V(),e=G(),{closeFannyPackModal:a}=I();return l.useCallback(s=>{e&&le.closeActiveSidebar(),t(s),a("click")},[t,a,e])}function Ae(){const{conversations:t}=ie(l.useMemo(()=>({}),[])),e=L(),{closeFannyPackModal:a}=I(),s=Z(e,"550560761").value,r=Number(s?.history_results_limit??6),o=l.useMemo(()=>t.slice(0,Math.min(t.length,r)),[t,r]),c=ke(o,0),d=$(),i=V(),g=l.useMemo(()=>({kind:"newChat",onSelect:()=>{we(i),a("button")}}),[i,a]);return l.useMemo(()=>{const h=[g];return h.push(...[c.recent,c.dynamicMonths,c.dynamicYears].reduce((m,p)=>(Object.entries(p).forEach(([y,{items:u,label:v}])=>{u.length>0&&(m.push({kind:"label",text:v}),u.forEach(k=>{m.push({kind:"history",onSelect:()=>{d(J(k.id))},item:k})}))}),m),[])),h},[g,c,d])}async function Le({query:t,cursor:e}){return ue.safeGet("/conversations/search",{parameters:{query:{query:t,cursor:e}}})}function qe(){const t=N(x=>x.query),e=$(),[a,s]=l.useState(""),[r,o]=l.useState(!1),c=l.useRef(de(x=>{o(!1),s(x)},250)).current,d=l.useCallback(x=>{x!==a&&(o(!0),c(x))},[a,c]);l.useEffect(()=>{d(t)},[t,d]);const{data:i,isError:g,isLoading:f,isFetchingNextPage:h,hasNextPage:m,fetchNextPage:p}=te({queryKey:["conversationSearch",{query:a}],queryFn:({pageParam:x})=>Le({query:a,cursor:x}),initialPageParam:"",getNextPageParam:x=>x.cursor??void 0,enabled:!!a});l.useEffect(()=>{f&&C.logQuery()},[f]),l.useEffect(()=>{g&&C.logQueryError()},[g]),l.useEffect(()=>{h&&C.logQueryMore()},[h]);const y=l.useMemo(()=>i?.pages.flatMap(x=>x.items)??[],[i]),u=l.useRef(null),v=l.useCallback(x=>{f||x==null||(u.current?.disconnect(),u.current=new IntersectionObserver(b=>{b[0].isIntersecting&&!h&&m&&p()}),u.current.observe(x))},[f,h,m,p]);l.useEffect(()=>()=>{u.current?.disconnect()},[]);const k=y&&a===t,S=t.length>0&&(r||f||h),R=L(),q=Z(R,"550560761").value,T=Number(q?.local_results_limit??0),_=ge(t,T),M=l.useMemo(()=>{const x=_;return k&&y.forEach(b=>{x.has(b.conversation_id)||x.set(b.conversation_id,{conversationId:b.conversation_id,nodeId:b.current_node_id,title:b.title,isArchived:b.is_archived,updateTime:b.update_time,snippet:b.payload.snippet,source:"remote"})}),Array.from(x.values())},[_,y,k]);return{searchResults:l.useMemo(()=>M.map(x=>({kind:"search",onSelect:()=>{e(`${J(x.conversationId)}?src=history_search`)},item:x,query:t})),[M,e,t]),shouldShowLoading:S,infiniteScrollTriggerElementRef:v}}function Te(t,e,a){switch(t.kind){case"history":return n.jsx(Ne,{historyResult:t,index:e});case"label":return n.jsx(Se,{labelResult:t});case"loading":return n.jsx($e,{loadingResults:t});case"newChat":return n.jsx(Re,{newChatResult:t,query:t.query,index:e});case"noResults":return n.jsx(Oe,{});case"search":return n.jsx(De,{searchResult:t,index:e,elementRef:a})}}function Be(t,e){const a=l.useCallback(()=>{for(let o=(t??-1)+1;o<e.length;o++)if(e[o].onSelect)return o;return t},[t,e]),s=l.useCallback(()=>{for(let o=(t??e.length)-1;o>=0;o--)if(e[o].onSelect)return o;return t},[t,e]),r=l.useCallback(()=>{t!==void 0&&e[t]&&e[t].onSelect&&e[t].onSelect()},[t,e]);l.useEffect(()=>{const o=c=>{c.isComposing||(c.key==="ArrowUp"&&!c.shiftKey?w.setActiveIndex(s()):c.key==="ArrowDown"&&!c.shiftKey?w.setActiveIndex(a()):(c.key==="Enter"||c.key==="Return")&&(c.preventDefault(),r()))};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[s,a,r]),l.useEffect(()=>{const o=()=>{ye.getMouseInteractionsDisabled()&&w.setMouseInteractionsDisabled(!1)};return window.addEventListener("mousemove",o),()=>{window.removeEventListener("mousemove",o)}},[])}function Qe(t,e){const a=l.useRef([]);return l.useEffect(()=>{a.current=e.map(()=>ne.createRef())},[e]),l.useEffect(()=>{a.current.forEach((s,r)=>{t===r&&s?.current&&s.current.scrollIntoView({behavior:"instant",block:"nearest"})})},[t,a]),a}function Oe(){return n.jsx(F,{className:"text-token-text-tertiary text-sm",icon:n.jsx(fe,{className:"icon"}),children:n.jsx(Q,{id:"FannyPack.Noresults",defaultMessage:"No results"})})}function P(){return n.jsx(F,{icon:n.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-[14px] w-[14px] rounded-full"}),children:n.jsxs("div",{className:"flex min-h-[40px] flex-col justify-center",children:[n.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-2 w-1/4 rounded-full"}),n.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary mt-3 h-2 w-1/2 rounded-full"})]})})}function $e({loadingResults:t}){return t.shouldShowMultiple?n.jsxs(n.Fragment,{children:[n.jsx(P,{}),n.jsx(P,{}),n.jsx(P,{}),n.jsx(P,{}),n.jsx(P,{})]}):n.jsx(P,{})}function He(){const t=$(),{searchResults:e,shouldShowLoading:a,infiniteScrollTriggerElementRef:s}=qe(),r=Ae(),o=N(u=>u.query),c=o.length>0,d=L(),i=O(d,"1741586789");l.useEffect(()=>{C.setQuerySessionId(se())},[o]);const g=l.useMemo(()=>({kind:"newChat",query:o,onSelect:()=>{t(`/?q=${o}`)}}),[o,t]),f=l.useMemo(()=>{const u=[];return o&&i&&u.push(g),c?u.push(...e):u.push(...r),a?u.push({kind:"loading",shouldShowMultiple:u.length===0}):u.length===0&&u.push({kind:"noResults"}),u},[o,i,g,c,a,e,r]),h=N(u=>u.activeIndex);Be(h,f);const m=Qe(h,f),p=l.useRef(null);l.useEffect(()=>{w.setActiveIndex(0),p.current&&(p.current.scrollTop=0)},[o]);const y=l.useRef(!0);return l.useEffect(()=>{y.current&&!a&&f.length===1&&f[0].kind==="noResults"&&C.logNoResults(),y.current=a},[a,f]),n.jsx("div",{ref:p,children:n.jsx("ol",{className:"mx-2",children:f.map((u,v)=>n.jsx("li",{ref:m.current[v],children:Te(u,v,v===f.length-1?s:void 0)},v))})})}function ze(){"use forget";const t=E.c(3),e=N(Ke),a=G();let s;return t[0]!==e||t[1]!==a?(s=a?n.jsx(Ue,{isOpen:e}):n.jsx(Ve,{isOpen:e}),t[0]=e,t[1]=a,t[2]=s):s=t[2],s}function Ke(t){return t.isActive}function Ye(t){"use forget";const e=E.c(9),{onClick:a,className:s}=t,r=A();let o;e[0]!==s?(o=j("hover:bg-token-main-surface-secondary focus-visible:ring-token-text-quaternary dark:hover:bg-token-main-surface-tertiary flex items-center justify-center rounded-full bg-transparent p-1 focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-offset-transparent focus-visible:outline-hidden",s),e[0]=s,e[1]=o):o=e[1];let c;e[2]!==r?(c=r.formatMessage({id:"Px7S/2",defaultMessage:"Close"}),e[2]=r,e[3]=c):c=e[3];let d;e[4]===Symbol.for("react.memo_cache_sentinel")?(d=n.jsx(xe,{className:"icon text-token-text-tertiary hover:text-token-text-primary"}),e[4]=d):d=e[4];let i;return e[5]!==a||e[6]!==o||e[7]!==c?(i=n.jsx("button",{className:o,"aria-label":c,onClick:a,children:d}),e[5]=a,e[6]=o,e[7]=c,e[8]=i):i=e[8],i}function z(t){"use forget";const e=E.c(21),{className:a}=t,{closeFannyPackModal:s}=I(),r=L();let o;e[0]!==r?(o=he(r),e[0]=r,e[1]=o):o=e[1];const c=o,d=l.useRef(!1);let i;e[2]!==r?(i=O(r,"3678527908"),e[2]=r,e[3]=i):i=e[3];const g=i;let f;e[4]!==r?(f=O(r,"1422501431"),e[4]=r,e[5]=f):f=e[5];const h=f;let m,p;e[6]!==c||e[7]!==g||e[8]!==h?(m=()=>{!d.current&&g&&c&&(h?K.setCurrentAccountV2(c):K.setCurrentAccount(c),d.current=!0)},p=[g,c,h],e[6]=c,e[7]=g,e[8]=h,e[9]=m,e[10]=p):(m=e[9],p=e[10]),l.useEffect(m,p);let y;e[11]!==a?(y=j("flex flex-col",a),e[11]=a,e[12]=y):y=e[12];let u;e[13]===Symbol.for("react.memo_cache_sentinel")?(u=n.jsx(Ce,{}),e[13]=u):u=e[13];let v;e[14]!==s?(v=n.jsxs("div",{className:"ms-3 me-4 flex max-h-[64px] min-h-[64px] items-center justify-between",children:[u,n.jsx(Ye,{className:"ms-4",onClick:()=>{s("button")}})]}),e[14]=s,e[15]=v):v=e[15];let k;e[16]===Symbol.for("react.memo_cache_sentinel")?(k=n.jsx("hr",{className:"border-token-border-default"}),e[16]=k):k=e[16];let S;e[17]===Symbol.for("react.memo_cache_sentinel")?(S=n.jsx("div",{className:"my-2 grow overflow-y-auto",children:n.jsx(He,{})}),e[17]=S):S=e[17];let R;return e[18]!==y||e[19]!==v?(R=n.jsxs("div",{className:y,children:[v,k,S]}),e[18]=y,e[19]=v,e[20]=R):R=e[20],R}function Ue(t){"use forget";const e=E.c(6),{isOpen:a}=t,{closeFannyPackModal:s}=I();let r;e[0]!==s?(r=()=>{s("modal")},e[0]=s,e[1]=r):r=e[1];let o;e[2]===Symbol.for("react.memo_cache_sentinel")?(o=n.jsx(z,{}),e[2]=o):o=e[2];let c;return e[3]!==a||e[4]!==r?(c=n.jsx(me,{testId:"modal-fanny-pack-mobile",isOpen:a,onClose:r,size:"fullscreen",showCloseButton:!0,type:"success",noPadding:!0,children:o}),e[3]=a,e[4]=r,e[5]=c):c=e[5],c}function Ve(t){"use forget";const e=E.c(6),{isOpen:a}=t,{closeFannyPackModal:s}=I();let r;e[0]!==s?(r=()=>{s("modal")},e[0]=s,e[1]=r):r=e[1];let o;e[2]===Symbol.for("react.memo_cache_sentinel")?(o=n.jsx(z,{className:"max-h-[440px] min-h-[440px]"}),e[2]=o):o=e[2];let c;return e[3]!==a||e[4]!==r?(c=n.jsx(be,{className:"border-token-border-default border bg-clip-padding shadow-[0_14px_62px_0_rgba(0,0,0,0.25)] md:max-w-[680px] md:min-w-[680px]",isOpen:a,onClose:r,showCloseButton:!0,type:"success",noPadding:!0,showOverlayBackground:!1,shadow:"custom",children:o}),e[3]=a,e[4]=r,e[5]=c):c=e[5],c}export{ze as FannyPackModalContainer};
//# sourceMappingURL=fbpla76a7lgo0654.js.map
