import{c as ge,e as de,r as K,d as he,j as t,M as R,l as pe,n as ve}from"./lu2xqwqmjc95q6j6.js";import{bg as re,fj as ae,P as c,bz as L,C as Me,R as _e,h0 as ye,B as ne}from"./hml6mmd5fyx85si7.js";import{C as se}from"./2a0vnvvg7ej5mmm1.js";import{T as M}from"./l2fd3uykkvam5v10.js";import{bc as xe,bd as De,be as Te,aE as be}from"./rseqzngxzbdt1oxg.js";function Ce(p){const e=pe(),r=re();return ve({mutationFn:({domainId:o})=>_e.safePost("/accounts/{account_id}/domains/{domain_id}/check",{parameters:{path:{account_id:p,domain_id:o}}}),onSuccess:()=>{e.invalidateQueries({queryKey:["workspace/identity",p]}),e.invalidateQueries({queryKey:["builderProfile"]})},onError:o=>{r.danger(o.message,{toastId:"domain_modal",loggingTitle:o.message,loggingDescription:"Domain check failed"})}})}function Ne(p){"use forget";const e=ge.c(75),{workspaceId:r,isOpen:o,onClose:l,currentDomain:m,domains:_,showUnverifiedDomains:y,onVerifyDomain:V}=p;let A;e[0]!==_?(A=_===void 0?[]:_,e[0]=_,e[1]=A):A=e[1];const x=A,$=y===void 0?!1:y,i=de(),f=re(),{mutateAsync:J,isPending:P}=xe(r),v=De(),{mutateAsync:Z,isPending:W}=Ce(r);let F,H;e[2]!==o?(F=()=>{o&&c.logEventWithStatsig("Identity: Domain Modal Opened","chatgpt_identity_domain_modal_opened")},H=[o],e[2]=o,e[3]=F,e[4]=H):(F=e[3],H=e[4]),K.useEffect(F,H);const[n,X]=K.useState(m??void 0),[u,le]=K.useState(m?.hostname),[s,N]=K.useState(m?.status===void 0?0:m?.status===ae.PENDING?1:2);let z;e[5]!==m?(z=()=>{m||(X(void 0),N(0))},e[5]=m,e[6]=z):z=e[6];const ee=z;let q;e[7]!==l||e[8]!==ee?(q=()=>{ee(),c.logEventWithStatsig("Identity: Domain Modal Closed","chatgpt_identity_domain_modal_closed"),l()},e[7]=l,e[8]=ee,e[9]=q):q=e[9];const g=q;let O;e[10]!==J||e[11]!==x||e[12]!==v||e[13]!==u?(O=async()=>{if(u===void 0)return;const d=x.find(h=>h.hostname===u&&h.status===ae.PENDING);if(d)X(d),N(1),c.logEventWithStatsig("Identity: Domain Added","chatgpt_identity_domain_added");else try{const h=await J({hostname:u});if(!v())return;"id"in h&&(X(h),c.logEventWithStatsig("Identity: Domain Added","chatgpt_identity_domain_added")),N(1)}catch(h){const ue=h;if(!v())return;throw c.logEventWithStatsig("Identity: Domain Verification Error","chatgpt_identity_domain_verification_error"),ue}},e[10]=J,e[11]=x,e[12]=v,e[13]=u,e[14]=O):O=e[14];const D=O;let T;e[15]!==i?(T=i.formatMessage(a.check),e[15]=i,e[16]=T):T=e[16];const te=n?.id===void 0||W;let b;e[17]!==Z||e[18]!==n||e[19]!==i||e[20]!==v||e[21]!==V||e[22]!==f?(b=async()=>{if(n?.id)try{const d=await Z({domainId:n.id});if(!v())return;c.logEventWithStatsig("Identity: Domain Verification Started","chatgpt_identity_domain_verification_started"),"error"in d&&(f.danger(i.formatMessage(a.domainCheckError,{message:d.error.message}),{toastId:"domain_modal",loggingTitle:a.domainCheckError.defaultMessage,loggingDescription:"Domain check failed"}),c.logEventWithStatsig("Identity: Domain Verification Error","chatgpt_identity_domain_verification_error")),"id"in d&&(V&&V(d),d.status===ae.VERIFIED&&(c.logEventWithStatsig("Identity: Domain Verification Success","chatgpt_identity_domain_verification_success"),N(2)))}catch(d){const h=d;if(!v())return;throw c.logEventWithStatsig("Identity: Domain Verification Error","chatgpt_identity_domain_verification_error"),h}},e[17]=Z,e[18]=n,e[19]=i,e[20]=v,e[21]=V,e[22]=f,e[23]=b):b=e[23];let Q;e[24]!==W||e[25]!==te||e[26]!==b||e[27]!==T?(Q=t.jsx(L.Button,{title:T,color:"primary",disabled:te,loading:W,onClick:b}),e[24]=W,e[25]=te,e[26]=b,e[27]=T,e[28]=Q):Q=e[28];const ce=Q;let C;e[29]!==i?(C=i.formatMessage(a.submit),e[29]=i,e[30]=C):C=e[30];const ie=u===void 0||P;let U;e[31]!==D||e[32]!==P||e[33]!==C||e[34]!==ie?(U=t.jsx(L.Button,{title:C,color:"primary",disabled:ie,loading:P,onClick:D}),e[31]=D,e[32]=P,e[33]=C,e[34]=ie,e[35]=U):U=e[35];const me=U;let k;e[36]!==i?(k=i.formatMessage(a.done),e[36]=i,e[37]=k):k=e[37];let Y;e[38]!==g||e[39]!==k?(Y=t.jsx(L.Button,{title:k,color:"primary",onClick:g}),e[38]=g,e[39]=k,e[40]=Y):Y=e[40];const fe=Y;let j;e[41]!==i||e[42]!==s?(j=i.formatMessage(s===0?a.newTitle:a.editTitle),e[41]=i,e[42]=s,e[43]=j):j=e[43];const oe=s===0?me:s===1?ce:fe;let E;e[44]!==i?(E=i.formatMessage(a.cancel),e[44]=i,e[45]=E):E=e[45];let S;e[46]!==g||e[47]!==E?(S=t.jsx(L.Button,{title:E,color:"secondary",onClick:g}),e[46]=g,e[47]=E,e[48]=S):S=e[48];let I;e[49]!==x||e[50]!==D||e[51]!==$||e[52]!==s||e[53]!==u||e[54]!==r?(I=s===0&&t.jsx(je,{hostname:u,onSetHostname:le,onSubmit:D,unverifiedDomains:$?x:[],onVerifyDomain:d=>{N(1),X(d)},workspaceId:r}),e[49]=x,e[50]=D,e[51]=$,e[52]=s,e[53]=u,e[54]=r,e[55]=I):I=e[55];let w;e[56]!==n||e[57]!==i||e[58]!==s||e[59]!==f?(w=s===1&&t.jsxs("div",{className:"flex flex-col gap-3",children:[i.formatMessage(a.verificationTokenMessage,{hostname:n?.hostname}),n?.dns_verification_token_string&&t.jsx(se,{value:n.dns_verification_token_string,onCopied:()=>{f.success(i.formatMessage(a.copiedTXTRecordToClipboard),{duration:3})}}),t.jsx(R,{...a.verificationTokenFooter})]}),e[56]=n,e[57]=i,e[58]=s,e[59]=f,e[60]=w):w=e[60];let B;e[61]!==n||e[62]!==i||e[63]!==s||e[64]!==f?(B=s===2&&t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx(R,{...a.successfulVerification,values:{hostname:n?.hostname}}),n?.dns_verification_token_string&&t.jsx(se,{value:n.dns_verification_token_string,onCopied:()=>{f.success(i.formatMessage(a.copiedTXTRecordToClipboard),{duration:3})}})]}),e[61]=n,e[62]=i,e[63]=s,e[64]=f,e[65]=B):B=e[65];let G;return e[66]!==g||e[67]!==o||e[68]!==j||e[69]!==oe||e[70]!==S||e[71]!==I||e[72]!==w||e[73]!==B?(G=t.jsxs(Me,{testId:"modal-domain",isOpen:o,onClose:g,type:"success",className:"text-token-text-secondary",title:j,primaryButton:oe,secondaryButton:S,children:[I,w,B]}),e[66]=g,e[67]=o,e[68]=j,e[69]=oe,e[70]=S,e[71]=I,e[72]=w,e[73]=B,e[74]=G):G=e[74],G}function ke({unverifiedDomains:p,onVerifyDomain:e,workspaceId:r}){const{mutateAsync:o}=Te(r);return t.jsxs(M.Root,{fixed:!0,size:"compact",className:"border-token-border-default mb-6 border-b",children:[t.jsxs(M.Header,{children:[t.jsx(M.HeaderCell,{children:t.jsx(R,{...a.unverifiedDomainsTableHeader})}),t.jsx(M.HeaderCell,{textAlign:"right"})]}),p.map(l=>t.jsxs(M.Row,{children:[t.jsx(M.Cell,{children:l.hostname}),t.jsx(M.Cell,{textAlign:"right",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(ne,{color:"secondary",size:"small",onClick:()=>e(l),children:t.jsx(R,{...a.verifyDomainButton})}),t.jsx(ne,{color:"secondary",size:"small",onClick:()=>{o({domainId:l.id}),c.logEventWithStatsig("Identity: Domain Removed","chatgpt_identity_domain_removed")},icon:be})]})})]},l.id))]})}function je({hostname:p,onSetHostname:e,onSubmit:r,unverifiedDomains:o,onVerifyDomain:l,workspaceId:m}){const _=de();return t.jsxs(t.Fragment,{children:[o&&o.length>0&&t.jsx(ke,{workspaceId:m,unverifiedDomains:o,onVerifyDomain:l}),t.jsx("form",{onSubmit:y=>{y.preventDefault(),r()},children:t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"hostname",className:"mb-2 flex items-center text-sm font-semibold",children:t.jsx(R,{...a.domainInput})}),t.jsx(ye,{ariaLabel:!1,name:"hostname",placeholder:_.formatMessage(a.placeholder),value:p??"",onChange:y=>{e(y.target.value)}})]})})]})}const a=he({newTitle:{id:"domainModal.newTitle.0",defaultMessage:"Verify a new domain"},editTitle:{id:"domainModal.editTitle",defaultMessage:"Manage Domain"},submit:{id:"domainModal.submit",defaultMessage:"Submit"},check:{id:"domainModal.check",defaultMessage:"Check"},done:{id:"domainModal.done",defaultMessage:"Done"},cancel:{id:"domainModal.cancel",defaultMessage:"Cancel"},domainInput:{id:"domainModal.domainInput.0",defaultMessage:"Add a new domain"},placeholder:{id:"domainModal.placeholder",defaultMessage:"openai.com"},domainCheckError:{id:"domainModal.domainCheckError",defaultMessage:"Your domain could not be verified: {message}"},verificationTokenMessage:{id:"domainModal.verificationTokenMessage",defaultMessage:"To verify ownership of {hostname}, navigate to your DNS provider and add a TXT record with this value:"},verificationTokenFooter:{id:"domainModal.verificationTokenFooter",defaultMessage:"Then, check the record to complete the verification."},successfulVerification:{id:"domainModal.successfulVerification.0",defaultMessage:'Success! Your domain, "{hostname}" has been verified.'},copiedTXTRecordToClipboard:{id:"domainModal.copiedTXTRecordToClipboard",defaultMessage:"Copied DNS TXT record to clipboard"},verifyDomainButton:{id:"domainModal.verifyDomainButton",defaultMessage:"Verify"},unverifiedDomainsTableHeader:{id:"domainModal.unverifiedDomainsTableHeader",defaultMessage:"Your unverified domains"}});export{Ne as default};
//# sourceMappingURL=dm9stvatbhwi1rf0.js.map
