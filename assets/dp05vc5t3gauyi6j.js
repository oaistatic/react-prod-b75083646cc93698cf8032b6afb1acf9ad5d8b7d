import{e as Y,j as e,d as H,r as y,M as v,u as He,b as Ke,R as Qe,v as be,o as S}from"./lu2xqwqmjc95q6j6.js";import{S as Xe,B as N,ay as L,pU as Ze,g as we,cR as ae,aO as Me,eU as Se,fm as et,ek as tt,a as st,b6 as at,s as ne,N as oe,P as Ne,R as Ce,i5 as nt,aN as ot,cE as it,oW as pe,gO as rt,gP as lt,kR as ct,T as dt,pV as mt,fH as I,a$ as ke,gE as ut,gg as ft,c0 as gt,dT as pt,hC as _t,cm as ht,mU as xt,pW as yt,cj as jt,gX as vt,dq as bt,dH as wt,pg as Mt}from"./hml6mmd5fyx85si7.js";import{i as St,L as Nt,a as _e}from"./bfcxfvncw1c0blhg.js";import{dQ as Ct,fL as kt,ju as Tt,bi as h,aF as Pt,bh as he,eq as Te,cf as Pe,gx as Et}from"./rseqzngxzbdt1oxg.js";const At=L.div`h-px bg-token-border-default`,E=L.div`text-sm font-medium py-3 leading-6`,It=L.div`my-4 p-5 w-full rounded-2xl popover bg-token-main-surface-primary shadow-lg border border-token-border-default`,te=":",zt=({to:t,cc:s,bcc:a,subject:i,body:n,onClick:o,isDraft:l=!0,isCanceled:d=!1})=>{const m=Y(),u=[];return t&&u.push(e.jsx("div",{children:e.jsxs("div",{className:"flex",children:[e.jsxs(E,{className:"text-token-text-tertiary me-1",children:[m.formatMessage(D.draftToFieldLabel),te]}),e.jsx(E,{children:t})]})},"to")),s&&u.push(e.jsx("div",{children:e.jsxs("div",{className:"flex",children:[e.jsxs(E,{className:"text-token-text-tertiary me-1",children:[m.formatMessage(D.draftCcFieldLabel),te]}),e.jsx(E,{children:s})]})},"cc")),a&&u.push(e.jsx("div",{children:e.jsxs("div",{className:"flex",children:[e.jsxs(E,{className:"text-token-text-tertiary me-1",children:[m.formatMessage(D.draftBccFieldLabel),te]}),e.jsx(E,{children:a})]})},"bcc")),i&&u.push(e.jsx(E,{children:i},"subject")),n&&u.push(e.jsx(E,{className:"whitespace-pre-line",children:n},"body")),e.jsxs(It,{children:[e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx(Xe,{className:"icon-sm me-4"}),e.jsx("div",{className:"font-semibold",children:l?m.formatMessage(D.draftMessageLabel):m.formatMessage(D.sentMessageLabel)})]}),u.map((f,M)=>e.jsxs(y.Fragment,{children:[e.jsx(At,{}),f]},M)),l&&!d&&e.jsx("div",{className:"mt-2 flex justify-end gap-4",children:e.jsx(N,{color:"primary",className:"py-2",onClick:o,children:m.formatMessage(D.sendButton)})}),d&&e.jsx("div",{className:"mt-2 flex justify-end gap-4",children:e.jsx(N,{color:"primary",className:"py-2",disabled:!0,children:m.formatMessage(D.canceledButton)})})]})},D=H({draftMessageLabel:{id:"emailView.draftMessageLabel",defaultMessage:"Draft Message"},sentMessageLabel:{id:"emailView.sentMessageLabel",defaultMessage:"Sent Message"},sendButton:{id:"emailView.sendButton",defaultMessage:"Send"},draftToFieldLabel:{id:"emailView.draftToLabel",defaultMessage:"To"},draftCcFieldLabel:{id:"emailView.draftCcLabel",defaultMessage:"Cc"},draftBccFieldLabel:{id:"emailView.draftBccLabel",defaultMessage:"Bcc"},canceledButton:{id:"emailView.canceledButton",defaultMessage:"Canceled"}});function Ft({action:t,handleUserAction:s,userActionParams:a,displayParams:i,rememberAnswer:n}){return t.type==="deny"?e.jsx(N,{color:"secondary",size:"small",onClick:o=>{s({sourceEvent:o,...a,actionData:{type:"deny",...t.deny,remember_answer:n}})},children:e.jsx(v,{...t.name==="decline"?A.decline:A.deny})}):t.type==="allow"?e.jsx(N,{color:"primary",size:"small",onClick:o=>{s({sourceEvent:o,...a,actionData:{type:"allow",...t.allow,remember_answer:n}})},children:e.jsx(v,{...t.name==="allow"?A.allow:A.confirm})}):t.type==="always_allow"?e.jsx(N,{color:"secondary",size:"small",onClick:o=>{s({sourceEvent:o,...a,actionData:{type:"always_allow",...t.always_allow}})},children:e.jsx(v,{...A.alwaysAllow})}):t.type==="oauth_redirect"?e.jsx(N,{color:"primary",size:"small",onClick:()=>{Lt(t.oauth_redirect,a.clientThreadId,a.turnGizmo)},children:e.jsx(v,{...A.signInButton,values:{domain:i.domain}})}):t.type==="contact_gizmo"?e.jsx(N,{color:"secondary",size:"small",onClick:o=>{s({sourceEvent:o,...a,actionData:{type:"contact_gizmo",...t.contact_gizmo}})},children:e.jsx(v,{...A.allow})}):null}function Dt({connector:t,onClick:s}){const a=Y();return t&&e.jsxs("div",{className:"flex w-80 flex-col items-center rounded-xl border p-6 text-center",children:[e.jsx(Ct,{connector:t,size:"large",className:"bg-primary shadow-xxs max-h-fit rounded-2xl border bg-clip-padding p-2"}),e.jsx("div",{className:"text-token-text-primary mt-3 text-lg font-semibold",children:Ze(t.name,a)}),e.jsx("div",{className:"text-token-text-secondary mt-1 text-sm",children:t.description}),e.jsx(N,{className:"mt-4 w-full",color:"secondary",onClick:s,children:e.jsx(v,{...A.connectButton})})]})}function Lt(t,s,a){const i=we(s),n=ae(s),o=i?.mode?.kind===Me.GizmoTest,l=n&&!o?Se(n,a):window.location.href;t.gizmo_id==="FAKE_PLUGIN_GIZMO"?et({id:t.gizmo_action_id},l):tt.doOAuthRedirect(t.gizmo_id,t.gizmo_action_id,t.domain,l,o)}const A=H({alwaysAllow:{id:"jitPluginMessage.alwaysAllow",defaultMessage:"Always Allow"},allow:{id:"jitPluginMessage.allow",defaultMessage:"Allow"},decline:{id:"jitPluginMessage.decline",defaultMessage:"Decline"},confirm:{id:"jitPluginMessage.confirm",defaultMessage:"Confirm"},deny:{id:"jitPluginMessage.deny",defaultMessage:"Deny"},signInButton:{id:"jitPluginMessage.signInButton",defaultMessage:"Sign in with {domain}"},connectButton:{id:"jitPluginMessage.connectButton",defaultMessage:"Connect"}});function Rt({namespace:t,functionName:s}){t==="ecosystem_demo"&&(ne.count(oe.ECOSYSTEM_DEMO,"ecosystem_demo.tool_impression",{tool:s}),Ne.logEvent("Ecosystem Demo: Tool Impression",{tool:s}))}function Bt({html:t,htmlAssetPointer:s,title:a,oai:i,toolInfo:n,overriddenWidgetState:o,overriddenWidgetInput:l}){const d=y.useRef(null),m=y.useRef(!1),[u,f]=y.useState(null),[M,G]=y.useState(null),K=st(),B=at(K).locale,C=y.useRef(!1),{data:J}=He({queryKey:["htmlAsset",s],queryFn:()=>s&&Ce.safeGet("/kanzi/__internal__/app/html_asset",{parameters:{query:{file_id:s.split("://")[1]}}}),enabled:!!s});return y.useEffect(()=>{!d.current||m.current||(m.current=!0,St(d.current,{...i,notifyEnvironmentError:()=>{},notifySecurityPolicyViolation:()=>{},sendInstrument:j=>{const k=[n?.namespace,n?.functionName].filter(Boolean).join(".");switch(j.type){case"hist":{ne.hist(oe.ECOSYSTEM,`${k}.${j.label}`,j.tags,j.value);break}case"count":{const O=`${k}.${j.label}`;ne.count(oe.ECOSYSTEM,O,j.tags,j.count),Ne.logEvent("Ecosystem Demo: Tool Clicked",{name:O});break}}},notifyIntrinsicHeight:G},["runWidgetCode"]).then(f))},[i]),y.useEffect(()=>{(async()=>{if(!u)return;const k=J??t;if(k)for await(const O of await u.runWidgetCode({html:k,widgetState:o??null,widgetInput:l??null,csp:null}));})()},[u,J,t]),y.useEffect(()=>{n&&!C.current&&(Rt(n),C.current=!0)},[n,C]),e.jsx("iframe",{title:a,className:"no-scrollbar my-2 w-full rounded-2xl shadow-[0px_0px_0px_1px_var(--border-heavy),0px_4px_10px_rgba(0,0,0,0.06)] sm:rounded-3xl",style:{height:M?`${M}px`:"auto"},src:`${Nt}/index.html?locale=${B}`,sandbox:"allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox",ref:d,tabIndex:-1})}const Ot=L.div`h-px bg-token-border-default`,xe=L.div`text-sm font-medium py-3 leading-6`,Vt=L.div`my-4 p-5 w-full rounded-2xl popover bg-token-main-surface-primary shadow-lg border border-token-border-default`,Gt=":",Jt=({functionName:t,parameters:s,onClick:a,isDraft:i=!0,isCanceled:n=!1})=>{const o=Y(),l=Object.entries(s).filter(([d,m])=>!m||d==="timezone_str"&&m===Intl.DateTimeFormat().resolvedOptions().timeZone?!1:m.length>0);return e.jsxs(Vt,{children:[e.jsx("div",{className:"mb-4 flex items-center font-semibold",children:e.jsx("div",{children:i?ie(t):$t(t,o)})}),l.map(([d,m])=>e.jsxs("div",{children:[e.jsx(Ot,{}),e.jsxs("div",{className:"flex",children:[e.jsxs(xe,{className:"text-token-text-tertiary me-1",children:[ie(d),Gt]}),e.jsx(xe,{className:"whitespace-pre-line",children:Ee(m,o)})]})]},d)),i&&!n&&e.jsx("div",{className:"mt-2 flex justify-end gap-4",children:e.jsx(N,{color:"primary",className:"py-2",onClick:a,children:o.formatMessage(q.approveButton)})}),n&&e.jsx("div",{className:"mt-2 flex justify-end gap-4",children:e.jsx(N,{color:"primary",className:"py-2",disabled:!0,children:o.formatMessage(q.canceledButton)})})]})},$t=(t,s)=>{switch(t){case"create_event":return"Created Event ✅";default:return`${ie(t)} ${s.formatMessage(q.completedAction)} ✅`}},ie=t=>{switch(t){case"timezone_str":return"Timezone";default:return t.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" ")}},Ee=(t,s)=>{if(Array.isArray(t))return t.map(n=>Ee(n,s)).join(s.formatMessage(q.valueSeparator));if(typeof t=="object")return JSON.stringify(t);if(t.match(/^\s*\d{4}-\d{2}-\d{2}/)==null)return t;const i=new Date(t);return Number.isNaN(i.getTime())?t:s.formatDate(i,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})},q=H({approveButton:{id:"ParametersView.approveButton",defaultMessage:"Approve"},completedAction:{id:"ParametersView.completedAction",defaultMessage:"Completed"},canceledButton:{id:"ParametersView.canceledButton",defaultMessage:"Canceled"},valueSeparator:{id:"ParametersView.valueSeparator",defaultMessage:","}}),Ae="openaiFileIdRefs",Ut=["send_email","batch_modify_email","create_event","update_event","delete_event"];function os({messages:t,nextMessage:s,clientThreadId:a,isLastMessageInTurn:i,isLastTurnInConversation:n,connectorFixture:o,allowInspectingArguments:l,onRequestCompletion:d}){const[m,u]=Ke(),[f,...M]=t,G=Y(),K=nt(a),B=f.metadata?.gizmo_id??K,C=ot(a,r=>Mt(r?.mode,B)),J=kt(C)&&C.gizmo_id===B,j=it(B,J)?.data,[k,O]=y.useState(!1),z=pe(f.recipient);let Q;if(z?.functionName!=null&&j?.tools!=null){for(const r of j.tools)if(Kt(r,z.functionName)){Q=r;break}}const ze=M.filter(r=>r.metadata?.jit_plugin_data?.from_server?.type==="debug"),X=M.filter(r=>!["debug","send_test"].some(c=>c===r.metadata?.jit_plugin_data?.from_server?.type)),{uiState:g,jitPluginData:_,fileAttachments:Fe,invokedPlugin:re}=Yt(f,X,i),De=pe(s?.recipient)?.namespace,{connectorId:le,connectorToolStatus:Le,connectorStatusMessage:ce,showConnectorConnect:Re}=Ht(z?.namespace,De,M,n),Be=rt(!0,lt.JIT_PLUGIN),V=o??Be.platformConnectors.get(le??""),Oe=ct();let $;for(let r=X.length-1;r>=0;r--){const c=X[r].metadata?.jit_plugin_data;if(c?.from_server?.type==="confirm_action"){$=c;break}}let b=_?.from_server?.type!=="denied_by_user"?_?.from_server?.body.domain:Q?.metadata?.domain,de=null;if(!b&&z?.functionName&&z.namespace==="kanzi_app"){const[r,c]=z.functionName.split("/");b=r.replace(/_/g," "),de=e.jsx(wt,{openNewTab:!0,className:"text-token-text-secondary pt-1 opacity-0 transition-opacity duration-200 group-hover/tool-message:opacity-100",href:`/kanzi/studio/c/${c}`,children:e.jsx(Et,{})})}b?b.endsWith("__jit_plugin")&&(b=b.slice(0,-12)):b="connector";const Ve=Q?.metadata?.privacy_policy_url;y.useEffect(()=>{if(Ie(_?.from_client)?.type==="oauth_success")return;const r=m.get("oauth_success");if(_?.from_server?.type==="oauth_required"&&r){u(c=>(c.delete("oauth_success"),c),{replace:!0});for(const c of _.from_server.body.actions)if(c.type==="oauth_redirect"){se({eventSource:"url",assistantMessage:f,onRequestCompletion:d,actionData:{type:"oauth_success",target_message_id:c.oauth_redirect.target_message_id},conversationMode:C});return}}},[C,f,t,a,d,_,n,m,u]);const x=M[M.length-1],me=Qe.useRef(null),Ge=y.useMemo(()=>{const r=x?.metadata?.chatgpt_sdk?.capabilities??{send_follow_up_message:!0,update_widget_state:!0},c={};if(r?.send_follow_up_message&&(c.sendFollowUpMessage=w=>{const T=dt.getRequestId(we(a));mt(T)||d({completionType:ut.Next,promptMessage:{id:be(),author:{role:ke.User,name:"user"},content:{content_type:I.Text,parts:[w]},recipient:"all",metadata:{is_visually_hidden_from_conversation:!0}},eventSource:"mouse"})}),r?.update_widget_state){const w=ft(async(T,F)=>{try{await Ce.safePost("/ecosystem/widget_state",{requestBody:{conversation_id:T,message_id:x?.id,state:JSON.stringify(F)}})}catch{}},2e3);me.current=w,c.updateWidgetState=T=>{const F=ae(a);F&&(Tt(F,T),w(F,T))}}return c},[d,a,x?.metadata?.chatgpt_sdk?.capabilities,x?.id]);y.useEffect(()=>()=>{me.current?.flush?.()},[]);let R=h.Running,P=b?p.running:p.starting,Z={domain:b};if(g===7)return null;g===4||g===5?(R=h.Paused,P=p.confirmingSimple,Z={...{gizmoName:j?.gizmo.display.name??"ChatGPT",domain:b},title:c=>e.jsxs("div",{className:"inline-flex items-center gap-1 text-sm",children:[c,e.jsx(Pe,{className:"icon-sm"})]}),subtitle:c=>e.jsx("div",{className:"text-xs",children:c})}):g===1?(R=h.Finished,P=p.finished,Z={domain:b}):g===2?(R=h.Error,P=p.error):(g===3||g===6)&&(R=h.Stopped,P=g===6?p.declined:p.stopped);const ue={assistantMessage:f,allMessages:t,clientThreadId:a,turnGizmo:j,onRequestCompletion:d,conversationMode:C},Je={domain:b},fe=_?.from_server?.type!=="denied_by_user"?_?.from_server?.body.actions.map((r,c)=>e.jsx(Ft,{action:r,displayParams:Je,handleUserAction:se,userActionParams:ue,rememberAnswer:k},c)):null;P=es(P,f.recipient,g);const $e=P?G.formatMessage(P,Z):null,Ue=L.div`flex gap-2 flex-wrap mt-1 empty:hidden`,ee=ve(_)??ve($)??Qt(f),ge=Xt(x),We=ee?.[Ae]??[],qe=l&&(!!ee||!!ge||We.length>0);let U=e.jsx(e.Fragment,{});const W=ye(_,re)??ye($,void 0)??"";if(Ut.includes(W)&&(g===5||g===1||g===3||g===6)){const r=g!==1,c=(g===3||g===6)&&!n,w=je(_,re)??je($,void 0),T=F=>{_?.from_server?.type==="confirm_action"&&_?.from_server?.body?.actions?.[0].type==="allow"&&(se({...ue,sourceEvent:F,actionData:{type:"allow",..._?.from_server?.body?.actions?.[0].allow,remember_answer:k}}),jt(a,Ye=>{Ye.scrollToMessageId=a}))};switch(W){case"send_email":U=e.jsx(zt,{to:w?.to,cc:w?.cc,bcc:w?.bcc,subject:w?.subject,body:w?.body,onClick:g===5?T:()=>{},isDraft:r,isCanceled:c});break;default:U=e.jsx(Jt,{functionName:W??"",parameters:w??{},onClick:g===5?T:()=>{},isDraft:r,isCanceled:c});break}}else(g===5||g===4)&&fe&&(U=e.jsxs(e.Fragment,{children:[_?.from_server?.type==="confirm_action"&&_?.from_server?.body?.offer_remember_answer?e.jsx("div",{className:"mb-2 flex gap-2 text-sm",children:e.jsx(Pt,{id:"dont-ask-again",label:e.jsx(v,{...p.rememberForThisConversation}),checked:k,onChange:r=>O(r.target.checked)})}):null,e.jsx("div",{className:"mb-2 flex gap-2",children:fe}),e.jsxs("div",{className:"my-1 flex items-center gap-2 text-sm",children:[e.jsx(gt,{className:"icon-sm"}),e.jsx(v,{...p.confirmingSubtitle})]})]}));return le?e.jsxs(e.Fragment,{children:[ce&&e.jsx(he,{highlightedCommand:V?G.formatMessage(ce,{domain:V.name}):e.jsx("br",{}),status:Le,showWorkUserSetting:!1}),Re&&V&&e.jsx("div",{className:"mb-2 flex gap-2",children:e.jsx(Dt,{connector:V,onClick:()=>{const r=ae(a),c=r?new URL(Se(r),window.location.origin):new URL(window.location.href);c.searchParams.set("oauth_success","true"),Oe({connectorId:V.id,redirectAfter:c.toString(),referrer:pt.JitPluginMessage})}})})]}):e.jsxs(e.Fragment,{children:[e.jsx(qt,{debugMessages:ze}),e.jsx("span",{className:"group/tool-message",children:e.jsx(he,{highlightedCommand:$e,status:R,showWorkUserSetting:!1,accessory:de,forceExpanded:g===5,children:qe?e.jsx(Zt,{privacyPolicyUrl:Ve,name:f.recipient??W,params:ee,result:ge,isPromptingForPermission:R===h.Paused}):null})}),e.jsx(Ue,{children:Fe?.map(r=>e.jsx(Te,{file:r.name,fileId:r.id,width:"wide",alwaysShowData:!0,showDownloadButton:!0,downloadLink:r.download_url,contextConnectorInfo:_t(r.context_connector_info)},r.id))}),x&&(x.metadata?.chatgpt_sdk?.rendered_template||x.metadata?.chatgpt_sdk?.html_asset_pointer)&&e.jsx(Bt,{html:x.metadata.chatgpt_sdk.rendered_template,htmlAssetPointer:x.metadata.chatgpt_sdk.html_asset_pointer,title:"",oai:Ge,toolInfo:z,overriddenWidgetState:x.metadata.chatgpt_sdk.widget_state?JSON.parse(x.metadata.chatgpt_sdk.widget_state):void 0,overriddenWidgetInput:x.content.content_type===I.Code?JSON.parse(x.content.text)??void 0:void 0}),U]})}function Wt({messageMetadata:t}){const[s,a]=y.useState(!1);return e.jsxs("div",{className:"my-2 flex flex-col text-sm",children:[e.jsxs("div",{className:"flex flex-row items-center hover:cursor-pointer",onClick:()=>{a(!s)},children:[s?e.jsx(Pe,{className:"icon-sm"}):e.jsx(bt,{className:"icon-sm"}),e.jsx("div",{className:"font-semibold",children:t.display_message})]}),s&&e.jsx("pre",{children:JSON.stringify(t.data,null,2)})]})}function qt({debugMessages:t}){return t.length===0?null:e.jsx("div",{children:t.map((s,a)=>{const i=s.metadata?.jit_plugin_data?.from_server;return i&&i.type==="debug"?e.jsx(Wt,{messageMetadata:i.body},a):null})})}function ye(t,s){return t?.from_server?.type==="confirm_action"?t?.from_server?.body?.operation:s?.parsed_function_call?.name}function je(t,s){return t?.from_server?.type==="confirm_action"?t?.from_server?.body?.params:s?.parsed_function_call?.kwargs}function Yt(t,s,a){if(t.metadata?.jit_plugin_data?.from_server?.type==="send_test")return{uiState:7};if(s.some(i=>i.content.content_type===I.SystemError))return{uiState:2};if(xt(t))return{uiState:3};for(let i=s.length-1;i>=0;i--){const n=s[i];if(n.metadata?.invoked_plugin){const d=[];return s.forEach(m=>{const u=m.metadata?.attachments?.filter(f=>f.display_files_from_actions_ext);u&&d.push(...u)}),{uiState:1,jitPluginData:n.metadata.jit_plugin_data,invokedPlugin:n.metadata.invoked_plugin,fileAttachments:d}}const o=Ie(n.metadata?.jit_plugin_data?.from_client);if(o!=null){if(o?.type==="contact_gizmo")return{uiState:1,jitPluginData:s[i-1]?.metadata?.jit_plugin_data};if(o?.type==="deny")return{uiState:6};if(o?.type==="oauth_success")return{uiState:0,jitPluginData:n.metadata?.jit_plugin_data};break}const l=n.metadata?.jit_plugin_data?.from_server;if(l?.type==="preview"&&a)return{uiState:0,jitPluginData:n.metadata?.jit_plugin_data};if(l?.type==="confirm_action"&&a)return{uiState:5,jitPluginData:n.metadata?.jit_plugin_data};if(l?.type==="oauth_required"&&a)return{uiState:4,jitPluginData:n.metadata?.jit_plugin_data}}return{uiState:a?0:3}}function Ht(t,s,a,i){var n=yt(t)??void 0;if(!n)return{connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};if(s===t)return{connectorId:n,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};var o=h.Running,l=null,d=!1;const m=a[a.length-1],u=m?.metadata?.jit_plugin_data;return a.some(f=>f.content.content_type===I.SystemError)?(o=h.Error,l=p.error):m?u?.from_server?.type==="oauth_required"&&i?(o=h.Paused,l=null,d=!0):u?.from_server?.type==="oauth_required"&&!i?(o=h.Stopped,l=p.connectorDeclined):u?.from_client?.type==="deny"?(o=h.Stopped,l=p.connectorDeclined):u?.from_client?.type==="oauth_success"?(o=h.Stopped,l=p.connectorAccepted):m?.metadata?.invoked_plugin?(o=h.Finished,l=p.finished):(o=h.Stopped,l=p.stopped):(o=h.Running,l=p.running),{connectorId:n,connectorToolStatus:o,connectorStatusMessage:l,showConnectorConnect:d}}function se({actionData:t,assistantMessage:s,turnGizmo:a,onRequestCompletion:i,conversationMode:n,...o}){const l={id:be(),author:{role:ke.Tool,name:s.recipient},content:{content_type:I.Text,parts:[""]},recipient:"all",metadata:{jit_plugin_data:{from_client:t},gizmo_id:a?.gizmo.id},clientMetadata:{completionSampleFinishTime:Date.now()}};i({...o,promptMessage:l,completionMetadata:{conversationMode:n??{kind:Me.PrimaryAssistant}}})}function Kt(t,s){if(t.type!==ht.JIT_PLUGIN||!t.metadata.json_schema)return!1;let a=!1;function i(n){for(const o in n)o==="operationId"&&n[o]===s&&(a=!0),n[o]&&typeof n[o]=="object"&&i(n[o])}return i(t.metadata.json_schema),a}function ve(t){if(t&&(t.from_server?.type==="confirm_action"||t.from_server?.type==="oauth_required"||t.from_server?.type==="preview"))return t.from_server.body.params}function Qt(t){if(t.content.content_type!==I.Code)return;const s=t.content.text;if(s)try{return JSON.parse(s)}catch{return{text:s}}}function Xt(t){if(!t)return;const s=t.content.content_type===I.Text?t.content.parts[0]:t.content.content_type===I.Code?t.content.text:void 0;if(s)try{return JSON.parse(s)}catch{return s}}function Zt({name:t,params:s,result:a,privacyPolicyUrl:i,isPromptingForPermission:n}){const l=(s?.[Ae]??[]).map((d,m)=>{const u=d.name.startsWith("dalle-");let f=d.name;return u&&(f=`${f}.webp`),e.jsx(Te,{file:f,fileId:d.id},m)});return e.jsxs("div",{className:"divide-token-border-default border-token-border-default mt-1 mb-4 divide-y overflow-hidden rounded-xl border",children:[t&&e.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary px-4 py-2 text-sm",children:e.jsx(v,{id:"JITPluginMessage.params.toolCall",defaultMessage:"Tool call: {name}",values:{name:e.jsx("span",{className:"text-token-text-primary",children:t})}})}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex justify-between px-4 py-2 text-sm",children:[n?e.jsx(v,{id:"JITPluginMessage.params.sharing.present",defaultMessage:"The following will be shared:"}):e.jsx(v,{id:"JITPluginMessage.params.sharing.past",defaultMessage:"The following was shared:"}),i&&e.jsx("a",{href:vt(i),className:"text-token-text-primary",target:"_blank",rel:"noreferrer",children:e.jsx(v,{...p.privacyPolicyLink})})]}),e.jsx("div",{className:"px-4 py-2",children:e.jsx(_e,{value:s})}),l.length>0&&e.jsx("div",{className:"px-4 py-2",children:l})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex justify-between px-4 py-2 text-sm",children:e.jsx(v,{id:"JITPluginMessage.params.result",defaultMessage:"Result:"})}),e.jsx("div",{className:"px-4 py-2",children:e.jsx(_e,{value:a})})]})]})}function es(t,s,a){if(![1,0,3].includes(a)||!s)return t;switch(s){case"ecosystem_demo.daw":case"ecosystem_demo.daw_drums":return a===1||a===3?S({id:"BYgUCC",defaultMessage:"Composed track"}):S({id:"9n1xDI",defaultMessage:"Composing track"});case"ecosystem_demo.flashcards":return a===1||a===3?S({id:"szZeVr",defaultMessage:"Created flashcards"}):S({id:"NYOjya",defaultMessage:"Creating flashcards"});case"api_tool.list_resources":return a===1||a===3?S({id:"OdEouq",defaultMessage:"Looked for available tools"}):S({id:"hSyoq0",defaultMessage:"Looking for available tools"});case"api_tool.search_tools":return a===1||a===3?S({id:"4et5qC",defaultMessage:"Searched tools"}):S({id:"V0IDh0",defaultMessage:"Searching tools"});case"api_tool.call_tool":return a===1||a===3?S({id:"NTASw4",defaultMessage:"Called tool"}):S({id:"gc64KQ",defaultMessage:"Calling tool"})}return t}function Ie(t){if(t&&"user_action"in t){const s=t.user_action;t={...t,...s.data},"target_message_id"in t&&s.target_message_id&&(t.target_message_id=s.target_message_id)}return t}const p=H({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"},connectorAccepted:{id:"jitPluginMessage.connectorAccepted",defaultMessage:"Accepted using {domain}"},connectorDeclined:{id:"jitPluginMessage.connectorDeclined",defaultMessage:"Declined using {domain}"},rememberForThisConversation:{id:"jitPluginMessage.rememberForThisConversation",defaultMessage:"Remember for this conversation"}});export{os as JITPluginMessage};
//# sourceMappingURL=dp05vc5t3gauyi6j.js.map
