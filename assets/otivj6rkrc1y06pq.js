import{r,j as t,M as y}from"./lu2xqwqmjc95q6j6.js";import{d7 as A,h2 as _,fM as H,g as F,T as I,aP as L,P as x,cj as R,fg as B,cR as z,hC as G,B as C,ay as K,eL as U}from"./hml6mmd5fyx85si7.js";import{ep as V,eq as D}from"./rseqzngxzbdt1oxg.js";import{E as J}from"./mbo24hq56wugb9b1.js";function O({initialText:c,clientThreadId:n,currentLeaf:i,onExitEdit:d,onRequestCompletion:h,disabled:j,attachments:o}){const[l,M]=r.useState(c??""),u=r.useRef(null),E=A(),p=_.useStore(),g=l.trim()==="",T=r.useCallback(e=>{M(e.currentTarget.value)},[]),m=r.useCallback(e=>{if(g)return;const s={},a=H();o&&(s.attachments=o),a&&(s.__internal={search_settings:a});const v=p.getActiveSystemHintType(),{systemHints:N,extraStreamParams:P}=V(v?[v]:[]),S=F(n),w=I.getParentNode(S,i).message.id;h({sourceEvent:e,parentMessageId:w,promptMessage:L(l,Object.keys(s).length>0?s:void 0),extraStreamParams:P,completionMetadata:{conversationMode:S?.mode,systemHints:N}}),d(),x.logEvent("Change Active Node",{intent:"edit_save"})},[g,o,n,p,h,d,i,l]),f=r.useCallback(()=>{R(n,e=>{B.setCurrentBranch(e,i)}),x.logEvent("Change Active Node",{intent:"edit_cancel"}),d(),x.logEvent("Cancel Edit Prompt",{threadId:z(n)})},[i,d,n]);r.useEffect(()=>{const e=u.current;if(e){e.focus();const s=e.value.length;e.setSelectionRange(s,s)}},[]),r.useEffect(()=>{const e=u.current,s=a=>{a.isComposing||(a.key==="Enter"&&a.metaKey?m(a):a.key==="Escape"&&f())};return e&&e.addEventListener("keydown",s),()=>{e&&e.removeEventListener("keydown",s)}},[f,m]);const b=o&&o.length>0&&t.jsx(W,{children:o.map(e=>t.jsx(D,{width:E?"wide":"normal",file:e.name,contextConnectorInfo:G(e.context_connector_info)},e.id))}),k=t.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:t.jsx(J,{ref:u,value:l,onChange:T,className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return t.jsxs("div",{className:"bg-token-main-surface-tertiary rounded-3xl px-3 py-3",children:[b,k,t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(C,{as:"button",color:"secondary",onClick:f,children:t.jsx(y,{id:"D9gbPp",defaultMessage:"Cancel"})}),t.jsx(C,{as:"button",onClick:m,disabled:j||g,children:t.jsx(y,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}const W=K.div`flex gap-2 flex-wrap`;function ee({message:c,...n}){return t.jsx(O,{currentLeaf:c.id,initialText:U(c),attachments:c.metadata?.attachments,...n})}export{ee as TextMessageEditor};
//# sourceMappingURL=otivj6rkrc1y06pq.js.map
