import{r as l,ao as J,b as Q,e as ee,j as o,A as te,m as v}from"./lu2xqwqmjc95q6j6.js";import{dj as _,gj as se,H as O,aN as H,T as I,gs as ae,fi as ne,i6 as oe,fN as ie,hj as F,eR as re,fT as ce,aZ as W,qV as de,di as le,pA as ue}from"./hml6mmd5fyx85si7.js";import{lN as me,mX as U,mY as he,C as g,mZ as pe,m_ as fe,iO as ge,m$ as xe,u as V,n0 as Ce,n1 as ve,mW as Te,n2 as we,n3 as Ie,n4 as be,n5 as k,n6 as G,mU as ye,n7 as Se,cy as j,n8 as L,n9 as P,na as Ee,nb as _e,nc as Ae}from"./rseqzngxzbdt1oxg.js";import{L as Ne}from"./glo5fx5nh6p199c2.js";import{T as Re}from"./b5mk7g3hp5gwjh3g.js";import{g as De}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./fi4t5vltimyk5jia.js";import"./nv7zjskuxqbd0a8k.js";import"./em6xteal3laxzbp5.js";import"./bim6j1enukewtwft.js";import"./iv9cwo4pw9mxn1rf.js";import"./bfcxfvncw1c0blhg.js";import"./ndox4jgq2pedhhgi.js";import"./gy64pge8qevmvg7e.js";import"./n7si32a8uoeznh1u.js";import"./clcq5kxjm77x0raa.js";import"./d0g29t0qm74gluj7.js";import"./d7o4nful0h1qw8zk.js";import"./cdnu0xlioh6eeshn.js";import"./bk8slwxjkdlmxjxm.js";import"./fc2c76vpc3m2kj8q.js";import"./isqkn4xlzoktkvfr.js";import"./ipg3e8rb8w1bw4eb.js";import"./gnhjnh2n0u3gy6qx.js";import"./ejklrllfl9wcn2za.js";import"./ik8y7nlve9mzjttb.js";import"./isxemcalu9537a8n.js";import"./e0pswmo7irlt62pp.js";import"./nsxv1nyryaz0gxvd.js";import"./edbh3e4r4nwc2qmv.js";const z="oai/apps/canmoreSidebarWidth",Fe=.25,je=400,B=400;function q(e){return e-je}function S(e,a){return J(B,q(e),a??Fe*e)}function Me(){const e=_.useState(_.selectWindowWidth),a=S(e,se(O.DANGER_SECRET_FOLDERS_ONLY_getItem(z))),s=Y(),[t,n]=l.useState(a);l.useEffect(()=>{(t<B||t>q(e))&&n(S(e,t))},[e]);function d(u){n(T=>S(e,T+=u.delta.x))}function c(u){n(u),O.DANGER_SECRET_FOLDERS_ONLY_setItem(z,u)}function i(){const u=S(e,void 0);c(u)}const r=`calc(100vw - ${t}px)`;return s?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:r,viewportWidth:e,handleDrag:d,handleDoubleClick:i,persist:c}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function Y(e){const a=_.useState(_.selectWindowWidth);return(e??a)>1e3}const D="sharedCanvas";function Oe(){const[e,a]=Q(),s=e.get(D),t=ee();l.useEffect(()=>{const n=s&&me.createRemixTempTextdoc(s,t);if(!n)return;requestAnimationFrame(()=>{U(n)});const d=new URLSearchParams(e);d.delete(D),a(d);const c=new URL(window.location.href);c.searchParams.delete(D),history.replaceState(null,"",c)},[s,e,a,t])}const We="textdocId",ke=e=>{const s=new URLSearchParams(window.location.search).get(We),t=H(e,n=>I.findNode(n,({message:d})=>{const c=d.metadata?.canvas;return c?.create_source===he.HIVE&&(s?c?.textdoc_id===s:!0)})?.message.metadata?.canvas?.textdoc_id);l.useEffect(()=>{t&&requestAnimationFrame(()=>{U(t)})},[t])};function Le(e,a){let s;return a?.type===g.Textdoc?a.textdocId.startsWith(pe)||(s={type:"canvas_textdoc",id:a.textdocId}):a?.type===g.Kanzi&&(s={type:"canvas_kanzi",id:a.kanziTurnId}),fe(e,{promptMessage:{metadata:{open_in_canvas_view:s}}})}const K=({isFullScreen:e=!1,clientThreadId:a,focusedObject:s,onClose:t,isAnimating:n=!1,width:d})=>{const{setTargetedContent:c}=ge(),i=l.useRef(!1);if(l.useEffect(()=>(i.current&&c(void 0),i.current=!0,()=>{i.current=!1}),[s]),s==null)return null;switch(s.type){case g.Textdoc:return o.jsx(Re,{isFullScreen:e,onClose:t,clientThreadId:a,focusedTextdoc:s,isAnimating:n,width:d});case g.Kanzi:break;case g.ADAVisualization:return null}},Pe=300,ze=e=>{switch(e?.type){case g.Textdoc:return e.textdocId;case g.Kanzi:return null;default:return null}};function He({clientThreadId:e,isDisabled:a,disabledTypes:s}){const[t,n,d,c]=H(e,m=>[I.getRequestId(m),I.getConversationLastTurn(m),I.isMessageTurnEnded(m),I.getVariantIds(m).length>1],{disablePerfDetector:!0}),i=ae(t),r=xe(),u=V(),[T,h]=l.useMemo(()=>{if(n&&c)return[void 0,null];if(a===!0)return[void 0,null];let m;return!d&&n&&(m=ne(n.messageGroups,p=>p.type!==oe)),Ue({groupedMessage:m,currentlyFocusedObject:u,isRequestActive:i,latestTextdocId:r,disabledTypes:s})},[d,n,c,u,a,i,r,s]),w=h!=null,A=ze(h),N=Ce("canvas");l.useEffect(()=>{if(h&&T&&!ie()&&(N(),ve(h,T),h.type===g.Textdoc)){const{textdocId:m}=h,p=De(m);Te(document.getElementById(p))}},[w,A])}function Ue({groupedMessage:e,currentlyFocusedObject:a,isRequestActive:s,latestTextdocId:t,disabledTypes:n}){if(e?.type&&n.includes(e.type))return[void 0,null];switch(e?.type){case F.Canmore:{const[d,c]=e.messages;if(!we(d))break;const i=Ie(s,d,c??null),r=i.textdocId??t;if(r&&(i.function===be.CreateTextdoc?(i.content??"").length>Pe||i.status===k.WAITING:i.status===k.STREAMING))return[i.messageId,{type:g.Textdoc,textdocId:r}];break}case F.kanzi:break}return[void 0,null]}const E={type:"spring",bounce:.12,duration:.64},Ve={type:"spring",bounce:0,duration:.58},C={duration:0},Ge=({clientThreadId:e,focusedObject:a,onClose:s})=>{const{chatWidth:t,canvasWidthCalc:n,handleDrag:d,handleDoubleClick:c,persist:i}=Me(),r=j(),[u,T]=l.useState(!r),[h,w]=l.useState(!1),A=r?C:E,N=r?C:Ve,m=Ee(({rect:f})=>f),{windowHeight:p,windowWidth:b}=le(f=>f,{windowWidth:0,windowHeight:0});let x=m??{top:0,left:t,width:b-t,height:p},M=!1;if(m&&(x.top<0||x.top+x.height>p)){M=!0;const f={width:(b-t)*.75,height:p*.75};x={top:p/2-f.height/2,left:(b-t-f.width)/2+t,width:f.width,height:f.height}}const y=m?.borderRadius,R=_e(),X=R?.history!=null||R?.showChangesAtVersion!=null,Z=ue();return o.jsxs(o.Fragment,{children:[X&&o.jsx(Ne,{onClick:()=>Ae(R.textdocId),zIndexKey:"chatOverlay"}),o.jsxs(v.div,{initial:{marginInlineEnd:Z?-260:0},animate:{marginInlineEnd:0},transition:N,children:[o.jsx(v.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:r?C:{...E,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),o.jsx(v.div,{className:"relative z-20 h-full",style:{width:n},exit:{width:0},transition:r?C:{type:"spring",bounce:0,duration:.1}})]}),o.jsx(v.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden shadow-[0_0_18px_rgba(0,0,0,0.12)] dark:shadow-[0_0_18px_rgba(0,0,0,0.48)]",initial:{borderRadius:y,opacity:M?0:1,x:x.left,y:x.top,height:x.height,width:x.width},animate:{opacity:1,x:t,y:0,width:n,height:p,borderRadius:0},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:r?C:{opacity:{duration:.14,bounce:.1}},borderRadius:y},transition:h||r?C:E,onAnimationComplete:()=>T(!1),children:o.jsx(v.div,{className:"dark:border-token-border-light border-token-border-medium h-full overflow-hidden border-s",initial:{borderRadius:y},animate:{borderRadius:0},exit:{borderRadius:y},transition:A,children:o.jsxs("div",{className:"h-full",children:[o.jsx(v.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:r?C:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>w(!0),onPointerUp:()=>w(!1),onDrag:(f,$)=>d($),onDragEnd:()=>{w(!1),i(t)},onDoubleClick:()=>c()}),h&&o.jsx("div",{className:"absolute inset-0 z-10"}),o.jsx(K,{onClose:s,clientThreadId:e,isAnimating:!r&&u,focusedObject:a,width:b-t})]})})})]})},Be=l.memo(Ge),qe=({clientThreadId:e,focusedObject:a,onClose:s})=>{const t=j();return o.jsx(de,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:o.jsx(v.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:t?C:E,children:o.jsx(K,{isFullScreen:!0,clientThreadId:e,focusedObject:a,onClose:s})})})},Ye=({clientThreadId:e,overrideWidth:a,isAutoFocusDisabled:s=!1})=>{const t=V(),n=Y(a)&&!ce(Se,t?.type),d=j();He({clientThreadId:e,isDisabled:s,disabledTypes:d?[F.Canmore]:[]}),Oe(),ke(e);const c=l.useRef(!1);l.useEffect(()=>{c.current?G():c.current=!0},[e]);const i=t&&(n?o.jsx(Be,{clientThreadId:e,onClose:P,focusedObject:t},"canvas-sidebar"):o.jsx(qe,{clientThreadId:e,onClose:P,focusedObject:t},"canvas-modal"));l.useEffect(()=>{if(t)return L(u=>Le(u,t)),()=>L(null)},[t]);const r=i!=null;return l.useEffect(()=>(W.setActiveStageSidebar(r),()=>{r&&W.setActiveStageSidebar(!1)}),[r]),d?o.jsx("div",{children:i},e):o.jsx(te,{children:i},e)},St=e=>{const a=l.useRef(null);return o.jsx(re,{ref:a,onError:(s,t)=>{G(),setTimeout(()=>{a.current?.resetErrorBoundary()}),ye.logError("Error boundary hit",s,{componentStack:t})},name:"canmore-focused-view",children:o.jsx(Ye,{...e})})};export{St as CanvasFocusedViewManager};
//# sourceMappingURL=doanc9iggtbd4zdx.js.map
