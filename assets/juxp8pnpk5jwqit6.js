import{r as S,j as n}from"./lu2xqwqmjc95q6j6.js";import{C as G}from"./e91xke4veyr6vkag.js";import{D as J,a as K}from"./b5mk7g3hp5gwjh3g.js";import{T as Q,a as X,A as F,u as Y,i as Z,C as $,g as z}from"./oi1o55r1q4i3japb.js";import{C as tt,c as et}from"./nv7zjskuxqbd0a8k.js";import{C as V}from"./glo5fx5nh6p199c2.js";import{u as ot,a as rt,b as nt,c as k}from"./iv9cwo4pw9mxn1rf.js";import{C as it}from"./jy1u8exw8iz2slve.js";import{b as st,cy as lt,iE as M,iF as at}from"./rseqzngxzbdt1oxg.js";import{eb as ct}from"./hml6mmd5fyx85si7.js";import{u as mt}from"./em6xteal3laxzbp5.js";import"./ndox4jgq2pedhhgi.js";import"./ibcsr9sfusjfjjf0.js";import"./l1uu5qm215xg1y5k.js";import"./ohrnryaqpp1d2um7.js";import"./n7si32a8uoeznh1u.js";import"./clcq5kxjm77x0raa.js";import"./d0g29t0qm74gluj7.js";import"./d7o4nful0h1qw8zk.js";import"./cdnu0xlioh6eeshn.js";import"./gy64pge8qevmvg7e.js";import"./bk8slwxjkdlmxjxm.js";import"./fc2c76vpc3m2kj8q.js";import"./isqkn4xlzoktkvfr.js";import"./ipg3e8rb8w1bw4eb.js";import"./gnhjnh2n0u3gy6qx.js";import"./ejklrllfl9wcn2za.js";import"./ik8y7nlve9mzjttb.js";import"./isxemcalu9537a8n.js";import"./e0pswmo7irlt62pp.js";import"./nsxv1nyryaz0gxvd.js";import"./edbh3e4r4nwc2qmv.js";import"./k7qzfsghcibbkoqo.js";import"./fi4t5vltimyk5jia.js";import"./bim6j1enukewtwft.js";import"./bfcxfvncw1c0blhg.js";function dt(t,e){const r=t.doc.lineAt(e.from);return e.from===r.from&&e.to-1===r.to}function ut(t){const e=t.dom.querySelector(".cm-gutters");return e?e.offsetWidth:0}const ft=({onAddComment:t,isSendDisabled:e=!1,isWaitingForCommentResponse:r=!1})=>{const o=ot(),f=rt(),c=nt(),L=S.useCallback(i=>{const{height:m,width:d}=i,s=o();if(!f||!s)return null;const l=f.selection.asSingle();if(l.ranges.length===0)return null;const a=l.ranges[0],{empty:H,to:O}=a;let{head:p}=a;const{platform:R}=st();p=R==="web"?p:O;const g=p===O;let v=p;if(g&&dt(f,a)&&(v-=1),H)return null;const{left:C,top:x,bottom:N}=s.contentDOM.getBoundingClientRect(),{left:w,top:y,bottom:E}=ct(s.coordsAtPos(v,g?-1:1)),h=ut(s);function A(){if(g)return Math.max(w-C+h-d,h);let u=w-C+h;return u+d>c&&(u=-(d-c)),u}function W(u){const b=m*2,_=u.contentHeight-(E-N)>b&&window.innerHeight-E>b,B=E-x+8,I=y-x-m-8;return g&&_||I<0?{top:B,aboveOrBelow:F.BELOW}:{top:I,aboveOrBelow:F.ABOVE}}const j=W(s);return{left:A(),top:j.top,aboveOrBelow:j.aboveOrBelow,toolbarSize:i}},[f,o,c]),D=S.useCallback(()=>o()?.dom??null,[o]);return n.jsx(Q,{onAddComment:t,isWaitingForCommentResponse:r,isSendDisabled:e,toolbarType:X.CODE,getToolbarPosition:L,getEditorDom:D,getSelectionRange:()=>{const i=o();if(!i)return null;const{state:m}=i,d=m.selection.asSingle();if(d.ranges.length===0)return null;const s=d.ranges[0],{from:l,to:a}=s;return l==null||a==null?null:{from:l,to:a,sourceFrom:l,sourceTo:a}}})};function pt({diff:t}){return Y(t?.edits??[]),null}function gt(t,e,r){const o=r?z():0;return t<=1e3-o?t-(e?tt:0):t-(e?et:0)}const $t=({comments:t,currentlyStreamingLineIndex:e,isPreview:r=!1,isWaitingForCommentResponse:o=!1,isSendDisabled:f=!1,readonlyReason:c,isRequestActive:L=!1,language:D,value:i,textdocDiff:m,maxLength:d,onAcceleratorsExpandedChange:s,onAddComment:l,onAcceptComment:a,onDismissComment:H,onBlur:O,onSave:p,onChange:R,onCancelRequest:g,getStableCommentId:v=at,commentsMode:C=V.ENABLED,hideToolbar:x,hideAccelerators:N=!1,onSubmitAccelerator:w,modelCursor:y,codemirrorRef:E})=>{const h=S.useRef(null),A=lt(),[{width:W},j]=mt(),u=S.useRef(null),b=t.length>0,_=u.current,B=gt(W,b,Z(_)??!1),I=k(({commentingOn:T})=>T),U=k(({hoveredCommentId:T})=>T),P=k(({focusedCommentId:T})=>T);S.useEffect(()=>{h.current?.UNSAFE_setValue(i||"")},[i]);const q=W-B;return n.jsx("div",{className:it.code,ref:M(j,u),style:A&&r?{margin:"0 16px"}:{},children:n.jsxs(G,{id:"codemirror",comments:C===V.ALL_HIDDEN?void 0:t,commentingOn:I,currentlyStreamingLineIndex:e,hoveredCommentId:U,focusedCommentId:P,language:D,readonlyReason:c,onChange:R,maxLength:d,value:i,textdocDiff:m,editorRef:M(h,E),width:B,modelCursor:y,isPreview:r,hideLineNumbers:A&&r,onBlur:O,onSave:p,children:[n.jsxs(G.EditorChildren,{children:[!x&&n.jsx(ft,{onAddComment:l,isSendDisabled:f,isWaitingForCommentResponse:o}),C!==V.ALL_HIDDEN&&n.jsx("div",{className:b?"me-4":"",children:n.jsx($,{getStableCommentId:v,availableWidth:q,comments:t,commentsMode:C,onAddComment:l,onAcceptComment:a,onDismissComment:H,isWaitingForCommentResponse:o,isRequestActive:L,disableBlockComments:!0})})]}),n.jsxs(G.ContextChildren,{children:[m&&n.jsx(pt,{diff:m}),!N&&n.jsx(J,{isRequestActive:L,isVisuallyHidden:f||!!c?.isStreamingFromNative||c?.isReadonly&&!c.isStreaming,onSubmit:w,onCancel:g,actions:K,onExpandedChange:s})]})]})})};export{$t as CodeComposer};
//# sourceMappingURL=juxp8pnpk5jwqit6.js.map
